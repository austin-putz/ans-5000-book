<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.8.26">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>7&nbsp; Data Reshaping, Joining, and Iteration – Introduction to Data Science &amp; Statistics</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
html { -webkit-text-size-adjust: 100%; }
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<link href="../chapters/ch08-special_formats.html" rel="next">
<link href="../chapters/ch06-ggplot2_advanced.html" rel="prev">
<script src="../site_libs/quarto-html/quarto.js" type="module"></script>
<script src="../site_libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="../site_libs/quarto-html/axe/axe-check.js" type="module"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting-587c61ba64f3a5504c4d52d930310e48.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap-55dc6e3050e9289ed354a3a098ff1a6b.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<script src="../site_libs/quarto-diagram/mermaid.min.js"></script>
<script src="../site_libs/quarto-diagram/mermaid-init.js"></script>
<link href="../site_libs/quarto-diagram/mermaid.css" rel="stylesheet">


</head>

<body class="nav-sidebar docked quarto-light">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../chapters/ch01-foundations.html">Part 1: Introduction to Data Science</a></li><li class="breadcrumb-item"><a href="../chapters/ch07-tidyr_joins_purrr.html"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Data Reshaping, Joining, and Iteration</span></a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="Search" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation docked overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="../">Introduction to Data Science &amp; Statistics</a> 
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Welcome</span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true">
 <span class="menu-text">Part 1: Introduction to Data Science</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/ch01-foundations.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Foundations of Data Science &amp; Best Practices</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/ch02-r_rstudio_reading_data.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Getting Started with R, RStudio, and Reading Data</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/ch03-data_types_strings_dplyr.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Data Types, Strings, and Introduction to dplyr</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/ch04-dplyr.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Data Manipulation with dplyr</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/ch05-ggplot2_intro.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Introduction to Data Visualization with ggplot2</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/ch06-ggplot2_advanced.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Advanced ggplot2 and Multi-Panel Plots</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/ch07-tidyr_joins_purrr.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Data Reshaping, Joining, and Iteration</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/ch08-special_formats.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Special Data Formats, Integration, and Course Wrap-up</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="true">
 <span class="menu-text">Part 2: Introduction to Statistics</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/ch09-statistical_foundations.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">Week 9: Statistical Foundations and Study Design</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/ch10-descriptive_statistics.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">Week 10: Descriptive Statistics and Exploratory Data Analysis</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/ch11-probability_distributions.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">11</span>&nbsp; <span class="chapter-title">Week 11: Probability Distributions and Introduction to Inference</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/ch12-hypothesis_testing.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">12</span>&nbsp; <span class="chapter-title">Week 12: Hypothesis Testing Fundamentals</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/ch13-anova.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">13</span>&nbsp; <span class="chapter-title">Week 13: Analysis of Variance (ANOVA)</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/ch14-categorical_data.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">14</span>&nbsp; <span class="chapter-title">Week 14: Categorical Data Analysis</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/ch15-linear_regression.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">15</span>&nbsp; <span class="chapter-title">Week 15: Simple Linear Regression</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/ch16-multiple_regression.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">16</span>&nbsp; <span class="chapter-title">Week 16: Multiple Regression &amp; Course Integration</span></span></a>
  </div>
</li>
      </ul>
  </li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#learning-objectives" id="toc-learning-objectives" class="nav-link active" data-scroll-target="#learning-objectives"><span class="header-section-number">7.1</span> Learning Objectives</a></li>
  <li><a href="#introduction" id="toc-introduction" class="nav-link" data-scroll-target="#introduction"><span class="header-section-number">7.2</span> Introduction</a>
  <ul class="collapse">
  <li><a href="#setup" id="toc-setup" class="nav-link" data-scroll-target="#setup"><span class="header-section-number">7.2.1</span> Setup</a></li>
  </ul></li>
  <li><a href="#tidy-data-principles" id="toc-tidy-data-principles" class="nav-link" data-scroll-target="#tidy-data-principles"><span class="header-section-number">7.3</span> Tidy Data Principles</a>
  <ul class="collapse">
  <li><a href="#what-is-tidy-data" id="toc-what-is-tidy-data" class="nav-link" data-scroll-target="#what-is-tidy-data"><span class="header-section-number">7.3.1</span> What is Tidy Data?</a></li>
  <li><a href="#tidy-vs-untidy-data" id="toc-tidy-vs-untidy-data" class="nav-link" data-scroll-target="#tidy-vs-untidy-data"><span class="header-section-number">7.3.2</span> Tidy vs Untidy Data</a></li>
  <li><a href="#common-messy-data-problems" id="toc-common-messy-data-problems" class="nav-link" data-scroll-target="#common-messy-data-problems"><span class="header-section-number">7.3.3</span> Common Messy Data Problems</a></li>
  </ul></li>
  <li><a href="#data-reshaping-with-tidyr" id="toc-data-reshaping-with-tidyr" class="nav-link" data-scroll-target="#data-reshaping-with-tidyr"><span class="header-section-number">7.4</span> Data Reshaping with tidyr</a>
  <ul class="collapse">
  <li><a href="#pivot_longer-wide-to-long" id="toc-pivot_longer-wide-to-long" class="nav-link" data-scroll-target="#pivot_longer-wide-to-long"><span class="header-section-number">7.4.1</span> <code>pivot_longer()</code>: Wide to Long</a></li>
  <li><a href="#pivot_wider-long-to-wide" id="toc-pivot_wider-long-to-wide" class="nav-link" data-scroll-target="#pivot_wider-long-to-wide"><span class="header-section-number">7.4.2</span> <code>pivot_wider()</code>: Long to Wide</a></li>
  <li><a href="#separate-split-one-column-into-many" id="toc-separate-split-one-column-into-many" class="nav-link" data-scroll-target="#separate-split-one-column-into-many"><span class="header-section-number">7.4.3</span> <code>separate()</code>: Split One Column into Many</a></li>
  <li><a href="#unite-combine-columns-into-one" id="toc-unite-combine-columns-into-one" class="nav-link" data-scroll-target="#unite-combine-columns-into-one"><span class="header-section-number">7.4.4</span> <code>unite()</code>: Combine Columns into One</a></li>
  <li><a href="#when-to-use-each-function" id="toc-when-to-use-each-function" class="nav-link" data-scroll-target="#when-to-use-each-function"><span class="header-section-number">7.4.5</span> When to Use Each Function</a></li>
  </ul></li>
  <li><a href="#joining-datasets" id="toc-joining-datasets" class="nav-link" data-scroll-target="#joining-datasets"><span class="header-section-number">7.5</span> Joining Datasets</a>
  <ul class="collapse">
  <li><a href="#relational-data-example" id="toc-relational-data-example" class="nav-link" data-scroll-target="#relational-data-example"><span class="header-section-number">7.5.1</span> Relational Data Example</a></li>
  <li><a href="#types-of-joins" id="toc-types-of-joins" class="nav-link" data-scroll-target="#types-of-joins"><span class="header-section-number">7.5.2</span> Types of Joins</a></li>
  <li><a href="#left_join-keep-all-left-rows" id="toc-left_join-keep-all-left-rows" class="nav-link" data-scroll-target="#left_join-keep-all-left-rows"><span class="header-section-number">7.5.3</span> <code>left_join()</code>: Keep All Left Rows</a></li>
  <li><a href="#right_join-keep-all-right-rows" id="toc-right_join-keep-all-right-rows" class="nav-link" data-scroll-target="#right_join-keep-all-right-rows"><span class="header-section-number">7.5.4</span> <code>right_join()</code>: Keep All Right Rows</a></li>
  <li><a href="#inner_join-keep-only-matching-rows" id="toc-inner_join-keep-only-matching-rows" class="nav-link" data-scroll-target="#inner_join-keep-only-matching-rows"><span class="header-section-number">7.5.5</span> <code>inner_join()</code>: Keep Only Matching Rows</a></li>
  <li><a href="#full_join-keep-all-rows-from-both" id="toc-full_join-keep-all-rows-from-both" class="nav-link" data-scroll-target="#full_join-keep-all-rows-from-both"><span class="header-section-number">7.5.6</span> <code>full_join()</code>: Keep All Rows from Both</a></li>
  <li><a href="#joining-with-multiple-keys" id="toc-joining-with-multiple-keys" class="nav-link" data-scroll-target="#joining-with-multiple-keys"><span class="header-section-number">7.5.7</span> Joining with Multiple Keys</a></li>
  <li><a href="#joining-with-different-column-names" id="toc-joining-with-different-column-names" class="nav-link" data-scroll-target="#joining-with-different-column-names"><span class="header-section-number">7.5.8</span> Joining with Different Column Names</a></li>
  <li><a href="#filtering-joins-filter-rows-dont-add-columns" id="toc-filtering-joins-filter-rows-dont-add-columns" class="nav-link" data-scroll-target="#filtering-joins-filter-rows-dont-add-columns"><span class="header-section-number">7.5.9</span> Filtering Joins: Filter Rows (Don’t Add Columns)</a></li>
  <li><a href="#join-summary-table" id="toc-join-summary-table" class="nav-link" data-scroll-target="#join-summary-table"><span class="header-section-number">7.5.10</span> Join Summary Table</a></li>
  <li><a href="#common-join-problems-and-solutions" id="toc-common-join-problems-and-solutions" class="nav-link" data-scroll-target="#common-join-problems-and-solutions"><span class="header-section-number">7.5.11</span> Common Join Problems and Solutions</a></li>
  <li><a href="#real-world-example-combining-multiple-tables" id="toc-real-world-example-combining-multiple-tables" class="nav-link" data-scroll-target="#real-world-example-combining-multiple-tables"><span class="header-section-number">7.5.12</span> Real-World Example: Combining Multiple Tables</a></li>
  </ul></li>
  <li><a href="#binding-datasets" id="toc-binding-datasets" class="nav-link" data-scroll-target="#binding-datasets"><span class="header-section-number">7.6</span> Binding Datasets</a>
  <ul class="collapse">
  <li><a href="#bind_rows-stack-datasets-vertically" id="toc-bind_rows-stack-datasets-vertically" class="nav-link" data-scroll-target="#bind_rows-stack-datasets-vertically"><span class="header-section-number">7.6.1</span> <code>bind_rows()</code>: Stack Datasets Vertically</a></li>
  <li><a href="#bind_cols-attach-datasets-horizontally" id="toc-bind_cols-attach-datasets-horizontally" class="nav-link" data-scroll-target="#bind_cols-attach-datasets-horizontally"><span class="header-section-number">7.6.2</span> <code>bind_cols()</code>: Attach Datasets Horizontally</a></li>
  <li><a href="#when-to-use-binding-vs-joining" id="toc-when-to-use-binding-vs-joining" class="nav-link" data-scroll-target="#when-to-use-binding-vs-joining"><span class="header-section-number">7.6.3</span> When to Use Binding vs Joining</a></li>
  </ul></li>
  <li><a href="#iteration-with-purrr" id="toc-iteration-with-purrr" class="nav-link" data-scroll-target="#iteration-with-purrr"><span class="header-section-number">7.7</span> Iteration with purrr</a>
  <ul class="collapse">
  <li><a href="#why-use-map-instead-of-loops" id="toc-why-use-map-instead-of-loops" class="nav-link" data-scroll-target="#why-use-map-instead-of-loops"><span class="header-section-number">7.7.1</span> Why Use <code>map()</code> Instead of Loops?</a></li>
  <li><a href="#basic-map-functions" id="toc-basic-map-functions" class="nav-link" data-scroll-target="#basic-map-functions"><span class="header-section-number">7.7.2</span> Basic <code>map()</code> Functions</a></li>
  <li><a href="#map-with-data-frames" id="toc-map-with-data-frames" class="nav-link" data-scroll-target="#map-with-data-frames"><span class="header-section-number">7.7.3</span> <code>map()</code> with Data Frames</a></li>
  <li><a href="#anonymous-functions-in-map" id="toc-anonymous-functions-in-map" class="nav-link" data-scroll-target="#anonymous-functions-in-map"><span class="header-section-number">7.7.4</span> Anonymous Functions in <code>map()</code></a></li>
  <li><a href="#map2-iterate-over-two-inputs" id="toc-map2-iterate-over-two-inputs" class="nav-link" data-scroll-target="#map2-iterate-over-two-inputs"><span class="header-section-number">7.7.5</span> <code>map2()</code>: Iterate Over Two Inputs</a></li>
  <li><a href="#pmap-iterate-over-many-inputs" id="toc-pmap-iterate-over-many-inputs" class="nav-link" data-scroll-target="#pmap-iterate-over-many-inputs"><span class="header-section-number">7.7.6</span> <code>pmap()</code>: Iterate Over Many Inputs</a></li>
  <li><a href="#practical-example-reading-multiple-files" id="toc-practical-example-reading-multiple-files" class="nav-link" data-scroll-target="#practical-example-reading-multiple-files"><span class="header-section-number">7.7.7</span> Practical Example: Reading Multiple Files</a></li>
  <li><a href="#handling-errors-with-safely-and-possibly" id="toc-handling-errors-with-safely-and-possibly" class="nav-link" data-scroll-target="#handling-errors-with-safely-and-possibly"><span class="header-section-number">7.7.8</span> Handling Errors with <code>safely()</code> and <code>possibly()</code></a></li>
  </ul></li>
  <li><a href="#list-columns-and-nested-data" id="toc-list-columns-and-nested-data" class="nav-link" data-scroll-target="#list-columns-and-nested-data"><span class="header-section-number">7.8</span> List Columns and Nested Data</a>
  <ul class="collapse">
  <li><a href="#creating-nested-data" id="toc-creating-nested-data" class="nav-link" data-scroll-target="#creating-nested-data"><span class="header-section-number">7.8.1</span> Creating Nested Data</a></li>
  <li><a href="#working-with-nested-data" id="toc-working-with-nested-data" class="nav-link" data-scroll-target="#working-with-nested-data"><span class="header-section-number">7.8.2</span> Working with Nested Data</a></li>
  <li><a href="#fitting-models-to-nested-data" id="toc-fitting-models-to-nested-data" class="nav-link" data-scroll-target="#fitting-models-to-nested-data"><span class="header-section-number">7.8.3</span> Fitting Models to Nested Data</a></li>
  <li><a href="#unnesting" id="toc-unnesting" class="nav-link" data-scroll-target="#unnesting"><span class="header-section-number">7.8.4</span> Unnesting</a></li>
  </ul></li>
  <li><a href="#summary" id="toc-summary" class="nav-link" data-scroll-target="#summary"><span class="header-section-number">7.9</span> Summary</a>
  <ul class="collapse">
  <li><a href="#data-reshaping-tidyr" id="toc-data-reshaping-tidyr" class="nav-link" data-scroll-target="#data-reshaping-tidyr"><span class="header-section-number">7.9.1</span> Data Reshaping (tidyr)</a></li>
  <li><a href="#joining-datasets-1" id="toc-joining-datasets-1" class="nav-link" data-scroll-target="#joining-datasets-1"><span class="header-section-number">7.9.2</span> Joining Datasets</a></li>
  <li><a href="#iteration-purrr" id="toc-iteration-purrr" class="nav-link" data-scroll-target="#iteration-purrr"><span class="header-section-number">7.9.3</span> Iteration (purrr)</a></li>
  </ul></li>
  <li><a href="#week-7-homework-multi-table-data-integration" id="toc-week-7-homework-multi-table-data-integration" class="nav-link" data-scroll-target="#week-7-homework-multi-table-data-integration"><span class="header-section-number">7.10</span> Week 7 Homework: Multi-Table Data Integration</a>
  <ul class="collapse">
  <li><a href="#assignment-overview" id="toc-assignment-overview" class="nav-link" data-scroll-target="#assignment-overview"><span class="header-section-number">7.10.1</span> Assignment Overview</a></li>
  <li><a href="#part-1-data-generation-0-points-but-required" id="toc-part-1-data-generation-0-points-but-required" class="nav-link" data-scroll-target="#part-1-data-generation-0-points-but-required"><span class="header-section-number">7.10.2</span> Part 1: Data Generation (0 points, but required)</a></li>
  <li><a href="#part-2-data-reshaping-25-points" id="toc-part-2-data-reshaping-25-points" class="nav-link" data-scroll-target="#part-2-data-reshaping-25-points"><span class="header-section-number">7.10.3</span> Part 2: Data Reshaping (25 points)</a></li>
  <li><a href="#part-3-joining-datasets-30-points" id="toc-part-3-joining-datasets-30-points" class="nav-link" data-scroll-target="#part-3-joining-datasets-30-points"><span class="header-section-number">7.10.4</span> Part 3: Joining Datasets (30 points)</a></li>
  <li><a href="#part-4-complex-joins-20-points" id="toc-part-4-complex-joins-20-points" class="nav-link" data-scroll-target="#part-4-complex-joins-20-points"><span class="header-section-number">7.10.5</span> Part 4: Complex Joins (20 points)</a></li>
  <li><a href="#part-5-iteration-with-purrr-20-points" id="toc-part-5-iteration-with-purrr-20-points" class="nav-link" data-scroll-target="#part-5-iteration-with-purrr-20-points"><span class="header-section-number">7.10.6</span> Part 5: Iteration with purrr (20 points)</a></li>
  <li><a href="#part-6-reflection-5-points" id="toc-part-6-reflection-5-points" class="nav-link" data-scroll-target="#part-6-reflection-5-points"><span class="header-section-number">7.10.7</span> Part 6: Reflection (5 points)</a></li>
  <li><a href="#recommended-yaml" id="toc-recommended-yaml" class="nav-link" data-scroll-target="#recommended-yaml"><span class="header-section-number">7.10.8</span> Recommended YAML</a></li>
  <li><a href="#grading-rubric" id="toc-grading-rubric" class="nav-link" data-scroll-target="#grading-rubric"><span class="header-section-number">7.10.9</span> Grading Rubric</a></li>
  <li><a href="#bonus-10-points" id="toc-bonus-10-points" class="nav-link" data-scroll-target="#bonus-10-points"><span class="header-section-number">7.10.10</span> Bonus (+10 points)</a></li>
  </ul></li>
  <li><a href="#additional-resources" id="toc-additional-resources" class="nav-link" data-scroll-target="#additional-resources"><span class="header-section-number">7.11</span> Additional Resources</a>
  <ul class="collapse">
  <li><a href="#required-reading" id="toc-required-reading" class="nav-link" data-scroll-target="#required-reading"><span class="header-section-number">7.11.1</span> Required Reading</a></li>
  <li><a href="#optional-reading" id="toc-optional-reading" class="nav-link" data-scroll-target="#optional-reading"><span class="header-section-number">7.11.2</span> Optional Reading</a></li>
  <li><a href="#videos" id="toc-videos" class="nav-link" data-scroll-target="#videos"><span class="header-section-number">7.11.3</span> Videos</a></li>
  <li><a href="#cheat-sheets" id="toc-cheat-sheets" class="nav-link" data-scroll-target="#cheat-sheets"><span class="header-section-number">7.11.4</span> Cheat Sheets</a></li>
  <li><a href="#interactive-learning" id="toc-interactive-learning" class="nav-link" data-scroll-target="#interactive-learning"><span class="header-section-number">7.11.5</span> Interactive Learning</a></li>
  <li><a href="#useful-websites" id="toc-useful-websites" class="nav-link" data-scroll-target="#useful-websites"><span class="header-section-number">7.11.6</span> Useful Websites</a></li>
  </ul></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default"><nav class="quarto-page-breadcrumbs quarto-title-breadcrumbs d-none d-lg-block" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../chapters/ch01-foundations.html">Part 1: Introduction to Data Science</a></li><li class="breadcrumb-item"><a href="../chapters/ch07-tidyr_joins_purrr.html"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Data Reshaping, Joining, and Iteration</span></a></li></ol></nav>
<div class="quarto-title">
<div class="quarto-title-block"><div><h1 class="title"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Data Reshaping, Joining, and Iteration</span></h1><button type="button" class="btn code-tools-button" id="quarto-code-tools-source"><i class="bi"></i> Code</button></div></div>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<section id="learning-objectives" class="level2" data-number="7.1">
<h2 data-number="7.1" class="anchored" data-anchor-id="learning-objectives"><span class="header-section-number">7.1</span> Learning Objectives</h2>
<p>By the end of this chapter, you will be able to:</p>
<ol type="1">
<li>Understand and apply tidy data principles to organize datasets effectively</li>
<li>Reshape data between wide and long formats using <code>pivot_longer()</code> and <code>pivot_wider()</code></li>
<li>Split and combine columns using <code>separate()</code> and <code>unite()</code></li>
<li>Join multiple datasets using SQL-style joins (<code>left_join()</code>, <code>inner_join()</code>, etc.)</li>
<li>Understand when to use different join types and filtering joins</li>
<li>Bind datasets together with <code>bind_rows()</code> and <code>bind_cols()</code></li>
<li>Use functional programming with <code>purrr::map()</code> for iteration</li>
<li>Work with list columns and nested data structures</li>
</ol>
<hr>
</section>
<section id="introduction" class="level2" data-number="7.2">
<h2 data-number="7.2" class="anchored" data-anchor-id="introduction"><span class="header-section-number">7.2</span> Introduction</h2>
<p>In previous chapters, you learned to manipulate single datasets with dplyr. Real-world analysis often requires: - <strong>Reshaping</strong> data between different formats - <strong>Combining</strong> multiple related datasets - <strong>Iterating</strong> operations across many groups or files</p>
<p>This chapter teaches these essential data wrangling skills using <code>tidyr</code> for reshaping and <code>purrr</code> for iteration.</p>
<section id="setup" class="level3" data-number="7.2.1">
<h3 data-number="7.2.1" class="anchored" data-anchor-id="setup"><span class="header-section-number">7.2.1</span> Setup</h3>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)  <span class="co"># Includes tidyr, dplyr, purrr</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(readxl)     <span class="co"># For reading Excel files</span></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Set default theme for plots</span></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="fu">theme_set</span>(<span class="fu">theme_minimal</span>())</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<hr>
</section>
</section>
<section id="tidy-data-principles" class="level2" data-number="7.3">
<h2 data-number="7.3" class="anchored" data-anchor-id="tidy-data-principles"><span class="header-section-number">7.3</span> Tidy Data Principles</h2>
<section id="what-is-tidy-data" class="level3" data-number="7.3.1">
<h3 data-number="7.3.1" class="anchored" data-anchor-id="what-is-tidy-data"><span class="header-section-number">7.3.1</span> What is Tidy Data?</h3>
<p><strong>Tidy data</strong> follows three interrelated rules:</p>
<ol type="1">
<li><strong>Each variable forms a column</strong></li>
<li><strong>Each observation forms a row</strong></li>
<li><strong>Each type of observational unit forms a table</strong></li>
</ol>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
<span class="screen-reader-only">Note</span>Hadley Wickham’s Tidy Data
</div>
</div>
<div class="callout-body-container callout-body">
<p>The concept of tidy data comes from Hadley Wickham’s 2014 paper in the <em>Journal of Statistical Software</em>. Tidy data makes analysis easier because: - Variables are easy to access as columns - Observations are easy to filter as rows - Most tidyverse functions expect tidy data</p>
</div>
</div>
</section>
<section id="tidy-vs-untidy-data" class="level3" data-number="7.3.2">
<h3 data-number="7.3.2" class="anchored" data-anchor-id="tidy-vs-untidy-data"><span class="header-section-number">7.3.2</span> Tidy vs Untidy Data</h3>
<p><strong>Example 1: Animal weight measurements</strong></p>
<p><strong>Untidy (wide format)</strong>:</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Each time point is a separate column</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>untidy_weights <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">animal_id =</span> <span class="fu">c</span>(<span class="st">"A001"</span>, <span class="st">"A002"</span>, <span class="st">"A003"</span>),</span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">week_0 =</span> <span class="fu">c</span>(<span class="dv">45</span>, <span class="dv">48</span>, <span class="dv">43</span>),</span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">week_4 =</span> <span class="fu">c</span>(<span class="dv">52</span>, <span class="dv">54</span>, <span class="dv">50</span>),</span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">week_8 =</span> <span class="fu">c</span>(<span class="dv">58</span>, <span class="dv">61</span>, <span class="dv">56</span>),</span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">week_12 =</span> <span class="fu">c</span>(<span class="dv">64</span>, <span class="dv">67</span>, <span class="dv">62</span>)</span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a>untidy_weights</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 5
  animal_id week_0 week_4 week_8 week_12
  &lt;chr&gt;      &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;   &lt;dbl&gt;
1 A001          45     52     58      64
2 A002          48     54     61      67
3 A003          43     50     56      62</code></pre>
</div>
</div>
<p><strong>Tidy (long format)</strong>:</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Each observation (animal × time) is a separate row</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>tidy_weights <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">animal_id =</span> <span class="fu">rep</span>(<span class="fu">c</span>(<span class="st">"A001"</span>, <span class="st">"A002"</span>, <span class="st">"A003"</span>), <span class="at">each =</span> <span class="dv">4</span>),</span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">week =</span> <span class="fu">rep</span>(<span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">4</span>, <span class="dv">8</span>, <span class="dv">12</span>), <span class="at">times =</span> <span class="dv">3</span>),</span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">weight_kg =</span> <span class="fu">c</span>(<span class="dv">45</span>, <span class="dv">52</span>, <span class="dv">58</span>, <span class="dv">64</span>,  <span class="co"># A001</span></span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a>                <span class="dv">48</span>, <span class="dv">54</span>, <span class="dv">61</span>, <span class="dv">67</span>,  <span class="co"># A002</span></span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a>                <span class="dv">43</span>, <span class="dv">50</span>, <span class="dv">56</span>, <span class="dv">62</span>)  <span class="co"># A003</span></span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a>tidy_weights</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 12 × 3
   animal_id  week weight_kg
   &lt;chr&gt;     &lt;dbl&gt;     &lt;dbl&gt;
 1 A001          0        45
 2 A001          4        52
 3 A001          8        58
 4 A001         12        64
 5 A002          0        48
 6 A002          4        54
 7 A002          8        61
 8 A002         12        67
 9 A003          0        43
10 A003          4        50
11 A003          8        56
12 A003         12        62</code></pre>
</div>
</div>
<p><strong>Why is tidy better?</strong></p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Easy to plot with ggplot2</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(tidy_weights, <span class="fu">aes</span>(<span class="at">x =</span> week, <span class="at">y =</span> weight_kg, <span class="at">color =</span> animal_id)) <span class="sc">+</span></span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">linewidth =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">size =</span> <span class="dv">3</span>) <span class="sc">+</span></span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Animal Growth Curves"</span>,</span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">"Week"</span>,</span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">"Weight (kg)"</span>,</span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a>       <span class="at">color =</span> <span class="st">"Animal ID"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="ch07-tidyr_joins_purrr_files/figure-html/unnamed-chunk-4-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Easy to calculate summaries</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>tidy_weights <span class="sc">%&gt;%</span></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(week) <span class="sc">%&gt;%</span></span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(</span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">mean_weight =</span> <span class="fu">mean</span>(weight_kg),</span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">sd_weight =</span> <span class="fu">sd</span>(weight_kg)</span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a>  )</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 4 × 3
   week mean_weight sd_weight
  &lt;dbl&gt;       &lt;dbl&gt;     &lt;dbl&gt;
1     0        45.3      2.52
2     4        52        2   
3     8        58.3      2.52
4    12        64.3      2.52</code></pre>
</div>
</div>
</section>
<section id="common-messy-data-problems" class="level3" data-number="7.3.3">
<h3 data-number="7.3.3" class="anchored" data-anchor-id="common-messy-data-problems"><span class="header-section-number">7.3.3</span> Common Messy Data Problems</h3>
<ol type="1">
<li><strong>Column headers are values, not variable names</strong> (like <code>week_0</code>, <code>week_4</code>)</li>
<li><strong>Multiple variables in one column</strong> (like “Holstein-Male”)</li>
<li><strong>Variables stored in both rows and columns</strong></li>
<li><strong>Multiple types of observational units in the same table</strong></li>
<li><strong>Single observational unit stored in multiple tables</strong></li>
</ol>
<p>This chapter teaches how to fix these problems.</p>
<hr>
</section>
</section>
<section id="data-reshaping-with-tidyr" class="level2" data-number="7.4">
<h2 data-number="7.4" class="anchored" data-anchor-id="data-reshaping-with-tidyr"><span class="header-section-number">7.4</span> Data Reshaping with tidyr</h2>
<section id="pivot_longer-wide-to-long" class="level3" data-number="7.4.1">
<h3 data-number="7.4.1" class="anchored" data-anchor-id="pivot_longer-wide-to-long"><span class="header-section-number">7.4.1</span> <code>pivot_longer()</code>: Wide to Long</h3>
<p><code>pivot_longer()</code> transforms wide data (many columns) into long data (many rows).</p>
<p><strong>Basic syntax</strong>:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="fu">pivot_longer</span>(</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>  data,</span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">cols =</span> <span class="sc">&lt;</span>columns to pivot<span class="sc">&gt;</span>,</span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">names_to =</span> <span class="st">"&lt;name for new column with old column names&gt;"</span>,</span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">values_to =</span> <span class="st">"&lt;name for new column with values&gt;"</span></span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<section id="example-pivoting-weight-measurements" class="level4" data-number="7.4.1.1">
<h4 data-number="7.4.1.1" class="anchored" data-anchor-id="example-pivoting-weight-measurements"><span class="header-section-number">7.4.1.1</span> Example: Pivoting Weight Measurements</h4>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Start with wide format</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>wide_weights <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">animal_id =</span> <span class="fu">c</span>(<span class="st">"A001"</span>, <span class="st">"A002"</span>, <span class="st">"A003"</span>),</span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">breed =</span> <span class="fu">c</span>(<span class="st">"Holstein"</span>, <span class="st">"Jersey"</span>, <span class="st">"Angus"</span>),</span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">week_0 =</span> <span class="fu">c</span>(<span class="dv">45</span>, <span class="dv">42</span>, <span class="dv">48</span>),</span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">week_4 =</span> <span class="fu">c</span>(<span class="dv">52</span>, <span class="dv">48</span>, <span class="dv">54</span>),</span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">week_8 =</span> <span class="fu">c</span>(<span class="dv">58</span>, <span class="dv">54</span>, <span class="dv">61</span>)</span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true" tabindex="-1"></a>wide_weights</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 5
  animal_id breed    week_0 week_4 week_8
  &lt;chr&gt;     &lt;chr&gt;     &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;
1 A001      Holstein     45     52     58
2 A002      Jersey       42     48     54
3 A003      Angus        48     54     61</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Pivot to long format</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>long_weights <span class="ot">&lt;-</span> wide_weights <span class="sc">%&gt;%</span></span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(</span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">cols =</span> <span class="fu">starts_with</span>(<span class="st">"week"</span>),</span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">names_to =</span> <span class="st">"time_point"</span>,</span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">values_to =</span> <span class="st">"weight_kg"</span></span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a>long_weights</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 9 × 4
  animal_id breed    time_point weight_kg
  &lt;chr&gt;     &lt;chr&gt;    &lt;chr&gt;          &lt;dbl&gt;
1 A001      Holstein week_0            45
2 A001      Holstein week_4            52
3 A001      Holstein week_8            58
4 A002      Jersey   week_0            42
5 A002      Jersey   week_4            48
6 A002      Jersey   week_8            54
7 A003      Angus    week_0            48
8 A003      Angus    week_4            54
9 A003      Angus    week_8            61</code></pre>
</div>
</div>
</section>
<section id="selecting-columns-to-pivot" class="level4" data-number="7.4.1.2">
<h4 data-number="7.4.1.2" class="anchored" data-anchor-id="selecting-columns-to-pivot"><span class="header-section-number">7.4.1.2</span> Selecting Columns to Pivot</h4>
<p>Multiple ways to specify which columns to pivot:</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="co"># By name</span></span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>wide_weights <span class="sc">%&gt;%</span></span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(</span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">cols =</span> <span class="fu">c</span>(week_0, week_4, week_8),</span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">names_to =</span> <span class="st">"time_point"</span>,</span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">values_to =</span> <span class="st">"weight_kg"</span></span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a>  )</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 9 × 4
  animal_id breed    time_point weight_kg
  &lt;chr&gt;     &lt;chr&gt;    &lt;chr&gt;          &lt;dbl&gt;
1 A001      Holstein week_0            45
2 A001      Holstein week_4            52
3 A001      Holstein week_8            58
4 A002      Jersey   week_0            42
5 A002      Jersey   week_4            48
6 A002      Jersey   week_8            54
7 A003      Angus    week_0            48
8 A003      Angus    week_4            54
9 A003      Angus    week_8            61</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="co"># By position</span></span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>wide_weights <span class="sc">%&gt;%</span></span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(</span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">cols =</span> <span class="dv">3</span><span class="sc">:</span><span class="dv">5</span>,</span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">names_to =</span> <span class="st">"time_point"</span>,</span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">values_to =</span> <span class="st">"weight_kg"</span></span>
<span id="cb16-7"><a href="#cb16-7" aria-hidden="true" tabindex="-1"></a>  )</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 9 × 4
  animal_id breed    time_point weight_kg
  &lt;chr&gt;     &lt;chr&gt;    &lt;chr&gt;          &lt;dbl&gt;
1 A001      Holstein week_0            45
2 A001      Holstein week_4            52
3 A001      Holstein week_8            58
4 A002      Jersey   week_0            42
5 A002      Jersey   week_4            48
6 A002      Jersey   week_8            54
7 A003      Angus    week_0            48
8 A003      Angus    week_4            54
9 A003      Angus    week_8            61</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Everything except ID columns</span></span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>wide_weights <span class="sc">%&gt;%</span></span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(</span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">cols =</span> <span class="sc">-</span><span class="fu">c</span>(animal_id, breed),</span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">names_to =</span> <span class="st">"time_point"</span>,</span>
<span id="cb18-6"><a href="#cb18-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">values_to =</span> <span class="st">"weight_kg"</span></span>
<span id="cb18-7"><a href="#cb18-7" aria-hidden="true" tabindex="-1"></a>  )</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 9 × 4
  animal_id breed    time_point weight_kg
  &lt;chr&gt;     &lt;chr&gt;    &lt;chr&gt;          &lt;dbl&gt;
1 A001      Holstein week_0            45
2 A001      Holstein week_4            52
3 A001      Holstein week_8            58
4 A002      Jersey   week_0            42
5 A002      Jersey   week_4            48
6 A002      Jersey   week_8            54
7 A003      Angus    week_0            48
8 A003      Angus    week_4            54
9 A003      Angus    week_8            61</code></pre>
</div>
</div>
</section>
<section id="cleaning-column-names-during-pivot" class="level4" data-number="7.4.1.3">
<h4 data-number="7.4.1.3" class="anchored" data-anchor-id="cleaning-column-names-during-pivot"><span class="header-section-number">7.4.1.3</span> Cleaning Column Names During Pivot</h4>
<p>Use <code>names_prefix</code> to remove prefixes and <code>names_transform</code> to change types:</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Remove "week_" prefix and convert to numeric</span></span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>wide_weights <span class="sc">%&gt;%</span></span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(</span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">cols =</span> <span class="fu">starts_with</span>(<span class="st">"week"</span>),</span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">names_to =</span> <span class="st">"week"</span>,</span>
<span id="cb20-6"><a href="#cb20-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">values_to =</span> <span class="st">"weight_kg"</span>,</span>
<span id="cb20-7"><a href="#cb20-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">names_prefix =</span> <span class="st">"week_"</span>,</span>
<span id="cb20-8"><a href="#cb20-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">names_transform =</span> <span class="fu">list</span>(<span class="at">week =</span> as.integer)</span>
<span id="cb20-9"><a href="#cb20-9" aria-hidden="true" tabindex="-1"></a>  )</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 9 × 4
  animal_id breed     week weight_kg
  &lt;chr&gt;     &lt;chr&gt;    &lt;int&gt;     &lt;dbl&gt;
1 A001      Holstein     0        45
2 A001      Holstein     4        52
3 A001      Holstein     8        58
4 A002      Jersey       0        42
5 A002      Jersey       4        48
6 A002      Jersey       8        54
7 A003      Angus        0        48
8 A003      Angus        4        54
9 A003      Angus        8        61</code></pre>
</div>
</div>
</section>
<section id="multiple-value-columns" class="level4" data-number="7.4.1.4">
<h4 data-number="7.4.1.4" class="anchored" data-anchor-id="multiple-value-columns"><span class="header-section-number">7.4.1.4</span> Multiple Value Columns</h4>
<p>What if you have multiple measurements at each time point?</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Wide data with multiple measurements</span></span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>wide_multi <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">animal_id =</span> <span class="fu">c</span>(<span class="st">"A001"</span>, <span class="st">"A002"</span>),</span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">weight_week0 =</span> <span class="fu">c</span>(<span class="dv">45</span>, <span class="dv">42</span>),</span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">weight_week4 =</span> <span class="fu">c</span>(<span class="dv">52</span>, <span class="dv">48</span>),</span>
<span id="cb22-6"><a href="#cb22-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">height_week0 =</span> <span class="fu">c</span>(<span class="dv">80</span>, <span class="dv">78</span>),</span>
<span id="cb22-7"><a href="#cb22-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">height_week4 =</span> <span class="fu">c</span>(<span class="dv">85</span>, <span class="dv">82</span>)</span>
<span id="cb22-8"><a href="#cb22-8" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb22-9"><a href="#cb22-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-10"><a href="#cb22-10" aria-hidden="true" tabindex="-1"></a>wide_multi</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 2 × 5
  animal_id weight_week0 weight_week4 height_week0 height_week4
  &lt;chr&gt;            &lt;dbl&gt;        &lt;dbl&gt;        &lt;dbl&gt;        &lt;dbl&gt;
1 A001                45           52           80           85
2 A002                42           48           78           82</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Alternative: create separate columns for each measurement</span></span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a>wide_multi <span class="sc">%&gt;%</span></span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(</span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">cols =</span> <span class="sc">-</span>animal_id,</span>
<span id="cb24-5"><a href="#cb24-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">names_to =</span> <span class="fu">c</span>(<span class="st">".value"</span>, <span class="st">"week"</span>),</span>
<span id="cb24-6"><a href="#cb24-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">names_pattern =</span> <span class="st">"(.+)_week(.+)"</span></span>
<span id="cb24-7"><a href="#cb24-7" aria-hidden="true" tabindex="-1"></a>  )</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 4 × 4
  animal_id week  weight height
  &lt;chr&gt;     &lt;chr&gt;  &lt;dbl&gt;  &lt;dbl&gt;
1 A001      0         45     80
2 A001      4         52     85
3 A002      0         42     78
4 A002      4         48     82</code></pre>
</div>
</div>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
<span class="screen-reader-only">Tip</span><code>names_pattern</code> with Regular Expressions
</div>
</div>
<div class="callout-body-container callout-body">
<p>Use <code>names_pattern</code> with regex to extract parts of column names: - <code>.+</code> matches one or more characters - <code>(.+)</code> creates a capture group - <code>week(.+)</code> matches “week” followed by captured characters</p>
</div>
</div>
</section>
</section>
<section id="pivot_wider-long-to-wide" class="level3" data-number="7.4.2">
<h3 data-number="7.4.2" class="anchored" data-anchor-id="pivot_wider-long-to-wide"><span class="header-section-number">7.4.2</span> <code>pivot_wider()</code>: Long to Wide</h3>
<p><code>pivot_wider()</code> transforms long data (many rows) into wide data (many columns). It’s the opposite of <code>pivot_longer()</code>.</p>
<p><strong>Basic syntax</strong>:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb26"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="fu">pivot_wider</span>(</span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a>  data,</span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">names_from =</span> <span class="sc">&lt;</span>column with names <span class="cf">for</span> new columns<span class="sc">&gt;</span>,</span>
<span id="cb26-4"><a href="#cb26-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">values_from =</span> <span class="sc">&lt;</span>column with values to fill new columns<span class="sc">&gt;</span></span>
<span id="cb26-5"><a href="#cb26-5" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<section id="example-creating-a-summary-table" class="level4" data-number="7.4.2.1">
<h4 data-number="7.4.2.1" class="anchored" data-anchor-id="example-creating-a-summary-table"><span class="header-section-number">7.4.2.1</span> Example: Creating a Summary Table</h4>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb27"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Long format data</span></span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a>animals_long <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">animal_id =</span> <span class="fu">rep</span>(<span class="fu">c</span>(<span class="st">"A001"</span>, <span class="st">"A002"</span>, <span class="st">"A003"</span>), <span class="at">each =</span> <span class="dv">3</span>),</span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">breed =</span> <span class="fu">rep</span>(<span class="fu">c</span>(<span class="st">"Holstein"</span>, <span class="st">"Jersey"</span>, <span class="st">"Angus"</span>), <span class="at">each =</span> <span class="dv">3</span>),</span>
<span id="cb27-5"><a href="#cb27-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">treatment =</span> <span class="fu">rep</span>(<span class="fu">c</span>(<span class="st">"Control"</span>, <span class="st">"Treatment_A"</span>, <span class="st">"Treatment_B"</span>), <span class="at">times =</span> <span class="dv">3</span>),</span>
<span id="cb27-6"><a href="#cb27-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">weight_gain_kg =</span> <span class="fu">c</span>(<span class="dv">15</span>, <span class="dv">22</span>, <span class="dv">18</span>, <span class="dv">12</span>, <span class="dv">18</span>, <span class="dv">15</span>, <span class="dv">16</span>, <span class="dv">21</span>, <span class="dv">17</span>)</span>
<span id="cb27-7"><a href="#cb27-7" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb27-8"><a href="#cb27-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-9"><a href="#cb27-9" aria-hidden="true" tabindex="-1"></a>animals_long</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 9 × 4
  animal_id breed    treatment   weight_gain_kg
  &lt;chr&gt;     &lt;chr&gt;    &lt;chr&gt;                &lt;dbl&gt;
1 A001      Holstein Control                 15
2 A001      Holstein Treatment_A             22
3 A001      Holstein Treatment_B             18
4 A002      Jersey   Control                 12
5 A002      Jersey   Treatment_A             18
6 A002      Jersey   Treatment_B             15
7 A003      Angus    Control                 16
8 A003      Angus    Treatment_A             21
9 A003      Angus    Treatment_B             17</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb29"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Pivot wider: treatments become columns</span></span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a>animals_wide <span class="ot">&lt;-</span> animals_long <span class="sc">%&gt;%</span></span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(</span>
<span id="cb29-4"><a href="#cb29-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">names_from =</span> treatment,</span>
<span id="cb29-5"><a href="#cb29-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">values_from =</span> weight_gain_kg</span>
<span id="cb29-6"><a href="#cb29-6" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb29-7"><a href="#cb29-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-8"><a href="#cb29-8" aria-hidden="true" tabindex="-1"></a>animals_wide</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 5
  animal_id breed    Control Treatment_A Treatment_B
  &lt;chr&gt;     &lt;chr&gt;      &lt;dbl&gt;       &lt;dbl&gt;       &lt;dbl&gt;
1 A001      Holstein      15          22          18
2 A002      Jersey        12          18          15
3 A003      Angus         16          21          17</code></pre>
</div>
</div>
</section>
<section id="handling-multiple-value-columns" class="level4" data-number="7.4.2.2">
<h4 data-number="7.4.2.2" class="anchored" data-anchor-id="handling-multiple-value-columns"><span class="header-section-number">7.4.2.2</span> Handling Multiple Value Columns</h4>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb31"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Long data with multiple measurements</span></span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a>measurements_long <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">animal_id =</span> <span class="fu">rep</span>(<span class="fu">c</span>(<span class="st">"A001"</span>, <span class="st">"A002"</span>), <span class="at">each =</span> <span class="dv">4</span>),</span>
<span id="cb31-4"><a href="#cb31-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">week =</span> <span class="fu">rep</span>(<span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">4</span>, <span class="dv">8</span>, <span class="dv">12</span>), <span class="at">times =</span> <span class="dv">2</span>),</span>
<span id="cb31-5"><a href="#cb31-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">weight_kg =</span> <span class="fu">c</span>(<span class="dv">45</span>, <span class="dv">52</span>, <span class="dv">58</span>, <span class="dv">64</span>, <span class="dv">42</span>, <span class="dv">48</span>, <span class="dv">54</span>, <span class="dv">60</span>),</span>
<span id="cb31-6"><a href="#cb31-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">height_cm =</span> <span class="fu">c</span>(<span class="dv">80</span>, <span class="dv">85</span>, <span class="dv">88</span>, <span class="dv">91</span>, <span class="dv">78</span>, <span class="dv">82</span>, <span class="dv">85</span>, <span class="dv">88</span>)</span>
<span id="cb31-7"><a href="#cb31-7" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb31-8"><a href="#cb31-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-9"><a href="#cb31-9" aria-hidden="true" tabindex="-1"></a>measurements_long</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 8 × 4
  animal_id  week weight_kg height_cm
  &lt;chr&gt;     &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;
1 A001          0        45        80
2 A001          4        52        85
3 A001          8        58        88
4 A001         12        64        91
5 A002          0        42        78
6 A002          4        48        82
7 A002          8        54        85
8 A002         12        60        88</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb33"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Pivot wider: weeks become columns for each measurement</span></span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a>measurements_long <span class="sc">%&gt;%</span></span>
<span id="cb33-3"><a href="#cb33-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(</span>
<span id="cb33-4"><a href="#cb33-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">names_from =</span> week,</span>
<span id="cb33-5"><a href="#cb33-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">values_from =</span> <span class="fu">c</span>(weight_kg, height_cm),</span>
<span id="cb33-6"><a href="#cb33-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">names_glue =</span> <span class="st">"{.value}_week{week}"</span></span>
<span id="cb33-7"><a href="#cb33-7" aria-hidden="true" tabindex="-1"></a>  )</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 2 × 9
  animal_id weight_kg_week0 weight_kg_week4 weight_kg_week8 weight_kg_week12
  &lt;chr&gt;               &lt;dbl&gt;           &lt;dbl&gt;           &lt;dbl&gt;            &lt;dbl&gt;
1 A001                   45              52              58               64
2 A002                   42              48              54               60
# ℹ 4 more variables: height_cm_week0 &lt;dbl&gt;, height_cm_week4 &lt;dbl&gt;,
#   height_cm_week8 &lt;dbl&gt;, height_cm_week12 &lt;dbl&gt;</code></pre>
</div>
</div>
</section>
<section id="dealing-with-duplicates" class="level4" data-number="7.4.2.3">
<h4 data-number="7.4.2.3" class="anchored" data-anchor-id="dealing-with-duplicates"><span class="header-section-number">7.4.2.3</span> Dealing with Duplicates</h4>
<p>What if you have duplicate id-time combinations?</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb35"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Data with duplicates</span></span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a>duplicated_data <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb35-3"><a href="#cb35-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">animal_id =</span> <span class="fu">c</span>(<span class="st">"A001"</span>, <span class="st">"A001"</span>, <span class="st">"A002"</span>, <span class="st">"A002"</span>),</span>
<span id="cb35-4"><a href="#cb35-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">week =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>),  <span class="co"># Same animal measured twice</span></span>
<span id="cb35-5"><a href="#cb35-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">weight_kg =</span> <span class="fu">c</span>(<span class="dv">45</span>, <span class="dv">46</span>, <span class="dv">42</span>, <span class="dv">43</span>)</span>
<span id="cb35-6"><a href="#cb35-6" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb35-7"><a href="#cb35-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-8"><a href="#cb35-8" aria-hidden="true" tabindex="-1"></a>duplicated_data</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 4 × 3
  animal_id  week weight_kg
  &lt;chr&gt;     &lt;dbl&gt;     &lt;dbl&gt;
1 A001          0        45
2 A001          0        46
3 A002          0        42
4 A002          0        43</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb37"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Summarize first to remove duplicates</span></span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a>duplicated_data <span class="sc">%&gt;%</span></span>
<span id="cb37-3"><a href="#cb37-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(animal_id, week) <span class="sc">%&gt;%</span></span>
<span id="cb37-4"><a href="#cb37-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">weight_kg =</span> <span class="fu">mean</span>(weight_kg), <span class="at">.groups =</span> <span class="st">"drop"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb37-5"><a href="#cb37-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(</span>
<span id="cb37-6"><a href="#cb37-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">names_from =</span> week,</span>
<span id="cb37-7"><a href="#cb37-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">values_from =</span> weight_kg</span>
<span id="cb37-8"><a href="#cb37-8" aria-hidden="true" tabindex="-1"></a>  )</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 2 × 2
  animal_id   `0`
  &lt;chr&gt;     &lt;dbl&gt;
1 A001       45.5
2 A002       42.5</code></pre>
</div>
</div>
<div class="callout callout-style-default callout-warning callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
<span class="screen-reader-only">Warning</span>Watch Out for Duplicates!
</div>
</div>
<div class="callout-body-container callout-body">
<p><code>pivot_wider()</code> creates list-columns when there are multiple values for the same id × names_from combination. Either: - Summarize first (take mean, max, etc.) - Keep as list-column and <code>unnest()</code> later - Check your data for unexpected duplicates</p>
</div>
</div>
</section>
</section>
<section id="separate-split-one-column-into-many" class="level3" data-number="7.4.3">
<h3 data-number="7.4.3" class="anchored" data-anchor-id="separate-split-one-column-into-many"><span class="header-section-number">7.4.3</span> <code>separate()</code>: Split One Column into Many</h3>
<p><code>separate()</code> splits a single column into multiple columns based on a separator.</p>
<p><strong>Basic syntax</strong>:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb39"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a><span class="fu">separate</span>(</span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a>  data,</span>
<span id="cb39-3"><a href="#cb39-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">col =</span> <span class="sc">&lt;</span>column to split<span class="sc">&gt;</span>,</span>
<span id="cb39-4"><a href="#cb39-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">into =</span> <span class="fu">c</span>(<span class="st">"&lt;new_col1&gt;"</span>, <span class="st">"&lt;new_col2&gt;"</span>),</span>
<span id="cb39-5"><a href="#cb39-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">sep =</span> <span class="st">"&lt;separator&gt;"</span></span>
<span id="cb39-6"><a href="#cb39-6" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<section id="example-splitting-composite-ids" class="level4" data-number="7.4.3.1">
<h4 data-number="7.4.3.1" class="anchored" data-anchor-id="example-splitting-composite-ids"><span class="header-section-number">7.4.3.1</span> Example: Splitting Composite IDs</h4>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb40"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Data with composite identifiers</span></span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a>animals_composite <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb40-3"><a href="#cb40-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">animal_id =</span> <span class="fu">c</span>(<span class="st">"Holstein_M_001"</span>, <span class="st">"Jersey_F_002"</span>, <span class="st">"Angus_M_003"</span>),</span>
<span id="cb40-4"><a href="#cb40-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">weight_kg =</span> <span class="fu">c</span>(<span class="dv">550</span>, <span class="dv">420</span>, <span class="dv">580</span>)</span>
<span id="cb40-5"><a href="#cb40-5" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb40-6"><a href="#cb40-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-7"><a href="#cb40-7" aria-hidden="true" tabindex="-1"></a>animals_composite</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 2
  animal_id      weight_kg
  &lt;chr&gt;              &lt;dbl&gt;
1 Holstein_M_001       550
2 Jersey_F_002         420
3 Angus_M_003          580</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb42"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Separate into components</span></span>
<span id="cb42-2"><a href="#cb42-2" aria-hidden="true" tabindex="-1"></a>animals_composite <span class="sc">%&gt;%</span></span>
<span id="cb42-3"><a href="#cb42-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">separate</span>(</span>
<span id="cb42-4"><a href="#cb42-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">col =</span> animal_id,</span>
<span id="cb42-5"><a href="#cb42-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">into =</span> <span class="fu">c</span>(<span class="st">"breed"</span>, <span class="st">"sex"</span>, <span class="st">"id_number"</span>),</span>
<span id="cb42-6"><a href="#cb42-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">sep =</span> <span class="st">"_"</span></span>
<span id="cb42-7"><a href="#cb42-7" aria-hidden="true" tabindex="-1"></a>  )</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 4
  breed    sex   id_number weight_kg
  &lt;chr&gt;    &lt;chr&gt; &lt;chr&gt;         &lt;dbl&gt;
1 Holstein M     001             550
2 Jersey   F     002             420
3 Angus    M     003             580</code></pre>
</div>
</div>
</section>
<section id="automatic-type-conversion" class="level4" data-number="7.4.3.2">
<h4 data-number="7.4.3.2" class="anchored" data-anchor-id="automatic-type-conversion"><span class="header-section-number">7.4.3.2</span> Automatic Type Conversion</h4>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb44"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Separate and convert types automatically</span></span>
<span id="cb44-2"><a href="#cb44-2" aria-hidden="true" tabindex="-1"></a>animals_composite <span class="sc">%&gt;%</span></span>
<span id="cb44-3"><a href="#cb44-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">separate</span>(</span>
<span id="cb44-4"><a href="#cb44-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">col =</span> animal_id,</span>
<span id="cb44-5"><a href="#cb44-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">into =</span> <span class="fu">c</span>(<span class="st">"breed"</span>, <span class="st">"sex"</span>, <span class="st">"id_number"</span>),</span>
<span id="cb44-6"><a href="#cb44-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">sep =</span> <span class="st">"_"</span>,</span>
<span id="cb44-7"><a href="#cb44-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">convert =</span> <span class="cn">TRUE</span>  <span class="co"># Automatically converts to appropriate types</span></span>
<span id="cb44-8"><a href="#cb44-8" aria-hidden="true" tabindex="-1"></a>  )</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 4
  breed    sex   id_number weight_kg
  &lt;chr&gt;    &lt;chr&gt;     &lt;int&gt;     &lt;dbl&gt;
1 Holstein M             1       550
2 Jersey   F             2       420
3 Angus    M             3       580</code></pre>
</div>
</div>
</section>
<section id="keeping-the-original-column" class="level4" data-number="7.4.3.3">
<h4 data-number="7.4.3.3" class="anchored" data-anchor-id="keeping-the-original-column"><span class="header-section-number">7.4.3.3</span> Keeping the Original Column</h4>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb46"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Keep original column</span></span>
<span id="cb46-2"><a href="#cb46-2" aria-hidden="true" tabindex="-1"></a>animals_composite <span class="sc">%&gt;%</span></span>
<span id="cb46-3"><a href="#cb46-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">separate</span>(</span>
<span id="cb46-4"><a href="#cb46-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">col =</span> animal_id,</span>
<span id="cb46-5"><a href="#cb46-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">into =</span> <span class="fu">c</span>(<span class="st">"breed"</span>, <span class="st">"sex"</span>, <span class="st">"id_number"</span>),</span>
<span id="cb46-6"><a href="#cb46-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">sep =</span> <span class="st">"_"</span>,</span>
<span id="cb46-7"><a href="#cb46-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">remove =</span> <span class="cn">FALSE</span>  <span class="co"># Don't remove original column</span></span>
<span id="cb46-8"><a href="#cb46-8" aria-hidden="true" tabindex="-1"></a>  )</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 5
  animal_id      breed    sex   id_number weight_kg
  &lt;chr&gt;          &lt;chr&gt;    &lt;chr&gt; &lt;chr&gt;         &lt;dbl&gt;
1 Holstein_M_001 Holstein M     001             550
2 Jersey_F_002   Jersey   F     002             420
3 Angus_M_003    Angus    M     003             580</code></pre>
</div>
</div>
</section>
</section>
<section id="unite-combine-columns-into-one" class="level3" data-number="7.4.4">
<h3 data-number="7.4.4" class="anchored" data-anchor-id="unite-combine-columns-into-one"><span class="header-section-number">7.4.4</span> <code>unite()</code>: Combine Columns into One</h3>
<p><code>unite()</code> is the opposite of <code>separate()</code> — it combines multiple columns into one.</p>
<p><strong>Basic syntax</strong>:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb48"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a><span class="fu">unite</span>(</span>
<span id="cb48-2"><a href="#cb48-2" aria-hidden="true" tabindex="-1"></a>  data,</span>
<span id="cb48-3"><a href="#cb48-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">col =</span> <span class="st">"&lt;new_column_name&gt;"</span>,</span>
<span id="cb48-4"><a href="#cb48-4" aria-hidden="true" tabindex="-1"></a>  ...,</span>
<span id="cb48-5"><a href="#cb48-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">sep =</span> <span class="st">"&lt;separator&gt;"</span></span>
<span id="cb48-6"><a href="#cb48-6" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<section id="example-creating-unique-ids" class="level4" data-number="7.4.4.1">
<h4 data-number="7.4.4.1" class="anchored" data-anchor-id="example-creating-unique-ids"><span class="header-section-number">7.4.4.1</span> Example: Creating Unique IDs</h4>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb49"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Separate columns</span></span>
<span id="cb49-2"><a href="#cb49-2" aria-hidden="true" tabindex="-1"></a>animals_separated <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb49-3"><a href="#cb49-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">farm =</span> <span class="fu">c</span>(<span class="st">"North"</span>, <span class="st">"South"</span>, <span class="st">"East"</span>),</span>
<span id="cb49-4"><a href="#cb49-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">breed =</span> <span class="fu">c</span>(<span class="st">"Holstein"</span>, <span class="st">"Jersey"</span>, <span class="st">"Angus"</span>),</span>
<span id="cb49-5"><a href="#cb49-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">id_num =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>),</span>
<span id="cb49-6"><a href="#cb49-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">weight_kg =</span> <span class="fu">c</span>(<span class="dv">550</span>, <span class="dv">420</span>, <span class="dv">580</span>)</span>
<span id="cb49-7"><a href="#cb49-7" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb49-8"><a href="#cb49-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-9"><a href="#cb49-9" aria-hidden="true" tabindex="-1"></a>animals_separated</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 4
  farm  breed    id_num weight_kg
  &lt;chr&gt; &lt;chr&gt;     &lt;dbl&gt;     &lt;dbl&gt;
1 North Holstein      1       550
2 South Jersey        2       420
3 East  Angus         3       580</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb51"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Unite into single ID</span></span>
<span id="cb51-2"><a href="#cb51-2" aria-hidden="true" tabindex="-1"></a>animals_separated <span class="sc">%&gt;%</span></span>
<span id="cb51-3"><a href="#cb51-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unite</span>(</span>
<span id="cb51-4"><a href="#cb51-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">col =</span> <span class="st">"animal_id"</span>,</span>
<span id="cb51-5"><a href="#cb51-5" aria-hidden="true" tabindex="-1"></a>    farm, breed, id_num,</span>
<span id="cb51-6"><a href="#cb51-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">sep =</span> <span class="st">"_"</span></span>
<span id="cb51-7"><a href="#cb51-7" aria-hidden="true" tabindex="-1"></a>  )</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 2
  animal_id        weight_kg
  &lt;chr&gt;                &lt;dbl&gt;
1 North_Holstein_1       550
2 South_Jersey_2         420
3 East_Angus_3           580</code></pre>
</div>
</div>
</section>
<section id="keeping-original-columns" class="level4" data-number="7.4.4.2">
<h4 data-number="7.4.4.2" class="anchored" data-anchor-id="keeping-original-columns"><span class="header-section-number">7.4.4.2</span> Keeping Original Columns</h4>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb53"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb53-1"><a href="#cb53-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Keep original columns</span></span>
<span id="cb53-2"><a href="#cb53-2" aria-hidden="true" tabindex="-1"></a>animals_separated <span class="sc">%&gt;%</span></span>
<span id="cb53-3"><a href="#cb53-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unite</span>(</span>
<span id="cb53-4"><a href="#cb53-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">col =</span> <span class="st">"animal_id"</span>,</span>
<span id="cb53-5"><a href="#cb53-5" aria-hidden="true" tabindex="-1"></a>    farm, breed, id_num,</span>
<span id="cb53-6"><a href="#cb53-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">sep =</span> <span class="st">"_"</span>,</span>
<span id="cb53-7"><a href="#cb53-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">remove =</span> <span class="cn">FALSE</span></span>
<span id="cb53-8"><a href="#cb53-8" aria-hidden="true" tabindex="-1"></a>  )</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 5
  animal_id        farm  breed    id_num weight_kg
  &lt;chr&gt;            &lt;chr&gt; &lt;chr&gt;     &lt;dbl&gt;     &lt;dbl&gt;
1 North_Holstein_1 North Holstein      1       550
2 South_Jersey_2   South Jersey        2       420
3 East_Angus_3     East  Angus         3       580</code></pre>
</div>
</div>
</section>
</section>
<section id="when-to-use-each-function" class="level3" data-number="7.4.5">
<h3 data-number="7.4.5" class="anchored" data-anchor-id="when-to-use-each-function"><span class="header-section-number">7.4.5</span> When to Use Each Function</h3>
<table class="caption-top table">
<colgroup>
<col style="width: 24%">
<col style="width: 40%">
<col style="width: 36%">
</colgroup>
<thead>
<tr class="header">
<th>Goal</th>
<th>Function</th>
<th>Example</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Many columns → few rows</td>
<td><code>pivot_longer()</code></td>
<td>week_0, week_4, week_8 → week column</td>
</tr>
<tr class="even">
<td>Few columns → many rows</td>
<td><code>pivot_wider()</code></td>
<td>week column → week_0, week_4, week_8</td>
</tr>
<tr class="odd">
<td>One column → many columns</td>
<td><code>separate()</code></td>
<td>“Holstein_M_001” → breed, sex, id</td>
</tr>
<tr class="even">
<td>Many columns → one column</td>
<td><code>unite()</code></td>
<td>breed, sex, id → “Holstein_M_001”</td>
</tr>
</tbody>
</table>
<hr>
</section>
</section>
<section id="joining-datasets" class="level2" data-number="7.5">
<h2 data-number="7.5" class="anchored" data-anchor-id="joining-datasets"><span class="header-section-number">7.5</span> Joining Datasets</h2>
<p>In real-world analysis, data is often spread across multiple tables. <strong>Joins</strong> combine tables based on shared keys.</p>
<section id="relational-data-example" class="level3" data-number="7.5.1">
<h3 data-number="7.5.1" class="anchored" data-anchor-id="relational-data-example"><span class="header-section-number">7.5.1</span> Relational Data Example</h3>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb55"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb55-1"><a href="#cb55-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Table 1: Animal information</span></span>
<span id="cb55-2"><a href="#cb55-2" aria-hidden="true" tabindex="-1"></a>animals <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb55-3"><a href="#cb55-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">animal_id =</span> <span class="fu">c</span>(<span class="st">"A001"</span>, <span class="st">"A002"</span>, <span class="st">"A003"</span>, <span class="st">"A004"</span>),</span>
<span id="cb55-4"><a href="#cb55-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">breed =</span> <span class="fu">c</span>(<span class="st">"Holstein"</span>, <span class="st">"Jersey"</span>, <span class="st">"Angus"</span>, <span class="st">"Holstein"</span>),</span>
<span id="cb55-5"><a href="#cb55-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">birth_date =</span> <span class="fu">as.Date</span>(<span class="fu">c</span>(<span class="st">"2023-01-15"</span>, <span class="st">"2023-02-20"</span>, <span class="st">"2023-01-10"</span>, <span class="st">"2023-03-05"</span>))</span>
<span id="cb55-6"><a href="#cb55-6" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb55-7"><a href="#cb55-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-8"><a href="#cb55-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Table 2: Weight records</span></span>
<span id="cb55-9"><a href="#cb55-9" aria-hidden="true" tabindex="-1"></a>weights <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb55-10"><a href="#cb55-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">animal_id =</span> <span class="fu">c</span>(<span class="st">"A001"</span>, <span class="st">"A001"</span>, <span class="st">"A002"</span>, <span class="st">"A002"</span>, <span class="st">"A005"</span>),</span>
<span id="cb55-11"><a href="#cb55-11" aria-hidden="true" tabindex="-1"></a>  <span class="at">date =</span> <span class="fu">as.Date</span>(<span class="fu">c</span>(<span class="st">"2023-06-01"</span>, <span class="st">"2023-09-01"</span>, <span class="st">"2023-06-01"</span>, <span class="st">"2023-09-01"</span>, <span class="st">"2023-06-01"</span>)),</span>
<span id="cb55-12"><a href="#cb55-12" aria-hidden="true" tabindex="-1"></a>  <span class="at">weight_kg =</span> <span class="fu">c</span>(<span class="dv">180</span>, <span class="dv">220</span>, <span class="dv">150</span>, <span class="dv">185</span>, <span class="dv">200</span>)</span>
<span id="cb55-13"><a href="#cb55-13" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb55-14"><a href="#cb55-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-15"><a href="#cb55-15" aria-hidden="true" tabindex="-1"></a><span class="co"># Table 3: Treatment assignments</span></span>
<span id="cb55-16"><a href="#cb55-16" aria-hidden="true" tabindex="-1"></a>treatments <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb55-17"><a href="#cb55-17" aria-hidden="true" tabindex="-1"></a>  <span class="at">animal_id =</span> <span class="fu">c</span>(<span class="st">"A001"</span>, <span class="st">"A002"</span>, <span class="st">"A003"</span>),</span>
<span id="cb55-18"><a href="#cb55-18" aria-hidden="true" tabindex="-1"></a>  <span class="at">treatment =</span> <span class="fu">c</span>(<span class="st">"Control"</span>, <span class="st">"Treatment_A"</span>, <span class="st">"Treatment_B"</span>)</span>
<span id="cb55-19"><a href="#cb55-19" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb55-20"><a href="#cb55-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-21"><a href="#cb55-21" aria-hidden="true" tabindex="-1"></a>animals</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 4 × 3
  animal_id breed    birth_date
  &lt;chr&gt;     &lt;chr&gt;    &lt;date&gt;    
1 A001      Holstein 2023-01-15
2 A002      Jersey   2023-02-20
3 A003      Angus    2023-01-10
4 A004      Holstein 2023-03-05</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb57"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb57-1"><a href="#cb57-1" aria-hidden="true" tabindex="-1"></a>weights</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 5 × 3
  animal_id date       weight_kg
  &lt;chr&gt;     &lt;date&gt;         &lt;dbl&gt;
1 A001      2023-06-01       180
2 A001      2023-09-01       220
3 A002      2023-06-01       150
4 A002      2023-09-01       185
5 A005      2023-06-01       200</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb59"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb59-1"><a href="#cb59-1" aria-hidden="true" tabindex="-1"></a>treatments</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 2
  animal_id treatment  
  &lt;chr&gt;     &lt;chr&gt;      
1 A001      Control    
2 A002      Treatment_A
3 A003      Treatment_B</code></pre>
</div>
</div>
</section>
<section id="types-of-joins" class="level3" data-number="7.5.2">
<h3 data-number="7.5.2" class="anchored" data-anchor-id="types-of-joins"><span class="header-section-number">7.5.2</span> Types of Joins</h3>
<section id="mutating-joins-add-columns" class="level4" data-number="7.5.2.1">
<h4 data-number="7.5.2.1" class="anchored" data-anchor-id="mutating-joins-add-columns"><span class="header-section-number">7.5.2.1</span> Mutating Joins: Add Columns</h4>
<p><strong>Visual representation</strong>:</p>
<div class="cell" data-layout-align="default">
<div class="cell-output-display">
<div>
<p></p><figure class="figure"><p></p>
<div>
<pre class="mermaid mermaid-js">flowchart TD
    A[Mutating Joins&lt;br/&gt;Add columns from y to x] --&gt; B[left_join]
    A --&gt; C[right_join]
    A --&gt; D[inner_join]
    A --&gt; E[full_join]

    B --&gt; B1[Keep all x rows&lt;br/&gt;Add matching y columns]
    C --&gt; C1[Keep all y rows&lt;br/&gt;Add matching x columns]
    D --&gt; D1[Keep only matching rows&lt;br/&gt;from both x and y]
    E --&gt; E1[Keep all rows&lt;br/&gt;from both x and y]
</pre>
</div>
<p></p></figure><p></p>
</div>
</div>
</div>
</section>
</section>
<section id="left_join-keep-all-left-rows" class="level3" data-number="7.5.3">
<h3 data-number="7.5.3" class="anchored" data-anchor-id="left_join-keep-all-left-rows"><span class="header-section-number">7.5.3</span> <code>left_join()</code>: Keep All Left Rows</h3>
<p><strong>Venn Diagram concept</strong>: All of LEFT + matching from RIGHT</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb61"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb61-1"><a href="#cb61-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Left join: keep all animals, add treatment info</span></span>
<span id="cb61-2"><a href="#cb61-2" aria-hidden="true" tabindex="-1"></a>animals <span class="sc">%&gt;%</span></span>
<span id="cb61-3"><a href="#cb61-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(treatments, <span class="at">by =</span> <span class="st">"animal_id"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 4 × 4
  animal_id breed    birth_date treatment  
  &lt;chr&gt;     &lt;chr&gt;    &lt;date&gt;     &lt;chr&gt;      
1 A001      Holstein 2023-01-15 Control    
2 A002      Jersey   2023-02-20 Treatment_A
3 A003      Angus    2023-01-10 Treatment_B
4 A004      Holstein 2023-03-05 &lt;NA&gt;       </code></pre>
</div>
</div>
<p>Notice: - All 4 animals kept (even A004 with no treatment) - A004 gets <code>NA</code> for treatment - Unmatched rows from <code>treatments</code> (if any) are dropped</p>
<section id="use-left_join-when" class="level4" data-number="7.5.3.1">
<h4 data-number="7.5.3.1" class="anchored" data-anchor-id="use-left_join-when"><span class="header-section-number">7.5.3.1</span> Use <code>left_join()</code> when:</h4>
<ul>
<li>You want to <strong>add information</strong> to your main table</li>
<li>You want to <strong>keep all rows</strong> from the main table</li>
<li>Missing matches should be <code>NA</code></li>
</ul>
</section>
</section>
<section id="right_join-keep-all-right-rows" class="level3" data-number="7.5.4">
<h3 data-number="7.5.4" class="anchored" data-anchor-id="right_join-keep-all-right-rows"><span class="header-section-number">7.5.4</span> <code>right_join()</code>: Keep All Right Rows</h3>
<p><strong>Venn Diagram concept</strong>: All of RIGHT + matching from LEFT</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb63"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb63-1"><a href="#cb63-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Right join: keep all treatments, add animal info</span></span>
<span id="cb63-2"><a href="#cb63-2" aria-hidden="true" tabindex="-1"></a>animals <span class="sc">%&gt;%</span></span>
<span id="cb63-3"><a href="#cb63-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">right_join</span>(treatments, <span class="at">by =</span> <span class="st">"animal_id"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 4
  animal_id breed    birth_date treatment  
  &lt;chr&gt;     &lt;chr&gt;    &lt;date&gt;     &lt;chr&gt;      
1 A001      Holstein 2023-01-15 Control    
2 A002      Jersey   2023-02-20 Treatment_A
3 A003      Angus    2023-01-10 Treatment_B</code></pre>
</div>
</div>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
<span class="screen-reader-only">Note</span><code>right_join()</code> is Rarely Used
</div>
</div>
<div class="callout-body-container callout-body">
<p><code>right_join(x, y)</code> gives the same result as <code>left_join(y, x)</code>. Most people prefer to use <code>left_join()</code> and think about the “main” table being on the left.</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb65"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb65-1"><a href="#cb65-1" aria-hidden="true" tabindex="-1"></a><span class="co"># These are equivalent:</span></span>
<span id="cb65-2"><a href="#cb65-2" aria-hidden="true" tabindex="-1"></a>animals <span class="sc">%&gt;%</span> <span class="fu">right_join</span>(treatments)</span>
<span id="cb65-3"><a href="#cb65-3" aria-hidden="true" tabindex="-1"></a>treatments <span class="sc">%&gt;%</span> <span class="fu">left_join</span>(animals)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
</div>
</section>
<section id="inner_join-keep-only-matching-rows" class="level3" data-number="7.5.5">
<h3 data-number="7.5.5" class="anchored" data-anchor-id="inner_join-keep-only-matching-rows"><span class="header-section-number">7.5.5</span> <code>inner_join()</code>: Keep Only Matching Rows</h3>
<p><strong>Venn Diagram concept</strong>: Only the INTERSECTION</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb66"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb66-1"><a href="#cb66-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Inner join: keep only animals with treatments</span></span>
<span id="cb66-2"><a href="#cb66-2" aria-hidden="true" tabindex="-1"></a>animals <span class="sc">%&gt;%</span></span>
<span id="cb66-3"><a href="#cb66-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">inner_join</span>(treatments, <span class="at">by =</span> <span class="st">"animal_id"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 4
  animal_id breed    birth_date treatment  
  &lt;chr&gt;     &lt;chr&gt;    &lt;date&gt;     &lt;chr&gt;      
1 A001      Holstein 2023-01-15 Control    
2 A002      Jersey   2023-02-20 Treatment_A
3 A003      Angus    2023-01-10 Treatment_B</code></pre>
</div>
</div>
<p>Notice: - Only 3 animals kept (A001, A002, A003) - A004 dropped (no treatment) - Perfect when you only want complete cases</p>
<section id="use-inner_join-when" class="level4" data-number="7.5.5.1">
<h4 data-number="7.5.5.1" class="anchored" data-anchor-id="use-inner_join-when"><span class="header-section-number">7.5.5.1</span> Use <code>inner_join()</code> when:</h4>
<ul>
<li>You only want rows that <strong>match in both tables</strong></li>
<li>Unmatched rows should be <strong>excluded</strong></li>
<li>You’re analyzing complete cases only</li>
</ul>
</section>
</section>
<section id="full_join-keep-all-rows-from-both" class="level3" data-number="7.5.6">
<h3 data-number="7.5.6" class="anchored" data-anchor-id="full_join-keep-all-rows-from-both"><span class="header-section-number">7.5.6</span> <code>full_join()</code>: Keep All Rows from Both</h3>
<p><strong>Venn Diagram concept</strong>: UNION of LEFT and RIGHT</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb68"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb68-1"><a href="#cb68-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Full join: keep everything</span></span>
<span id="cb68-2"><a href="#cb68-2" aria-hidden="true" tabindex="-1"></a>animals <span class="sc">%&gt;%</span></span>
<span id="cb68-3"><a href="#cb68-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">full_join</span>(treatments, <span class="at">by =</span> <span class="st">"animal_id"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 4 × 4
  animal_id breed    birth_date treatment  
  &lt;chr&gt;     &lt;chr&gt;    &lt;date&gt;     &lt;chr&gt;      
1 A001      Holstein 2023-01-15 Control    
2 A002      Jersey   2023-02-20 Treatment_A
3 A003      Angus    2023-01-10 Treatment_B
4 A004      Holstein 2023-03-05 &lt;NA&gt;       </code></pre>
</div>
</div>
<section id="use-full_join-when" class="level4" data-number="7.5.6.1">
<h4 data-number="7.5.6.1" class="anchored" data-anchor-id="use-full_join-when"><span class="header-section-number">7.5.6.1</span> Use <code>full_join()</code> when:</h4>
<ul>
<li>You want <strong>all data</strong> from both tables</li>
<li>You want to see what’s missing from each table</li>
<li>You’ll handle <code>NA</code> values later</li>
</ul>
</section>
</section>
<section id="joining-with-multiple-keys" class="level3" data-number="7.5.7">
<h3 data-number="7.5.7" class="anchored" data-anchor-id="joining-with-multiple-keys"><span class="header-section-number">7.5.7</span> Joining with Multiple Keys</h3>
<p>What if matching requires multiple columns?</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb70"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb70-1"><a href="#cb70-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Farm data with state</span></span>
<span id="cb70-2"><a href="#cb70-2" aria-hidden="true" tabindex="-1"></a>farms <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb70-3"><a href="#cb70-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">farm_name =</span> <span class="fu">c</span>(<span class="st">"Green Acres"</span>, <span class="st">"Sunny Farm"</span>, <span class="st">"Green Acres"</span>),</span>
<span id="cb70-4"><a href="#cb70-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">state =</span> <span class="fu">c</span>(<span class="st">"Iowa"</span>, <span class="st">"Kansas"</span>, <span class="st">"Nebraska"</span>),</span>
<span id="cb70-5"><a href="#cb70-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">size_acres =</span> <span class="fu">c</span>(<span class="dv">500</span>, <span class="dv">350</span>, <span class="dv">600</span>)</span>
<span id="cb70-6"><a href="#cb70-6" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb70-7"><a href="#cb70-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-8"><a href="#cb70-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Animal locations</span></span>
<span id="cb70-9"><a href="#cb70-9" aria-hidden="true" tabindex="-1"></a>animal_locations <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb70-10"><a href="#cb70-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">animal_id =</span> <span class="fu">c</span>(<span class="st">"A001"</span>, <span class="st">"A002"</span>, <span class="st">"A003"</span>),</span>
<span id="cb70-11"><a href="#cb70-11" aria-hidden="true" tabindex="-1"></a>  <span class="at">farm_name =</span> <span class="fu">c</span>(<span class="st">"Green Acres"</span>, <span class="st">"Sunny Farm"</span>, <span class="st">"Green Acres"</span>),</span>
<span id="cb70-12"><a href="#cb70-12" aria-hidden="true" tabindex="-1"></a>  <span class="at">state =</span> <span class="fu">c</span>(<span class="st">"Iowa"</span>, <span class="st">"Kansas"</span>, <span class="st">"Iowa"</span>)</span>
<span id="cb70-13"><a href="#cb70-13" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb70-14"><a href="#cb70-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-15"><a href="#cb70-15" aria-hidden="true" tabindex="-1"></a><span class="co"># Join on both farm_name AND state</span></span>
<span id="cb70-16"><a href="#cb70-16" aria-hidden="true" tabindex="-1"></a>animal_locations <span class="sc">%&gt;%</span></span>
<span id="cb70-17"><a href="#cb70-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(farms, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"farm_name"</span>, <span class="st">"state"</span>))</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 4
  animal_id farm_name   state  size_acres
  &lt;chr&gt;     &lt;chr&gt;       &lt;chr&gt;       &lt;dbl&gt;
1 A001      Green Acres Iowa          500
2 A002      Sunny Farm  Kansas        350
3 A003      Green Acres Iowa          500</code></pre>
</div>
</div>
</section>
<section id="joining-with-different-column-names" class="level3" data-number="7.5.8">
<h3 data-number="7.5.8" class="anchored" data-anchor-id="joining-with-different-column-names"><span class="header-section-number">7.5.8</span> Joining with Different Column Names</h3>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb72"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb72-1"><a href="#cb72-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Different ID column names</span></span>
<span id="cb72-2"><a href="#cb72-2" aria-hidden="true" tabindex="-1"></a>table1 <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb72-3"><a href="#cb72-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">animal_id =</span> <span class="fu">c</span>(<span class="st">"A001"</span>, <span class="st">"A002"</span>, <span class="st">"A003"</span>),</span>
<span id="cb72-4"><a href="#cb72-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">weight_kg =</span> <span class="fu">c</span>(<span class="dv">180</span>, <span class="dv">150</span>, <span class="dv">200</span>)</span>
<span id="cb72-5"><a href="#cb72-5" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb72-6"><a href="#cb72-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-7"><a href="#cb72-7" aria-hidden="true" tabindex="-1"></a>table2 <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb72-8"><a href="#cb72-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">id =</span> <span class="fu">c</span>(<span class="st">"A001"</span>, <span class="st">"A002"</span>, <span class="st">"A004"</span>),</span>
<span id="cb72-9"><a href="#cb72-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">breed =</span> <span class="fu">c</span>(<span class="st">"Holstein"</span>, <span class="st">"Jersey"</span>, <span class="st">"Angus"</span>)</span>
<span id="cb72-10"><a href="#cb72-10" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb72-11"><a href="#cb72-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-12"><a href="#cb72-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Specify which columns to join on</span></span>
<span id="cb72-13"><a href="#cb72-13" aria-hidden="true" tabindex="-1"></a>table1 <span class="sc">%&gt;%</span></span>
<span id="cb72-14"><a href="#cb72-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(table2, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"animal_id"</span> <span class="ot">=</span> <span class="st">"id"</span>))</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 3
  animal_id weight_kg breed   
  &lt;chr&gt;         &lt;dbl&gt; &lt;chr&gt;   
1 A001            180 Holstein
2 A002            150 Jersey  
3 A003            200 &lt;NA&gt;    </code></pre>
</div>
</div>
</section>
<section id="filtering-joins-filter-rows-dont-add-columns" class="level3" data-number="7.5.9">
<h3 data-number="7.5.9" class="anchored" data-anchor-id="filtering-joins-filter-rows-dont-add-columns"><span class="header-section-number">7.5.9</span> Filtering Joins: Filter Rows (Don’t Add Columns)</h3>
<section id="semi_join-keep-rows-with-matches" class="level4" data-number="7.5.9.1">
<h4 data-number="7.5.9.1" class="anchored" data-anchor-id="semi_join-keep-rows-with-matches"><span class="header-section-number">7.5.9.1</span> <code>semi_join()</code>: Keep Rows with Matches</h4>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb74"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb74-1"><a href="#cb74-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Semi join: keep animals that have treatments (but don't add treatment column)</span></span>
<span id="cb74-2"><a href="#cb74-2" aria-hidden="true" tabindex="-1"></a>animals <span class="sc">%&gt;%</span></span>
<span id="cb74-3"><a href="#cb74-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">semi_join</span>(treatments, <span class="at">by =</span> <span class="st">"animal_id"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 3
  animal_id breed    birth_date
  &lt;chr&gt;     &lt;chr&gt;    &lt;date&gt;    
1 A001      Holstein 2023-01-15
2 A002      Jersey   2023-02-20
3 A003      Angus    2023-01-10</code></pre>
</div>
</div>
<p><strong>Use <code>semi_join()</code> to answer</strong>: “Which x rows have a match in y?”</p>
</section>
<section id="anti_join-keep-rows-without-matches" class="level4" data-number="7.5.9.2">
<h4 data-number="7.5.9.2" class="anchored" data-anchor-id="anti_join-keep-rows-without-matches"><span class="header-section-number">7.5.9.2</span> <code>anti_join()</code>: Keep Rows WITHOUT Matches</h4>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb76"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb76-1"><a href="#cb76-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Anti join: keep animals that DON'T have treatments</span></span>
<span id="cb76-2"><a href="#cb76-2" aria-hidden="true" tabindex="-1"></a>animals <span class="sc">%&gt;%</span></span>
<span id="cb76-3"><a href="#cb76-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">anti_join</span>(treatments, <span class="at">by =</span> <span class="st">"animal_id"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1 × 3
  animal_id breed    birth_date
  &lt;chr&gt;     &lt;chr&gt;    &lt;date&gt;    
1 A004      Holstein 2023-03-05</code></pre>
</div>
</div>
<p><strong>Use <code>anti_join()</code> to answer</strong>: “Which x rows DON’T have a match in y?”</p>
<p>This is incredibly useful for finding missing data or orphaned records.</p>
</section>
</section>
<section id="join-summary-table" class="level3" data-number="7.5.10">
<h3 data-number="7.5.10" class="anchored" data-anchor-id="join-summary-table"><span class="header-section-number">7.5.10</span> Join Summary Table</h3>
<table class="caption-top table">
<colgroup>
<col style="width: 23%">
<col style="width: 23%">
<col style="width: 31%">
<col style="width: 21%">
</colgroup>
<thead>
<tr class="header">
<th>Join Type</th>
<th>Rows Kept</th>
<th>Columns Added</th>
<th>Use When</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><code>left_join(x, y)</code></td>
<td>All from x</td>
<td>From y</td>
<td>Adding info to main table</td>
</tr>
<tr class="even">
<td><code>right_join(x, y)</code></td>
<td>All from y</td>
<td>From x</td>
<td>Rarely used (use left_join instead)</td>
</tr>
<tr class="odd">
<td><code>inner_join(x, y)</code></td>
<td>Only matches</td>
<td>From both</td>
<td>Only want complete cases</td>
</tr>
<tr class="even">
<td><code>full_join(x, y)</code></td>
<td>All from both</td>
<td>From both</td>
<td>Keep everything</td>
</tr>
<tr class="odd">
<td><code>semi_join(x, y)</code></td>
<td>Matches from x</td>
<td>None</td>
<td>Filter x by presence in y</td>
</tr>
<tr class="even">
<td><code>anti_join(x, y)</code></td>
<td>Non-matches from x</td>
<td>None</td>
<td>Filter x by absence in y</td>
</tr>
</tbody>
</table>
</section>
<section id="common-join-problems-and-solutions" class="level3" data-number="7.5.11">
<h3 data-number="7.5.11" class="anchored" data-anchor-id="common-join-problems-and-solutions"><span class="header-section-number">7.5.11</span> Common Join Problems and Solutions</h3>
<section id="problem-1-duplicate-keys" class="level4" data-number="7.5.11.1">
<h4 data-number="7.5.11.1" class="anchored" data-anchor-id="problem-1-duplicate-keys"><span class="header-section-number">7.5.11.1</span> Problem 1: Duplicate Keys</h4>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb78"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb78-1"><a href="#cb78-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Multiple weights per animal</span></span>
<span id="cb78-2"><a href="#cb78-2" aria-hidden="true" tabindex="-1"></a>weights_dup <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb78-3"><a href="#cb78-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">animal_id =</span> <span class="fu">c</span>(<span class="st">"A001"</span>, <span class="st">"A001"</span>, <span class="st">"A002"</span>),</span>
<span id="cb78-4"><a href="#cb78-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">weight_kg =</span> <span class="fu">c</span>(<span class="dv">180</span>, <span class="dv">185</span>, <span class="dv">150</span>)</span>
<span id="cb78-5"><a href="#cb78-5" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb78-6"><a href="#cb78-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-7"><a href="#cb78-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Join creates all combinations</span></span>
<span id="cb78-8"><a href="#cb78-8" aria-hidden="true" tabindex="-1"></a>animals <span class="sc">%&gt;%</span></span>
<span id="cb78-9"><a href="#cb78-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(weights_dup, <span class="at">by =</span> <span class="st">"animal_id"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 5 × 4
  animal_id breed    birth_date weight_kg
  &lt;chr&gt;     &lt;chr&gt;    &lt;date&gt;         &lt;dbl&gt;
1 A001      Holstein 2023-01-15       180
2 A001      Holstein 2023-01-15       185
3 A002      Jersey   2023-02-20       150
4 A003      Angus    2023-01-10        NA
5 A004      Holstein 2023-03-05        NA</code></pre>
</div>
</div>
<p><strong>Solution</strong>: If you only want one weight per animal, summarize first:</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb80"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb80-1"><a href="#cb80-1" aria-hidden="true" tabindex="-1"></a>weights_dup <span class="sc">%&gt;%</span></span>
<span id="cb80-2"><a href="#cb80-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(animal_id) <span class="sc">%&gt;%</span></span>
<span id="cb80-3"><a href="#cb80-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">avg_weight_kg =</span> <span class="fu">mean</span>(weight_kg), <span class="at">.groups =</span> <span class="st">"drop"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb80-4"><a href="#cb80-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(animals, ., <span class="at">by =</span> <span class="st">"animal_id"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 4 × 4
  animal_id breed    birth_date avg_weight_kg
  &lt;chr&gt;     &lt;chr&gt;    &lt;date&gt;             &lt;dbl&gt;
1 A001      Holstein 2023-01-15          182.
2 A002      Jersey   2023-02-20          150 
3 A003      Angus    2023-01-10           NA 
4 A004      Holstein 2023-03-05           NA </code></pre>
</div>
</div>
<div class="callout callout-style-default callout-warning callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
<span class="screen-reader-only">Warning</span>Always Specify <code>by =</code>
</div>
</div>
<div class="callout-body-container callout-body">
<p>If you don’t specify <code>by</code>, joins use all columns with the same name. This can lead to: - Unintended matches - Silent errors - Confusing results</p>
<p><strong>Best practice</strong>: Always explicitly state <code>by = "column_name"</code></p>
</div>
</div>
</section>
</section>
<section id="real-world-example-combining-multiple-tables" class="level3" data-number="7.5.12">
<h3 data-number="7.5.12" class="anchored" data-anchor-id="real-world-example-combining-multiple-tables"><span class="header-section-number">7.5.12</span> Real-World Example: Combining Multiple Tables</h3>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb82"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb82-1"><a href="#cb82-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Start with animals</span></span>
<span id="cb82-2"><a href="#cb82-2" aria-hidden="true" tabindex="-1"></a>result <span class="ot">&lt;-</span> animals <span class="sc">%&gt;%</span></span>
<span id="cb82-3"><a href="#cb82-3" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Add treatments</span></span>
<span id="cb82-4"><a href="#cb82-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(treatments, <span class="at">by =</span> <span class="st">"animal_id"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb82-5"><a href="#cb82-5" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Add weights (keeping all weight records)</span></span>
<span id="cb82-6"><a href="#cb82-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(weights, <span class="at">by =</span> <span class="st">"animal_id"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb82-7"><a href="#cb82-7" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Calculate age at weighing</span></span>
<span id="cb82-8"><a href="#cb82-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb82-9"><a href="#cb82-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">age_days =</span> <span class="fu">as.numeric</span>(date <span class="sc">-</span> birth_date),</span>
<span id="cb82-10"><a href="#cb82-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">.after =</span> date</span>
<span id="cb82-11"><a href="#cb82-11" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb82-12"><a href="#cb82-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-13"><a href="#cb82-13" aria-hidden="true" tabindex="-1"></a>result</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 × 7
  animal_id breed    birth_date treatment   date       age_days weight_kg
  &lt;chr&gt;     &lt;chr&gt;    &lt;date&gt;     &lt;chr&gt;       &lt;date&gt;        &lt;dbl&gt;     &lt;dbl&gt;
1 A001      Holstein 2023-01-15 Control     2023-06-01      137       180
2 A001      Holstein 2023-01-15 Control     2023-09-01      229       220
3 A002      Jersey   2023-02-20 Treatment_A 2023-06-01      101       150
4 A002      Jersey   2023-02-20 Treatment_A 2023-09-01      193       185
5 A003      Angus    2023-01-10 Treatment_B NA               NA        NA
6 A004      Holstein 2023-03-05 &lt;NA&gt;        NA               NA        NA</code></pre>
</div>
</div>
<hr>
</section>
</section>
<section id="binding-datasets" class="level2" data-number="7.6">
<h2 data-number="7.6" class="anchored" data-anchor-id="binding-datasets"><span class="header-section-number">7.6</span> Binding Datasets</h2>
<p>Sometimes you need to combine datasets by <strong>stacking</strong> (rows) or <strong>attaching</strong> (columns), not by joining on keys.</p>
<section id="bind_rows-stack-datasets-vertically" class="level3" data-number="7.6.1">
<h3 data-number="7.6.1" class="anchored" data-anchor-id="bind_rows-stack-datasets-vertically"><span class="header-section-number">7.6.1</span> <code>bind_rows()</code>: Stack Datasets Vertically</h3>
<p>Use when you have the same structure in multiple datasets.</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb84"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb84-1"><a href="#cb84-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Data from multiple farms</span></span>
<span id="cb84-2"><a href="#cb84-2" aria-hidden="true" tabindex="-1"></a>farm_a <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb84-3"><a href="#cb84-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">animal_id =</span> <span class="fu">c</span>(<span class="st">"A001"</span>, <span class="st">"A002"</span>),</span>
<span id="cb84-4"><a href="#cb84-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">weight_kg =</span> <span class="fu">c</span>(<span class="dv">180</span>, <span class="dv">150</span>),</span>
<span id="cb84-5"><a href="#cb84-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">farm =</span> <span class="st">"Farm_A"</span></span>
<span id="cb84-6"><a href="#cb84-6" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb84-7"><a href="#cb84-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-8"><a href="#cb84-8" aria-hidden="true" tabindex="-1"></a>farm_b <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb84-9"><a href="#cb84-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">animal_id =</span> <span class="fu">c</span>(<span class="st">"B001"</span>, <span class="st">"B002"</span>),</span>
<span id="cb84-10"><a href="#cb84-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">weight_kg =</span> <span class="fu">c</span>(<span class="dv">170</span>, <span class="dv">160</span>),</span>
<span id="cb84-11"><a href="#cb84-11" aria-hidden="true" tabindex="-1"></a>  <span class="at">farm =</span> <span class="st">"Farm_B"</span></span>
<span id="cb84-12"><a href="#cb84-12" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb84-13"><a href="#cb84-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-14"><a href="#cb84-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Stack them</span></span>
<span id="cb84-15"><a href="#cb84-15" aria-hidden="true" tabindex="-1"></a><span class="fu">bind_rows</span>(farm_a, farm_b)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 4 × 3
  animal_id weight_kg farm  
  &lt;chr&gt;         &lt;dbl&gt; &lt;chr&gt; 
1 A001            180 Farm_A
2 A002            150 Farm_A
3 B001            170 Farm_B
4 B002            160 Farm_B</code></pre>
</div>
</div>
<section id="handling-missing-columns" class="level4" data-number="7.6.1.1">
<h4 data-number="7.6.1.1" class="anchored" data-anchor-id="handling-missing-columns"><span class="header-section-number">7.6.1.1</span> Handling Missing Columns</h4>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb86"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb86-1"><a href="#cb86-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Different columns</span></span>
<span id="cb86-2"><a href="#cb86-2" aria-hidden="true" tabindex="-1"></a>df1 <span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="at">animal_id =</span> <span class="st">"A001"</span>, <span class="at">weight_kg =</span> <span class="dv">180</span>)</span>
<span id="cb86-3"><a href="#cb86-3" aria-hidden="true" tabindex="-1"></a>df2 <span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="at">animal_id =</span> <span class="st">"B001"</span>, <span class="at">height_cm =</span> <span class="dv">125</span>)</span>
<span id="cb86-4"><a href="#cb86-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-5"><a href="#cb86-5" aria-hidden="true" tabindex="-1"></a><span class="co"># bind_rows() fills missing columns with NA</span></span>
<span id="cb86-6"><a href="#cb86-6" aria-hidden="true" tabindex="-1"></a><span class="fu">bind_rows</span>(df1, df2)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 2 × 3
  animal_id weight_kg height_cm
  &lt;chr&gt;         &lt;dbl&gt;     &lt;dbl&gt;
1 A001            180        NA
2 B001             NA       125</code></pre>
</div>
</div>
</section>
<section id="adding-source-identifier" class="level4" data-number="7.6.1.2">
<h4 data-number="7.6.1.2" class="anchored" data-anchor-id="adding-source-identifier"><span class="header-section-number">7.6.1.2</span> Adding Source Identifier</h4>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb88"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb88-1"><a href="#cb88-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Or use named list</span></span>
<span id="cb88-2"><a href="#cb88-2" aria-hidden="true" tabindex="-1"></a><span class="fu">bind_rows</span>(</span>
<span id="cb88-3"><a href="#cb88-3" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Iowa"</span> <span class="ot">=</span> farm_a,</span>
<span id="cb88-4"><a href="#cb88-4" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Kansas"</span> <span class="ot">=</span> farm_b,</span>
<span id="cb88-5"><a href="#cb88-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">.id =</span> <span class="st">"state"</span></span>
<span id="cb88-6"><a href="#cb88-6" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 4 × 4
  state  animal_id weight_kg farm  
  &lt;chr&gt;  &lt;chr&gt;         &lt;dbl&gt; &lt;chr&gt; 
1 Iowa   A001            180 Farm_A
2 Iowa   A002            150 Farm_A
3 Kansas B001            170 Farm_B
4 Kansas B002            160 Farm_B</code></pre>
</div>
</div>
</section>
</section>
<section id="bind_cols-attach-datasets-horizontally" class="level3" data-number="7.6.2">
<h3 data-number="7.6.2" class="anchored" data-anchor-id="bind_cols-attach-datasets-horizontally"><span class="header-section-number">7.6.2</span> <code>bind_cols()</code>: Attach Datasets Horizontally</h3>
<div class="callout callout-style-default callout-warning callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
<span class="screen-reader-only">Warning</span>Use <code>bind_cols()</code> with Caution!
</div>
</div>
<div class="callout-body-container callout-body">
<p><code>bind_cols()</code> simply attaches columns side-by-side based on row position. It does NOT match by keys!</p>
<p><strong>Problems</strong>: - No checking if rows actually match - Row order must be identical - Easy to create mismatched data</p>
<p><strong>Better alternative</strong>: Use a join with a row number or ID column.</p>
</div>
</div>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb90"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb90-1"><a href="#cb90-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Two datasets with same row order (risky!)</span></span>
<span id="cb90-2"><a href="#cb90-2" aria-hidden="true" tabindex="-1"></a>ids <span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="at">animal_id =</span> <span class="fu">c</span>(<span class="st">"A001"</span>, <span class="st">"A002"</span>, <span class="st">"A003"</span>))</span>
<span id="cb90-3"><a href="#cb90-3" aria-hidden="true" tabindex="-1"></a>weights <span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="at">weight_kg =</span> <span class="fu">c</span>(<span class="dv">180</span>, <span class="dv">150</span>, <span class="dv">200</span>))</span>
<span id="cb90-4"><a href="#cb90-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb90-5"><a href="#cb90-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Attach side-by-side</span></span>
<span id="cb90-6"><a href="#cb90-6" aria-hidden="true" tabindex="-1"></a><span class="fu">bind_cols</span>(ids, weights)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 2
  animal_id weight_kg
  &lt;chr&gt;         &lt;dbl&gt;
1 A001            180
2 A002            150
3 A003            200</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb92"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb92-1"><a href="#cb92-1" aria-hidden="true" tabindex="-1"></a><span class="co"># MUCH SAFER: Use mutate instead if they're truly row-aligned</span></span>
<span id="cb92-2"><a href="#cb92-2" aria-hidden="true" tabindex="-1"></a>ids <span class="sc">%&gt;%</span></span>
<span id="cb92-3"><a href="#cb92-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">weight_kg =</span> weights<span class="sc">$</span>weight_kg)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 2
  animal_id weight_kg
  &lt;chr&gt;         &lt;dbl&gt;
1 A001            180
2 A002            150
3 A003            200</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb94"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb94-1"><a href="#cb94-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Or use a proper join if you have keys!</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
</section>
<section id="when-to-use-binding-vs-joining" class="level3" data-number="7.6.3">
<h3 data-number="7.6.3" class="anchored" data-anchor-id="when-to-use-binding-vs-joining"><span class="header-section-number">7.6.3</span> When to Use Binding vs Joining</h3>
<table class="caption-top table">
<thead>
<tr class="header">
<th>Use</th>
<th><code>bind_rows()</code></th>
<th><code>bind_cols()</code></th>
<th>Join</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Same structure, stack vertically</td>
<td>✅</td>
<td>❌</td>
<td>❌</td>
</tr>
<tr class="even">
<td>Different farms/time periods</td>
<td>✅</td>
<td>❌</td>
<td>❌</td>
</tr>
<tr class="odd">
<td>Add columns based on keys</td>
<td>❌</td>
<td>❌</td>
<td>✅</td>
</tr>
<tr class="even">
<td>Row-aligned data (same order)</td>
<td>❌</td>
<td>⚠️ Use with caution</td>
<td>❌</td>
</tr>
<tr class="odd">
<td>Relational data (shared IDs)</td>
<td>❌</td>
<td>❌</td>
<td>✅</td>
</tr>
</tbody>
</table>
<hr>
</section>
</section>
<section id="iteration-with-purrr" class="level2" data-number="7.7">
<h2 data-number="7.7" class="anchored" data-anchor-id="iteration-with-purrr"><span class="header-section-number">7.7</span> Iteration with purrr</h2>
<p>The <code>purrr</code> package provides tools for <strong>functional programming</strong> — applying functions across elements of a list or vector.</p>
<section id="why-use-map-instead-of-loops" class="level3" data-number="7.7.1">
<h3 data-number="7.7.1" class="anchored" data-anchor-id="why-use-map-instead-of-loops"><span class="header-section-number">7.7.1</span> Why Use <code>map()</code> Instead of Loops?</h3>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb95"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb95-1"><a href="#cb95-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Example: Calculate mean of each column</span></span>
<span id="cb95-2"><a href="#cb95-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb95-3"><a href="#cb95-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Base R loop approach</span></span>
<span id="cb95-4"><a href="#cb95-4" aria-hidden="true" tabindex="-1"></a>col_means_loop <span class="ot">&lt;-</span> <span class="fu">numeric</span>(<span class="fu">ncol</span>(mtcars))</span>
<span id="cb95-5"><a href="#cb95-5" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="fu">seq_along</span>(mtcars)) {</span>
<span id="cb95-6"><a href="#cb95-6" aria-hidden="true" tabindex="-1"></a>  col_means_loop[i] <span class="ot">&lt;-</span> <span class="fu">mean</span>(mtcars[[i]])</span>
<span id="cb95-7"><a href="#cb95-7" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb95-8"><a href="#cb95-8" aria-hidden="true" tabindex="-1"></a>col_means_loop</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code> [1]  20.090625   6.187500 230.721875 146.687500   3.596563   3.217250
 [7]  17.848750   0.437500   0.406250   3.687500   2.812500</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb97"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb97-1"><a href="#cb97-1" aria-hidden="true" tabindex="-1"></a><span class="co"># purrr approach</span></span>
<span id="cb97-2"><a href="#cb97-2" aria-hidden="true" tabindex="-1"></a>col_means_map <span class="ot">&lt;-</span> <span class="fu">map_dbl</span>(mtcars, mean)</span>
<span id="cb97-3"><a href="#cb97-3" aria-hidden="true" tabindex="-1"></a>col_means_map</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>       mpg        cyl       disp         hp       drat         wt       qsec 
 20.090625   6.187500 230.721875 146.687500   3.596563   3.217250  17.848750 
        vs         am       gear       carb 
  0.437500   0.406250   3.687500   2.812500 </code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb99"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb99-1"><a href="#cb99-1" aria-hidden="true" tabindex="-1"></a><span class="co"># They're the same!</span></span>
<span id="cb99-2"><a href="#cb99-2" aria-hidden="true" tabindex="-1"></a><span class="fu">all.equal</span>(col_means_loop, col_means_map)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "names for current but not for target"</code></pre>
</div>
</div>
<p><strong>Benefits of <code>map()</code></strong>: - More concise - Less error-prone (no index management) - Easier to read intent - Consistent return types</p>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
<span class="screen-reader-only">Note</span>When to Use Loops vs <code>map()</code>
</div>
</div>
<div class="callout-body-container callout-body">
<p><strong>Use loops when</strong>: - You need to modify objects in place - The operation depends on previous iterations - The logic is complex and loops are clearer</p>
<p><strong>Use <code>map()</code> when</strong>: - Applying the same operation to each element - You want consistent output types - You’re working with lists or data frames</p>
</div>
</div>
</section>
<section id="basic-map-functions" class="level3" data-number="7.7.2">
<h3 data-number="7.7.2" class="anchored" data-anchor-id="basic-map-functions"><span class="header-section-number">7.7.2</span> Basic <code>map()</code> Functions</h3>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb101"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb101-1"><a href="#cb101-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Create example data</span></span>
<span id="cb101-2"><a href="#cb101-2" aria-hidden="true" tabindex="-1"></a>numbers <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb101-3"><a href="#cb101-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">a =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">4</span>, <span class="dv">5</span>),</span>
<span id="cb101-4"><a href="#cb101-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">b =</span> <span class="fu">c</span>(<span class="dv">10</span>, <span class="dv">20</span>, <span class="dv">30</span>),</span>
<span id="cb101-5"><a href="#cb101-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">c =</span> <span class="fu">c</span>(<span class="dv">100</span>, <span class="dv">200</span>, <span class="dv">300</span>, <span class="dv">400</span>)</span>
<span id="cb101-6"><a href="#cb101-6" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb101-7"><a href="#cb101-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb101-8"><a href="#cb101-8" aria-hidden="true" tabindex="-1"></a><span class="co"># map() returns a list</span></span>
<span id="cb101-9"><a href="#cb101-9" aria-hidden="true" tabindex="-1"></a><span class="fu">map</span>(numbers, mean)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>$a
[1] 3

$b
[1] 20

$c
[1] 250</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb103"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb103-1"><a href="#cb103-1" aria-hidden="true" tabindex="-1"></a><span class="co"># map_dbl() returns a numeric vector</span></span>
<span id="cb103-2"><a href="#cb103-2" aria-hidden="true" tabindex="-1"></a><span class="fu">map_dbl</span>(numbers, mean)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>  a   b   c 
  3  20 250 </code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb105"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb105-1"><a href="#cb105-1" aria-hidden="true" tabindex="-1"></a><span class="co"># map_chr() returns a character vector</span></span>
<span id="cb105-2"><a href="#cb105-2" aria-hidden="true" tabindex="-1"></a><span class="fu">map_chr</span>(numbers, \(x) <span class="fu">paste</span>(<span class="st">"Mean:"</span>, <span class="fu">round</span>(<span class="fu">mean</span>(x), <span class="dv">1</span>)))</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>          a           b           c 
  "Mean: 3"  "Mean: 20" "Mean: 250" </code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb107"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb107-1"><a href="#cb107-1" aria-hidden="true" tabindex="-1"></a><span class="co"># map_int() returns an integer vector</span></span>
<span id="cb107-2"><a href="#cb107-2" aria-hidden="true" tabindex="-1"></a><span class="fu">map_int</span>(numbers, length)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>a b c 
5 3 4 </code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb109"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb109-1"><a href="#cb109-1" aria-hidden="true" tabindex="-1"></a><span class="co"># map_lgl() returns a logical vector</span></span>
<span id="cb109-2"><a href="#cb109-2" aria-hidden="true" tabindex="-1"></a><span class="fu">map_lgl</span>(numbers, \(x) <span class="fu">mean</span>(x) <span class="sc">&gt;</span> <span class="dv">50</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>    a     b     c 
FALSE FALSE  TRUE </code></pre>
</div>
</div>
</section>
<section id="map-with-data-frames" class="level3" data-number="7.7.3">
<h3 data-number="7.7.3" class="anchored" data-anchor-id="map-with-data-frames"><span class="header-section-number">7.7.3</span> <code>map()</code> with Data Frames</h3>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb111"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb111-1"><a href="#cb111-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Create example animal data</span></span>
<span id="cb111-2"><a href="#cb111-2" aria-hidden="true" tabindex="-1"></a>animals_list <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb111-3"><a href="#cb111-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">farm_a =</span> <span class="fu">tibble</span>(<span class="at">animal_id =</span> <span class="fu">c</span>(<span class="st">"A001"</span>, <span class="st">"A002"</span>), <span class="at">weight_kg =</span> <span class="fu">c</span>(<span class="dv">180</span>, <span class="dv">150</span>)),</span>
<span id="cb111-4"><a href="#cb111-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">farm_b =</span> <span class="fu">tibble</span>(<span class="at">animal_id =</span> <span class="fu">c</span>(<span class="st">"B001"</span>, <span class="st">"B002"</span>), <span class="at">weight_kg =</span> <span class="fu">c</span>(<span class="dv">170</span>, <span class="dv">160</span>)),</span>
<span id="cb111-5"><a href="#cb111-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">farm_c =</span> <span class="fu">tibble</span>(<span class="at">animal_id =</span> <span class="fu">c</span>(<span class="st">"C001"</span>, <span class="st">"C002"</span>), <span class="at">weight_kg =</span> <span class="fu">c</span>(<span class="dv">190</span>, <span class="dv">165</span>))</span>
<span id="cb111-6"><a href="#cb111-6" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb111-7"><a href="#cb111-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb111-8"><a href="#cb111-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate mean weight for each farm</span></span>
<span id="cb111-9"><a href="#cb111-9" aria-hidden="true" tabindex="-1"></a><span class="fu">map_dbl</span>(animals_list, \(df) <span class="fu">mean</span>(df<span class="sc">$</span>weight_kg))</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>farm_a farm_b farm_c 
 165.0  165.0  177.5 </code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb113"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb113-1"><a href="#cb113-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Count rows in each data frame</span></span>
<span id="cb113-2"><a href="#cb113-2" aria-hidden="true" tabindex="-1"></a><span class="fu">map_int</span>(animals_list, nrow)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>farm_a farm_b farm_c 
     2      2      2 </code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb115"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb115-1"><a href="#cb115-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Add a new column to each data frame</span></span>
<span id="cb115-2"><a href="#cb115-2" aria-hidden="true" tabindex="-1"></a><span class="fu">map</span>(animals_list, \(df) <span class="fu">mutate</span>(df, <span class="at">weight_lb =</span> weight_kg <span class="sc">*</span> <span class="fl">2.20462</span>))</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>$farm_a
# A tibble: 2 × 3
  animal_id weight_kg weight_lb
  &lt;chr&gt;         &lt;dbl&gt;     &lt;dbl&gt;
1 A001            180      397.
2 A002            150      331.

$farm_b
# A tibble: 2 × 3
  animal_id weight_kg weight_lb
  &lt;chr&gt;         &lt;dbl&gt;     &lt;dbl&gt;
1 B001            170      375.
2 B002            160      353.

$farm_c
# A tibble: 2 × 3
  animal_id weight_kg weight_lb
  &lt;chr&gt;         &lt;dbl&gt;     &lt;dbl&gt;
1 C001            190      419.
2 C002            165      364.</code></pre>
</div>
</div>
</section>
<section id="anonymous-functions-in-map" class="level3" data-number="7.7.4">
<h3 data-number="7.7.4" class="anchored" data-anchor-id="anonymous-functions-in-map"><span class="header-section-number">7.7.4</span> Anonymous Functions in <code>map()</code></h3>
<p>Three ways to write anonymous functions:</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb117"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb117-1"><a href="#cb117-1" aria-hidden="true" tabindex="-1"></a>numbers <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="at">a =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>, <span class="at">b =</span> <span class="dv">10</span><span class="sc">:</span><span class="dv">15</span>, <span class="at">c =</span> <span class="dv">20</span><span class="sc">:</span><span class="dv">25</span>)</span>
<span id="cb117-2"><a href="#cb117-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb117-3"><a href="#cb117-3" aria-hidden="true" tabindex="-1"></a><span class="co"># 1. Traditional function() syntax</span></span>
<span id="cb117-4"><a href="#cb117-4" aria-hidden="true" tabindex="-1"></a><span class="fu">map_dbl</span>(numbers, <span class="cf">function</span>(x) <span class="fu">mean</span>(x) <span class="sc">*</span> <span class="dv">2</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code> a  b  c 
 6 25 45 </code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb119"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb119-1"><a href="#cb119-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 2. Formula shorthand with ~ and .x</span></span>
<span id="cb119-2"><a href="#cb119-2" aria-hidden="true" tabindex="-1"></a><span class="fu">map_dbl</span>(numbers, <span class="sc">~</span> <span class="fu">mean</span>(.x) <span class="sc">*</span> <span class="dv">2</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code> a  b  c 
 6 25 45 </code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb121"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb121-1"><a href="#cb121-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 3. Lambda function with \() (R &gt;= 4.1)</span></span>
<span id="cb121-2"><a href="#cb121-2" aria-hidden="true" tabindex="-1"></a><span class="fu">map_dbl</span>(numbers, \(x) <span class="fu">mean</span>(x) <span class="sc">*</span> <span class="dv">2</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code> a  b  c 
 6 25 45 </code></pre>
</div>
</div>
<p>All three are equivalent. Use whichever you find most readable.</p>
</section>
<section id="map2-iterate-over-two-inputs" class="level3" data-number="7.7.5">
<h3 data-number="7.7.5" class="anchored" data-anchor-id="map2-iterate-over-two-inputs"><span class="header-section-number">7.7.5</span> <code>map2()</code>: Iterate Over Two Inputs</h3>
<p>When you need to iterate over two vectors/lists in parallel:</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb123"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb123-1"><a href="#cb123-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Two vectors to iterate over</span></span>
<span id="cb123-2"><a href="#cb123-2" aria-hidden="true" tabindex="-1"></a>weights_kg <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">180</span>, <span class="dv">150</span>, <span class="dv">200</span>)</span>
<span id="cb123-3"><a href="#cb123-3" aria-hidden="true" tabindex="-1"></a>prices_per_kg <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">5</span>, <span class="fl">5.50</span>, <span class="fl">4.80</span>)</span>
<span id="cb123-4"><a href="#cb123-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb123-5"><a href="#cb123-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate total value for each animal</span></span>
<span id="cb123-6"><a href="#cb123-6" aria-hidden="true" tabindex="-1"></a><span class="fu">map2_dbl</span>(weights_kg, prices_per_kg, \(w, p) w <span class="sc">*</span> p)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 900 825 960</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb125"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb125-1"><a href="#cb125-1" aria-hidden="true" tabindex="-1"></a><span class="co"># With names</span></span>
<span id="cb125-2"><a href="#cb125-2" aria-hidden="true" tabindex="-1"></a>animals <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"A001"</span>, <span class="st">"A002"</span>, <span class="st">"A003"</span>)</span>
<span id="cb125-3"><a href="#cb125-3" aria-hidden="true" tabindex="-1"></a><span class="fu">map2_chr</span>(animals, weights_kg, \(id, wt) <span class="fu">paste</span>(id, <span class="st">"weighs"</span>, wt, <span class="st">"kg"</span>))</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "A001 weighs 180 kg" "A002 weighs 150 kg" "A003 weighs 200 kg"</code></pre>
</div>
</div>
</section>
<section id="pmap-iterate-over-many-inputs" class="level3" data-number="7.7.6">
<h3 data-number="7.7.6" class="anchored" data-anchor-id="pmap-iterate-over-many-inputs"><span class="header-section-number">7.7.6</span> <code>pmap()</code>: Iterate Over Many Inputs</h3>
<p>For more than two inputs, use <code>pmap()</code>:</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb127"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb127-1"><a href="#cb127-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Data frame with multiple columns</span></span>
<span id="cb127-2"><a href="#cb127-2" aria-hidden="true" tabindex="-1"></a>sales <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb127-3"><a href="#cb127-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">animal_id =</span> <span class="fu">c</span>(<span class="st">"A001"</span>, <span class="st">"A002"</span>, <span class="st">"A003"</span>),</span>
<span id="cb127-4"><a href="#cb127-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">weight_kg =</span> <span class="fu">c</span>(<span class="dv">180</span>, <span class="dv">150</span>, <span class="dv">200</span>),</span>
<span id="cb127-5"><a href="#cb127-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">price_per_kg =</span> <span class="fu">c</span>(<span class="dv">5</span>, <span class="fl">5.50</span>, <span class="fl">4.80</span>),</span>
<span id="cb127-6"><a href="#cb127-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">bonus =</span> <span class="fu">c</span>(<span class="dv">50</span>, <span class="dv">30</span>, <span class="dv">60</span>)</span>
<span id="cb127-7"><a href="#cb127-7" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb127-8"><a href="#cb127-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb127-9"><a href="#cb127-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate total value: (weight * price) + bonus</span></span>
<span id="cb127-10"><a href="#cb127-10" aria-hidden="true" tabindex="-1"></a>sales <span class="sc">%&gt;%</span></span>
<span id="cb127-11"><a href="#cb127-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb127-12"><a href="#cb127-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">total_value =</span> <span class="fu">pmap_dbl</span>(</span>
<span id="cb127-13"><a href="#cb127-13" aria-hidden="true" tabindex="-1"></a>      <span class="fu">list</span>(weight_kg, price_per_kg, bonus),</span>
<span id="cb127-14"><a href="#cb127-14" aria-hidden="true" tabindex="-1"></a>      \(w, p, b) (w <span class="sc">*</span> p) <span class="sc">+</span> b</span>
<span id="cb127-15"><a href="#cb127-15" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb127-16"><a href="#cb127-16" aria-hidden="true" tabindex="-1"></a>  )</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 5
  animal_id weight_kg price_per_kg bonus total_value
  &lt;chr&gt;         &lt;dbl&gt;        &lt;dbl&gt; &lt;dbl&gt;       &lt;dbl&gt;
1 A001            180          5      50         950
2 A002            150          5.5    30         855
3 A003            200          4.8    60        1020</code></pre>
</div>
</div>
</section>
<section id="practical-example-reading-multiple-files" class="level3" data-number="7.7.7">
<h3 data-number="7.7.7" class="anchored" data-anchor-id="practical-example-reading-multiple-files"><span class="header-section-number">7.7.7</span> Practical Example: Reading Multiple Files</h3>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb129"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb129-1"><a href="#cb129-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Get list of CSV files</span></span>
<span id="cb129-2"><a href="#cb129-2" aria-hidden="true" tabindex="-1"></a>file_list <span class="ot">&lt;-</span> <span class="fu">list.files</span>(<span class="at">path =</span> <span class="st">"data/"</span>, <span class="at">pattern =</span> <span class="st">"*.csv"</span>, <span class="at">full.names =</span> <span class="cn">TRUE</span>)</span>
<span id="cb129-3"><a href="#cb129-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb129-4"><a href="#cb129-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Read all files into a list</span></span>
<span id="cb129-5"><a href="#cb129-5" aria-hidden="true" tabindex="-1"></a>all_data <span class="ot">&lt;-</span> <span class="fu">map</span>(file_list, read_csv)</span>
<span id="cb129-6"><a href="#cb129-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb129-7"><a href="#cb129-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Combine into single data frame with source file</span></span>
<span id="cb129-8"><a href="#cb129-8" aria-hidden="true" tabindex="-1"></a>combined_data <span class="ot">&lt;-</span> <span class="fu">map</span>(file_list, read_csv) <span class="sc">%&gt;%</span></span>
<span id="cb129-9"><a href="#cb129-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set_names</span>(<span class="fu">basename</span>(file_list)) <span class="sc">%&gt;%</span></span>
<span id="cb129-10"><a href="#cb129-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bind_rows</span>(<span class="at">.id =</span> <span class="st">"source_file"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
</section>
<section id="handling-errors-with-safely-and-possibly" class="level3" data-number="7.7.8">
<h3 data-number="7.7.8" class="anchored" data-anchor-id="handling-errors-with-safely-and-possibly"><span class="header-section-number">7.7.8</span> Handling Errors with <code>safely()</code> and <code>possibly()</code></h3>
<p>Sometimes operations fail for some elements. Handle errors gracefully:</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb130"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb130-1"><a href="#cb130-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Some operations might fail</span></span>
<span id="cb130-2"><a href="#cb130-2" aria-hidden="true" tabindex="-1"></a>mixed_list <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb130-3"><a href="#cb130-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">a =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>),</span>
<span id="cb130-4"><a href="#cb130-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">b =</span> <span class="fu">c</span>(<span class="st">"a"</span>, <span class="st">"b"</span>, <span class="st">"c"</span>),  <span class="co"># This will cause an error with mean()</span></span>
<span id="cb130-5"><a href="#cb130-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">c =</span> <span class="fu">c</span>(<span class="dv">10</span>, <span class="dv">20</span>, <span class="dv">30</span>)</span>
<span id="cb130-6"><a href="#cb130-6" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb130-7"><a href="#cb130-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb130-8"><a href="#cb130-8" aria-hidden="true" tabindex="-1"></a><span class="co"># This would error:</span></span>
<span id="cb130-9"><a href="#cb130-9" aria-hidden="true" tabindex="-1"></a><span class="co"># map_dbl(mixed_list, mean)</span></span>
<span id="cb130-10"><a href="#cb130-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb130-11"><a href="#cb130-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Use safely() to catch errors</span></span>
<span id="cb130-12"><a href="#cb130-12" aria-hidden="true" tabindex="-1"></a>safe_mean <span class="ot">&lt;-</span> <span class="fu">safely</span>(mean)</span>
<span id="cb130-13"><a href="#cb130-13" aria-hidden="true" tabindex="-1"></a><span class="fu">map</span>(mixed_list, safe_mean)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>$a
$a$result
[1] 2

$a$error
NULL


$b
$b$result
[1] NA

$b$error
NULL


$c
$c$result
[1] 20

$c$error
NULL</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb132"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb132-1"><a href="#cb132-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Use possibly() to return a default value on error</span></span>
<span id="cb132-2"><a href="#cb132-2" aria-hidden="true" tabindex="-1"></a>possibly_mean <span class="ot">&lt;-</span> <span class="fu">possibly</span>(mean, <span class="at">otherwise =</span> <span class="cn">NA_real_</span>)</span>
<span id="cb132-3"><a href="#cb132-3" aria-hidden="true" tabindex="-1"></a><span class="fu">map_dbl</span>(mixed_list, possibly_mean)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code> a  b  c 
 2 NA 20 </code></pre>
</div>
</div>
<hr>
</section>
</section>
<section id="list-columns-and-nested-data" class="level2" data-number="7.8">
<h2 data-number="7.8" class="anchored" data-anchor-id="list-columns-and-nested-data"><span class="header-section-number">7.8</span> List Columns and Nested Data</h2>
<p>List columns allow you to store complex objects (like data frames) inside data frame cells.</p>
<section id="creating-nested-data" class="level3" data-number="7.8.1">
<h3 data-number="7.8.1" class="anchored" data-anchor-id="creating-nested-data"><span class="header-section-number">7.8.1</span> Creating Nested Data</h3>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb134"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb134-1"><a href="#cb134-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Example: Group and nest</span></span>
<span id="cb134-2"><a href="#cb134-2" aria-hidden="true" tabindex="-1"></a>animals_nested <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb134-3"><a href="#cb134-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">animal_id =</span> <span class="fu">c</span>(<span class="st">"A001"</span>, <span class="st">"A002"</span>, <span class="st">"A003"</span>, <span class="st">"A001"</span>, <span class="st">"A002"</span>, <span class="st">"A003"</span>),</span>
<span id="cb134-4"><a href="#cb134-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">week =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">4</span>, <span class="dv">4</span>, <span class="dv">4</span>),</span>
<span id="cb134-5"><a href="#cb134-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">weight_kg =</span> <span class="fu">c</span>(<span class="dv">45</span>, <span class="dv">42</span>, <span class="dv">48</span>, <span class="dv">52</span>, <span class="dv">48</span>, <span class="dv">54</span>)</span>
<span id="cb134-6"><a href="#cb134-6" aria-hidden="true" tabindex="-1"></a>) <span class="sc">%&gt;%</span></span>
<span id="cb134-7"><a href="#cb134-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(animal_id) <span class="sc">%&gt;%</span></span>
<span id="cb134-8"><a href="#cb134-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">nest</span>()</span>
<span id="cb134-9"><a href="#cb134-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb134-10"><a href="#cb134-10" aria-hidden="true" tabindex="-1"></a>animals_nested</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 2
# Groups:   animal_id [3]
  animal_id data            
  &lt;chr&gt;     &lt;list&gt;          
1 A001      &lt;tibble [2 × 2]&gt;
2 A002      &lt;tibble [2 × 2]&gt;
3 A003      &lt;tibble [2 × 2]&gt;</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb136"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb136-1"><a href="#cb136-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Each row now contains a data frame in the 'data' column</span></span>
<span id="cb136-2"><a href="#cb136-2" aria-hidden="true" tabindex="-1"></a>animals_nested<span class="sc">$</span>data[[<span class="dv">1</span>]]  <span class="co"># Data for first animal</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 2 × 2
   week weight_kg
  &lt;dbl&gt;     &lt;dbl&gt;
1     0        45
2     4        52</code></pre>
</div>
</div>
</section>
<section id="working-with-nested-data" class="level3" data-number="7.8.2">
<h3 data-number="7.8.2" class="anchored" data-anchor-id="working-with-nested-data"><span class="header-section-number">7.8.2</span> Working with Nested Data</h3>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb138"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb138-1"><a href="#cb138-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate statistics for each animal's data</span></span>
<span id="cb138-2"><a href="#cb138-2" aria-hidden="true" tabindex="-1"></a>animals_nested <span class="sc">%&gt;%</span></span>
<span id="cb138-3"><a href="#cb138-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb138-4"><a href="#cb138-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">n_measurements =</span> <span class="fu">map_int</span>(data, nrow),</span>
<span id="cb138-5"><a href="#cb138-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">mean_weight =</span> <span class="fu">map_dbl</span>(data, <span class="sc">~</span><span class="fu">mean</span>(.x<span class="sc">$</span>weight_kg)),</span>
<span id="cb138-6"><a href="#cb138-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">weight_gain =</span> <span class="fu">map_dbl</span>(data, <span class="sc">~</span><span class="fu">diff</span>(<span class="fu">range</span>(.x<span class="sc">$</span>weight_kg)))</span>
<span id="cb138-7"><a href="#cb138-7" aria-hidden="true" tabindex="-1"></a>  )</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 5
# Groups:   animal_id [3]
  animal_id data             n_measurements mean_weight weight_gain
  &lt;chr&gt;     &lt;list&gt;                    &lt;int&gt;       &lt;dbl&gt;       &lt;dbl&gt;
1 A001      &lt;tibble [2 × 2]&gt;              2        48.5           7
2 A002      &lt;tibble [2 × 2]&gt;              2        45             6
3 A003      &lt;tibble [2 × 2]&gt;              2        51             6</code></pre>
</div>
</div>
</section>
<section id="fitting-models-to-nested-data" class="level3" data-number="7.8.3">
<h3 data-number="7.8.3" class="anchored" data-anchor-id="fitting-models-to-nested-data"><span class="header-section-number">7.8.3</span> Fitting Models to Nested Data</h3>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb140"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb140-1"><a href="#cb140-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Create more complete data</span></span>
<span id="cb140-2"><a href="#cb140-2" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">123</span>)</span>
<span id="cb140-3"><a href="#cb140-3" aria-hidden="true" tabindex="-1"></a>growth_data <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb140-4"><a href="#cb140-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">animal_id =</span> <span class="fu">rep</span>(<span class="fu">c</span>(<span class="st">"A001"</span>, <span class="st">"A002"</span>, <span class="st">"A003"</span>), <span class="at">each =</span> <span class="dv">5</span>),</span>
<span id="cb140-5"><a href="#cb140-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">week =</span> <span class="fu">rep</span>(<span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">2</span>, <span class="dv">4</span>, <span class="dv">6</span>, <span class="dv">8</span>), <span class="at">times =</span> <span class="dv">3</span>),</span>
<span id="cb140-6"><a href="#cb140-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">weight_kg =</span> <span class="fu">c</span>(</span>
<span id="cb140-7"><a href="#cb140-7" aria-hidden="true" tabindex="-1"></a>    <span class="dv">45</span> <span class="sc">+</span> (<span class="dv">0</span><span class="sc">:</span><span class="dv">4</span>) <span class="sc">*</span> <span class="dv">2</span> <span class="sc">+</span> <span class="fu">rnorm</span>(<span class="dv">5</span>, <span class="dv">0</span>, <span class="dv">1</span>),  <span class="co"># A001</span></span>
<span id="cb140-8"><a href="#cb140-8" aria-hidden="true" tabindex="-1"></a>    <span class="dv">42</span> <span class="sc">+</span> (<span class="dv">0</span><span class="sc">:</span><span class="dv">4</span>) <span class="sc">*</span> <span class="fl">1.8</span> <span class="sc">+</span> <span class="fu">rnorm</span>(<span class="dv">5</span>, <span class="dv">0</span>, <span class="dv">1</span>),  <span class="co"># A002</span></span>
<span id="cb140-9"><a href="#cb140-9" aria-hidden="true" tabindex="-1"></a>    <span class="dv">48</span> <span class="sc">+</span> (<span class="dv">0</span><span class="sc">:</span><span class="dv">4</span>) <span class="sc">*</span> <span class="fl">2.2</span> <span class="sc">+</span> <span class="fu">rnorm</span>(<span class="dv">5</span>, <span class="dv">0</span>, <span class="dv">1</span>)   <span class="co"># A003</span></span>
<span id="cb140-10"><a href="#cb140-10" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb140-11"><a href="#cb140-11" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb140-12"><a href="#cb140-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb140-13"><a href="#cb140-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Nest by animal</span></span>
<span id="cb140-14"><a href="#cb140-14" aria-hidden="true" tabindex="-1"></a>growth_nested <span class="ot">&lt;-</span> growth_data <span class="sc">%&gt;%</span></span>
<span id="cb140-15"><a href="#cb140-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(animal_id) <span class="sc">%&gt;%</span></span>
<span id="cb140-16"><a href="#cb140-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">nest</span>()</span>
<span id="cb140-17"><a href="#cb140-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb140-18"><a href="#cb140-18" aria-hidden="true" tabindex="-1"></a><span class="co"># Fit linear model to each animal's growth</span></span>
<span id="cb140-19"><a href="#cb140-19" aria-hidden="true" tabindex="-1"></a>growth_nested <span class="ot">&lt;-</span> growth_nested <span class="sc">%&gt;%</span></span>
<span id="cb140-20"><a href="#cb140-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb140-21"><a href="#cb140-21" aria-hidden="true" tabindex="-1"></a>    <span class="at">model =</span> <span class="fu">map</span>(data, <span class="sc">~</span><span class="fu">lm</span>(weight_kg <span class="sc">~</span> week, <span class="at">data =</span> .x)),</span>
<span id="cb140-22"><a href="#cb140-22" aria-hidden="true" tabindex="-1"></a>    <span class="at">growth_rate =</span> <span class="fu">map_dbl</span>(model, <span class="sc">~</span><span class="fu">coef</span>(.x)[<span class="dv">2</span>])</span>
<span id="cb140-23"><a href="#cb140-23" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb140-24"><a href="#cb140-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb140-25"><a href="#cb140-25" aria-hidden="true" tabindex="-1"></a>growth_nested</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 4
# Groups:   animal_id [3]
  animal_id data             model  growth_rate
  &lt;chr&gt;     &lt;list&gt;           &lt;list&gt;       &lt;dbl&gt;
1 A001      &lt;tibble [5 × 2]&gt; &lt;lm&gt;         1.08 
2 A002      &lt;tibble [5 × 2]&gt; &lt;lm&gt;         0.627
3 A003      &lt;tibble [5 × 2]&gt; &lt;lm&gt;         0.910</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb142"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb142-1"><a href="#cb142-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Extract coefficients</span></span>
<span id="cb142-2"><a href="#cb142-2" aria-hidden="true" tabindex="-1"></a>growth_nested <span class="sc">%&gt;%</span></span>
<span id="cb142-3"><a href="#cb142-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(animal_id, growth_rate)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 2
# Groups:   animal_id [3]
  animal_id growth_rate
  &lt;chr&gt;           &lt;dbl&gt;
1 A001            1.08 
2 A002            0.627
3 A003            0.910</code></pre>
</div>
</div>
</section>
<section id="unnesting" class="level3" data-number="7.8.4">
<h3 data-number="7.8.4" class="anchored" data-anchor-id="unnesting"><span class="header-section-number">7.8.4</span> Unnesting</h3>
<p>Convert list columns back to regular rows:</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb144"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb144-1"><a href="#cb144-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Unnest data column</span></span>
<span id="cb144-2"><a href="#cb144-2" aria-hidden="true" tabindex="-1"></a>growth_nested <span class="sc">%&gt;%</span></span>
<span id="cb144-3"><a href="#cb144-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(animal_id, data) <span class="sc">%&gt;%</span></span>
<span id="cb144-4"><a href="#cb144-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unnest</span>(<span class="at">cols =</span> data)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 15 × 3
# Groups:   animal_id [3]
   animal_id  week weight_kg
   &lt;chr&gt;     &lt;dbl&gt;     &lt;dbl&gt;
 1 A001          0      44.4
 2 A001          2      46.8
 3 A001          4      50.6
 4 A001          6      51.1
 5 A001          8      53.1
 6 A002          0      43.7
 7 A002          2      44.3
 8 A002          4      44.3
 9 A002          6      46.7
10 A002          8      48.8
11 A003          0      49.2
12 A003          2      50.6
13 A003          4      52.8
14 A003          6      54.7
15 A003          8      56.2</code></pre>
</div>
</div>
<hr>
</section>
</section>
<section id="summary" class="level2" data-number="7.9">
<h2 data-number="7.9" class="anchored" data-anchor-id="summary"><span class="header-section-number">7.9</span> Summary</h2>
<p>This chapter covered three major topics for advanced data wrangling:</p>
<section id="data-reshaping-tidyr" class="level3" data-number="7.9.1">
<h3 data-number="7.9.1" class="anchored" data-anchor-id="data-reshaping-tidyr"><span class="header-section-number">7.9.1</span> Data Reshaping (tidyr)</h3>
<ol type="1">
<li><strong><code>pivot_longer()</code></strong>: Wide → Long format
<ul>
<li>Convert column names to values</li>
<li>Stack measurements</li>
</ul></li>
<li><strong><code>pivot_wider()</code></strong>: Long → Wide format
<ul>
<li>Create summary tables</li>
<li>Spread values across columns</li>
</ul></li>
<li><strong><code>separate()</code> &amp; <code>unite()</code></strong>: Split or combine columns
<ul>
<li>Extract information from composite columns</li>
<li>Create unique identifiers</li>
</ul></li>
</ol>
</section>
<section id="joining-datasets-1" class="level3" data-number="7.9.2">
<h3 data-number="7.9.2" class="anchored" data-anchor-id="joining-datasets-1"><span class="header-section-number">7.9.2</span> Joining Datasets</h3>
<ol type="1">
<li><strong>Mutating joins</strong> (add columns):
<ul>
<li><code>left_join()</code>: Keep all left, add matching right</li>
<li><code>inner_join()</code>: Keep only matches</li>
<li><code>full_join()</code>: Keep everything</li>
</ul></li>
<li><strong>Filtering joins</strong> (filter rows):
<ul>
<li><code>semi_join()</code>: Keep rows with matches</li>
<li><code>anti_join()</code>: Keep rows without matches</li>
</ul></li>
<li><strong>Binding</strong>:
<ul>
<li><code>bind_rows()</code>: Stack vertically</li>
<li><code>bind_cols()</code>: Attach horizontally (use cautiously)</li>
</ul></li>
</ol>
</section>
<section id="iteration-purrr" class="level3" data-number="7.9.3">
<h3 data-number="7.9.3" class="anchored" data-anchor-id="iteration-purrr"><span class="header-section-number">7.9.3</span> Iteration (purrr)</h3>
<ol type="1">
<li><strong><code>map()</code> functions</strong>: Apply functions to each element
<ul>
<li><code>map()</code>: Returns list</li>
<li><code>map_dbl()</code>, <code>map_chr()</code>, <code>map_int()</code>, <code>map_lgl()</code>: Return vectors</li>
</ul></li>
<li><strong>Multiple inputs</strong>:
<ul>
<li><code>map2()</code>: Two inputs</li>
<li><code>pmap()</code>: Many inputs</li>
</ul></li>
<li><strong>List columns</strong>: Store complex objects in data frames
<ul>
<li><code>nest()</code>: Create nested data</li>
<li><code>unnest()</code>: Expand nested data</li>
</ul></li>
</ol>
<hr>
</section>
</section>
<section id="week-7-homework-multi-table-data-integration" class="level2" data-number="7.10">
<h2 data-number="7.10" class="anchored" data-anchor-id="week-7-homework-multi-table-data-integration"><span class="header-section-number">7.10</span> Week 7 Homework: Multi-Table Data Integration</h2>
<section id="assignment-overview" class="level3" data-number="7.10.1">
<h3 data-number="7.10.1" class="anchored" data-anchor-id="assignment-overview"><span class="header-section-number">7.10.1</span> Assignment Overview</h3>
<p>You will work with three related datasets about a pig feeding trial. Your task is to reshape, join, and analyze the data using techniques from this chapter.</p>
</section>
<section id="part-1-data-generation-0-points-but-required" class="level3" data-number="7.10.2">
<h3 data-number="7.10.2" class="anchored" data-anchor-id="part-1-data-generation-0-points-but-required"><span class="header-section-number">7.10.2</span> Part 1: Data Generation (0 points, but required)</h3>
<p>Run this code to create your datasets:</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb146"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb146-1"><a href="#cb146-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb146-2"><a href="#cb146-2" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">2024</span>)</span>
<span id="cb146-3"><a href="#cb146-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb146-4"><a href="#cb146-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Dataset 1: Pig information</span></span>
<span id="cb146-5"><a href="#cb146-5" aria-hidden="true" tabindex="-1"></a>pigs <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb146-6"><a href="#cb146-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">pig_id =</span> <span class="fu">paste0</span>(<span class="st">"P"</span>, <span class="dv">1001</span><span class="sc">:</span><span class="dv">1050</span>),</span>
<span id="cb146-7"><a href="#cb146-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">breed =</span> <span class="fu">sample</span>(<span class="fu">c</span>(<span class="st">"Yorkshire"</span>, <span class="st">"Duroc"</span>, <span class="st">"Hampshire"</span>), <span class="dv">50</span>, <span class="at">replace =</span> <span class="cn">TRUE</span>),</span>
<span id="cb146-8"><a href="#cb146-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">birth_date =</span> <span class="fu">as.Date</span>(<span class="st">"2023-03-01"</span>) <span class="sc">+</span> <span class="fu">sample</span>(<span class="dv">0</span><span class="sc">:</span><span class="dv">30</span>, <span class="dv">50</span>, <span class="at">replace =</span> <span class="cn">TRUE</span>),</span>
<span id="cb146-9"><a href="#cb146-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">initial_weight_kg =</span> <span class="fu">rnorm</span>(<span class="dv">50</span>, <span class="at">mean =</span> <span class="dv">8</span>, <span class="at">sd =</span> <span class="dv">1</span>)</span>
<span id="cb146-10"><a href="#cb146-10" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb146-11"><a href="#cb146-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb146-12"><a href="#cb146-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Dataset 2: Feed records (wide format - needs reshaping!)</span></span>
<span id="cb146-13"><a href="#cb146-13" aria-hidden="true" tabindex="-1"></a>feed_wide <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb146-14"><a href="#cb146-14" aria-hidden="true" tabindex="-1"></a>  <span class="at">pig_id =</span> <span class="fu">paste0</span>(<span class="st">"P"</span>, <span class="dv">1001</span><span class="sc">:</span><span class="dv">1050</span>),</span>
<span id="cb146-15"><a href="#cb146-15" aria-hidden="true" tabindex="-1"></a>  <span class="at">week_1_kg =</span> <span class="fu">rnorm</span>(<span class="dv">50</span>, <span class="at">mean =</span> <span class="dv">5</span>, <span class="at">sd =</span> <span class="fl">0.5</span>),</span>
<span id="cb146-16"><a href="#cb146-16" aria-hidden="true" tabindex="-1"></a>  <span class="at">week_2_kg =</span> <span class="fu">rnorm</span>(<span class="dv">50</span>, <span class="at">mean =</span> <span class="dv">6</span>, <span class="at">sd =</span> <span class="fl">0.6</span>),</span>
<span id="cb146-17"><a href="#cb146-17" aria-hidden="true" tabindex="-1"></a>  <span class="at">week_3_kg =</span> <span class="fu">rnorm</span>(<span class="dv">50</span>, <span class="at">mean =</span> <span class="dv">7</span>, <span class="at">sd =</span> <span class="fl">0.7</span>),</span>
<span id="cb146-18"><a href="#cb146-18" aria-hidden="true" tabindex="-1"></a>  <span class="at">week_4_kg =</span> <span class="fu">rnorm</span>(<span class="dv">50</span>, <span class="at">mean =</span> <span class="dv">8</span>, <span class="at">sd =</span> <span class="fl">0.8</span>)</span>
<span id="cb146-19"><a href="#cb146-19" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb146-20"><a href="#cb146-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb146-21"><a href="#cb146-21" aria-hidden="true" tabindex="-1"></a><span class="co"># Dataset 3: Treatment assignments (some pigs, not all)</span></span>
<span id="cb146-22"><a href="#cb146-22" aria-hidden="true" tabindex="-1"></a>treatments <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb146-23"><a href="#cb146-23" aria-hidden="true" tabindex="-1"></a>  <span class="at">pig_id =</span> <span class="fu">sample</span>(<span class="fu">paste0</span>(<span class="st">"P"</span>, <span class="dv">1001</span><span class="sc">:</span><span class="dv">1050</span>), <span class="dv">40</span>),</span>
<span id="cb146-24"><a href="#cb146-24" aria-hidden="true" tabindex="-1"></a>  <span class="at">treatment =</span> <span class="fu">sample</span>(<span class="fu">c</span>(<span class="st">"Standard"</span>, <span class="st">"HighProtein"</span>, <span class="st">"Supplement"</span>), <span class="dv">40</span>, <span class="at">replace =</span> <span class="cn">TRUE</span>),</span>
<span id="cb146-25"><a href="#cb146-25" aria-hidden="true" tabindex="-1"></a>  <span class="at">treatment_start =</span> <span class="fu">as.Date</span>(<span class="st">"2023-03-15"</span>)</span>
<span id="cb146-26"><a href="#cb146-26" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb146-27"><a href="#cb146-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb146-28"><a href="#cb146-28" aria-hidden="true" tabindex="-1"></a><span class="co"># Dataset 4: Health records (long format, multiple records per pig)</span></span>
<span id="cb146-29"><a href="#cb146-29" aria-hidden="true" tabindex="-1"></a>health <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb146-30"><a href="#cb146-30" aria-hidden="true" tabindex="-1"></a>  <span class="at">pig_id =</span> <span class="fu">rep</span>(<span class="fu">sample</span>(<span class="fu">paste0</span>(<span class="st">"P"</span>, <span class="dv">1001</span><span class="sc">:</span><span class="dv">1050</span>), <span class="dv">30</span>), <span class="at">each =</span> <span class="dv">3</span>),</span>
<span id="cb146-31"><a href="#cb146-31" aria-hidden="true" tabindex="-1"></a>  <span class="at">check_date =</span> <span class="fu">rep</span>(<span class="fu">as.Date</span>(<span class="st">"2023-03-15"</span>) <span class="sc">+</span> <span class="fu">c</span>(<span class="dv">7</span>, <span class="dv">14</span>, <span class="dv">21</span>), <span class="at">times =</span> <span class="dv">30</span>),</span>
<span id="cb146-32"><a href="#cb146-32" aria-hidden="true" tabindex="-1"></a>  <span class="at">health_score =</span> <span class="fu">sample</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>, <span class="dv">90</span>, <span class="at">replace =</span> <span class="cn">TRUE</span>),</span>
<span id="cb146-33"><a href="#cb146-33" aria-hidden="true" tabindex="-1"></a>  <span class="at">temperature_C =</span> <span class="fu">rnorm</span>(<span class="dv">90</span>, <span class="at">mean =</span> <span class="dv">39</span>, <span class="at">sd =</span> <span class="fl">0.5</span>)</span>
<span id="cb146-34"><a href="#cb146-34" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb146-35"><a href="#cb146-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb146-36"><a href="#cb146-36" aria-hidden="true" tabindex="-1"></a><span class="co"># Save datasets</span></span>
<span id="cb146-37"><a href="#cb146-37" aria-hidden="true" tabindex="-1"></a><span class="fu">write_csv</span>(pigs, <span class="st">"pigs.csv"</span>)</span>
<span id="cb146-38"><a href="#cb146-38" aria-hidden="true" tabindex="-1"></a><span class="fu">write_csv</span>(feed_wide, <span class="st">"feed_wide.csv"</span>)</span>
<span id="cb146-39"><a href="#cb146-39" aria-hidden="true" tabindex="-1"></a><span class="fu">write_csv</span>(treatments, <span class="st">"treatments.csv"</span>)</span>
<span id="cb146-40"><a href="#cb146-40" aria-hidden="true" tabindex="-1"></a><span class="fu">write_csv</span>(health, <span class="st">"health.csv"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
</section>
<section id="part-2-data-reshaping-25-points" class="level3" data-number="7.10.3">
<h3 data-number="7.10.3" class="anchored" data-anchor-id="part-2-data-reshaping-25-points"><span class="header-section-number">7.10.3</span> Part 2: Data Reshaping (25 points)</h3>
<p><strong>Task 1</strong> (10 points): Reshape <code>feed_wide</code> from wide to long format - Create columns: <code>pig_id</code>, <code>week</code>, <code>feed_consumed_kg</code> - Convert week to numeric (remove “week_” prefix and “_kg” suffix) - Show first 10 rows</p>
<p><strong>Task 2</strong> (10 points): Create a summary table showing average feed by week - Calculate mean feed consumed for each week - Reshape to wide format where weeks are columns - Add a “total” column with sum across weeks</p>
<p><strong>Task 3</strong> (5 points): In the <code>health</code> dataset, separate <code>check_date</code> into <code>year</code>, <code>month</code>, <code>day</code></p>
</section>
<section id="part-3-joining-datasets-30-points" class="level3" data-number="7.10.4">
<h3 data-number="7.10.4" class="anchored" data-anchor-id="part-3-joining-datasets-30-points"><span class="header-section-number">7.10.4</span> Part 3: Joining Datasets (30 points)</h3>
<p><strong>Task 1</strong> (10 points): Create a master dataset - Start with <code>pigs</code> - Add treatment information (keep all pigs) - Add the reshaped feed data (long format) - Show structure and first 15 rows</p>
<p><strong>Task 2</strong> (10 points): Analyze which pigs DON’T have health records - Use an appropriate filtering join - Show pig_id, breed, and initial_weight_kg - How many pigs lack health records?</p>
<p><strong>Task 3</strong> (10 points): Create a complete cases dataset - Only include pigs that have: - Treatment assignments - Feed records for all 4 weeks - At least one health record - How many pigs remain? - What’s the average initial weight?</p>
</section>
<section id="part-4-complex-joins-20-points" class="level3" data-number="7.10.5">
<h3 data-number="7.10.5" class="anchored" data-anchor-id="part-4-complex-joins-20-points"><span class="header-section-number">7.10.5</span> Part 4: Complex Joins (20 points)</h3>
<p><strong>Task 1</strong> (10 points): Calculate total feed consumption per pig - Sum feed_consumed_kg across all weeks for each pig - Join with pig information and treatment - Create a table showing mean total feed by breed and treatment - Which breed × treatment combination consumed most feed?</p>
<p><strong>Task 2</strong> (10 points): Identify treatment effects - Calculate average health_score for each pig - Join with treatment information - Compare average health scores across treatments - Create a visualization (boxplot or violin plot)</p>
</section>
<section id="part-5-iteration-with-purrr-20-points" class="level3" data-number="7.10.6">
<h3 data-number="7.10.6" class="anchored" data-anchor-id="part-5-iteration-with-purrr-20-points"><span class="header-section-number">7.10.6</span> Part 5: Iteration with purrr (20 points)</h3>
<p><strong>Task 1</strong> (10 points): Calculate summary statistics for each breed - Nest data by breed - Use <code>map()</code> to calculate for each breed: - Number of pigs - Mean initial weight - Mean total feed consumed (if you calculated it in Part 4) - Mean health score (if available) - Unnest results into a summary table</p>
<p><strong>Task 2</strong> (10 points): Fit models to nested data - Nest feed data by pig_id - Fit a linear model of feed_consumed_kg ~ week for each pig - Extract the slope (growth rate of feed consumption) - Which pig has the highest feed growth rate? - Which breed has the highest average feed growth rate?</p>
</section>
<section id="part-6-reflection-5-points" class="level3" data-number="7.10.7">
<h3 data-number="7.10.7" class="anchored" data-anchor-id="part-6-reflection-5-points"><span class="header-section-number">7.10.7</span> Part 6: Reflection (5 points)</h3>
<p>Write 200-300 words addressing: - Which type of join did you use most and why? - What was the most challenging aspect of reshaping the data? - When did you choose <code>map()</code> vs a loop (if at all)? - What insights did you discover about the pig feeding trial?</p>
</section>
<section id="recommended-yaml" class="level3" data-number="7.10.8">
<h3 data-number="7.10.8" class="anchored" data-anchor-id="recommended-yaml"><span class="header-section-number">7.10.8</span> Recommended YAML</h3>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb147"><pre class="sourceCode yaml code-with-copy"><code class="sourceCode yaml"><span id="cb147-1"><a href="#cb147-1" aria-hidden="true" tabindex="-1"></a><span class="pp">---</span></span>
<span id="cb147-2"><a href="#cb147-2" aria-hidden="true" tabindex="-1"></a><span class="fu">title</span><span class="kw">:</span><span class="at"> </span><span class="st">"Week 7 Homework: Multi-Table Data Integration"</span></span>
<span id="cb147-3"><a href="#cb147-3" aria-hidden="true" tabindex="-1"></a><span class="fu">author</span><span class="kw">:</span><span class="at"> </span><span class="st">"Your Name"</span></span>
<span id="cb147-4"><a href="#cb147-4" aria-hidden="true" tabindex="-1"></a><span class="fu">date</span><span class="kw">:</span><span class="at"> today</span></span>
<span id="cb147-5"><a href="#cb147-5" aria-hidden="true" tabindex="-1"></a><span class="fu">format</span><span class="kw">:</span></span>
<span id="cb147-6"><a href="#cb147-6" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">html</span><span class="kw">:</span></span>
<span id="cb147-7"><a href="#cb147-7" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">toc</span><span class="kw">:</span><span class="at"> </span><span class="ch">true</span></span>
<span id="cb147-8"><a href="#cb147-8" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">toc-depth</span><span class="kw">:</span><span class="at"> </span><span class="dv">3</span></span>
<span id="cb147-9"><a href="#cb147-9" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">code-fold</span><span class="kw">:</span><span class="at"> </span><span class="ch">false</span></span>
<span id="cb147-10"><a href="#cb147-10" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">theme</span><span class="kw">:</span><span class="at"> cosmo</span></span>
<span id="cb147-11"><a href="#cb147-11" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">embed-resources</span><span class="kw">:</span><span class="at"> </span><span class="ch">true</span></span>
<span id="cb147-12"><a href="#cb147-12" aria-hidden="true" tabindex="-1"></a><span class="fu">execute</span><span class="kw">:</span></span>
<span id="cb147-13"><a href="#cb147-13" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">warning</span><span class="kw">:</span><span class="at"> </span><span class="ch">false</span></span>
<span id="cb147-14"><a href="#cb147-14" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">message</span><span class="kw">:</span><span class="at"> </span><span class="ch">false</span></span>
<span id="cb147-15"><a href="#cb147-15" aria-hidden="true" tabindex="-1"></a><span class="pp">---</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</section>
<section id="grading-rubric" class="level3" data-number="7.10.9">
<h3 data-number="7.10.9" class="anchored" data-anchor-id="grading-rubric"><span class="header-section-number">7.10.9</span> Grading Rubric</h3>
<ul>
<li><strong>Part 2: Data Reshaping (25%)</strong>
<ul>
<li>Correct pivoting to long format (10%)</li>
<li>Summary table correctly reshaped (10%)</li>
<li>Date separation correct (5%)</li>
</ul></li>
<li><strong>Part 3: Joining Datasets (30%)</strong>
<ul>
<li>Master dataset correctly created (10%)</li>
<li>Anti-join to find missing health records (10%)</li>
<li>Complete cases filtering correct (10%)</li>
</ul></li>
<li><strong>Part 4: Complex Joins (20%)</strong>
<ul>
<li>Total feed calculation and table (10%)</li>
<li>Treatment effects analysis (10%)</li>
</ul></li>
<li><strong>Part 5: Iteration with purrr (20%)</strong>
<ul>
<li>Nested summaries by breed (10%)</li>
<li>Model fitting with map (10%)</li>
</ul></li>
<li><strong>Part 6: Reflection (5%)</strong>
<ul>
<li>Thoughtful analysis of methods and insights</li>
</ul></li>
</ul>
</section>
<section id="bonus-10-points" class="level3" data-number="7.10.10">
<h3 data-number="7.10.10" class="anchored" data-anchor-id="bonus-10-points"><span class="header-section-number">7.10.10</span> Bonus (+10 points)</h3>
<ol type="1">
<li>Create a function that takes a pig_id and returns a plot of their feed consumption over time</li>
<li>Use <code>map()</code> to generate plots for all pigs in one breed</li>
<li>Combine plots using patchwork (from Chapter 6)</li>
</ol>
<hr>
</section>
</section>
<section id="additional-resources" class="level2" data-number="7.11">
<h2 data-number="7.11" class="anchored" data-anchor-id="additional-resources"><span class="header-section-number">7.11</span> Additional Resources</h2>
<section id="required-reading" class="level3" data-number="7.11.1">
<h3 data-number="7.11.1" class="anchored" data-anchor-id="required-reading"><span class="header-section-number">7.11.1</span> Required Reading</h3>
<ul>
<li><a href="https://r4ds.hadley.nz/">R for Data Science (2e)</a> - Chapters 19-21 (Joins, Tidy Data, Iteration)</li>
<li><a href="https://tidyr.tidyverse.org/">tidyr documentation</a></li>
<li><a href="https://purrr.tidyverse.org/">purrr documentation</a></li>
<li>Wickham, H. (2014). “Tidy Data.” <em>Journal of Statistical Software</em>, 59(10). <a href="https://www.jstatsoft.org/article/view/v059i10">Link</a></li>
</ul>
</section>
<section id="optional-reading" class="level3" data-number="7.11.2">
<h3 data-number="7.11.2" class="anchored" data-anchor-id="optional-reading"><span class="header-section-number">7.11.2</span> Optional Reading</h3>
<ul>
<li><a href="https://tidydatatutor.com/">Tidy Data Tutor</a> - Interactive visual guide</li>
<li><a href="https://jennybc.github.io/purrr-tutorial/">purrr tutorial</a> by Jenny Bryan</li>
<li><a href="https://r4ds.hadley.nz/joins.html">Relational Data chapter</a> from R4DS</li>
</ul>
</section>
<section id="videos" class="level3" data-number="7.11.3">
<h3 data-number="7.11.3" class="anchored" data-anchor-id="videos"><span class="header-section-number">7.11.3</span> Videos</h3>
<ul>
<li>“Tidy Data and tidyr” by RStudio / Posit</li>
<li>“Iteration with purrr” by RStudio / Posit</li>
<li>“Row-oriented workflows” by Jenny Bryan</li>
</ul>
</section>
<section id="cheat-sheets" class="level3" data-number="7.11.4">
<h3 data-number="7.11.4" class="anchored" data-anchor-id="cheat-sheets"><span class="header-section-number">7.11.4</span> Cheat Sheets</h3>
<ul>
<li><a href="https://rstudio.github.io/cheatsheets/tidyr.pdf">tidyr Cheat Sheet</a></li>
<li><a href="https://rstudio.github.io/cheatsheets/purrr.pdf">purrr Cheat Sheet</a></li>
<li><a href="https://rstudio.github.io/cheatsheets/data-import.pdf">Data Import Cheat Sheet</a></li>
</ul>
</section>
<section id="interactive-learning" class="level3" data-number="7.11.5">
<h3 data-number="7.11.5" class="anchored" data-anchor-id="interactive-learning"><span class="header-section-number">7.11.5</span> Interactive Learning</h3>
<ul>
<li><a href="https://posit.cloud/learn/primers/4">RStudio Primers: Tidy Your Data</a></li>
<li><a href="https://posit.cloud/learn/primers/5">RStudio Primers: Iterate</a></li>
</ul>
</section>
<section id="useful-websites" class="level3" data-number="7.11.6">
<h3 data-number="7.11.6" class="anchored" data-anchor-id="useful-websites"><span class="header-section-number">7.11.6</span> Useful Websites</h3>
<ul>
<li><a href="https://tidyr.tidyverse.org/articles/tidy-data.html">Tidy Data Principles</a></li>
<li><a href="https://dplyr.tidyverse.org/articles/two-table.html">dplyr join vignette</a></li>
<li><a href="https://github.com/tidyverse/purrr">purrr GitHub</a></li>
<li><a href="https://stackoverflow.com/questions/tagged/tidyr">Stack Overflow: tidyr tag</a></li>
</ul>
<hr>
<p><strong>Next Chapter</strong>: <a href="../chapters/ch08-special_formats.html">Special Data Formats, Integration, and Course Wrap-up</a></p>


<!-- -->

</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    const icon = "";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
      const outerScaffold = trigger.parentElement.cloneNode(true);
      const codeEl = outerScaffold.querySelector('code');
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
    const viewSource = window.document.getElementById('quarto-view-source') ||
                       window.document.getElementById('quarto-code-tools-source');
    if (viewSource) {
      const sourceUrl = viewSource.getAttribute("data-quarto-source-url");
      viewSource.addEventListener("click", function(e) {
        if (sourceUrl) {
          // rstudio viewer pane
          if (/\bcapabilities=\b/.test(window.location)) {
            window.open(sourceUrl);
          } else {
            window.location.href = sourceUrl;
          }
        } else {
          const modal = new bootstrap.Modal(document.getElementById('quarto-embedded-source-code-modal'));
          modal.show();
        }
        return false;
      });
    }
    function toggleCodeHandler(show) {
      return function(e) {
        const detailsSrc = window.document.querySelectorAll(".cell > details > .sourceCode");
        for (let i=0; i<detailsSrc.length; i++) {
          const details = detailsSrc[i].parentElement;
          if (show) {
            details.open = true;
          } else {
            details.removeAttribute("open");
          }
        }
        const cellCodeDivs = window.document.querySelectorAll(".cell > .sourceCode");
        const fromCls = show ? "hidden" : "unhidden";
        const toCls = show ? "unhidden" : "hidden";
        for (let i=0; i<cellCodeDivs.length; i++) {
          const codeDiv = cellCodeDivs[i];
          if (codeDiv.classList.contains(fromCls)) {
            codeDiv.classList.remove(fromCls);
            codeDiv.classList.add(toCls);
          } 
        }
        return false;
      }
    }
    const hideAllCode = window.document.getElementById("quarto-hide-all-code");
    if (hideAllCode) {
      hideAllCode.addEventListener("click", toggleCodeHandler(false));
    }
    const showAllCode = window.document.getElementById("quarto-show-all-code");
    if (showAllCode) {
      showAllCode.addEventListener("click", toggleCodeHandler(true));
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp('/' + window.location.host + '/');
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
            // target, if specified
            link.setAttribute("target", "_blank");
            if (link.getAttribute("rel") === null) {
              link.setAttribute("rel", "noopener");
            }
            // default icon
            link.classList.add("external");
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="../chapters/ch06-ggplot2_advanced.html" class="pagination-link" aria-label="Advanced ggplot2 and Multi-Panel Plots">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Advanced ggplot2 and Multi-Panel Plots</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="../chapters/ch08-special_formats.html" class="pagination-link" aria-label="Special Data Formats, Integration, and Course Wrap-up">
        <span class="nav-page-text"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Special Data Formats, Integration, and Course Wrap-up</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav><div class="modal fade" id="quarto-embedded-source-code-modal" tabindex="-1" aria-labelledby="quarto-embedded-source-code-modal-label" aria-hidden="true"><div class="modal-dialog modal-dialog-scrollable"><div class="modal-content"><div class="modal-header"><h5 class="modal-title" id="quarto-embedded-source-code-modal-label">Source Code</h5><button class="btn-close" data-bs-dismiss="modal"></button></div><div class="modal-body"><div class="">
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb148" data-shortcodes="false"><pre class="sourceCode markdown code-with-copy"><code class="sourceCode markdown"><span id="cb148-1"><a href="#cb148-1" aria-hidden="true" tabindex="-1"></a><span class="fu"># Data Reshaping, Joining, and Iteration</span></span>
<span id="cb148-2"><a href="#cb148-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-3"><a href="#cb148-3" aria-hidden="true" tabindex="-1"></a><span class="fu">## Learning Objectives</span></span>
<span id="cb148-4"><a href="#cb148-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-5"><a href="#cb148-5" aria-hidden="true" tabindex="-1"></a>By the end of this chapter, you will be able to:</span>
<span id="cb148-6"><a href="#cb148-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-7"><a href="#cb148-7" aria-hidden="true" tabindex="-1"></a><span class="ss">1. </span>Understand and apply tidy data principles to organize datasets effectively</span>
<span id="cb148-8"><a href="#cb148-8" aria-hidden="true" tabindex="-1"></a><span class="ss">2. </span>Reshape data between wide and long formats using <span class="in">`pivot_longer()`</span> and <span class="in">`pivot_wider()`</span></span>
<span id="cb148-9"><a href="#cb148-9" aria-hidden="true" tabindex="-1"></a><span class="ss">3. </span>Split and combine columns using <span class="in">`separate()`</span> and <span class="in">`unite()`</span></span>
<span id="cb148-10"><a href="#cb148-10" aria-hidden="true" tabindex="-1"></a><span class="ss">4. </span>Join multiple datasets using SQL-style joins (<span class="in">`left_join()`</span>, <span class="in">`inner_join()`</span>, etc.)</span>
<span id="cb148-11"><a href="#cb148-11" aria-hidden="true" tabindex="-1"></a><span class="ss">5. </span>Understand when to use different join types and filtering joins</span>
<span id="cb148-12"><a href="#cb148-12" aria-hidden="true" tabindex="-1"></a><span class="ss">6. </span>Bind datasets together with <span class="in">`bind_rows()`</span> and <span class="in">`bind_cols()`</span></span>
<span id="cb148-13"><a href="#cb148-13" aria-hidden="true" tabindex="-1"></a><span class="ss">7. </span>Use functional programming with <span class="in">`purrr::map()`</span> for iteration</span>
<span id="cb148-14"><a href="#cb148-14" aria-hidden="true" tabindex="-1"></a><span class="ss">8. </span>Work with list columns and nested data structures</span>
<span id="cb148-15"><a href="#cb148-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-16"><a href="#cb148-16" aria-hidden="true" tabindex="-1"></a>---</span>
<span id="cb148-17"><a href="#cb148-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-18"><a href="#cb148-18" aria-hidden="true" tabindex="-1"></a><span class="fu">## Introduction</span></span>
<span id="cb148-19"><a href="#cb148-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-20"><a href="#cb148-20" aria-hidden="true" tabindex="-1"></a>In previous chapters, you learned to manipulate single datasets with dplyr. Real-world analysis often requires:</span>
<span id="cb148-21"><a href="#cb148-21" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Reshaping** data between different formats</span>
<span id="cb148-22"><a href="#cb148-22" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Combining** multiple related datasets</span>
<span id="cb148-23"><a href="#cb148-23" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Iterating** operations across many groups or files</span>
<span id="cb148-24"><a href="#cb148-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-25"><a href="#cb148-25" aria-hidden="true" tabindex="-1"></a>This chapter teaches these essential data wrangling skills using <span class="in">`tidyr`</span> for reshaping and <span class="in">`purrr`</span> for iteration.</span>
<span id="cb148-26"><a href="#cb148-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-27"><a href="#cb148-27" aria-hidden="true" tabindex="-1"></a><span class="fu">### Setup</span></span>
<span id="cb148-28"><a href="#cb148-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-31"><a href="#cb148-31" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb148-32"><a href="#cb148-32" aria-hidden="true" tabindex="-1"></a><span class="co">#| eval: true</span></span>
<span id="cb148-33"><a href="#cb148-33" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: true</span></span>
<span id="cb148-34"><a href="#cb148-34" aria-hidden="true" tabindex="-1"></a><span class="co">#| message: false</span></span>
<span id="cb148-35"><a href="#cb148-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-36"><a href="#cb148-36" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)  <span class="co"># Includes tidyr, dplyr, purrr</span></span>
<span id="cb148-37"><a href="#cb148-37" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(readxl)     <span class="co"># For reading Excel files</span></span>
<span id="cb148-38"><a href="#cb148-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-39"><a href="#cb148-39" aria-hidden="true" tabindex="-1"></a><span class="co"># Set default theme for plots</span></span>
<span id="cb148-40"><a href="#cb148-40" aria-hidden="true" tabindex="-1"></a><span class="fu">theme_set</span>(<span class="fu">theme_minimal</span>())</span>
<span id="cb148-41"><a href="#cb148-41" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb148-42"><a href="#cb148-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-43"><a href="#cb148-43" aria-hidden="true" tabindex="-1"></a>---</span>
<span id="cb148-44"><a href="#cb148-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-45"><a href="#cb148-45" aria-hidden="true" tabindex="-1"></a><span class="fu">## Tidy Data Principles</span></span>
<span id="cb148-46"><a href="#cb148-46" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-47"><a href="#cb148-47" aria-hidden="true" tabindex="-1"></a><span class="fu">### What is Tidy Data?</span></span>
<span id="cb148-48"><a href="#cb148-48" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-49"><a href="#cb148-49" aria-hidden="true" tabindex="-1"></a>**Tidy data** follows three interrelated rules:</span>
<span id="cb148-50"><a href="#cb148-50" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-51"><a href="#cb148-51" aria-hidden="true" tabindex="-1"></a><span class="ss">1. </span>**Each variable forms a column**</span>
<span id="cb148-52"><a href="#cb148-52" aria-hidden="true" tabindex="-1"></a><span class="ss">2. </span>**Each observation forms a row**</span>
<span id="cb148-53"><a href="#cb148-53" aria-hidden="true" tabindex="-1"></a><span class="ss">3. </span>**Each type of observational unit forms a table**</span>
<span id="cb148-54"><a href="#cb148-54" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-55"><a href="#cb148-55" aria-hidden="true" tabindex="-1"></a>::: {.callout-note}</span>
<span id="cb148-56"><a href="#cb148-56" aria-hidden="true" tabindex="-1"></a><span class="fu">## Hadley Wickham's Tidy Data</span></span>
<span id="cb148-57"><a href="#cb148-57" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-58"><a href="#cb148-58" aria-hidden="true" tabindex="-1"></a>The concept of tidy data comes from Hadley Wickham's 2014 paper in the *Journal of Statistical Software*. Tidy data makes analysis easier because:</span>
<span id="cb148-59"><a href="#cb148-59" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Variables are easy to access as columns</span>
<span id="cb148-60"><a href="#cb148-60" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Observations are easy to filter as rows</span>
<span id="cb148-61"><a href="#cb148-61" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Most tidyverse functions expect tidy data</span>
<span id="cb148-62"><a href="#cb148-62" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb148-63"><a href="#cb148-63" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-64"><a href="#cb148-64" aria-hidden="true" tabindex="-1"></a><span class="fu">### Tidy vs Untidy Data</span></span>
<span id="cb148-65"><a href="#cb148-65" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-66"><a href="#cb148-66" aria-hidden="true" tabindex="-1"></a>**Example 1: Animal weight measurements**</span>
<span id="cb148-67"><a href="#cb148-67" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-68"><a href="#cb148-68" aria-hidden="true" tabindex="-1"></a>**Untidy (wide format)**:</span>
<span id="cb148-71"><a href="#cb148-71" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb148-72"><a href="#cb148-72" aria-hidden="true" tabindex="-1"></a><span class="co">#| eval: true</span></span>
<span id="cb148-73"><a href="#cb148-73" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: true</span></span>
<span id="cb148-74"><a href="#cb148-74" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-75"><a href="#cb148-75" aria-hidden="true" tabindex="-1"></a><span class="co"># Each time point is a separate column</span></span>
<span id="cb148-76"><a href="#cb148-76" aria-hidden="true" tabindex="-1"></a>untidy_weights <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb148-77"><a href="#cb148-77" aria-hidden="true" tabindex="-1"></a>  <span class="at">animal_id =</span> <span class="fu">c</span>(<span class="st">"A001"</span>, <span class="st">"A002"</span>, <span class="st">"A003"</span>),</span>
<span id="cb148-78"><a href="#cb148-78" aria-hidden="true" tabindex="-1"></a>  <span class="at">week_0 =</span> <span class="fu">c</span>(<span class="dv">45</span>, <span class="dv">48</span>, <span class="dv">43</span>),</span>
<span id="cb148-79"><a href="#cb148-79" aria-hidden="true" tabindex="-1"></a>  <span class="at">week_4 =</span> <span class="fu">c</span>(<span class="dv">52</span>, <span class="dv">54</span>, <span class="dv">50</span>),</span>
<span id="cb148-80"><a href="#cb148-80" aria-hidden="true" tabindex="-1"></a>  <span class="at">week_8 =</span> <span class="fu">c</span>(<span class="dv">58</span>, <span class="dv">61</span>, <span class="dv">56</span>),</span>
<span id="cb148-81"><a href="#cb148-81" aria-hidden="true" tabindex="-1"></a>  <span class="at">week_12 =</span> <span class="fu">c</span>(<span class="dv">64</span>, <span class="dv">67</span>, <span class="dv">62</span>)</span>
<span id="cb148-82"><a href="#cb148-82" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb148-83"><a href="#cb148-83" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-84"><a href="#cb148-84" aria-hidden="true" tabindex="-1"></a>untidy_weights</span>
<span id="cb148-85"><a href="#cb148-85" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb148-86"><a href="#cb148-86" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-87"><a href="#cb148-87" aria-hidden="true" tabindex="-1"></a>**Tidy (long format)**:</span>
<span id="cb148-90"><a href="#cb148-90" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb148-91"><a href="#cb148-91" aria-hidden="true" tabindex="-1"></a><span class="co">#| eval: true</span></span>
<span id="cb148-92"><a href="#cb148-92" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: true</span></span>
<span id="cb148-93"><a href="#cb148-93" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-94"><a href="#cb148-94" aria-hidden="true" tabindex="-1"></a><span class="co"># Each observation (animal × time) is a separate row</span></span>
<span id="cb148-95"><a href="#cb148-95" aria-hidden="true" tabindex="-1"></a>tidy_weights <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb148-96"><a href="#cb148-96" aria-hidden="true" tabindex="-1"></a>  <span class="at">animal_id =</span> <span class="fu">rep</span>(<span class="fu">c</span>(<span class="st">"A001"</span>, <span class="st">"A002"</span>, <span class="st">"A003"</span>), <span class="at">each =</span> <span class="dv">4</span>),</span>
<span id="cb148-97"><a href="#cb148-97" aria-hidden="true" tabindex="-1"></a>  <span class="at">week =</span> <span class="fu">rep</span>(<span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">4</span>, <span class="dv">8</span>, <span class="dv">12</span>), <span class="at">times =</span> <span class="dv">3</span>),</span>
<span id="cb148-98"><a href="#cb148-98" aria-hidden="true" tabindex="-1"></a>  <span class="at">weight_kg =</span> <span class="fu">c</span>(<span class="dv">45</span>, <span class="dv">52</span>, <span class="dv">58</span>, <span class="dv">64</span>,  <span class="co"># A001</span></span>
<span id="cb148-99"><a href="#cb148-99" aria-hidden="true" tabindex="-1"></a>                <span class="dv">48</span>, <span class="dv">54</span>, <span class="dv">61</span>, <span class="dv">67</span>,  <span class="co"># A002</span></span>
<span id="cb148-100"><a href="#cb148-100" aria-hidden="true" tabindex="-1"></a>                <span class="dv">43</span>, <span class="dv">50</span>, <span class="dv">56</span>, <span class="dv">62</span>)  <span class="co"># A003</span></span>
<span id="cb148-101"><a href="#cb148-101" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb148-102"><a href="#cb148-102" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-103"><a href="#cb148-103" aria-hidden="true" tabindex="-1"></a>tidy_weights</span>
<span id="cb148-104"><a href="#cb148-104" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb148-105"><a href="#cb148-105" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-106"><a href="#cb148-106" aria-hidden="true" tabindex="-1"></a>**Why is tidy better?**</span>
<span id="cb148-107"><a href="#cb148-107" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-110"><a href="#cb148-110" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb148-111"><a href="#cb148-111" aria-hidden="true" tabindex="-1"></a><span class="co">#| eval: true</span></span>
<span id="cb148-112"><a href="#cb148-112" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: true</span></span>
<span id="cb148-113"><a href="#cb148-113" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-114"><a href="#cb148-114" aria-hidden="true" tabindex="-1"></a><span class="co"># Easy to plot with ggplot2</span></span>
<span id="cb148-115"><a href="#cb148-115" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(tidy_weights, <span class="fu">aes</span>(<span class="at">x =</span> week, <span class="at">y =</span> weight_kg, <span class="at">color =</span> animal_id)) <span class="sc">+</span></span>
<span id="cb148-116"><a href="#cb148-116" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">linewidth =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb148-117"><a href="#cb148-117" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">size =</span> <span class="dv">3</span>) <span class="sc">+</span></span>
<span id="cb148-118"><a href="#cb148-118" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Animal Growth Curves"</span>,</span>
<span id="cb148-119"><a href="#cb148-119" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">"Week"</span>,</span>
<span id="cb148-120"><a href="#cb148-120" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">"Weight (kg)"</span>,</span>
<span id="cb148-121"><a href="#cb148-121" aria-hidden="true" tabindex="-1"></a>       <span class="at">color =</span> <span class="st">"Animal ID"</span>)</span>
<span id="cb148-122"><a href="#cb148-122" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-123"><a href="#cb148-123" aria-hidden="true" tabindex="-1"></a><span class="co"># Easy to calculate summaries</span></span>
<span id="cb148-124"><a href="#cb148-124" aria-hidden="true" tabindex="-1"></a>tidy_weights <span class="sc">%&gt;%</span></span>
<span id="cb148-125"><a href="#cb148-125" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(week) <span class="sc">%&gt;%</span></span>
<span id="cb148-126"><a href="#cb148-126" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(</span>
<span id="cb148-127"><a href="#cb148-127" aria-hidden="true" tabindex="-1"></a>    <span class="at">mean_weight =</span> <span class="fu">mean</span>(weight_kg),</span>
<span id="cb148-128"><a href="#cb148-128" aria-hidden="true" tabindex="-1"></a>    <span class="at">sd_weight =</span> <span class="fu">sd</span>(weight_kg)</span>
<span id="cb148-129"><a href="#cb148-129" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb148-130"><a href="#cb148-130" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb148-131"><a href="#cb148-131" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-132"><a href="#cb148-132" aria-hidden="true" tabindex="-1"></a><span class="fu">### Common Messy Data Problems</span></span>
<span id="cb148-133"><a href="#cb148-133" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-134"><a href="#cb148-134" aria-hidden="true" tabindex="-1"></a><span class="ss">1. </span>**Column headers are values, not variable names** (like <span class="in">`week_0`</span>, <span class="in">`week_4`</span>)</span>
<span id="cb148-135"><a href="#cb148-135" aria-hidden="true" tabindex="-1"></a><span class="ss">2. </span>**Multiple variables in one column** (like "Holstein-Male")</span>
<span id="cb148-136"><a href="#cb148-136" aria-hidden="true" tabindex="-1"></a><span class="ss">3. </span>**Variables stored in both rows and columns**</span>
<span id="cb148-137"><a href="#cb148-137" aria-hidden="true" tabindex="-1"></a><span class="ss">4. </span>**Multiple types of observational units in the same table**</span>
<span id="cb148-138"><a href="#cb148-138" aria-hidden="true" tabindex="-1"></a><span class="ss">5. </span>**Single observational unit stored in multiple tables**</span>
<span id="cb148-139"><a href="#cb148-139" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-140"><a href="#cb148-140" aria-hidden="true" tabindex="-1"></a>This chapter teaches how to fix these problems.</span>
<span id="cb148-141"><a href="#cb148-141" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-142"><a href="#cb148-142" aria-hidden="true" tabindex="-1"></a>---</span>
<span id="cb148-143"><a href="#cb148-143" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-144"><a href="#cb148-144" aria-hidden="true" tabindex="-1"></a><span class="fu">## Data Reshaping with tidyr</span></span>
<span id="cb148-145"><a href="#cb148-145" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-146"><a href="#cb148-146" aria-hidden="true" tabindex="-1"></a><span class="fu">### `pivot_longer()`: Wide to Long</span></span>
<span id="cb148-147"><a href="#cb148-147" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-148"><a href="#cb148-148" aria-hidden="true" tabindex="-1"></a><span class="in">`pivot_longer()`</span> transforms wide data (many columns) into long data (many rows).</span>
<span id="cb148-149"><a href="#cb148-149" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-150"><a href="#cb148-150" aria-hidden="true" tabindex="-1"></a>**Basic syntax**:</span>
<span id="cb148-151"><a href="#cb148-151" aria-hidden="true" tabindex="-1"></a><span class="in">```r</span></span>
<span id="cb148-152"><a href="#cb148-152" aria-hidden="true" tabindex="-1"></a><span class="fu">pivot_longer</span>(</span>
<span id="cb148-153"><a href="#cb148-153" aria-hidden="true" tabindex="-1"></a>  data,</span>
<span id="cb148-154"><a href="#cb148-154" aria-hidden="true" tabindex="-1"></a>  <span class="at">cols =</span> <span class="sc">&lt;</span>columns to pivot<span class="sc">&gt;</span>,</span>
<span id="cb148-155"><a href="#cb148-155" aria-hidden="true" tabindex="-1"></a>  <span class="at">names_to =</span> <span class="st">"&lt;name for new column with old column names&gt;"</span>,</span>
<span id="cb148-156"><a href="#cb148-156" aria-hidden="true" tabindex="-1"></a>  <span class="at">values_to =</span> <span class="st">"&lt;name for new column with values&gt;"</span></span>
<span id="cb148-157"><a href="#cb148-157" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb148-158"><a href="#cb148-158" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb148-159"><a href="#cb148-159" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-160"><a href="#cb148-160" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Example: Pivoting Weight Measurements</span></span>
<span id="cb148-161"><a href="#cb148-161" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-164"><a href="#cb148-164" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb148-165"><a href="#cb148-165" aria-hidden="true" tabindex="-1"></a><span class="co">#| eval: true</span></span>
<span id="cb148-166"><a href="#cb148-166" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: true</span></span>
<span id="cb148-167"><a href="#cb148-167" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-168"><a href="#cb148-168" aria-hidden="true" tabindex="-1"></a><span class="co"># Start with wide format</span></span>
<span id="cb148-169"><a href="#cb148-169" aria-hidden="true" tabindex="-1"></a>wide_weights <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb148-170"><a href="#cb148-170" aria-hidden="true" tabindex="-1"></a>  <span class="at">animal_id =</span> <span class="fu">c</span>(<span class="st">"A001"</span>, <span class="st">"A002"</span>, <span class="st">"A003"</span>),</span>
<span id="cb148-171"><a href="#cb148-171" aria-hidden="true" tabindex="-1"></a>  <span class="at">breed =</span> <span class="fu">c</span>(<span class="st">"Holstein"</span>, <span class="st">"Jersey"</span>, <span class="st">"Angus"</span>),</span>
<span id="cb148-172"><a href="#cb148-172" aria-hidden="true" tabindex="-1"></a>  <span class="at">week_0 =</span> <span class="fu">c</span>(<span class="dv">45</span>, <span class="dv">42</span>, <span class="dv">48</span>),</span>
<span id="cb148-173"><a href="#cb148-173" aria-hidden="true" tabindex="-1"></a>  <span class="at">week_4 =</span> <span class="fu">c</span>(<span class="dv">52</span>, <span class="dv">48</span>, <span class="dv">54</span>),</span>
<span id="cb148-174"><a href="#cb148-174" aria-hidden="true" tabindex="-1"></a>  <span class="at">week_8 =</span> <span class="fu">c</span>(<span class="dv">58</span>, <span class="dv">54</span>, <span class="dv">61</span>)</span>
<span id="cb148-175"><a href="#cb148-175" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb148-176"><a href="#cb148-176" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-177"><a href="#cb148-177" aria-hidden="true" tabindex="-1"></a>wide_weights</span>
<span id="cb148-178"><a href="#cb148-178" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-179"><a href="#cb148-179" aria-hidden="true" tabindex="-1"></a><span class="co"># Pivot to long format</span></span>
<span id="cb148-180"><a href="#cb148-180" aria-hidden="true" tabindex="-1"></a>long_weights <span class="ot">&lt;-</span> wide_weights <span class="sc">%&gt;%</span></span>
<span id="cb148-181"><a href="#cb148-181" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(</span>
<span id="cb148-182"><a href="#cb148-182" aria-hidden="true" tabindex="-1"></a>    <span class="at">cols =</span> <span class="fu">starts_with</span>(<span class="st">"week"</span>),</span>
<span id="cb148-183"><a href="#cb148-183" aria-hidden="true" tabindex="-1"></a>    <span class="at">names_to =</span> <span class="st">"time_point"</span>,</span>
<span id="cb148-184"><a href="#cb148-184" aria-hidden="true" tabindex="-1"></a>    <span class="at">values_to =</span> <span class="st">"weight_kg"</span></span>
<span id="cb148-185"><a href="#cb148-185" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb148-186"><a href="#cb148-186" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-187"><a href="#cb148-187" aria-hidden="true" tabindex="-1"></a>long_weights</span>
<span id="cb148-188"><a href="#cb148-188" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb148-189"><a href="#cb148-189" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-190"><a href="#cb148-190" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Selecting Columns to Pivot</span></span>
<span id="cb148-191"><a href="#cb148-191" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-192"><a href="#cb148-192" aria-hidden="true" tabindex="-1"></a>Multiple ways to specify which columns to pivot:</span>
<span id="cb148-193"><a href="#cb148-193" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-196"><a href="#cb148-196" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb148-197"><a href="#cb148-197" aria-hidden="true" tabindex="-1"></a><span class="co">#| eval: true</span></span>
<span id="cb148-198"><a href="#cb148-198" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: true</span></span>
<span id="cb148-199"><a href="#cb148-199" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-200"><a href="#cb148-200" aria-hidden="true" tabindex="-1"></a><span class="co"># By name</span></span>
<span id="cb148-201"><a href="#cb148-201" aria-hidden="true" tabindex="-1"></a>wide_weights <span class="sc">%&gt;%</span></span>
<span id="cb148-202"><a href="#cb148-202" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(</span>
<span id="cb148-203"><a href="#cb148-203" aria-hidden="true" tabindex="-1"></a>    <span class="at">cols =</span> <span class="fu">c</span>(week_0, week_4, week_8),</span>
<span id="cb148-204"><a href="#cb148-204" aria-hidden="true" tabindex="-1"></a>    <span class="at">names_to =</span> <span class="st">"time_point"</span>,</span>
<span id="cb148-205"><a href="#cb148-205" aria-hidden="true" tabindex="-1"></a>    <span class="at">values_to =</span> <span class="st">"weight_kg"</span></span>
<span id="cb148-206"><a href="#cb148-206" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb148-207"><a href="#cb148-207" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-208"><a href="#cb148-208" aria-hidden="true" tabindex="-1"></a><span class="co"># By position</span></span>
<span id="cb148-209"><a href="#cb148-209" aria-hidden="true" tabindex="-1"></a>wide_weights <span class="sc">%&gt;%</span></span>
<span id="cb148-210"><a href="#cb148-210" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(</span>
<span id="cb148-211"><a href="#cb148-211" aria-hidden="true" tabindex="-1"></a>    <span class="at">cols =</span> <span class="dv">3</span><span class="sc">:</span><span class="dv">5</span>,</span>
<span id="cb148-212"><a href="#cb148-212" aria-hidden="true" tabindex="-1"></a>    <span class="at">names_to =</span> <span class="st">"time_point"</span>,</span>
<span id="cb148-213"><a href="#cb148-213" aria-hidden="true" tabindex="-1"></a>    <span class="at">values_to =</span> <span class="st">"weight_kg"</span></span>
<span id="cb148-214"><a href="#cb148-214" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb148-215"><a href="#cb148-215" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-216"><a href="#cb148-216" aria-hidden="true" tabindex="-1"></a><span class="co"># Everything except ID columns</span></span>
<span id="cb148-217"><a href="#cb148-217" aria-hidden="true" tabindex="-1"></a>wide_weights <span class="sc">%&gt;%</span></span>
<span id="cb148-218"><a href="#cb148-218" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(</span>
<span id="cb148-219"><a href="#cb148-219" aria-hidden="true" tabindex="-1"></a>    <span class="at">cols =</span> <span class="sc">-</span><span class="fu">c</span>(animal_id, breed),</span>
<span id="cb148-220"><a href="#cb148-220" aria-hidden="true" tabindex="-1"></a>    <span class="at">names_to =</span> <span class="st">"time_point"</span>,</span>
<span id="cb148-221"><a href="#cb148-221" aria-hidden="true" tabindex="-1"></a>    <span class="at">values_to =</span> <span class="st">"weight_kg"</span></span>
<span id="cb148-222"><a href="#cb148-222" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb148-223"><a href="#cb148-223" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb148-224"><a href="#cb148-224" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-225"><a href="#cb148-225" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Cleaning Column Names During Pivot</span></span>
<span id="cb148-226"><a href="#cb148-226" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-227"><a href="#cb148-227" aria-hidden="true" tabindex="-1"></a>Use <span class="in">`names_prefix`</span> to remove prefixes and <span class="in">`names_transform`</span> to change types:</span>
<span id="cb148-228"><a href="#cb148-228" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-231"><a href="#cb148-231" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb148-232"><a href="#cb148-232" aria-hidden="true" tabindex="-1"></a><span class="co">#| eval: true</span></span>
<span id="cb148-233"><a href="#cb148-233" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: true</span></span>
<span id="cb148-234"><a href="#cb148-234" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-235"><a href="#cb148-235" aria-hidden="true" tabindex="-1"></a><span class="co"># Remove "week_" prefix and convert to numeric</span></span>
<span id="cb148-236"><a href="#cb148-236" aria-hidden="true" tabindex="-1"></a>wide_weights <span class="sc">%&gt;%</span></span>
<span id="cb148-237"><a href="#cb148-237" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(</span>
<span id="cb148-238"><a href="#cb148-238" aria-hidden="true" tabindex="-1"></a>    <span class="at">cols =</span> <span class="fu">starts_with</span>(<span class="st">"week"</span>),</span>
<span id="cb148-239"><a href="#cb148-239" aria-hidden="true" tabindex="-1"></a>    <span class="at">names_to =</span> <span class="st">"week"</span>,</span>
<span id="cb148-240"><a href="#cb148-240" aria-hidden="true" tabindex="-1"></a>    <span class="at">values_to =</span> <span class="st">"weight_kg"</span>,</span>
<span id="cb148-241"><a href="#cb148-241" aria-hidden="true" tabindex="-1"></a>    <span class="at">names_prefix =</span> <span class="st">"week_"</span>,</span>
<span id="cb148-242"><a href="#cb148-242" aria-hidden="true" tabindex="-1"></a>    <span class="at">names_transform =</span> <span class="fu">list</span>(<span class="at">week =</span> as.integer)</span>
<span id="cb148-243"><a href="#cb148-243" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb148-244"><a href="#cb148-244" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb148-245"><a href="#cb148-245" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-246"><a href="#cb148-246" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Multiple Value Columns</span></span>
<span id="cb148-247"><a href="#cb148-247" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-248"><a href="#cb148-248" aria-hidden="true" tabindex="-1"></a>What if you have multiple measurements at each time point?</span>
<span id="cb148-249"><a href="#cb148-249" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-252"><a href="#cb148-252" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb148-253"><a href="#cb148-253" aria-hidden="true" tabindex="-1"></a><span class="co">#| eval: true</span></span>
<span id="cb148-254"><a href="#cb148-254" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: true</span></span>
<span id="cb148-255"><a href="#cb148-255" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-256"><a href="#cb148-256" aria-hidden="true" tabindex="-1"></a><span class="co"># Wide data with multiple measurements</span></span>
<span id="cb148-257"><a href="#cb148-257" aria-hidden="true" tabindex="-1"></a>wide_multi <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb148-258"><a href="#cb148-258" aria-hidden="true" tabindex="-1"></a>  <span class="at">animal_id =</span> <span class="fu">c</span>(<span class="st">"A001"</span>, <span class="st">"A002"</span>),</span>
<span id="cb148-259"><a href="#cb148-259" aria-hidden="true" tabindex="-1"></a>  <span class="at">weight_week0 =</span> <span class="fu">c</span>(<span class="dv">45</span>, <span class="dv">42</span>),</span>
<span id="cb148-260"><a href="#cb148-260" aria-hidden="true" tabindex="-1"></a>  <span class="at">weight_week4 =</span> <span class="fu">c</span>(<span class="dv">52</span>, <span class="dv">48</span>),</span>
<span id="cb148-261"><a href="#cb148-261" aria-hidden="true" tabindex="-1"></a>  <span class="at">height_week0 =</span> <span class="fu">c</span>(<span class="dv">80</span>, <span class="dv">78</span>),</span>
<span id="cb148-262"><a href="#cb148-262" aria-hidden="true" tabindex="-1"></a>  <span class="at">height_week4 =</span> <span class="fu">c</span>(<span class="dv">85</span>, <span class="dv">82</span>)</span>
<span id="cb148-263"><a href="#cb148-263" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb148-264"><a href="#cb148-264" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-265"><a href="#cb148-265" aria-hidden="true" tabindex="-1"></a>wide_multi</span>
<span id="cb148-266"><a href="#cb148-266" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-267"><a href="#cb148-267" aria-hidden="true" tabindex="-1"></a><span class="co"># Alternative: create separate columns for each measurement</span></span>
<span id="cb148-268"><a href="#cb148-268" aria-hidden="true" tabindex="-1"></a>wide_multi <span class="sc">%&gt;%</span></span>
<span id="cb148-269"><a href="#cb148-269" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(</span>
<span id="cb148-270"><a href="#cb148-270" aria-hidden="true" tabindex="-1"></a>    <span class="at">cols =</span> <span class="sc">-</span>animal_id,</span>
<span id="cb148-271"><a href="#cb148-271" aria-hidden="true" tabindex="-1"></a>    <span class="at">names_to =</span> <span class="fu">c</span>(<span class="st">".value"</span>, <span class="st">"week"</span>),</span>
<span id="cb148-272"><a href="#cb148-272" aria-hidden="true" tabindex="-1"></a>    <span class="at">names_pattern =</span> <span class="st">"(.+)_week(.+)"</span></span>
<span id="cb148-273"><a href="#cb148-273" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb148-274"><a href="#cb148-274" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb148-275"><a href="#cb148-275" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-276"><a href="#cb148-276" aria-hidden="true" tabindex="-1"></a>::: {.callout-tip}</span>
<span id="cb148-277"><a href="#cb148-277" aria-hidden="true" tabindex="-1"></a><span class="fu">## `names_pattern` with Regular Expressions</span></span>
<span id="cb148-278"><a href="#cb148-278" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-279"><a href="#cb148-279" aria-hidden="true" tabindex="-1"></a>Use <span class="in">`names_pattern`</span> with regex to extract parts of column names:</span>
<span id="cb148-280"><a href="#cb148-280" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span><span class="in">`.+`</span> matches one or more characters</span>
<span id="cb148-281"><a href="#cb148-281" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span><span class="in">`(.+)`</span> creates a capture group</span>
<span id="cb148-282"><a href="#cb148-282" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span><span class="in">`week(.+)`</span> matches "week" followed by captured characters</span>
<span id="cb148-283"><a href="#cb148-283" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb148-284"><a href="#cb148-284" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-285"><a href="#cb148-285" aria-hidden="true" tabindex="-1"></a><span class="fu">### `pivot_wider()`: Long to Wide</span></span>
<span id="cb148-286"><a href="#cb148-286" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-287"><a href="#cb148-287" aria-hidden="true" tabindex="-1"></a><span class="in">`pivot_wider()`</span> transforms long data (many rows) into wide data (many columns). It's the opposite of <span class="in">`pivot_longer()`</span>.</span>
<span id="cb148-288"><a href="#cb148-288" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-289"><a href="#cb148-289" aria-hidden="true" tabindex="-1"></a>**Basic syntax**:</span>
<span id="cb148-290"><a href="#cb148-290" aria-hidden="true" tabindex="-1"></a><span class="in">```r</span></span>
<span id="cb148-291"><a href="#cb148-291" aria-hidden="true" tabindex="-1"></a><span class="fu">pivot_wider</span>(</span>
<span id="cb148-292"><a href="#cb148-292" aria-hidden="true" tabindex="-1"></a>  data,</span>
<span id="cb148-293"><a href="#cb148-293" aria-hidden="true" tabindex="-1"></a>  <span class="at">names_from =</span> <span class="sc">&lt;</span>column with names <span class="cf">for</span> new columns<span class="sc">&gt;</span>,</span>
<span id="cb148-294"><a href="#cb148-294" aria-hidden="true" tabindex="-1"></a>  <span class="at">values_from =</span> <span class="sc">&lt;</span>column with values to fill new columns<span class="sc">&gt;</span></span>
<span id="cb148-295"><a href="#cb148-295" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb148-296"><a href="#cb148-296" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb148-297"><a href="#cb148-297" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-298"><a href="#cb148-298" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Example: Creating a Summary Table</span></span>
<span id="cb148-299"><a href="#cb148-299" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-302"><a href="#cb148-302" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb148-303"><a href="#cb148-303" aria-hidden="true" tabindex="-1"></a><span class="co">#| eval: true</span></span>
<span id="cb148-304"><a href="#cb148-304" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: true</span></span>
<span id="cb148-305"><a href="#cb148-305" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-306"><a href="#cb148-306" aria-hidden="true" tabindex="-1"></a><span class="co"># Long format data</span></span>
<span id="cb148-307"><a href="#cb148-307" aria-hidden="true" tabindex="-1"></a>animals_long <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb148-308"><a href="#cb148-308" aria-hidden="true" tabindex="-1"></a>  <span class="at">animal_id =</span> <span class="fu">rep</span>(<span class="fu">c</span>(<span class="st">"A001"</span>, <span class="st">"A002"</span>, <span class="st">"A003"</span>), <span class="at">each =</span> <span class="dv">3</span>),</span>
<span id="cb148-309"><a href="#cb148-309" aria-hidden="true" tabindex="-1"></a>  <span class="at">breed =</span> <span class="fu">rep</span>(<span class="fu">c</span>(<span class="st">"Holstein"</span>, <span class="st">"Jersey"</span>, <span class="st">"Angus"</span>), <span class="at">each =</span> <span class="dv">3</span>),</span>
<span id="cb148-310"><a href="#cb148-310" aria-hidden="true" tabindex="-1"></a>  <span class="at">treatment =</span> <span class="fu">rep</span>(<span class="fu">c</span>(<span class="st">"Control"</span>, <span class="st">"Treatment_A"</span>, <span class="st">"Treatment_B"</span>), <span class="at">times =</span> <span class="dv">3</span>),</span>
<span id="cb148-311"><a href="#cb148-311" aria-hidden="true" tabindex="-1"></a>  <span class="at">weight_gain_kg =</span> <span class="fu">c</span>(<span class="dv">15</span>, <span class="dv">22</span>, <span class="dv">18</span>, <span class="dv">12</span>, <span class="dv">18</span>, <span class="dv">15</span>, <span class="dv">16</span>, <span class="dv">21</span>, <span class="dv">17</span>)</span>
<span id="cb148-312"><a href="#cb148-312" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb148-313"><a href="#cb148-313" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-314"><a href="#cb148-314" aria-hidden="true" tabindex="-1"></a>animals_long</span>
<span id="cb148-315"><a href="#cb148-315" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-316"><a href="#cb148-316" aria-hidden="true" tabindex="-1"></a><span class="co"># Pivot wider: treatments become columns</span></span>
<span id="cb148-317"><a href="#cb148-317" aria-hidden="true" tabindex="-1"></a>animals_wide <span class="ot">&lt;-</span> animals_long <span class="sc">%&gt;%</span></span>
<span id="cb148-318"><a href="#cb148-318" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(</span>
<span id="cb148-319"><a href="#cb148-319" aria-hidden="true" tabindex="-1"></a>    <span class="at">names_from =</span> treatment,</span>
<span id="cb148-320"><a href="#cb148-320" aria-hidden="true" tabindex="-1"></a>    <span class="at">values_from =</span> weight_gain_kg</span>
<span id="cb148-321"><a href="#cb148-321" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb148-322"><a href="#cb148-322" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-323"><a href="#cb148-323" aria-hidden="true" tabindex="-1"></a>animals_wide</span>
<span id="cb148-324"><a href="#cb148-324" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb148-325"><a href="#cb148-325" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-326"><a href="#cb148-326" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Handling Multiple Value Columns</span></span>
<span id="cb148-327"><a href="#cb148-327" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-330"><a href="#cb148-330" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb148-331"><a href="#cb148-331" aria-hidden="true" tabindex="-1"></a><span class="co">#| eval: true</span></span>
<span id="cb148-332"><a href="#cb148-332" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: true</span></span>
<span id="cb148-333"><a href="#cb148-333" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-334"><a href="#cb148-334" aria-hidden="true" tabindex="-1"></a><span class="co"># Long data with multiple measurements</span></span>
<span id="cb148-335"><a href="#cb148-335" aria-hidden="true" tabindex="-1"></a>measurements_long <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb148-336"><a href="#cb148-336" aria-hidden="true" tabindex="-1"></a>  <span class="at">animal_id =</span> <span class="fu">rep</span>(<span class="fu">c</span>(<span class="st">"A001"</span>, <span class="st">"A002"</span>), <span class="at">each =</span> <span class="dv">4</span>),</span>
<span id="cb148-337"><a href="#cb148-337" aria-hidden="true" tabindex="-1"></a>  <span class="at">week =</span> <span class="fu">rep</span>(<span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">4</span>, <span class="dv">8</span>, <span class="dv">12</span>), <span class="at">times =</span> <span class="dv">2</span>),</span>
<span id="cb148-338"><a href="#cb148-338" aria-hidden="true" tabindex="-1"></a>  <span class="at">weight_kg =</span> <span class="fu">c</span>(<span class="dv">45</span>, <span class="dv">52</span>, <span class="dv">58</span>, <span class="dv">64</span>, <span class="dv">42</span>, <span class="dv">48</span>, <span class="dv">54</span>, <span class="dv">60</span>),</span>
<span id="cb148-339"><a href="#cb148-339" aria-hidden="true" tabindex="-1"></a>  <span class="at">height_cm =</span> <span class="fu">c</span>(<span class="dv">80</span>, <span class="dv">85</span>, <span class="dv">88</span>, <span class="dv">91</span>, <span class="dv">78</span>, <span class="dv">82</span>, <span class="dv">85</span>, <span class="dv">88</span>)</span>
<span id="cb148-340"><a href="#cb148-340" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb148-341"><a href="#cb148-341" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-342"><a href="#cb148-342" aria-hidden="true" tabindex="-1"></a>measurements_long</span>
<span id="cb148-343"><a href="#cb148-343" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-344"><a href="#cb148-344" aria-hidden="true" tabindex="-1"></a><span class="co"># Pivot wider: weeks become columns for each measurement</span></span>
<span id="cb148-345"><a href="#cb148-345" aria-hidden="true" tabindex="-1"></a>measurements_long <span class="sc">%&gt;%</span></span>
<span id="cb148-346"><a href="#cb148-346" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(</span>
<span id="cb148-347"><a href="#cb148-347" aria-hidden="true" tabindex="-1"></a>    <span class="at">names_from =</span> week,</span>
<span id="cb148-348"><a href="#cb148-348" aria-hidden="true" tabindex="-1"></a>    <span class="at">values_from =</span> <span class="fu">c</span>(weight_kg, height_cm),</span>
<span id="cb148-349"><a href="#cb148-349" aria-hidden="true" tabindex="-1"></a>    <span class="at">names_glue =</span> <span class="st">"{.value}_week{week}"</span></span>
<span id="cb148-350"><a href="#cb148-350" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb148-351"><a href="#cb148-351" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb148-352"><a href="#cb148-352" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-353"><a href="#cb148-353" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Dealing with Duplicates</span></span>
<span id="cb148-354"><a href="#cb148-354" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-355"><a href="#cb148-355" aria-hidden="true" tabindex="-1"></a>What if you have duplicate id-time combinations?</span>
<span id="cb148-356"><a href="#cb148-356" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-359"><a href="#cb148-359" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb148-360"><a href="#cb148-360" aria-hidden="true" tabindex="-1"></a><span class="co">#| eval: true</span></span>
<span id="cb148-361"><a href="#cb148-361" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: true</span></span>
<span id="cb148-362"><a href="#cb148-362" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-363"><a href="#cb148-363" aria-hidden="true" tabindex="-1"></a><span class="co"># Data with duplicates</span></span>
<span id="cb148-364"><a href="#cb148-364" aria-hidden="true" tabindex="-1"></a>duplicated_data <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb148-365"><a href="#cb148-365" aria-hidden="true" tabindex="-1"></a>  <span class="at">animal_id =</span> <span class="fu">c</span>(<span class="st">"A001"</span>, <span class="st">"A001"</span>, <span class="st">"A002"</span>, <span class="st">"A002"</span>),</span>
<span id="cb148-366"><a href="#cb148-366" aria-hidden="true" tabindex="-1"></a>  <span class="at">week =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>),  <span class="co"># Same animal measured twice</span></span>
<span id="cb148-367"><a href="#cb148-367" aria-hidden="true" tabindex="-1"></a>  <span class="at">weight_kg =</span> <span class="fu">c</span>(<span class="dv">45</span>, <span class="dv">46</span>, <span class="dv">42</span>, <span class="dv">43</span>)</span>
<span id="cb148-368"><a href="#cb148-368" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb148-369"><a href="#cb148-369" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-370"><a href="#cb148-370" aria-hidden="true" tabindex="-1"></a>duplicated_data</span>
<span id="cb148-371"><a href="#cb148-371" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-372"><a href="#cb148-372" aria-hidden="true" tabindex="-1"></a><span class="co"># Summarize first to remove duplicates</span></span>
<span id="cb148-373"><a href="#cb148-373" aria-hidden="true" tabindex="-1"></a>duplicated_data <span class="sc">%&gt;%</span></span>
<span id="cb148-374"><a href="#cb148-374" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(animal_id, week) <span class="sc">%&gt;%</span></span>
<span id="cb148-375"><a href="#cb148-375" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">weight_kg =</span> <span class="fu">mean</span>(weight_kg), <span class="at">.groups =</span> <span class="st">"drop"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb148-376"><a href="#cb148-376" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(</span>
<span id="cb148-377"><a href="#cb148-377" aria-hidden="true" tabindex="-1"></a>    <span class="at">names_from =</span> week,</span>
<span id="cb148-378"><a href="#cb148-378" aria-hidden="true" tabindex="-1"></a>    <span class="at">values_from =</span> weight_kg</span>
<span id="cb148-379"><a href="#cb148-379" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb148-380"><a href="#cb148-380" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb148-381"><a href="#cb148-381" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-382"><a href="#cb148-382" aria-hidden="true" tabindex="-1"></a>::: {.callout-warning}</span>
<span id="cb148-383"><a href="#cb148-383" aria-hidden="true" tabindex="-1"></a><span class="fu">## Watch Out for Duplicates!</span></span>
<span id="cb148-384"><a href="#cb148-384" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-385"><a href="#cb148-385" aria-hidden="true" tabindex="-1"></a><span class="in">`pivot_wider()`</span> creates list-columns when there are multiple values for the same id × names_from combination. Either:</span>
<span id="cb148-386"><a href="#cb148-386" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Summarize first (take mean, max, etc.)</span>
<span id="cb148-387"><a href="#cb148-387" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Keep as list-column and <span class="in">`unnest()`</span> later</span>
<span id="cb148-388"><a href="#cb148-388" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Check your data for unexpected duplicates</span>
<span id="cb148-389"><a href="#cb148-389" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb148-390"><a href="#cb148-390" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-391"><a href="#cb148-391" aria-hidden="true" tabindex="-1"></a><span class="fu">### `separate()`: Split One Column into Many</span></span>
<span id="cb148-392"><a href="#cb148-392" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-393"><a href="#cb148-393" aria-hidden="true" tabindex="-1"></a><span class="in">`separate()`</span> splits a single column into multiple columns based on a separator.</span>
<span id="cb148-394"><a href="#cb148-394" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-395"><a href="#cb148-395" aria-hidden="true" tabindex="-1"></a>**Basic syntax**:</span>
<span id="cb148-396"><a href="#cb148-396" aria-hidden="true" tabindex="-1"></a><span class="in">```r</span></span>
<span id="cb148-397"><a href="#cb148-397" aria-hidden="true" tabindex="-1"></a><span class="fu">separate</span>(</span>
<span id="cb148-398"><a href="#cb148-398" aria-hidden="true" tabindex="-1"></a>  data,</span>
<span id="cb148-399"><a href="#cb148-399" aria-hidden="true" tabindex="-1"></a>  <span class="at">col =</span> <span class="sc">&lt;</span>column to split<span class="sc">&gt;</span>,</span>
<span id="cb148-400"><a href="#cb148-400" aria-hidden="true" tabindex="-1"></a>  <span class="at">into =</span> <span class="fu">c</span>(<span class="st">"&lt;new_col1&gt;"</span>, <span class="st">"&lt;new_col2&gt;"</span>),</span>
<span id="cb148-401"><a href="#cb148-401" aria-hidden="true" tabindex="-1"></a>  <span class="at">sep =</span> <span class="st">"&lt;separator&gt;"</span></span>
<span id="cb148-402"><a href="#cb148-402" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb148-403"><a href="#cb148-403" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb148-404"><a href="#cb148-404" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-405"><a href="#cb148-405" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Example: Splitting Composite IDs</span></span>
<span id="cb148-406"><a href="#cb148-406" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-409"><a href="#cb148-409" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb148-410"><a href="#cb148-410" aria-hidden="true" tabindex="-1"></a><span class="co">#| eval: true</span></span>
<span id="cb148-411"><a href="#cb148-411" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: true</span></span>
<span id="cb148-412"><a href="#cb148-412" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-413"><a href="#cb148-413" aria-hidden="true" tabindex="-1"></a><span class="co"># Data with composite identifiers</span></span>
<span id="cb148-414"><a href="#cb148-414" aria-hidden="true" tabindex="-1"></a>animals_composite <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb148-415"><a href="#cb148-415" aria-hidden="true" tabindex="-1"></a>  <span class="at">animal_id =</span> <span class="fu">c</span>(<span class="st">"Holstein_M_001"</span>, <span class="st">"Jersey_F_002"</span>, <span class="st">"Angus_M_003"</span>),</span>
<span id="cb148-416"><a href="#cb148-416" aria-hidden="true" tabindex="-1"></a>  <span class="at">weight_kg =</span> <span class="fu">c</span>(<span class="dv">550</span>, <span class="dv">420</span>, <span class="dv">580</span>)</span>
<span id="cb148-417"><a href="#cb148-417" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb148-418"><a href="#cb148-418" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-419"><a href="#cb148-419" aria-hidden="true" tabindex="-1"></a>animals_composite</span>
<span id="cb148-420"><a href="#cb148-420" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-421"><a href="#cb148-421" aria-hidden="true" tabindex="-1"></a><span class="co"># Separate into components</span></span>
<span id="cb148-422"><a href="#cb148-422" aria-hidden="true" tabindex="-1"></a>animals_composite <span class="sc">%&gt;%</span></span>
<span id="cb148-423"><a href="#cb148-423" aria-hidden="true" tabindex="-1"></a>  <span class="fu">separate</span>(</span>
<span id="cb148-424"><a href="#cb148-424" aria-hidden="true" tabindex="-1"></a>    <span class="at">col =</span> animal_id,</span>
<span id="cb148-425"><a href="#cb148-425" aria-hidden="true" tabindex="-1"></a>    <span class="at">into =</span> <span class="fu">c</span>(<span class="st">"breed"</span>, <span class="st">"sex"</span>, <span class="st">"id_number"</span>),</span>
<span id="cb148-426"><a href="#cb148-426" aria-hidden="true" tabindex="-1"></a>    <span class="at">sep =</span> <span class="st">"_"</span></span>
<span id="cb148-427"><a href="#cb148-427" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb148-428"><a href="#cb148-428" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb148-429"><a href="#cb148-429" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-430"><a href="#cb148-430" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Automatic Type Conversion</span></span>
<span id="cb148-431"><a href="#cb148-431" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-434"><a href="#cb148-434" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb148-435"><a href="#cb148-435" aria-hidden="true" tabindex="-1"></a><span class="co">#| eval: true</span></span>
<span id="cb148-436"><a href="#cb148-436" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: true</span></span>
<span id="cb148-437"><a href="#cb148-437" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-438"><a href="#cb148-438" aria-hidden="true" tabindex="-1"></a><span class="co"># Separate and convert types automatically</span></span>
<span id="cb148-439"><a href="#cb148-439" aria-hidden="true" tabindex="-1"></a>animals_composite <span class="sc">%&gt;%</span></span>
<span id="cb148-440"><a href="#cb148-440" aria-hidden="true" tabindex="-1"></a>  <span class="fu">separate</span>(</span>
<span id="cb148-441"><a href="#cb148-441" aria-hidden="true" tabindex="-1"></a>    <span class="at">col =</span> animal_id,</span>
<span id="cb148-442"><a href="#cb148-442" aria-hidden="true" tabindex="-1"></a>    <span class="at">into =</span> <span class="fu">c</span>(<span class="st">"breed"</span>, <span class="st">"sex"</span>, <span class="st">"id_number"</span>),</span>
<span id="cb148-443"><a href="#cb148-443" aria-hidden="true" tabindex="-1"></a>    <span class="at">sep =</span> <span class="st">"_"</span>,</span>
<span id="cb148-444"><a href="#cb148-444" aria-hidden="true" tabindex="-1"></a>    <span class="at">convert =</span> <span class="cn">TRUE</span>  <span class="co"># Automatically converts to appropriate types</span></span>
<span id="cb148-445"><a href="#cb148-445" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb148-446"><a href="#cb148-446" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb148-447"><a href="#cb148-447" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-448"><a href="#cb148-448" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Keeping the Original Column</span></span>
<span id="cb148-449"><a href="#cb148-449" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-452"><a href="#cb148-452" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb148-453"><a href="#cb148-453" aria-hidden="true" tabindex="-1"></a><span class="co">#| eval: true</span></span>
<span id="cb148-454"><a href="#cb148-454" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: true</span></span>
<span id="cb148-455"><a href="#cb148-455" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-456"><a href="#cb148-456" aria-hidden="true" tabindex="-1"></a><span class="co"># Keep original column</span></span>
<span id="cb148-457"><a href="#cb148-457" aria-hidden="true" tabindex="-1"></a>animals_composite <span class="sc">%&gt;%</span></span>
<span id="cb148-458"><a href="#cb148-458" aria-hidden="true" tabindex="-1"></a>  <span class="fu">separate</span>(</span>
<span id="cb148-459"><a href="#cb148-459" aria-hidden="true" tabindex="-1"></a>    <span class="at">col =</span> animal_id,</span>
<span id="cb148-460"><a href="#cb148-460" aria-hidden="true" tabindex="-1"></a>    <span class="at">into =</span> <span class="fu">c</span>(<span class="st">"breed"</span>, <span class="st">"sex"</span>, <span class="st">"id_number"</span>),</span>
<span id="cb148-461"><a href="#cb148-461" aria-hidden="true" tabindex="-1"></a>    <span class="at">sep =</span> <span class="st">"_"</span>,</span>
<span id="cb148-462"><a href="#cb148-462" aria-hidden="true" tabindex="-1"></a>    <span class="at">remove =</span> <span class="cn">FALSE</span>  <span class="co"># Don't remove original column</span></span>
<span id="cb148-463"><a href="#cb148-463" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb148-464"><a href="#cb148-464" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb148-465"><a href="#cb148-465" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-466"><a href="#cb148-466" aria-hidden="true" tabindex="-1"></a><span class="fu">### `unite()`: Combine Columns into One</span></span>
<span id="cb148-467"><a href="#cb148-467" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-468"><a href="#cb148-468" aria-hidden="true" tabindex="-1"></a><span class="in">`unite()`</span> is the opposite of <span class="in">`separate()`</span> — it combines multiple columns into one.</span>
<span id="cb148-469"><a href="#cb148-469" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-470"><a href="#cb148-470" aria-hidden="true" tabindex="-1"></a>**Basic syntax**:</span>
<span id="cb148-471"><a href="#cb148-471" aria-hidden="true" tabindex="-1"></a><span class="in">```r</span></span>
<span id="cb148-472"><a href="#cb148-472" aria-hidden="true" tabindex="-1"></a><span class="fu">unite</span>(</span>
<span id="cb148-473"><a href="#cb148-473" aria-hidden="true" tabindex="-1"></a>  data,</span>
<span id="cb148-474"><a href="#cb148-474" aria-hidden="true" tabindex="-1"></a>  <span class="at">col =</span> <span class="st">"&lt;new_column_name&gt;"</span>,</span>
<span id="cb148-475"><a href="#cb148-475" aria-hidden="true" tabindex="-1"></a>  ...,</span>
<span id="cb148-476"><a href="#cb148-476" aria-hidden="true" tabindex="-1"></a>  <span class="at">sep =</span> <span class="st">"&lt;separator&gt;"</span></span>
<span id="cb148-477"><a href="#cb148-477" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb148-478"><a href="#cb148-478" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb148-479"><a href="#cb148-479" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-480"><a href="#cb148-480" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Example: Creating Unique IDs</span></span>
<span id="cb148-481"><a href="#cb148-481" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-484"><a href="#cb148-484" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb148-485"><a href="#cb148-485" aria-hidden="true" tabindex="-1"></a><span class="co">#| eval: true</span></span>
<span id="cb148-486"><a href="#cb148-486" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: true</span></span>
<span id="cb148-487"><a href="#cb148-487" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-488"><a href="#cb148-488" aria-hidden="true" tabindex="-1"></a><span class="co"># Separate columns</span></span>
<span id="cb148-489"><a href="#cb148-489" aria-hidden="true" tabindex="-1"></a>animals_separated <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb148-490"><a href="#cb148-490" aria-hidden="true" tabindex="-1"></a>  <span class="at">farm =</span> <span class="fu">c</span>(<span class="st">"North"</span>, <span class="st">"South"</span>, <span class="st">"East"</span>),</span>
<span id="cb148-491"><a href="#cb148-491" aria-hidden="true" tabindex="-1"></a>  <span class="at">breed =</span> <span class="fu">c</span>(<span class="st">"Holstein"</span>, <span class="st">"Jersey"</span>, <span class="st">"Angus"</span>),</span>
<span id="cb148-492"><a href="#cb148-492" aria-hidden="true" tabindex="-1"></a>  <span class="at">id_num =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>),</span>
<span id="cb148-493"><a href="#cb148-493" aria-hidden="true" tabindex="-1"></a>  <span class="at">weight_kg =</span> <span class="fu">c</span>(<span class="dv">550</span>, <span class="dv">420</span>, <span class="dv">580</span>)</span>
<span id="cb148-494"><a href="#cb148-494" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb148-495"><a href="#cb148-495" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-496"><a href="#cb148-496" aria-hidden="true" tabindex="-1"></a>animals_separated</span>
<span id="cb148-497"><a href="#cb148-497" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-498"><a href="#cb148-498" aria-hidden="true" tabindex="-1"></a><span class="co"># Unite into single ID</span></span>
<span id="cb148-499"><a href="#cb148-499" aria-hidden="true" tabindex="-1"></a>animals_separated <span class="sc">%&gt;%</span></span>
<span id="cb148-500"><a href="#cb148-500" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unite</span>(</span>
<span id="cb148-501"><a href="#cb148-501" aria-hidden="true" tabindex="-1"></a>    <span class="at">col =</span> <span class="st">"animal_id"</span>,</span>
<span id="cb148-502"><a href="#cb148-502" aria-hidden="true" tabindex="-1"></a>    farm, breed, id_num,</span>
<span id="cb148-503"><a href="#cb148-503" aria-hidden="true" tabindex="-1"></a>    <span class="at">sep =</span> <span class="st">"_"</span></span>
<span id="cb148-504"><a href="#cb148-504" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb148-505"><a href="#cb148-505" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb148-506"><a href="#cb148-506" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-507"><a href="#cb148-507" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Keeping Original Columns</span></span>
<span id="cb148-508"><a href="#cb148-508" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-511"><a href="#cb148-511" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb148-512"><a href="#cb148-512" aria-hidden="true" tabindex="-1"></a><span class="co">#| eval: true</span></span>
<span id="cb148-513"><a href="#cb148-513" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: true</span></span>
<span id="cb148-514"><a href="#cb148-514" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-515"><a href="#cb148-515" aria-hidden="true" tabindex="-1"></a><span class="co"># Keep original columns</span></span>
<span id="cb148-516"><a href="#cb148-516" aria-hidden="true" tabindex="-1"></a>animals_separated <span class="sc">%&gt;%</span></span>
<span id="cb148-517"><a href="#cb148-517" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unite</span>(</span>
<span id="cb148-518"><a href="#cb148-518" aria-hidden="true" tabindex="-1"></a>    <span class="at">col =</span> <span class="st">"animal_id"</span>,</span>
<span id="cb148-519"><a href="#cb148-519" aria-hidden="true" tabindex="-1"></a>    farm, breed, id_num,</span>
<span id="cb148-520"><a href="#cb148-520" aria-hidden="true" tabindex="-1"></a>    <span class="at">sep =</span> <span class="st">"_"</span>,</span>
<span id="cb148-521"><a href="#cb148-521" aria-hidden="true" tabindex="-1"></a>    <span class="at">remove =</span> <span class="cn">FALSE</span></span>
<span id="cb148-522"><a href="#cb148-522" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb148-523"><a href="#cb148-523" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb148-524"><a href="#cb148-524" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-525"><a href="#cb148-525" aria-hidden="true" tabindex="-1"></a><span class="fu">### When to Use Each Function</span></span>
<span id="cb148-526"><a href="#cb148-526" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-527"><a href="#cb148-527" aria-hidden="true" tabindex="-1"></a><span class="pp">|</span> Goal <span class="pp">|</span> Function <span class="pp">|</span> Example <span class="pp">|</span></span>
<span id="cb148-528"><a href="#cb148-528" aria-hidden="true" tabindex="-1"></a><span class="pp">|------|----------|---------|</span></span>
<span id="cb148-529"><a href="#cb148-529" aria-hidden="true" tabindex="-1"></a><span class="pp">|</span> Many columns → few rows <span class="pp">|</span> <span class="in">`pivot_longer()`</span> <span class="pp">|</span> week_0, week_4, week_8 → week column <span class="pp">|</span></span>
<span id="cb148-530"><a href="#cb148-530" aria-hidden="true" tabindex="-1"></a><span class="pp">|</span> Few columns → many rows <span class="pp">|</span> <span class="in">`pivot_wider()`</span> <span class="pp">|</span> week column → week_0, week_4, week_8 <span class="pp">|</span></span>
<span id="cb148-531"><a href="#cb148-531" aria-hidden="true" tabindex="-1"></a><span class="pp">|</span> One column → many columns <span class="pp">|</span> <span class="in">`separate()`</span> <span class="pp">|</span> "Holstein_M_001" → breed, sex, id <span class="pp">|</span></span>
<span id="cb148-532"><a href="#cb148-532" aria-hidden="true" tabindex="-1"></a><span class="pp">|</span> Many columns → one column <span class="pp">|</span> <span class="in">`unite()`</span> <span class="pp">|</span> breed, sex, id → "Holstein_M_001" <span class="pp">|</span></span>
<span id="cb148-533"><a href="#cb148-533" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-534"><a href="#cb148-534" aria-hidden="true" tabindex="-1"></a>---</span>
<span id="cb148-535"><a href="#cb148-535" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-536"><a href="#cb148-536" aria-hidden="true" tabindex="-1"></a><span class="fu">## Joining Datasets</span></span>
<span id="cb148-537"><a href="#cb148-537" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-538"><a href="#cb148-538" aria-hidden="true" tabindex="-1"></a>In real-world analysis, data is often spread across multiple tables. **Joins** combine tables based on shared keys.</span>
<span id="cb148-539"><a href="#cb148-539" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-540"><a href="#cb148-540" aria-hidden="true" tabindex="-1"></a><span class="fu">### Relational Data Example</span></span>
<span id="cb148-541"><a href="#cb148-541" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-544"><a href="#cb148-544" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb148-545"><a href="#cb148-545" aria-hidden="true" tabindex="-1"></a><span class="co">#| eval: true</span></span>
<span id="cb148-546"><a href="#cb148-546" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: true</span></span>
<span id="cb148-547"><a href="#cb148-547" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-548"><a href="#cb148-548" aria-hidden="true" tabindex="-1"></a><span class="co"># Table 1: Animal information</span></span>
<span id="cb148-549"><a href="#cb148-549" aria-hidden="true" tabindex="-1"></a>animals <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb148-550"><a href="#cb148-550" aria-hidden="true" tabindex="-1"></a>  <span class="at">animal_id =</span> <span class="fu">c</span>(<span class="st">"A001"</span>, <span class="st">"A002"</span>, <span class="st">"A003"</span>, <span class="st">"A004"</span>),</span>
<span id="cb148-551"><a href="#cb148-551" aria-hidden="true" tabindex="-1"></a>  <span class="at">breed =</span> <span class="fu">c</span>(<span class="st">"Holstein"</span>, <span class="st">"Jersey"</span>, <span class="st">"Angus"</span>, <span class="st">"Holstein"</span>),</span>
<span id="cb148-552"><a href="#cb148-552" aria-hidden="true" tabindex="-1"></a>  <span class="at">birth_date =</span> <span class="fu">as.Date</span>(<span class="fu">c</span>(<span class="st">"2023-01-15"</span>, <span class="st">"2023-02-20"</span>, <span class="st">"2023-01-10"</span>, <span class="st">"2023-03-05"</span>))</span>
<span id="cb148-553"><a href="#cb148-553" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb148-554"><a href="#cb148-554" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-555"><a href="#cb148-555" aria-hidden="true" tabindex="-1"></a><span class="co"># Table 2: Weight records</span></span>
<span id="cb148-556"><a href="#cb148-556" aria-hidden="true" tabindex="-1"></a>weights <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb148-557"><a href="#cb148-557" aria-hidden="true" tabindex="-1"></a>  <span class="at">animal_id =</span> <span class="fu">c</span>(<span class="st">"A001"</span>, <span class="st">"A001"</span>, <span class="st">"A002"</span>, <span class="st">"A002"</span>, <span class="st">"A005"</span>),</span>
<span id="cb148-558"><a href="#cb148-558" aria-hidden="true" tabindex="-1"></a>  <span class="at">date =</span> <span class="fu">as.Date</span>(<span class="fu">c</span>(<span class="st">"2023-06-01"</span>, <span class="st">"2023-09-01"</span>, <span class="st">"2023-06-01"</span>, <span class="st">"2023-09-01"</span>, <span class="st">"2023-06-01"</span>)),</span>
<span id="cb148-559"><a href="#cb148-559" aria-hidden="true" tabindex="-1"></a>  <span class="at">weight_kg =</span> <span class="fu">c</span>(<span class="dv">180</span>, <span class="dv">220</span>, <span class="dv">150</span>, <span class="dv">185</span>, <span class="dv">200</span>)</span>
<span id="cb148-560"><a href="#cb148-560" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb148-561"><a href="#cb148-561" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-562"><a href="#cb148-562" aria-hidden="true" tabindex="-1"></a><span class="co"># Table 3: Treatment assignments</span></span>
<span id="cb148-563"><a href="#cb148-563" aria-hidden="true" tabindex="-1"></a>treatments <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb148-564"><a href="#cb148-564" aria-hidden="true" tabindex="-1"></a>  <span class="at">animal_id =</span> <span class="fu">c</span>(<span class="st">"A001"</span>, <span class="st">"A002"</span>, <span class="st">"A003"</span>),</span>
<span id="cb148-565"><a href="#cb148-565" aria-hidden="true" tabindex="-1"></a>  <span class="at">treatment =</span> <span class="fu">c</span>(<span class="st">"Control"</span>, <span class="st">"Treatment_A"</span>, <span class="st">"Treatment_B"</span>)</span>
<span id="cb148-566"><a href="#cb148-566" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb148-567"><a href="#cb148-567" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-568"><a href="#cb148-568" aria-hidden="true" tabindex="-1"></a>animals</span>
<span id="cb148-569"><a href="#cb148-569" aria-hidden="true" tabindex="-1"></a>weights</span>
<span id="cb148-570"><a href="#cb148-570" aria-hidden="true" tabindex="-1"></a>treatments</span>
<span id="cb148-571"><a href="#cb148-571" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb148-572"><a href="#cb148-572" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-573"><a href="#cb148-573" aria-hidden="true" tabindex="-1"></a><span class="fu">### Types of Joins</span></span>
<span id="cb148-574"><a href="#cb148-574" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-575"><a href="#cb148-575" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Mutating Joins: Add Columns</span></span>
<span id="cb148-576"><a href="#cb148-576" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-577"><a href="#cb148-577" aria-hidden="true" tabindex="-1"></a>**Visual representation**:</span>
<span id="cb148-578"><a href="#cb148-578" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-581"><a href="#cb148-581" aria-hidden="true" tabindex="-1"></a><span class="in">```{mermaid}</span></span>
<span id="cb148-582"><a href="#cb148-582" aria-hidden="true" tabindex="-1"></a>flowchart TD</span>
<span id="cb148-583"><a href="#cb148-583" aria-hidden="true" tabindex="-1"></a>    A[Mutating Joins&lt;br/&gt;Add columns from y to x] --&gt; B[left_join]</span>
<span id="cb148-584"><a href="#cb148-584" aria-hidden="true" tabindex="-1"></a>    A --&gt; C[right_join]</span>
<span id="cb148-585"><a href="#cb148-585" aria-hidden="true" tabindex="-1"></a>    A --&gt; D[inner_join]</span>
<span id="cb148-586"><a href="#cb148-586" aria-hidden="true" tabindex="-1"></a>    A --&gt; E[full_join]</span>
<span id="cb148-587"><a href="#cb148-587" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-588"><a href="#cb148-588" aria-hidden="true" tabindex="-1"></a>    B --&gt; B1[Keep all x rows&lt;br/&gt;Add matching y columns]</span>
<span id="cb148-589"><a href="#cb148-589" aria-hidden="true" tabindex="-1"></a>    C --&gt; C1[Keep all y rows&lt;br/&gt;Add matching x columns]</span>
<span id="cb148-590"><a href="#cb148-590" aria-hidden="true" tabindex="-1"></a>    D --&gt; D1[Keep only matching rows&lt;br/&gt;from both x <span class="ot">and</span> y]</span>
<span id="cb148-591"><a href="#cb148-591" aria-hidden="true" tabindex="-1"></a>    E --&gt; E1[Keep all rows&lt;br/&gt;from both x <span class="ot">and</span> y]</span>
<span id="cb148-592"><a href="#cb148-592" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb148-593"><a href="#cb148-593" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-594"><a href="#cb148-594" aria-hidden="true" tabindex="-1"></a><span class="fu">### `left_join()`: Keep All Left Rows</span></span>
<span id="cb148-595"><a href="#cb148-595" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-596"><a href="#cb148-596" aria-hidden="true" tabindex="-1"></a>**Venn Diagram concept**: All of LEFT + matching from RIGHT</span>
<span id="cb148-597"><a href="#cb148-597" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-600"><a href="#cb148-600" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb148-601"><a href="#cb148-601" aria-hidden="true" tabindex="-1"></a><span class="co">#| eval: true</span></span>
<span id="cb148-602"><a href="#cb148-602" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: true</span></span>
<span id="cb148-603"><a href="#cb148-603" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-604"><a href="#cb148-604" aria-hidden="true" tabindex="-1"></a><span class="co"># Left join: keep all animals, add treatment info</span></span>
<span id="cb148-605"><a href="#cb148-605" aria-hidden="true" tabindex="-1"></a>animals <span class="sc">%&gt;%</span></span>
<span id="cb148-606"><a href="#cb148-606" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(treatments, <span class="at">by =</span> <span class="st">"animal_id"</span>)</span>
<span id="cb148-607"><a href="#cb148-607" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb148-608"><a href="#cb148-608" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-609"><a href="#cb148-609" aria-hidden="true" tabindex="-1"></a>Notice:</span>
<span id="cb148-610"><a href="#cb148-610" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>All 4 animals kept (even A004 with no treatment)</span>
<span id="cb148-611"><a href="#cb148-611" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>A004 gets <span class="in">`NA`</span> for treatment</span>
<span id="cb148-612"><a href="#cb148-612" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Unmatched rows from <span class="in">`treatments`</span> (if any) are dropped</span>
<span id="cb148-613"><a href="#cb148-613" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-614"><a href="#cb148-614" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Use `left_join()` when:</span></span>
<span id="cb148-615"><a href="#cb148-615" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>You want to **add information** to your main table</span>
<span id="cb148-616"><a href="#cb148-616" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>You want to **keep all rows** from the main table</span>
<span id="cb148-617"><a href="#cb148-617" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Missing matches should be <span class="in">`NA`</span></span>
<span id="cb148-618"><a href="#cb148-618" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-619"><a href="#cb148-619" aria-hidden="true" tabindex="-1"></a><span class="fu">### `right_join()`: Keep All Right Rows</span></span>
<span id="cb148-620"><a href="#cb148-620" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-621"><a href="#cb148-621" aria-hidden="true" tabindex="-1"></a>**Venn Diagram concept**: All of RIGHT + matching from LEFT</span>
<span id="cb148-622"><a href="#cb148-622" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-625"><a href="#cb148-625" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb148-626"><a href="#cb148-626" aria-hidden="true" tabindex="-1"></a><span class="co">#| eval: true</span></span>
<span id="cb148-627"><a href="#cb148-627" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: true</span></span>
<span id="cb148-628"><a href="#cb148-628" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-629"><a href="#cb148-629" aria-hidden="true" tabindex="-1"></a><span class="co"># Right join: keep all treatments, add animal info</span></span>
<span id="cb148-630"><a href="#cb148-630" aria-hidden="true" tabindex="-1"></a>animals <span class="sc">%&gt;%</span></span>
<span id="cb148-631"><a href="#cb148-631" aria-hidden="true" tabindex="-1"></a>  <span class="fu">right_join</span>(treatments, <span class="at">by =</span> <span class="st">"animal_id"</span>)</span>
<span id="cb148-632"><a href="#cb148-632" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb148-633"><a href="#cb148-633" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-634"><a href="#cb148-634" aria-hidden="true" tabindex="-1"></a>::: {.callout-note}</span>
<span id="cb148-635"><a href="#cb148-635" aria-hidden="true" tabindex="-1"></a><span class="fu">## `right_join()` is Rarely Used</span></span>
<span id="cb148-636"><a href="#cb148-636" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-637"><a href="#cb148-637" aria-hidden="true" tabindex="-1"></a><span class="in">`right_join(x, y)`</span> gives the same result as <span class="in">`left_join(y, x)`</span>. Most people prefer to use <span class="in">`left_join()`</span> and think about the "main" table being on the left.</span>
<span id="cb148-638"><a href="#cb148-638" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-639"><a href="#cb148-639" aria-hidden="true" tabindex="-1"></a><span class="in">```r</span></span>
<span id="cb148-640"><a href="#cb148-640" aria-hidden="true" tabindex="-1"></a><span class="co"># These are equivalent:</span></span>
<span id="cb148-641"><a href="#cb148-641" aria-hidden="true" tabindex="-1"></a>animals <span class="sc">%&gt;%</span> <span class="fu">right_join</span>(treatments)</span>
<span id="cb148-642"><a href="#cb148-642" aria-hidden="true" tabindex="-1"></a>treatments <span class="sc">%&gt;%</span> <span class="fu">left_join</span>(animals)</span>
<span id="cb148-643"><a href="#cb148-643" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb148-644"><a href="#cb148-644" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb148-645"><a href="#cb148-645" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-646"><a href="#cb148-646" aria-hidden="true" tabindex="-1"></a><span class="fu">### `inner_join()`: Keep Only Matching Rows</span></span>
<span id="cb148-647"><a href="#cb148-647" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-648"><a href="#cb148-648" aria-hidden="true" tabindex="-1"></a>**Venn Diagram concept**: Only the INTERSECTION</span>
<span id="cb148-649"><a href="#cb148-649" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-652"><a href="#cb148-652" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb148-653"><a href="#cb148-653" aria-hidden="true" tabindex="-1"></a><span class="co">#| eval: true</span></span>
<span id="cb148-654"><a href="#cb148-654" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: true</span></span>
<span id="cb148-655"><a href="#cb148-655" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-656"><a href="#cb148-656" aria-hidden="true" tabindex="-1"></a><span class="co"># Inner join: keep only animals with treatments</span></span>
<span id="cb148-657"><a href="#cb148-657" aria-hidden="true" tabindex="-1"></a>animals <span class="sc">%&gt;%</span></span>
<span id="cb148-658"><a href="#cb148-658" aria-hidden="true" tabindex="-1"></a>  <span class="fu">inner_join</span>(treatments, <span class="at">by =</span> <span class="st">"animal_id"</span>)</span>
<span id="cb148-659"><a href="#cb148-659" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb148-660"><a href="#cb148-660" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-661"><a href="#cb148-661" aria-hidden="true" tabindex="-1"></a>Notice:</span>
<span id="cb148-662"><a href="#cb148-662" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Only 3 animals kept (A001, A002, A003)</span>
<span id="cb148-663"><a href="#cb148-663" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>A004 dropped (no treatment)</span>
<span id="cb148-664"><a href="#cb148-664" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Perfect when you only want complete cases</span>
<span id="cb148-665"><a href="#cb148-665" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-666"><a href="#cb148-666" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Use `inner_join()` when:</span></span>
<span id="cb148-667"><a href="#cb148-667" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>You only want rows that **match in both tables**</span>
<span id="cb148-668"><a href="#cb148-668" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Unmatched rows should be **excluded**</span>
<span id="cb148-669"><a href="#cb148-669" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>You're analyzing complete cases only</span>
<span id="cb148-670"><a href="#cb148-670" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-671"><a href="#cb148-671" aria-hidden="true" tabindex="-1"></a><span class="fu">### `full_join()`: Keep All Rows from Both</span></span>
<span id="cb148-672"><a href="#cb148-672" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-673"><a href="#cb148-673" aria-hidden="true" tabindex="-1"></a>**Venn Diagram concept**: UNION of LEFT and RIGHT</span>
<span id="cb148-674"><a href="#cb148-674" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-677"><a href="#cb148-677" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb148-678"><a href="#cb148-678" aria-hidden="true" tabindex="-1"></a><span class="co">#| eval: true</span></span>
<span id="cb148-679"><a href="#cb148-679" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: true</span></span>
<span id="cb148-680"><a href="#cb148-680" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-681"><a href="#cb148-681" aria-hidden="true" tabindex="-1"></a><span class="co"># Full join: keep everything</span></span>
<span id="cb148-682"><a href="#cb148-682" aria-hidden="true" tabindex="-1"></a>animals <span class="sc">%&gt;%</span></span>
<span id="cb148-683"><a href="#cb148-683" aria-hidden="true" tabindex="-1"></a>  <span class="fu">full_join</span>(treatments, <span class="at">by =</span> <span class="st">"animal_id"</span>)</span>
<span id="cb148-684"><a href="#cb148-684" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb148-685"><a href="#cb148-685" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-686"><a href="#cb148-686" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Use `full_join()` when:</span></span>
<span id="cb148-687"><a href="#cb148-687" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>You want **all data** from both tables</span>
<span id="cb148-688"><a href="#cb148-688" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>You want to see what's missing from each table</span>
<span id="cb148-689"><a href="#cb148-689" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>You'll handle <span class="in">`NA`</span> values later</span>
<span id="cb148-690"><a href="#cb148-690" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-691"><a href="#cb148-691" aria-hidden="true" tabindex="-1"></a><span class="fu">### Joining with Multiple Keys</span></span>
<span id="cb148-692"><a href="#cb148-692" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-693"><a href="#cb148-693" aria-hidden="true" tabindex="-1"></a>What if matching requires multiple columns?</span>
<span id="cb148-694"><a href="#cb148-694" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-697"><a href="#cb148-697" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb148-698"><a href="#cb148-698" aria-hidden="true" tabindex="-1"></a><span class="co">#| eval: true</span></span>
<span id="cb148-699"><a href="#cb148-699" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: true</span></span>
<span id="cb148-700"><a href="#cb148-700" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-701"><a href="#cb148-701" aria-hidden="true" tabindex="-1"></a><span class="co"># Farm data with state</span></span>
<span id="cb148-702"><a href="#cb148-702" aria-hidden="true" tabindex="-1"></a>farms <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb148-703"><a href="#cb148-703" aria-hidden="true" tabindex="-1"></a>  <span class="at">farm_name =</span> <span class="fu">c</span>(<span class="st">"Green Acres"</span>, <span class="st">"Sunny Farm"</span>, <span class="st">"Green Acres"</span>),</span>
<span id="cb148-704"><a href="#cb148-704" aria-hidden="true" tabindex="-1"></a>  <span class="at">state =</span> <span class="fu">c</span>(<span class="st">"Iowa"</span>, <span class="st">"Kansas"</span>, <span class="st">"Nebraska"</span>),</span>
<span id="cb148-705"><a href="#cb148-705" aria-hidden="true" tabindex="-1"></a>  <span class="at">size_acres =</span> <span class="fu">c</span>(<span class="dv">500</span>, <span class="dv">350</span>, <span class="dv">600</span>)</span>
<span id="cb148-706"><a href="#cb148-706" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb148-707"><a href="#cb148-707" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-708"><a href="#cb148-708" aria-hidden="true" tabindex="-1"></a><span class="co"># Animal locations</span></span>
<span id="cb148-709"><a href="#cb148-709" aria-hidden="true" tabindex="-1"></a>animal_locations <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb148-710"><a href="#cb148-710" aria-hidden="true" tabindex="-1"></a>  <span class="at">animal_id =</span> <span class="fu">c</span>(<span class="st">"A001"</span>, <span class="st">"A002"</span>, <span class="st">"A003"</span>),</span>
<span id="cb148-711"><a href="#cb148-711" aria-hidden="true" tabindex="-1"></a>  <span class="at">farm_name =</span> <span class="fu">c</span>(<span class="st">"Green Acres"</span>, <span class="st">"Sunny Farm"</span>, <span class="st">"Green Acres"</span>),</span>
<span id="cb148-712"><a href="#cb148-712" aria-hidden="true" tabindex="-1"></a>  <span class="at">state =</span> <span class="fu">c</span>(<span class="st">"Iowa"</span>, <span class="st">"Kansas"</span>, <span class="st">"Iowa"</span>)</span>
<span id="cb148-713"><a href="#cb148-713" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb148-714"><a href="#cb148-714" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-715"><a href="#cb148-715" aria-hidden="true" tabindex="-1"></a><span class="co"># Join on both farm_name AND state</span></span>
<span id="cb148-716"><a href="#cb148-716" aria-hidden="true" tabindex="-1"></a>animal_locations <span class="sc">%&gt;%</span></span>
<span id="cb148-717"><a href="#cb148-717" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(farms, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"farm_name"</span>, <span class="st">"state"</span>))</span>
<span id="cb148-718"><a href="#cb148-718" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb148-719"><a href="#cb148-719" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-720"><a href="#cb148-720" aria-hidden="true" tabindex="-1"></a><span class="fu">### Joining with Different Column Names</span></span>
<span id="cb148-721"><a href="#cb148-721" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-724"><a href="#cb148-724" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb148-725"><a href="#cb148-725" aria-hidden="true" tabindex="-1"></a><span class="co">#| eval: true</span></span>
<span id="cb148-726"><a href="#cb148-726" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: true</span></span>
<span id="cb148-727"><a href="#cb148-727" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-728"><a href="#cb148-728" aria-hidden="true" tabindex="-1"></a><span class="co"># Different ID column names</span></span>
<span id="cb148-729"><a href="#cb148-729" aria-hidden="true" tabindex="-1"></a>table1 <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb148-730"><a href="#cb148-730" aria-hidden="true" tabindex="-1"></a>  <span class="at">animal_id =</span> <span class="fu">c</span>(<span class="st">"A001"</span>, <span class="st">"A002"</span>, <span class="st">"A003"</span>),</span>
<span id="cb148-731"><a href="#cb148-731" aria-hidden="true" tabindex="-1"></a>  <span class="at">weight_kg =</span> <span class="fu">c</span>(<span class="dv">180</span>, <span class="dv">150</span>, <span class="dv">200</span>)</span>
<span id="cb148-732"><a href="#cb148-732" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb148-733"><a href="#cb148-733" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-734"><a href="#cb148-734" aria-hidden="true" tabindex="-1"></a>table2 <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb148-735"><a href="#cb148-735" aria-hidden="true" tabindex="-1"></a>  <span class="at">id =</span> <span class="fu">c</span>(<span class="st">"A001"</span>, <span class="st">"A002"</span>, <span class="st">"A004"</span>),</span>
<span id="cb148-736"><a href="#cb148-736" aria-hidden="true" tabindex="-1"></a>  <span class="at">breed =</span> <span class="fu">c</span>(<span class="st">"Holstein"</span>, <span class="st">"Jersey"</span>, <span class="st">"Angus"</span>)</span>
<span id="cb148-737"><a href="#cb148-737" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb148-738"><a href="#cb148-738" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-739"><a href="#cb148-739" aria-hidden="true" tabindex="-1"></a><span class="co"># Specify which columns to join on</span></span>
<span id="cb148-740"><a href="#cb148-740" aria-hidden="true" tabindex="-1"></a>table1 <span class="sc">%&gt;%</span></span>
<span id="cb148-741"><a href="#cb148-741" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(table2, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"animal_id"</span> <span class="ot">=</span> <span class="st">"id"</span>))</span>
<span id="cb148-742"><a href="#cb148-742" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb148-743"><a href="#cb148-743" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-744"><a href="#cb148-744" aria-hidden="true" tabindex="-1"></a><span class="fu">### Filtering Joins: Filter Rows (Don't Add Columns)</span></span>
<span id="cb148-745"><a href="#cb148-745" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-746"><a href="#cb148-746" aria-hidden="true" tabindex="-1"></a><span class="fu">#### `semi_join()`: Keep Rows with Matches</span></span>
<span id="cb148-747"><a href="#cb148-747" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-750"><a href="#cb148-750" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb148-751"><a href="#cb148-751" aria-hidden="true" tabindex="-1"></a><span class="co">#| eval: true</span></span>
<span id="cb148-752"><a href="#cb148-752" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: true</span></span>
<span id="cb148-753"><a href="#cb148-753" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-754"><a href="#cb148-754" aria-hidden="true" tabindex="-1"></a><span class="co"># Semi join: keep animals that have treatments (but don't add treatment column)</span></span>
<span id="cb148-755"><a href="#cb148-755" aria-hidden="true" tabindex="-1"></a>animals <span class="sc">%&gt;%</span></span>
<span id="cb148-756"><a href="#cb148-756" aria-hidden="true" tabindex="-1"></a>  <span class="fu">semi_join</span>(treatments, <span class="at">by =</span> <span class="st">"animal_id"</span>)</span>
<span id="cb148-757"><a href="#cb148-757" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb148-758"><a href="#cb148-758" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-759"><a href="#cb148-759" aria-hidden="true" tabindex="-1"></a>**Use `semi_join()` to answer**: "Which x rows have a match in y?"</span>
<span id="cb148-760"><a href="#cb148-760" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-761"><a href="#cb148-761" aria-hidden="true" tabindex="-1"></a><span class="fu">#### `anti_join()`: Keep Rows WITHOUT Matches</span></span>
<span id="cb148-762"><a href="#cb148-762" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-765"><a href="#cb148-765" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb148-766"><a href="#cb148-766" aria-hidden="true" tabindex="-1"></a><span class="co">#| eval: true</span></span>
<span id="cb148-767"><a href="#cb148-767" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: true</span></span>
<span id="cb148-768"><a href="#cb148-768" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-769"><a href="#cb148-769" aria-hidden="true" tabindex="-1"></a><span class="co"># Anti join: keep animals that DON'T have treatments</span></span>
<span id="cb148-770"><a href="#cb148-770" aria-hidden="true" tabindex="-1"></a>animals <span class="sc">%&gt;%</span></span>
<span id="cb148-771"><a href="#cb148-771" aria-hidden="true" tabindex="-1"></a>  <span class="fu">anti_join</span>(treatments, <span class="at">by =</span> <span class="st">"animal_id"</span>)</span>
<span id="cb148-772"><a href="#cb148-772" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb148-773"><a href="#cb148-773" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-774"><a href="#cb148-774" aria-hidden="true" tabindex="-1"></a>**Use `anti_join()` to answer**: "Which x rows DON'T have a match in y?"</span>
<span id="cb148-775"><a href="#cb148-775" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-776"><a href="#cb148-776" aria-hidden="true" tabindex="-1"></a>This is incredibly useful for finding missing data or orphaned records.</span>
<span id="cb148-777"><a href="#cb148-777" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-778"><a href="#cb148-778" aria-hidden="true" tabindex="-1"></a><span class="fu">### Join Summary Table</span></span>
<span id="cb148-779"><a href="#cb148-779" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-780"><a href="#cb148-780" aria-hidden="true" tabindex="-1"></a><span class="pp">|</span> Join Type <span class="pp">|</span> Rows Kept <span class="pp">|</span> Columns Added <span class="pp">|</span> Use When <span class="pp">|</span></span>
<span id="cb148-781"><a href="#cb148-781" aria-hidden="true" tabindex="-1"></a><span class="pp">|-----------|-----------|---------------|----------|</span></span>
<span id="cb148-782"><a href="#cb148-782" aria-hidden="true" tabindex="-1"></a><span class="pp">|</span> <span class="in">`left_join(x, y)`</span> <span class="pp">|</span> All from x <span class="pp">|</span> From y <span class="pp">|</span> Adding info to main table <span class="pp">|</span></span>
<span id="cb148-783"><a href="#cb148-783" aria-hidden="true" tabindex="-1"></a><span class="pp">|</span> <span class="in">`right_join(x, y)`</span> <span class="pp">|</span> All from y <span class="pp">|</span> From x <span class="pp">|</span> Rarely used (use left_join instead) <span class="pp">|</span></span>
<span id="cb148-784"><a href="#cb148-784" aria-hidden="true" tabindex="-1"></a><span class="pp">|</span> <span class="in">`inner_join(x, y)`</span> <span class="pp">|</span> Only matches <span class="pp">|</span> From both <span class="pp">|</span> Only want complete cases <span class="pp">|</span></span>
<span id="cb148-785"><a href="#cb148-785" aria-hidden="true" tabindex="-1"></a><span class="pp">|</span> <span class="in">`full_join(x, y)`</span> <span class="pp">|</span> All from both <span class="pp">|</span> From both <span class="pp">|</span> Keep everything <span class="pp">|</span></span>
<span id="cb148-786"><a href="#cb148-786" aria-hidden="true" tabindex="-1"></a><span class="pp">|</span> <span class="in">`semi_join(x, y)`</span> <span class="pp">|</span> Matches from x <span class="pp">|</span> None <span class="pp">|</span> Filter x by presence in y <span class="pp">|</span></span>
<span id="cb148-787"><a href="#cb148-787" aria-hidden="true" tabindex="-1"></a><span class="pp">|</span> <span class="in">`anti_join(x, y)`</span> <span class="pp">|</span> Non-matches from x <span class="pp">|</span> None <span class="pp">|</span> Filter x by absence in y <span class="pp">|</span></span>
<span id="cb148-788"><a href="#cb148-788" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-789"><a href="#cb148-789" aria-hidden="true" tabindex="-1"></a><span class="fu">### Common Join Problems and Solutions</span></span>
<span id="cb148-790"><a href="#cb148-790" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-791"><a href="#cb148-791" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Problem 1: Duplicate Keys</span></span>
<span id="cb148-792"><a href="#cb148-792" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-795"><a href="#cb148-795" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb148-796"><a href="#cb148-796" aria-hidden="true" tabindex="-1"></a><span class="co">#| eval: true</span></span>
<span id="cb148-797"><a href="#cb148-797" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: true</span></span>
<span id="cb148-798"><a href="#cb148-798" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-799"><a href="#cb148-799" aria-hidden="true" tabindex="-1"></a><span class="co"># Multiple weights per animal</span></span>
<span id="cb148-800"><a href="#cb148-800" aria-hidden="true" tabindex="-1"></a>weights_dup <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb148-801"><a href="#cb148-801" aria-hidden="true" tabindex="-1"></a>  <span class="at">animal_id =</span> <span class="fu">c</span>(<span class="st">"A001"</span>, <span class="st">"A001"</span>, <span class="st">"A002"</span>),</span>
<span id="cb148-802"><a href="#cb148-802" aria-hidden="true" tabindex="-1"></a>  <span class="at">weight_kg =</span> <span class="fu">c</span>(<span class="dv">180</span>, <span class="dv">185</span>, <span class="dv">150</span>)</span>
<span id="cb148-803"><a href="#cb148-803" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb148-804"><a href="#cb148-804" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-805"><a href="#cb148-805" aria-hidden="true" tabindex="-1"></a><span class="co"># Join creates all combinations</span></span>
<span id="cb148-806"><a href="#cb148-806" aria-hidden="true" tabindex="-1"></a>animals <span class="sc">%&gt;%</span></span>
<span id="cb148-807"><a href="#cb148-807" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(weights_dup, <span class="at">by =</span> <span class="st">"animal_id"</span>)</span>
<span id="cb148-808"><a href="#cb148-808" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb148-809"><a href="#cb148-809" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-810"><a href="#cb148-810" aria-hidden="true" tabindex="-1"></a>**Solution**: If you only want one weight per animal, summarize first:</span>
<span id="cb148-811"><a href="#cb148-811" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-814"><a href="#cb148-814" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb148-815"><a href="#cb148-815" aria-hidden="true" tabindex="-1"></a><span class="co">#| eval: true</span></span>
<span id="cb148-816"><a href="#cb148-816" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: true</span></span>
<span id="cb148-817"><a href="#cb148-817" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-818"><a href="#cb148-818" aria-hidden="true" tabindex="-1"></a>weights_dup <span class="sc">%&gt;%</span></span>
<span id="cb148-819"><a href="#cb148-819" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(animal_id) <span class="sc">%&gt;%</span></span>
<span id="cb148-820"><a href="#cb148-820" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">avg_weight_kg =</span> <span class="fu">mean</span>(weight_kg), <span class="at">.groups =</span> <span class="st">"drop"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb148-821"><a href="#cb148-821" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(animals, ., <span class="at">by =</span> <span class="st">"animal_id"</span>)</span>
<span id="cb148-822"><a href="#cb148-822" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb148-823"><a href="#cb148-823" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-824"><a href="#cb148-824" aria-hidden="true" tabindex="-1"></a>::: {.callout-warning}</span>
<span id="cb148-825"><a href="#cb148-825" aria-hidden="true" tabindex="-1"></a><span class="fu">## Always Specify `by =`</span></span>
<span id="cb148-826"><a href="#cb148-826" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-827"><a href="#cb148-827" aria-hidden="true" tabindex="-1"></a>If you don't specify <span class="in">`by`</span>, joins use all columns with the same name. This can lead to:</span>
<span id="cb148-828"><a href="#cb148-828" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Unintended matches</span>
<span id="cb148-829"><a href="#cb148-829" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Silent errors</span>
<span id="cb148-830"><a href="#cb148-830" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Confusing results</span>
<span id="cb148-831"><a href="#cb148-831" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-832"><a href="#cb148-832" aria-hidden="true" tabindex="-1"></a>**Best practice**: Always explicitly state <span class="in">`by = "column_name"`</span></span>
<span id="cb148-833"><a href="#cb148-833" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb148-834"><a href="#cb148-834" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-835"><a href="#cb148-835" aria-hidden="true" tabindex="-1"></a><span class="fu">### Real-World Example: Combining Multiple Tables</span></span>
<span id="cb148-836"><a href="#cb148-836" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-839"><a href="#cb148-839" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb148-840"><a href="#cb148-840" aria-hidden="true" tabindex="-1"></a><span class="co">#| eval: true</span></span>
<span id="cb148-841"><a href="#cb148-841" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: true</span></span>
<span id="cb148-842"><a href="#cb148-842" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-843"><a href="#cb148-843" aria-hidden="true" tabindex="-1"></a><span class="co"># Start with animals</span></span>
<span id="cb148-844"><a href="#cb148-844" aria-hidden="true" tabindex="-1"></a>result <span class="ot">&lt;-</span> animals <span class="sc">%&gt;%</span></span>
<span id="cb148-845"><a href="#cb148-845" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Add treatments</span></span>
<span id="cb148-846"><a href="#cb148-846" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(treatments, <span class="at">by =</span> <span class="st">"animal_id"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb148-847"><a href="#cb148-847" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Add weights (keeping all weight records)</span></span>
<span id="cb148-848"><a href="#cb148-848" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(weights, <span class="at">by =</span> <span class="st">"animal_id"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb148-849"><a href="#cb148-849" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Calculate age at weighing</span></span>
<span id="cb148-850"><a href="#cb148-850" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb148-851"><a href="#cb148-851" aria-hidden="true" tabindex="-1"></a>    <span class="at">age_days =</span> <span class="fu">as.numeric</span>(date <span class="sc">-</span> birth_date),</span>
<span id="cb148-852"><a href="#cb148-852" aria-hidden="true" tabindex="-1"></a>    <span class="at">.after =</span> date</span>
<span id="cb148-853"><a href="#cb148-853" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb148-854"><a href="#cb148-854" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-855"><a href="#cb148-855" aria-hidden="true" tabindex="-1"></a>result</span>
<span id="cb148-856"><a href="#cb148-856" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb148-857"><a href="#cb148-857" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-858"><a href="#cb148-858" aria-hidden="true" tabindex="-1"></a>---</span>
<span id="cb148-859"><a href="#cb148-859" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-860"><a href="#cb148-860" aria-hidden="true" tabindex="-1"></a><span class="fu">## Binding Datasets</span></span>
<span id="cb148-861"><a href="#cb148-861" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-862"><a href="#cb148-862" aria-hidden="true" tabindex="-1"></a>Sometimes you need to combine datasets by **stacking** (rows) or **attaching** (columns), not by joining on keys.</span>
<span id="cb148-863"><a href="#cb148-863" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-864"><a href="#cb148-864" aria-hidden="true" tabindex="-1"></a><span class="fu">### `bind_rows()`: Stack Datasets Vertically</span></span>
<span id="cb148-865"><a href="#cb148-865" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-866"><a href="#cb148-866" aria-hidden="true" tabindex="-1"></a>Use when you have the same structure in multiple datasets.</span>
<span id="cb148-867"><a href="#cb148-867" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-870"><a href="#cb148-870" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb148-871"><a href="#cb148-871" aria-hidden="true" tabindex="-1"></a><span class="co">#| eval: true</span></span>
<span id="cb148-872"><a href="#cb148-872" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: true</span></span>
<span id="cb148-873"><a href="#cb148-873" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-874"><a href="#cb148-874" aria-hidden="true" tabindex="-1"></a><span class="co"># Data from multiple farms</span></span>
<span id="cb148-875"><a href="#cb148-875" aria-hidden="true" tabindex="-1"></a>farm_a <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb148-876"><a href="#cb148-876" aria-hidden="true" tabindex="-1"></a>  <span class="at">animal_id =</span> <span class="fu">c</span>(<span class="st">"A001"</span>, <span class="st">"A002"</span>),</span>
<span id="cb148-877"><a href="#cb148-877" aria-hidden="true" tabindex="-1"></a>  <span class="at">weight_kg =</span> <span class="fu">c</span>(<span class="dv">180</span>, <span class="dv">150</span>),</span>
<span id="cb148-878"><a href="#cb148-878" aria-hidden="true" tabindex="-1"></a>  <span class="at">farm =</span> <span class="st">"Farm_A"</span></span>
<span id="cb148-879"><a href="#cb148-879" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb148-880"><a href="#cb148-880" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-881"><a href="#cb148-881" aria-hidden="true" tabindex="-1"></a>farm_b <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb148-882"><a href="#cb148-882" aria-hidden="true" tabindex="-1"></a>  <span class="at">animal_id =</span> <span class="fu">c</span>(<span class="st">"B001"</span>, <span class="st">"B002"</span>),</span>
<span id="cb148-883"><a href="#cb148-883" aria-hidden="true" tabindex="-1"></a>  <span class="at">weight_kg =</span> <span class="fu">c</span>(<span class="dv">170</span>, <span class="dv">160</span>),</span>
<span id="cb148-884"><a href="#cb148-884" aria-hidden="true" tabindex="-1"></a>  <span class="at">farm =</span> <span class="st">"Farm_B"</span></span>
<span id="cb148-885"><a href="#cb148-885" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb148-886"><a href="#cb148-886" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-887"><a href="#cb148-887" aria-hidden="true" tabindex="-1"></a><span class="co"># Stack them</span></span>
<span id="cb148-888"><a href="#cb148-888" aria-hidden="true" tabindex="-1"></a><span class="fu">bind_rows</span>(farm_a, farm_b)</span>
<span id="cb148-889"><a href="#cb148-889" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb148-890"><a href="#cb148-890" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-891"><a href="#cb148-891" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Handling Missing Columns</span></span>
<span id="cb148-892"><a href="#cb148-892" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-895"><a href="#cb148-895" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb148-896"><a href="#cb148-896" aria-hidden="true" tabindex="-1"></a><span class="co">#| eval: true</span></span>
<span id="cb148-897"><a href="#cb148-897" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: true</span></span>
<span id="cb148-898"><a href="#cb148-898" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-899"><a href="#cb148-899" aria-hidden="true" tabindex="-1"></a><span class="co"># Different columns</span></span>
<span id="cb148-900"><a href="#cb148-900" aria-hidden="true" tabindex="-1"></a>df1 <span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="at">animal_id =</span> <span class="st">"A001"</span>, <span class="at">weight_kg =</span> <span class="dv">180</span>)</span>
<span id="cb148-901"><a href="#cb148-901" aria-hidden="true" tabindex="-1"></a>df2 <span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="at">animal_id =</span> <span class="st">"B001"</span>, <span class="at">height_cm =</span> <span class="dv">125</span>)</span>
<span id="cb148-902"><a href="#cb148-902" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-903"><a href="#cb148-903" aria-hidden="true" tabindex="-1"></a><span class="co"># bind_rows() fills missing columns with NA</span></span>
<span id="cb148-904"><a href="#cb148-904" aria-hidden="true" tabindex="-1"></a><span class="fu">bind_rows</span>(df1, df2)</span>
<span id="cb148-905"><a href="#cb148-905" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb148-906"><a href="#cb148-906" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-907"><a href="#cb148-907" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Adding Source Identifier</span></span>
<span id="cb148-908"><a href="#cb148-908" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-911"><a href="#cb148-911" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb148-912"><a href="#cb148-912" aria-hidden="true" tabindex="-1"></a><span class="co">#| eval: true</span></span>
<span id="cb148-913"><a href="#cb148-913" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: true</span></span>
<span id="cb148-914"><a href="#cb148-914" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-915"><a href="#cb148-915" aria-hidden="true" tabindex="-1"></a><span class="co"># Or use named list</span></span>
<span id="cb148-916"><a href="#cb148-916" aria-hidden="true" tabindex="-1"></a><span class="fu">bind_rows</span>(</span>
<span id="cb148-917"><a href="#cb148-917" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Iowa"</span> <span class="ot">=</span> farm_a,</span>
<span id="cb148-918"><a href="#cb148-918" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Kansas"</span> <span class="ot">=</span> farm_b,</span>
<span id="cb148-919"><a href="#cb148-919" aria-hidden="true" tabindex="-1"></a>  <span class="at">.id =</span> <span class="st">"state"</span></span>
<span id="cb148-920"><a href="#cb148-920" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb148-921"><a href="#cb148-921" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb148-922"><a href="#cb148-922" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-923"><a href="#cb148-923" aria-hidden="true" tabindex="-1"></a><span class="fu">### `bind_cols()`: Attach Datasets Horizontally</span></span>
<span id="cb148-924"><a href="#cb148-924" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-925"><a href="#cb148-925" aria-hidden="true" tabindex="-1"></a>::: {.callout-warning}</span>
<span id="cb148-926"><a href="#cb148-926" aria-hidden="true" tabindex="-1"></a><span class="fu">## Use `bind_cols()` with Caution!</span></span>
<span id="cb148-927"><a href="#cb148-927" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-928"><a href="#cb148-928" aria-hidden="true" tabindex="-1"></a><span class="in">`bind_cols()`</span> simply attaches columns side-by-side based on row position. It does NOT match by keys!</span>
<span id="cb148-929"><a href="#cb148-929" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-930"><a href="#cb148-930" aria-hidden="true" tabindex="-1"></a>**Problems**:</span>
<span id="cb148-931"><a href="#cb148-931" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>No checking if rows actually match</span>
<span id="cb148-932"><a href="#cb148-932" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Row order must be identical</span>
<span id="cb148-933"><a href="#cb148-933" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Easy to create mismatched data</span>
<span id="cb148-934"><a href="#cb148-934" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-935"><a href="#cb148-935" aria-hidden="true" tabindex="-1"></a>**Better alternative**: Use a join with a row number or ID column.</span>
<span id="cb148-936"><a href="#cb148-936" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb148-937"><a href="#cb148-937" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-940"><a href="#cb148-940" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb148-941"><a href="#cb148-941" aria-hidden="true" tabindex="-1"></a><span class="co">#| eval: true</span></span>
<span id="cb148-942"><a href="#cb148-942" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: true</span></span>
<span id="cb148-943"><a href="#cb148-943" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-944"><a href="#cb148-944" aria-hidden="true" tabindex="-1"></a><span class="co"># Two datasets with same row order (risky!)</span></span>
<span id="cb148-945"><a href="#cb148-945" aria-hidden="true" tabindex="-1"></a>ids <span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="at">animal_id =</span> <span class="fu">c</span>(<span class="st">"A001"</span>, <span class="st">"A002"</span>, <span class="st">"A003"</span>))</span>
<span id="cb148-946"><a href="#cb148-946" aria-hidden="true" tabindex="-1"></a>weights <span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="at">weight_kg =</span> <span class="fu">c</span>(<span class="dv">180</span>, <span class="dv">150</span>, <span class="dv">200</span>))</span>
<span id="cb148-947"><a href="#cb148-947" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-948"><a href="#cb148-948" aria-hidden="true" tabindex="-1"></a><span class="co"># Attach side-by-side</span></span>
<span id="cb148-949"><a href="#cb148-949" aria-hidden="true" tabindex="-1"></a><span class="fu">bind_cols</span>(ids, weights)</span>
<span id="cb148-950"><a href="#cb148-950" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-951"><a href="#cb148-951" aria-hidden="true" tabindex="-1"></a><span class="co"># MUCH SAFER: Use mutate instead if they're truly row-aligned</span></span>
<span id="cb148-952"><a href="#cb148-952" aria-hidden="true" tabindex="-1"></a>ids <span class="sc">%&gt;%</span></span>
<span id="cb148-953"><a href="#cb148-953" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">weight_kg =</span> weights<span class="sc">$</span>weight_kg)</span>
<span id="cb148-954"><a href="#cb148-954" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-955"><a href="#cb148-955" aria-hidden="true" tabindex="-1"></a><span class="co"># Or use a proper join if you have keys!</span></span>
<span id="cb148-956"><a href="#cb148-956" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb148-957"><a href="#cb148-957" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-958"><a href="#cb148-958" aria-hidden="true" tabindex="-1"></a><span class="fu">### When to Use Binding vs Joining</span></span>
<span id="cb148-959"><a href="#cb148-959" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-960"><a href="#cb148-960" aria-hidden="true" tabindex="-1"></a><span class="pp">|</span> Use <span class="pp">|</span> <span class="in">`bind_rows()`</span> <span class="pp">|</span> <span class="in">`bind_cols()`</span> <span class="pp">|</span> Join <span class="pp">|</span></span>
<span id="cb148-961"><a href="#cb148-961" aria-hidden="true" tabindex="-1"></a><span class="pp">|-----|---------------|---------------|------|</span></span>
<span id="cb148-962"><a href="#cb148-962" aria-hidden="true" tabindex="-1"></a><span class="pp">|</span> Same structure, stack vertically <span class="pp">|</span> ✅ <span class="pp">|</span> ❌ <span class="pp">|</span> ❌ <span class="pp">|</span></span>
<span id="cb148-963"><a href="#cb148-963" aria-hidden="true" tabindex="-1"></a><span class="pp">|</span> Different farms/time periods <span class="pp">|</span> ✅ <span class="pp">|</span> ❌ <span class="pp">|</span> ❌ <span class="pp">|</span></span>
<span id="cb148-964"><a href="#cb148-964" aria-hidden="true" tabindex="-1"></a><span class="pp">|</span> Add columns based on keys <span class="pp">|</span> ❌ <span class="pp">|</span> ❌ <span class="pp">|</span> ✅ <span class="pp">|</span></span>
<span id="cb148-965"><a href="#cb148-965" aria-hidden="true" tabindex="-1"></a><span class="pp">|</span> Row-aligned data (same order) <span class="pp">|</span> ❌ <span class="pp">|</span> ⚠️ Use with caution <span class="pp">|</span> ❌ <span class="pp">|</span></span>
<span id="cb148-966"><a href="#cb148-966" aria-hidden="true" tabindex="-1"></a><span class="pp">|</span> Relational data (shared IDs) <span class="pp">|</span> ❌ <span class="pp">|</span> ❌ <span class="pp">|</span> ✅ <span class="pp">|</span></span>
<span id="cb148-967"><a href="#cb148-967" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-968"><a href="#cb148-968" aria-hidden="true" tabindex="-1"></a>---</span>
<span id="cb148-969"><a href="#cb148-969" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-970"><a href="#cb148-970" aria-hidden="true" tabindex="-1"></a><span class="fu">## Iteration with purrr</span></span>
<span id="cb148-971"><a href="#cb148-971" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-972"><a href="#cb148-972" aria-hidden="true" tabindex="-1"></a>The <span class="in">`purrr`</span> package provides tools for **functional programming** — applying functions across elements of a list or vector.</span>
<span id="cb148-973"><a href="#cb148-973" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-974"><a href="#cb148-974" aria-hidden="true" tabindex="-1"></a><span class="fu">### Why Use `map()` Instead of Loops?</span></span>
<span id="cb148-975"><a href="#cb148-975" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-978"><a href="#cb148-978" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb148-979"><a href="#cb148-979" aria-hidden="true" tabindex="-1"></a><span class="co">#| eval: true</span></span>
<span id="cb148-980"><a href="#cb148-980" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: true</span></span>
<span id="cb148-981"><a href="#cb148-981" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-982"><a href="#cb148-982" aria-hidden="true" tabindex="-1"></a><span class="co"># Example: Calculate mean of each column</span></span>
<span id="cb148-983"><a href="#cb148-983" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-984"><a href="#cb148-984" aria-hidden="true" tabindex="-1"></a><span class="co"># Base R loop approach</span></span>
<span id="cb148-985"><a href="#cb148-985" aria-hidden="true" tabindex="-1"></a>col_means_loop <span class="ot">&lt;-</span> <span class="fu">numeric</span>(<span class="fu">ncol</span>(mtcars))</span>
<span id="cb148-986"><a href="#cb148-986" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="fu">seq_along</span>(mtcars)) {</span>
<span id="cb148-987"><a href="#cb148-987" aria-hidden="true" tabindex="-1"></a>  col_means_loop[i] <span class="ot">&lt;-</span> <span class="fu">mean</span>(mtcars[[i]])</span>
<span id="cb148-988"><a href="#cb148-988" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb148-989"><a href="#cb148-989" aria-hidden="true" tabindex="-1"></a>col_means_loop</span>
<span id="cb148-990"><a href="#cb148-990" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-991"><a href="#cb148-991" aria-hidden="true" tabindex="-1"></a><span class="co"># purrr approach</span></span>
<span id="cb148-992"><a href="#cb148-992" aria-hidden="true" tabindex="-1"></a>col_means_map <span class="ot">&lt;-</span> <span class="fu">map_dbl</span>(mtcars, mean)</span>
<span id="cb148-993"><a href="#cb148-993" aria-hidden="true" tabindex="-1"></a>col_means_map</span>
<span id="cb148-994"><a href="#cb148-994" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-995"><a href="#cb148-995" aria-hidden="true" tabindex="-1"></a><span class="co"># They're the same!</span></span>
<span id="cb148-996"><a href="#cb148-996" aria-hidden="true" tabindex="-1"></a><span class="fu">all.equal</span>(col_means_loop, col_means_map)</span>
<span id="cb148-997"><a href="#cb148-997" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb148-998"><a href="#cb148-998" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-999"><a href="#cb148-999" aria-hidden="true" tabindex="-1"></a>**Benefits of `map()`**:</span>
<span id="cb148-1000"><a href="#cb148-1000" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>More concise</span>
<span id="cb148-1001"><a href="#cb148-1001" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Less error-prone (no index management)</span>
<span id="cb148-1002"><a href="#cb148-1002" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Easier to read intent</span>
<span id="cb148-1003"><a href="#cb148-1003" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Consistent return types</span>
<span id="cb148-1004"><a href="#cb148-1004" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-1005"><a href="#cb148-1005" aria-hidden="true" tabindex="-1"></a>::: {.callout-note}</span>
<span id="cb148-1006"><a href="#cb148-1006" aria-hidden="true" tabindex="-1"></a><span class="fu">## When to Use Loops vs `map()`</span></span>
<span id="cb148-1007"><a href="#cb148-1007" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-1008"><a href="#cb148-1008" aria-hidden="true" tabindex="-1"></a>**Use loops when**:</span>
<span id="cb148-1009"><a href="#cb148-1009" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>You need to modify objects in place</span>
<span id="cb148-1010"><a href="#cb148-1010" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>The operation depends on previous iterations</span>
<span id="cb148-1011"><a href="#cb148-1011" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>The logic is complex and loops are clearer</span>
<span id="cb148-1012"><a href="#cb148-1012" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-1013"><a href="#cb148-1013" aria-hidden="true" tabindex="-1"></a>**Use `map()` when**:</span>
<span id="cb148-1014"><a href="#cb148-1014" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Applying the same operation to each element</span>
<span id="cb148-1015"><a href="#cb148-1015" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>You want consistent output types</span>
<span id="cb148-1016"><a href="#cb148-1016" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>You're working with lists or data frames</span>
<span id="cb148-1017"><a href="#cb148-1017" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb148-1018"><a href="#cb148-1018" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-1019"><a href="#cb148-1019" aria-hidden="true" tabindex="-1"></a><span class="fu">### Basic `map()` Functions</span></span>
<span id="cb148-1020"><a href="#cb148-1020" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-1023"><a href="#cb148-1023" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb148-1024"><a href="#cb148-1024" aria-hidden="true" tabindex="-1"></a><span class="co">#| eval: true</span></span>
<span id="cb148-1025"><a href="#cb148-1025" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: true</span></span>
<span id="cb148-1026"><a href="#cb148-1026" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-1027"><a href="#cb148-1027" aria-hidden="true" tabindex="-1"></a><span class="co"># Create example data</span></span>
<span id="cb148-1028"><a href="#cb148-1028" aria-hidden="true" tabindex="-1"></a>numbers <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb148-1029"><a href="#cb148-1029" aria-hidden="true" tabindex="-1"></a>  <span class="at">a =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">4</span>, <span class="dv">5</span>),</span>
<span id="cb148-1030"><a href="#cb148-1030" aria-hidden="true" tabindex="-1"></a>  <span class="at">b =</span> <span class="fu">c</span>(<span class="dv">10</span>, <span class="dv">20</span>, <span class="dv">30</span>),</span>
<span id="cb148-1031"><a href="#cb148-1031" aria-hidden="true" tabindex="-1"></a>  <span class="at">c =</span> <span class="fu">c</span>(<span class="dv">100</span>, <span class="dv">200</span>, <span class="dv">300</span>, <span class="dv">400</span>)</span>
<span id="cb148-1032"><a href="#cb148-1032" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb148-1033"><a href="#cb148-1033" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-1034"><a href="#cb148-1034" aria-hidden="true" tabindex="-1"></a><span class="co"># map() returns a list</span></span>
<span id="cb148-1035"><a href="#cb148-1035" aria-hidden="true" tabindex="-1"></a><span class="fu">map</span>(numbers, mean)</span>
<span id="cb148-1036"><a href="#cb148-1036" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-1037"><a href="#cb148-1037" aria-hidden="true" tabindex="-1"></a><span class="co"># map_dbl() returns a numeric vector</span></span>
<span id="cb148-1038"><a href="#cb148-1038" aria-hidden="true" tabindex="-1"></a><span class="fu">map_dbl</span>(numbers, mean)</span>
<span id="cb148-1039"><a href="#cb148-1039" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-1040"><a href="#cb148-1040" aria-hidden="true" tabindex="-1"></a><span class="co"># map_chr() returns a character vector</span></span>
<span id="cb148-1041"><a href="#cb148-1041" aria-hidden="true" tabindex="-1"></a><span class="fu">map_chr</span>(numbers, \(x) <span class="fu">paste</span>(<span class="st">"Mean:"</span>, <span class="fu">round</span>(<span class="fu">mean</span>(x), <span class="dv">1</span>)))</span>
<span id="cb148-1042"><a href="#cb148-1042" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-1043"><a href="#cb148-1043" aria-hidden="true" tabindex="-1"></a><span class="co"># map_int() returns an integer vector</span></span>
<span id="cb148-1044"><a href="#cb148-1044" aria-hidden="true" tabindex="-1"></a><span class="fu">map_int</span>(numbers, length)</span>
<span id="cb148-1045"><a href="#cb148-1045" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-1046"><a href="#cb148-1046" aria-hidden="true" tabindex="-1"></a><span class="co"># map_lgl() returns a logical vector</span></span>
<span id="cb148-1047"><a href="#cb148-1047" aria-hidden="true" tabindex="-1"></a><span class="fu">map_lgl</span>(numbers, \(x) <span class="fu">mean</span>(x) <span class="sc">&gt;</span> <span class="dv">50</span>)</span>
<span id="cb148-1048"><a href="#cb148-1048" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb148-1049"><a href="#cb148-1049" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-1050"><a href="#cb148-1050" aria-hidden="true" tabindex="-1"></a><span class="fu">### `map()` with Data Frames</span></span>
<span id="cb148-1051"><a href="#cb148-1051" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-1054"><a href="#cb148-1054" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb148-1055"><a href="#cb148-1055" aria-hidden="true" tabindex="-1"></a><span class="co">#| eval: true</span></span>
<span id="cb148-1056"><a href="#cb148-1056" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: true</span></span>
<span id="cb148-1057"><a href="#cb148-1057" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-1058"><a href="#cb148-1058" aria-hidden="true" tabindex="-1"></a><span class="co"># Create example animal data</span></span>
<span id="cb148-1059"><a href="#cb148-1059" aria-hidden="true" tabindex="-1"></a>animals_list <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb148-1060"><a href="#cb148-1060" aria-hidden="true" tabindex="-1"></a>  <span class="at">farm_a =</span> <span class="fu">tibble</span>(<span class="at">animal_id =</span> <span class="fu">c</span>(<span class="st">"A001"</span>, <span class="st">"A002"</span>), <span class="at">weight_kg =</span> <span class="fu">c</span>(<span class="dv">180</span>, <span class="dv">150</span>)),</span>
<span id="cb148-1061"><a href="#cb148-1061" aria-hidden="true" tabindex="-1"></a>  <span class="at">farm_b =</span> <span class="fu">tibble</span>(<span class="at">animal_id =</span> <span class="fu">c</span>(<span class="st">"B001"</span>, <span class="st">"B002"</span>), <span class="at">weight_kg =</span> <span class="fu">c</span>(<span class="dv">170</span>, <span class="dv">160</span>)),</span>
<span id="cb148-1062"><a href="#cb148-1062" aria-hidden="true" tabindex="-1"></a>  <span class="at">farm_c =</span> <span class="fu">tibble</span>(<span class="at">animal_id =</span> <span class="fu">c</span>(<span class="st">"C001"</span>, <span class="st">"C002"</span>), <span class="at">weight_kg =</span> <span class="fu">c</span>(<span class="dv">190</span>, <span class="dv">165</span>))</span>
<span id="cb148-1063"><a href="#cb148-1063" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb148-1064"><a href="#cb148-1064" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-1065"><a href="#cb148-1065" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate mean weight for each farm</span></span>
<span id="cb148-1066"><a href="#cb148-1066" aria-hidden="true" tabindex="-1"></a><span class="fu">map_dbl</span>(animals_list, \(df) <span class="fu">mean</span>(df<span class="sc">$</span>weight_kg))</span>
<span id="cb148-1067"><a href="#cb148-1067" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-1068"><a href="#cb148-1068" aria-hidden="true" tabindex="-1"></a><span class="co"># Count rows in each data frame</span></span>
<span id="cb148-1069"><a href="#cb148-1069" aria-hidden="true" tabindex="-1"></a><span class="fu">map_int</span>(animals_list, nrow)</span>
<span id="cb148-1070"><a href="#cb148-1070" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-1071"><a href="#cb148-1071" aria-hidden="true" tabindex="-1"></a><span class="co"># Add a new column to each data frame</span></span>
<span id="cb148-1072"><a href="#cb148-1072" aria-hidden="true" tabindex="-1"></a><span class="fu">map</span>(animals_list, \(df) <span class="fu">mutate</span>(df, <span class="at">weight_lb =</span> weight_kg <span class="sc">*</span> <span class="fl">2.20462</span>))</span>
<span id="cb148-1073"><a href="#cb148-1073" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb148-1074"><a href="#cb148-1074" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-1075"><a href="#cb148-1075" aria-hidden="true" tabindex="-1"></a><span class="fu">### Anonymous Functions in `map()`</span></span>
<span id="cb148-1076"><a href="#cb148-1076" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-1077"><a href="#cb148-1077" aria-hidden="true" tabindex="-1"></a>Three ways to write anonymous functions:</span>
<span id="cb148-1078"><a href="#cb148-1078" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-1081"><a href="#cb148-1081" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb148-1082"><a href="#cb148-1082" aria-hidden="true" tabindex="-1"></a><span class="co">#| eval: true</span></span>
<span id="cb148-1083"><a href="#cb148-1083" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: true</span></span>
<span id="cb148-1084"><a href="#cb148-1084" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-1085"><a href="#cb148-1085" aria-hidden="true" tabindex="-1"></a>numbers <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="at">a =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>, <span class="at">b =</span> <span class="dv">10</span><span class="sc">:</span><span class="dv">15</span>, <span class="at">c =</span> <span class="dv">20</span><span class="sc">:</span><span class="dv">25</span>)</span>
<span id="cb148-1086"><a href="#cb148-1086" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-1087"><a href="#cb148-1087" aria-hidden="true" tabindex="-1"></a><span class="co"># 1. Traditional function() syntax</span></span>
<span id="cb148-1088"><a href="#cb148-1088" aria-hidden="true" tabindex="-1"></a><span class="fu">map_dbl</span>(numbers, <span class="cf">function</span>(x) <span class="fu">mean</span>(x) <span class="sc">*</span> <span class="dv">2</span>)</span>
<span id="cb148-1089"><a href="#cb148-1089" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-1090"><a href="#cb148-1090" aria-hidden="true" tabindex="-1"></a><span class="co"># 2. Formula shorthand with ~ and .x</span></span>
<span id="cb148-1091"><a href="#cb148-1091" aria-hidden="true" tabindex="-1"></a><span class="fu">map_dbl</span>(numbers, <span class="sc">~</span> <span class="fu">mean</span>(.x) <span class="sc">*</span> <span class="dv">2</span>)</span>
<span id="cb148-1092"><a href="#cb148-1092" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-1093"><a href="#cb148-1093" aria-hidden="true" tabindex="-1"></a><span class="co"># 3. Lambda function with \() (R &gt;= 4.1)</span></span>
<span id="cb148-1094"><a href="#cb148-1094" aria-hidden="true" tabindex="-1"></a><span class="fu">map_dbl</span>(numbers, \(x) <span class="fu">mean</span>(x) <span class="sc">*</span> <span class="dv">2</span>)</span>
<span id="cb148-1095"><a href="#cb148-1095" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb148-1096"><a href="#cb148-1096" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-1097"><a href="#cb148-1097" aria-hidden="true" tabindex="-1"></a>All three are equivalent. Use whichever you find most readable.</span>
<span id="cb148-1098"><a href="#cb148-1098" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-1099"><a href="#cb148-1099" aria-hidden="true" tabindex="-1"></a><span class="fu">### `map2()`: Iterate Over Two Inputs</span></span>
<span id="cb148-1100"><a href="#cb148-1100" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-1101"><a href="#cb148-1101" aria-hidden="true" tabindex="-1"></a>When you need to iterate over two vectors/lists in parallel:</span>
<span id="cb148-1102"><a href="#cb148-1102" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-1105"><a href="#cb148-1105" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb148-1106"><a href="#cb148-1106" aria-hidden="true" tabindex="-1"></a><span class="co">#| eval: true</span></span>
<span id="cb148-1107"><a href="#cb148-1107" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: true</span></span>
<span id="cb148-1108"><a href="#cb148-1108" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-1109"><a href="#cb148-1109" aria-hidden="true" tabindex="-1"></a><span class="co"># Two vectors to iterate over</span></span>
<span id="cb148-1110"><a href="#cb148-1110" aria-hidden="true" tabindex="-1"></a>weights_kg <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">180</span>, <span class="dv">150</span>, <span class="dv">200</span>)</span>
<span id="cb148-1111"><a href="#cb148-1111" aria-hidden="true" tabindex="-1"></a>prices_per_kg <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">5</span>, <span class="fl">5.50</span>, <span class="fl">4.80</span>)</span>
<span id="cb148-1112"><a href="#cb148-1112" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-1113"><a href="#cb148-1113" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate total value for each animal</span></span>
<span id="cb148-1114"><a href="#cb148-1114" aria-hidden="true" tabindex="-1"></a><span class="fu">map2_dbl</span>(weights_kg, prices_per_kg, \(w, p) w <span class="sc">*</span> p)</span>
<span id="cb148-1115"><a href="#cb148-1115" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-1116"><a href="#cb148-1116" aria-hidden="true" tabindex="-1"></a><span class="co"># With names</span></span>
<span id="cb148-1117"><a href="#cb148-1117" aria-hidden="true" tabindex="-1"></a>animals <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"A001"</span>, <span class="st">"A002"</span>, <span class="st">"A003"</span>)</span>
<span id="cb148-1118"><a href="#cb148-1118" aria-hidden="true" tabindex="-1"></a><span class="fu">map2_chr</span>(animals, weights_kg, \(id, wt) <span class="fu">paste</span>(id, <span class="st">"weighs"</span>, wt, <span class="st">"kg"</span>))</span>
<span id="cb148-1119"><a href="#cb148-1119" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb148-1120"><a href="#cb148-1120" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-1121"><a href="#cb148-1121" aria-hidden="true" tabindex="-1"></a><span class="fu">### `pmap()`: Iterate Over Many Inputs</span></span>
<span id="cb148-1122"><a href="#cb148-1122" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-1123"><a href="#cb148-1123" aria-hidden="true" tabindex="-1"></a>For more than two inputs, use <span class="in">`pmap()`</span>:</span>
<span id="cb148-1124"><a href="#cb148-1124" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-1127"><a href="#cb148-1127" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb148-1128"><a href="#cb148-1128" aria-hidden="true" tabindex="-1"></a><span class="co">#| eval: true</span></span>
<span id="cb148-1129"><a href="#cb148-1129" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: true</span></span>
<span id="cb148-1130"><a href="#cb148-1130" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-1131"><a href="#cb148-1131" aria-hidden="true" tabindex="-1"></a><span class="co"># Data frame with multiple columns</span></span>
<span id="cb148-1132"><a href="#cb148-1132" aria-hidden="true" tabindex="-1"></a>sales <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb148-1133"><a href="#cb148-1133" aria-hidden="true" tabindex="-1"></a>  <span class="at">animal_id =</span> <span class="fu">c</span>(<span class="st">"A001"</span>, <span class="st">"A002"</span>, <span class="st">"A003"</span>),</span>
<span id="cb148-1134"><a href="#cb148-1134" aria-hidden="true" tabindex="-1"></a>  <span class="at">weight_kg =</span> <span class="fu">c</span>(<span class="dv">180</span>, <span class="dv">150</span>, <span class="dv">200</span>),</span>
<span id="cb148-1135"><a href="#cb148-1135" aria-hidden="true" tabindex="-1"></a>  <span class="at">price_per_kg =</span> <span class="fu">c</span>(<span class="dv">5</span>, <span class="fl">5.50</span>, <span class="fl">4.80</span>),</span>
<span id="cb148-1136"><a href="#cb148-1136" aria-hidden="true" tabindex="-1"></a>  <span class="at">bonus =</span> <span class="fu">c</span>(<span class="dv">50</span>, <span class="dv">30</span>, <span class="dv">60</span>)</span>
<span id="cb148-1137"><a href="#cb148-1137" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb148-1138"><a href="#cb148-1138" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-1139"><a href="#cb148-1139" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate total value: (weight * price) + bonus</span></span>
<span id="cb148-1140"><a href="#cb148-1140" aria-hidden="true" tabindex="-1"></a>sales <span class="sc">%&gt;%</span></span>
<span id="cb148-1141"><a href="#cb148-1141" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb148-1142"><a href="#cb148-1142" aria-hidden="true" tabindex="-1"></a>    <span class="at">total_value =</span> <span class="fu">pmap_dbl</span>(</span>
<span id="cb148-1143"><a href="#cb148-1143" aria-hidden="true" tabindex="-1"></a>      <span class="fu">list</span>(weight_kg, price_per_kg, bonus),</span>
<span id="cb148-1144"><a href="#cb148-1144" aria-hidden="true" tabindex="-1"></a>      \(w, p, b) (w <span class="sc">*</span> p) <span class="sc">+</span> b</span>
<span id="cb148-1145"><a href="#cb148-1145" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb148-1146"><a href="#cb148-1146" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb148-1147"><a href="#cb148-1147" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb148-1148"><a href="#cb148-1148" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-1149"><a href="#cb148-1149" aria-hidden="true" tabindex="-1"></a><span class="fu">### Practical Example: Reading Multiple Files</span></span>
<span id="cb148-1150"><a href="#cb148-1150" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-1153"><a href="#cb148-1153" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb148-1154"><a href="#cb148-1154" aria-hidden="true" tabindex="-1"></a><span class="co">#| eval: false</span></span>
<span id="cb148-1155"><a href="#cb148-1155" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: true</span></span>
<span id="cb148-1156"><a href="#cb148-1156" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-1157"><a href="#cb148-1157" aria-hidden="true" tabindex="-1"></a><span class="co"># Get list of CSV files</span></span>
<span id="cb148-1158"><a href="#cb148-1158" aria-hidden="true" tabindex="-1"></a>file_list <span class="ot">&lt;-</span> <span class="fu">list.files</span>(<span class="at">path =</span> <span class="st">"data/"</span>, <span class="at">pattern =</span> <span class="st">"*.csv"</span>, <span class="at">full.names =</span> <span class="cn">TRUE</span>)</span>
<span id="cb148-1159"><a href="#cb148-1159" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-1160"><a href="#cb148-1160" aria-hidden="true" tabindex="-1"></a><span class="co"># Read all files into a list</span></span>
<span id="cb148-1161"><a href="#cb148-1161" aria-hidden="true" tabindex="-1"></a>all_data <span class="ot">&lt;-</span> <span class="fu">map</span>(file_list, read_csv)</span>
<span id="cb148-1162"><a href="#cb148-1162" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-1163"><a href="#cb148-1163" aria-hidden="true" tabindex="-1"></a><span class="co"># Combine into single data frame with source file</span></span>
<span id="cb148-1164"><a href="#cb148-1164" aria-hidden="true" tabindex="-1"></a>combined_data <span class="ot">&lt;-</span> <span class="fu">map</span>(file_list, read_csv) <span class="sc">%&gt;%</span></span>
<span id="cb148-1165"><a href="#cb148-1165" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set_names</span>(<span class="fu">basename</span>(file_list)) <span class="sc">%&gt;%</span></span>
<span id="cb148-1166"><a href="#cb148-1166" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bind_rows</span>(<span class="at">.id =</span> <span class="st">"source_file"</span>)</span>
<span id="cb148-1167"><a href="#cb148-1167" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb148-1168"><a href="#cb148-1168" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-1169"><a href="#cb148-1169" aria-hidden="true" tabindex="-1"></a><span class="fu">### Handling Errors with `safely()` and `possibly()`</span></span>
<span id="cb148-1170"><a href="#cb148-1170" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-1171"><a href="#cb148-1171" aria-hidden="true" tabindex="-1"></a>Sometimes operations fail for some elements. Handle errors gracefully:</span>
<span id="cb148-1172"><a href="#cb148-1172" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-1175"><a href="#cb148-1175" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb148-1176"><a href="#cb148-1176" aria-hidden="true" tabindex="-1"></a><span class="co">#| eval: true</span></span>
<span id="cb148-1177"><a href="#cb148-1177" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: true</span></span>
<span id="cb148-1178"><a href="#cb148-1178" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-1179"><a href="#cb148-1179" aria-hidden="true" tabindex="-1"></a><span class="co"># Some operations might fail</span></span>
<span id="cb148-1180"><a href="#cb148-1180" aria-hidden="true" tabindex="-1"></a>mixed_list <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb148-1181"><a href="#cb148-1181" aria-hidden="true" tabindex="-1"></a>  <span class="at">a =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>),</span>
<span id="cb148-1182"><a href="#cb148-1182" aria-hidden="true" tabindex="-1"></a>  <span class="at">b =</span> <span class="fu">c</span>(<span class="st">"a"</span>, <span class="st">"b"</span>, <span class="st">"c"</span>),  <span class="co"># This will cause an error with mean()</span></span>
<span id="cb148-1183"><a href="#cb148-1183" aria-hidden="true" tabindex="-1"></a>  <span class="at">c =</span> <span class="fu">c</span>(<span class="dv">10</span>, <span class="dv">20</span>, <span class="dv">30</span>)</span>
<span id="cb148-1184"><a href="#cb148-1184" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb148-1185"><a href="#cb148-1185" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-1186"><a href="#cb148-1186" aria-hidden="true" tabindex="-1"></a><span class="co"># This would error:</span></span>
<span id="cb148-1187"><a href="#cb148-1187" aria-hidden="true" tabindex="-1"></a><span class="co"># map_dbl(mixed_list, mean)</span></span>
<span id="cb148-1188"><a href="#cb148-1188" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-1189"><a href="#cb148-1189" aria-hidden="true" tabindex="-1"></a><span class="co"># Use safely() to catch errors</span></span>
<span id="cb148-1190"><a href="#cb148-1190" aria-hidden="true" tabindex="-1"></a>safe_mean <span class="ot">&lt;-</span> <span class="fu">safely</span>(mean)</span>
<span id="cb148-1191"><a href="#cb148-1191" aria-hidden="true" tabindex="-1"></a><span class="fu">map</span>(mixed_list, safe_mean)</span>
<span id="cb148-1192"><a href="#cb148-1192" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-1193"><a href="#cb148-1193" aria-hidden="true" tabindex="-1"></a><span class="co"># Use possibly() to return a default value on error</span></span>
<span id="cb148-1194"><a href="#cb148-1194" aria-hidden="true" tabindex="-1"></a>possibly_mean <span class="ot">&lt;-</span> <span class="fu">possibly</span>(mean, <span class="at">otherwise =</span> <span class="cn">NA_real_</span>)</span>
<span id="cb148-1195"><a href="#cb148-1195" aria-hidden="true" tabindex="-1"></a><span class="fu">map_dbl</span>(mixed_list, possibly_mean)</span>
<span id="cb148-1196"><a href="#cb148-1196" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb148-1197"><a href="#cb148-1197" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-1198"><a href="#cb148-1198" aria-hidden="true" tabindex="-1"></a>---</span>
<span id="cb148-1199"><a href="#cb148-1199" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-1200"><a href="#cb148-1200" aria-hidden="true" tabindex="-1"></a><span class="fu">## List Columns and Nested Data</span></span>
<span id="cb148-1201"><a href="#cb148-1201" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-1202"><a href="#cb148-1202" aria-hidden="true" tabindex="-1"></a>List columns allow you to store complex objects (like data frames) inside data frame cells.</span>
<span id="cb148-1203"><a href="#cb148-1203" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-1204"><a href="#cb148-1204" aria-hidden="true" tabindex="-1"></a><span class="fu">### Creating Nested Data</span></span>
<span id="cb148-1205"><a href="#cb148-1205" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-1208"><a href="#cb148-1208" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb148-1209"><a href="#cb148-1209" aria-hidden="true" tabindex="-1"></a><span class="co">#| eval: true</span></span>
<span id="cb148-1210"><a href="#cb148-1210" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: true</span></span>
<span id="cb148-1211"><a href="#cb148-1211" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-1212"><a href="#cb148-1212" aria-hidden="true" tabindex="-1"></a><span class="co"># Example: Group and nest</span></span>
<span id="cb148-1213"><a href="#cb148-1213" aria-hidden="true" tabindex="-1"></a>animals_nested <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb148-1214"><a href="#cb148-1214" aria-hidden="true" tabindex="-1"></a>  <span class="at">animal_id =</span> <span class="fu">c</span>(<span class="st">"A001"</span>, <span class="st">"A002"</span>, <span class="st">"A003"</span>, <span class="st">"A001"</span>, <span class="st">"A002"</span>, <span class="st">"A003"</span>),</span>
<span id="cb148-1215"><a href="#cb148-1215" aria-hidden="true" tabindex="-1"></a>  <span class="at">week =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">4</span>, <span class="dv">4</span>, <span class="dv">4</span>),</span>
<span id="cb148-1216"><a href="#cb148-1216" aria-hidden="true" tabindex="-1"></a>  <span class="at">weight_kg =</span> <span class="fu">c</span>(<span class="dv">45</span>, <span class="dv">42</span>, <span class="dv">48</span>, <span class="dv">52</span>, <span class="dv">48</span>, <span class="dv">54</span>)</span>
<span id="cb148-1217"><a href="#cb148-1217" aria-hidden="true" tabindex="-1"></a>) <span class="sc">%&gt;%</span></span>
<span id="cb148-1218"><a href="#cb148-1218" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(animal_id) <span class="sc">%&gt;%</span></span>
<span id="cb148-1219"><a href="#cb148-1219" aria-hidden="true" tabindex="-1"></a>  <span class="fu">nest</span>()</span>
<span id="cb148-1220"><a href="#cb148-1220" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-1221"><a href="#cb148-1221" aria-hidden="true" tabindex="-1"></a>animals_nested</span>
<span id="cb148-1222"><a href="#cb148-1222" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-1223"><a href="#cb148-1223" aria-hidden="true" tabindex="-1"></a><span class="co"># Each row now contains a data frame in the 'data' column</span></span>
<span id="cb148-1224"><a href="#cb148-1224" aria-hidden="true" tabindex="-1"></a>animals_nested<span class="sc">$</span>data[[<span class="dv">1</span>]]  <span class="co"># Data for first animal</span></span>
<span id="cb148-1225"><a href="#cb148-1225" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb148-1226"><a href="#cb148-1226" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-1227"><a href="#cb148-1227" aria-hidden="true" tabindex="-1"></a><span class="fu">### Working with Nested Data</span></span>
<span id="cb148-1228"><a href="#cb148-1228" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-1231"><a href="#cb148-1231" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb148-1232"><a href="#cb148-1232" aria-hidden="true" tabindex="-1"></a><span class="co">#| eval: true</span></span>
<span id="cb148-1233"><a href="#cb148-1233" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: true</span></span>
<span id="cb148-1234"><a href="#cb148-1234" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-1235"><a href="#cb148-1235" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate statistics for each animal's data</span></span>
<span id="cb148-1236"><a href="#cb148-1236" aria-hidden="true" tabindex="-1"></a>animals_nested <span class="sc">%&gt;%</span></span>
<span id="cb148-1237"><a href="#cb148-1237" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb148-1238"><a href="#cb148-1238" aria-hidden="true" tabindex="-1"></a>    <span class="at">n_measurements =</span> <span class="fu">map_int</span>(data, nrow),</span>
<span id="cb148-1239"><a href="#cb148-1239" aria-hidden="true" tabindex="-1"></a>    <span class="at">mean_weight =</span> <span class="fu">map_dbl</span>(data, <span class="sc">~</span><span class="fu">mean</span>(.x<span class="sc">$</span>weight_kg)),</span>
<span id="cb148-1240"><a href="#cb148-1240" aria-hidden="true" tabindex="-1"></a>    <span class="at">weight_gain =</span> <span class="fu">map_dbl</span>(data, <span class="sc">~</span><span class="fu">diff</span>(<span class="fu">range</span>(.x<span class="sc">$</span>weight_kg)))</span>
<span id="cb148-1241"><a href="#cb148-1241" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb148-1242"><a href="#cb148-1242" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb148-1243"><a href="#cb148-1243" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-1244"><a href="#cb148-1244" aria-hidden="true" tabindex="-1"></a><span class="fu">### Fitting Models to Nested Data</span></span>
<span id="cb148-1245"><a href="#cb148-1245" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-1248"><a href="#cb148-1248" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb148-1249"><a href="#cb148-1249" aria-hidden="true" tabindex="-1"></a><span class="co">#| eval: true</span></span>
<span id="cb148-1250"><a href="#cb148-1250" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: true</span></span>
<span id="cb148-1251"><a href="#cb148-1251" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-1252"><a href="#cb148-1252" aria-hidden="true" tabindex="-1"></a><span class="co"># Create more complete data</span></span>
<span id="cb148-1253"><a href="#cb148-1253" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">123</span>)</span>
<span id="cb148-1254"><a href="#cb148-1254" aria-hidden="true" tabindex="-1"></a>growth_data <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb148-1255"><a href="#cb148-1255" aria-hidden="true" tabindex="-1"></a>  <span class="at">animal_id =</span> <span class="fu">rep</span>(<span class="fu">c</span>(<span class="st">"A001"</span>, <span class="st">"A002"</span>, <span class="st">"A003"</span>), <span class="at">each =</span> <span class="dv">5</span>),</span>
<span id="cb148-1256"><a href="#cb148-1256" aria-hidden="true" tabindex="-1"></a>  <span class="at">week =</span> <span class="fu">rep</span>(<span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">2</span>, <span class="dv">4</span>, <span class="dv">6</span>, <span class="dv">8</span>), <span class="at">times =</span> <span class="dv">3</span>),</span>
<span id="cb148-1257"><a href="#cb148-1257" aria-hidden="true" tabindex="-1"></a>  <span class="at">weight_kg =</span> <span class="fu">c</span>(</span>
<span id="cb148-1258"><a href="#cb148-1258" aria-hidden="true" tabindex="-1"></a>    <span class="dv">45</span> <span class="sc">+</span> (<span class="dv">0</span><span class="sc">:</span><span class="dv">4</span>) <span class="sc">*</span> <span class="dv">2</span> <span class="sc">+</span> <span class="fu">rnorm</span>(<span class="dv">5</span>, <span class="dv">0</span>, <span class="dv">1</span>),  <span class="co"># A001</span></span>
<span id="cb148-1259"><a href="#cb148-1259" aria-hidden="true" tabindex="-1"></a>    <span class="dv">42</span> <span class="sc">+</span> (<span class="dv">0</span><span class="sc">:</span><span class="dv">4</span>) <span class="sc">*</span> <span class="fl">1.8</span> <span class="sc">+</span> <span class="fu">rnorm</span>(<span class="dv">5</span>, <span class="dv">0</span>, <span class="dv">1</span>),  <span class="co"># A002</span></span>
<span id="cb148-1260"><a href="#cb148-1260" aria-hidden="true" tabindex="-1"></a>    <span class="dv">48</span> <span class="sc">+</span> (<span class="dv">0</span><span class="sc">:</span><span class="dv">4</span>) <span class="sc">*</span> <span class="fl">2.2</span> <span class="sc">+</span> <span class="fu">rnorm</span>(<span class="dv">5</span>, <span class="dv">0</span>, <span class="dv">1</span>)   <span class="co"># A003</span></span>
<span id="cb148-1261"><a href="#cb148-1261" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb148-1262"><a href="#cb148-1262" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb148-1263"><a href="#cb148-1263" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-1264"><a href="#cb148-1264" aria-hidden="true" tabindex="-1"></a><span class="co"># Nest by animal</span></span>
<span id="cb148-1265"><a href="#cb148-1265" aria-hidden="true" tabindex="-1"></a>growth_nested <span class="ot">&lt;-</span> growth_data <span class="sc">%&gt;%</span></span>
<span id="cb148-1266"><a href="#cb148-1266" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(animal_id) <span class="sc">%&gt;%</span></span>
<span id="cb148-1267"><a href="#cb148-1267" aria-hidden="true" tabindex="-1"></a>  <span class="fu">nest</span>()</span>
<span id="cb148-1268"><a href="#cb148-1268" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-1269"><a href="#cb148-1269" aria-hidden="true" tabindex="-1"></a><span class="co"># Fit linear model to each animal's growth</span></span>
<span id="cb148-1270"><a href="#cb148-1270" aria-hidden="true" tabindex="-1"></a>growth_nested <span class="ot">&lt;-</span> growth_nested <span class="sc">%&gt;%</span></span>
<span id="cb148-1271"><a href="#cb148-1271" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb148-1272"><a href="#cb148-1272" aria-hidden="true" tabindex="-1"></a>    <span class="at">model =</span> <span class="fu">map</span>(data, <span class="sc">~</span><span class="fu">lm</span>(weight_kg <span class="sc">~</span> week, <span class="at">data =</span> .x)),</span>
<span id="cb148-1273"><a href="#cb148-1273" aria-hidden="true" tabindex="-1"></a>    <span class="at">growth_rate =</span> <span class="fu">map_dbl</span>(model, <span class="sc">~</span><span class="fu">coef</span>(.x)[<span class="dv">2</span>])</span>
<span id="cb148-1274"><a href="#cb148-1274" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb148-1275"><a href="#cb148-1275" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-1276"><a href="#cb148-1276" aria-hidden="true" tabindex="-1"></a>growth_nested</span>
<span id="cb148-1277"><a href="#cb148-1277" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-1278"><a href="#cb148-1278" aria-hidden="true" tabindex="-1"></a><span class="co"># Extract coefficients</span></span>
<span id="cb148-1279"><a href="#cb148-1279" aria-hidden="true" tabindex="-1"></a>growth_nested <span class="sc">%&gt;%</span></span>
<span id="cb148-1280"><a href="#cb148-1280" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(animal_id, growth_rate)</span>
<span id="cb148-1281"><a href="#cb148-1281" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb148-1282"><a href="#cb148-1282" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-1283"><a href="#cb148-1283" aria-hidden="true" tabindex="-1"></a><span class="fu">### Unnesting</span></span>
<span id="cb148-1284"><a href="#cb148-1284" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-1285"><a href="#cb148-1285" aria-hidden="true" tabindex="-1"></a>Convert list columns back to regular rows:</span>
<span id="cb148-1286"><a href="#cb148-1286" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-1289"><a href="#cb148-1289" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb148-1290"><a href="#cb148-1290" aria-hidden="true" tabindex="-1"></a><span class="co">#| eval: true</span></span>
<span id="cb148-1291"><a href="#cb148-1291" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: true</span></span>
<span id="cb148-1292"><a href="#cb148-1292" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-1293"><a href="#cb148-1293" aria-hidden="true" tabindex="-1"></a><span class="co"># Unnest data column</span></span>
<span id="cb148-1294"><a href="#cb148-1294" aria-hidden="true" tabindex="-1"></a>growth_nested <span class="sc">%&gt;%</span></span>
<span id="cb148-1295"><a href="#cb148-1295" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(animal_id, data) <span class="sc">%&gt;%</span></span>
<span id="cb148-1296"><a href="#cb148-1296" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unnest</span>(<span class="at">cols =</span> data)</span>
<span id="cb148-1297"><a href="#cb148-1297" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb148-1298"><a href="#cb148-1298" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-1299"><a href="#cb148-1299" aria-hidden="true" tabindex="-1"></a>---</span>
<span id="cb148-1300"><a href="#cb148-1300" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-1301"><a href="#cb148-1301" aria-hidden="true" tabindex="-1"></a><span class="fu">## Summary</span></span>
<span id="cb148-1302"><a href="#cb148-1302" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-1303"><a href="#cb148-1303" aria-hidden="true" tabindex="-1"></a>This chapter covered three major topics for advanced data wrangling:</span>
<span id="cb148-1304"><a href="#cb148-1304" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-1305"><a href="#cb148-1305" aria-hidden="true" tabindex="-1"></a><span class="fu">### Data Reshaping (tidyr)</span></span>
<span id="cb148-1306"><a href="#cb148-1306" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-1307"><a href="#cb148-1307" aria-hidden="true" tabindex="-1"></a><span class="ss">1. </span>**`pivot_longer()`**: Wide → Long format</span>
<span id="cb148-1308"><a href="#cb148-1308" aria-hidden="true" tabindex="-1"></a><span class="ss">   - </span>Convert column names to values</span>
<span id="cb148-1309"><a href="#cb148-1309" aria-hidden="true" tabindex="-1"></a><span class="ss">   - </span>Stack measurements</span>
<span id="cb148-1310"><a href="#cb148-1310" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-1311"><a href="#cb148-1311" aria-hidden="true" tabindex="-1"></a><span class="ss">2. </span>**`pivot_wider()`**: Long → Wide format</span>
<span id="cb148-1312"><a href="#cb148-1312" aria-hidden="true" tabindex="-1"></a><span class="ss">   - </span>Create summary tables</span>
<span id="cb148-1313"><a href="#cb148-1313" aria-hidden="true" tabindex="-1"></a><span class="ss">   - </span>Spread values across columns</span>
<span id="cb148-1314"><a href="#cb148-1314" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-1315"><a href="#cb148-1315" aria-hidden="true" tabindex="-1"></a><span class="ss">3. </span>**`separate()` &amp; `unite()`**: Split or combine columns</span>
<span id="cb148-1316"><a href="#cb148-1316" aria-hidden="true" tabindex="-1"></a><span class="ss">   - </span>Extract information from composite columns</span>
<span id="cb148-1317"><a href="#cb148-1317" aria-hidden="true" tabindex="-1"></a><span class="ss">   - </span>Create unique identifiers</span>
<span id="cb148-1318"><a href="#cb148-1318" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-1319"><a href="#cb148-1319" aria-hidden="true" tabindex="-1"></a><span class="fu">### Joining Datasets</span></span>
<span id="cb148-1320"><a href="#cb148-1320" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-1321"><a href="#cb148-1321" aria-hidden="true" tabindex="-1"></a><span class="ss">1. </span>**Mutating joins** (add columns):</span>
<span id="cb148-1322"><a href="#cb148-1322" aria-hidden="true" tabindex="-1"></a><span class="ss">   - </span><span class="in">`left_join()`</span>: Keep all left, add matching right</span>
<span id="cb148-1323"><a href="#cb148-1323" aria-hidden="true" tabindex="-1"></a><span class="ss">   - </span><span class="in">`inner_join()`</span>: Keep only matches</span>
<span id="cb148-1324"><a href="#cb148-1324" aria-hidden="true" tabindex="-1"></a><span class="ss">   - </span><span class="in">`full_join()`</span>: Keep everything</span>
<span id="cb148-1325"><a href="#cb148-1325" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-1326"><a href="#cb148-1326" aria-hidden="true" tabindex="-1"></a><span class="ss">2. </span>**Filtering joins** (filter rows):</span>
<span id="cb148-1327"><a href="#cb148-1327" aria-hidden="true" tabindex="-1"></a><span class="ss">   - </span><span class="in">`semi_join()`</span>: Keep rows with matches</span>
<span id="cb148-1328"><a href="#cb148-1328" aria-hidden="true" tabindex="-1"></a><span class="ss">   - </span><span class="in">`anti_join()`</span>: Keep rows without matches</span>
<span id="cb148-1329"><a href="#cb148-1329" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-1330"><a href="#cb148-1330" aria-hidden="true" tabindex="-1"></a><span class="ss">3. </span>**Binding**:</span>
<span id="cb148-1331"><a href="#cb148-1331" aria-hidden="true" tabindex="-1"></a><span class="ss">   - </span><span class="in">`bind_rows()`</span>: Stack vertically</span>
<span id="cb148-1332"><a href="#cb148-1332" aria-hidden="true" tabindex="-1"></a><span class="ss">   - </span><span class="in">`bind_cols()`</span>: Attach horizontally (use cautiously)</span>
<span id="cb148-1333"><a href="#cb148-1333" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-1334"><a href="#cb148-1334" aria-hidden="true" tabindex="-1"></a><span class="fu">### Iteration (purrr)</span></span>
<span id="cb148-1335"><a href="#cb148-1335" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-1336"><a href="#cb148-1336" aria-hidden="true" tabindex="-1"></a><span class="ss">1. </span>**`map()` functions**: Apply functions to each element</span>
<span id="cb148-1337"><a href="#cb148-1337" aria-hidden="true" tabindex="-1"></a><span class="ss">   - </span><span class="in">`map()`</span>: Returns list</span>
<span id="cb148-1338"><a href="#cb148-1338" aria-hidden="true" tabindex="-1"></a><span class="ss">   - </span><span class="in">`map_dbl()`</span>, <span class="in">`map_chr()`</span>, <span class="in">`map_int()`</span>, <span class="in">`map_lgl()`</span>: Return vectors</span>
<span id="cb148-1339"><a href="#cb148-1339" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-1340"><a href="#cb148-1340" aria-hidden="true" tabindex="-1"></a><span class="ss">2. </span>**Multiple inputs**:</span>
<span id="cb148-1341"><a href="#cb148-1341" aria-hidden="true" tabindex="-1"></a><span class="ss">   - </span><span class="in">`map2()`</span>: Two inputs</span>
<span id="cb148-1342"><a href="#cb148-1342" aria-hidden="true" tabindex="-1"></a><span class="ss">   - </span><span class="in">`pmap()`</span>: Many inputs</span>
<span id="cb148-1343"><a href="#cb148-1343" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-1344"><a href="#cb148-1344" aria-hidden="true" tabindex="-1"></a><span class="ss">3. </span>**List columns**: Store complex objects in data frames</span>
<span id="cb148-1345"><a href="#cb148-1345" aria-hidden="true" tabindex="-1"></a><span class="ss">   - </span><span class="in">`nest()`</span>: Create nested data</span>
<span id="cb148-1346"><a href="#cb148-1346" aria-hidden="true" tabindex="-1"></a><span class="ss">   - </span><span class="in">`unnest()`</span>: Expand nested data</span>
<span id="cb148-1347"><a href="#cb148-1347" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-1348"><a href="#cb148-1348" aria-hidden="true" tabindex="-1"></a>---</span>
<span id="cb148-1349"><a href="#cb148-1349" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-1350"><a href="#cb148-1350" aria-hidden="true" tabindex="-1"></a><span class="fu">## Week 7 Homework: Multi-Table Data Integration</span></span>
<span id="cb148-1351"><a href="#cb148-1351" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-1352"><a href="#cb148-1352" aria-hidden="true" tabindex="-1"></a><span class="fu">### Assignment Overview</span></span>
<span id="cb148-1353"><a href="#cb148-1353" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-1354"><a href="#cb148-1354" aria-hidden="true" tabindex="-1"></a>You will work with three related datasets about a pig feeding trial. Your task is to reshape, join, and analyze the data using techniques from this chapter.</span>
<span id="cb148-1355"><a href="#cb148-1355" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-1356"><a href="#cb148-1356" aria-hidden="true" tabindex="-1"></a><span class="fu">### Part 1: Data Generation (0 points, but required)</span></span>
<span id="cb148-1357"><a href="#cb148-1357" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-1358"><a href="#cb148-1358" aria-hidden="true" tabindex="-1"></a>Run this code to create your datasets:</span>
<span id="cb148-1359"><a href="#cb148-1359" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-1362"><a href="#cb148-1362" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb148-1363"><a href="#cb148-1363" aria-hidden="true" tabindex="-1"></a><span class="co">#| eval: false</span></span>
<span id="cb148-1364"><a href="#cb148-1364" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: true</span></span>
<span id="cb148-1365"><a href="#cb148-1365" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-1366"><a href="#cb148-1366" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb148-1367"><a href="#cb148-1367" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">2024</span>)</span>
<span id="cb148-1368"><a href="#cb148-1368" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-1369"><a href="#cb148-1369" aria-hidden="true" tabindex="-1"></a><span class="co"># Dataset 1: Pig information</span></span>
<span id="cb148-1370"><a href="#cb148-1370" aria-hidden="true" tabindex="-1"></a>pigs <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb148-1371"><a href="#cb148-1371" aria-hidden="true" tabindex="-1"></a>  <span class="at">pig_id =</span> <span class="fu">paste0</span>(<span class="st">"P"</span>, <span class="dv">1001</span><span class="sc">:</span><span class="dv">1050</span>),</span>
<span id="cb148-1372"><a href="#cb148-1372" aria-hidden="true" tabindex="-1"></a>  <span class="at">breed =</span> <span class="fu">sample</span>(<span class="fu">c</span>(<span class="st">"Yorkshire"</span>, <span class="st">"Duroc"</span>, <span class="st">"Hampshire"</span>), <span class="dv">50</span>, <span class="at">replace =</span> <span class="cn">TRUE</span>),</span>
<span id="cb148-1373"><a href="#cb148-1373" aria-hidden="true" tabindex="-1"></a>  <span class="at">birth_date =</span> <span class="fu">as.Date</span>(<span class="st">"2023-03-01"</span>) <span class="sc">+</span> <span class="fu">sample</span>(<span class="dv">0</span><span class="sc">:</span><span class="dv">30</span>, <span class="dv">50</span>, <span class="at">replace =</span> <span class="cn">TRUE</span>),</span>
<span id="cb148-1374"><a href="#cb148-1374" aria-hidden="true" tabindex="-1"></a>  <span class="at">initial_weight_kg =</span> <span class="fu">rnorm</span>(<span class="dv">50</span>, <span class="at">mean =</span> <span class="dv">8</span>, <span class="at">sd =</span> <span class="dv">1</span>)</span>
<span id="cb148-1375"><a href="#cb148-1375" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb148-1376"><a href="#cb148-1376" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-1377"><a href="#cb148-1377" aria-hidden="true" tabindex="-1"></a><span class="co"># Dataset 2: Feed records (wide format - needs reshaping!)</span></span>
<span id="cb148-1378"><a href="#cb148-1378" aria-hidden="true" tabindex="-1"></a>feed_wide <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb148-1379"><a href="#cb148-1379" aria-hidden="true" tabindex="-1"></a>  <span class="at">pig_id =</span> <span class="fu">paste0</span>(<span class="st">"P"</span>, <span class="dv">1001</span><span class="sc">:</span><span class="dv">1050</span>),</span>
<span id="cb148-1380"><a href="#cb148-1380" aria-hidden="true" tabindex="-1"></a>  <span class="at">week_1_kg =</span> <span class="fu">rnorm</span>(<span class="dv">50</span>, <span class="at">mean =</span> <span class="dv">5</span>, <span class="at">sd =</span> <span class="fl">0.5</span>),</span>
<span id="cb148-1381"><a href="#cb148-1381" aria-hidden="true" tabindex="-1"></a>  <span class="at">week_2_kg =</span> <span class="fu">rnorm</span>(<span class="dv">50</span>, <span class="at">mean =</span> <span class="dv">6</span>, <span class="at">sd =</span> <span class="fl">0.6</span>),</span>
<span id="cb148-1382"><a href="#cb148-1382" aria-hidden="true" tabindex="-1"></a>  <span class="at">week_3_kg =</span> <span class="fu">rnorm</span>(<span class="dv">50</span>, <span class="at">mean =</span> <span class="dv">7</span>, <span class="at">sd =</span> <span class="fl">0.7</span>),</span>
<span id="cb148-1383"><a href="#cb148-1383" aria-hidden="true" tabindex="-1"></a>  <span class="at">week_4_kg =</span> <span class="fu">rnorm</span>(<span class="dv">50</span>, <span class="at">mean =</span> <span class="dv">8</span>, <span class="at">sd =</span> <span class="fl">0.8</span>)</span>
<span id="cb148-1384"><a href="#cb148-1384" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb148-1385"><a href="#cb148-1385" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-1386"><a href="#cb148-1386" aria-hidden="true" tabindex="-1"></a><span class="co"># Dataset 3: Treatment assignments (some pigs, not all)</span></span>
<span id="cb148-1387"><a href="#cb148-1387" aria-hidden="true" tabindex="-1"></a>treatments <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb148-1388"><a href="#cb148-1388" aria-hidden="true" tabindex="-1"></a>  <span class="at">pig_id =</span> <span class="fu">sample</span>(<span class="fu">paste0</span>(<span class="st">"P"</span>, <span class="dv">1001</span><span class="sc">:</span><span class="dv">1050</span>), <span class="dv">40</span>),</span>
<span id="cb148-1389"><a href="#cb148-1389" aria-hidden="true" tabindex="-1"></a>  <span class="at">treatment =</span> <span class="fu">sample</span>(<span class="fu">c</span>(<span class="st">"Standard"</span>, <span class="st">"HighProtein"</span>, <span class="st">"Supplement"</span>), <span class="dv">40</span>, <span class="at">replace =</span> <span class="cn">TRUE</span>),</span>
<span id="cb148-1390"><a href="#cb148-1390" aria-hidden="true" tabindex="-1"></a>  <span class="at">treatment_start =</span> <span class="fu">as.Date</span>(<span class="st">"2023-03-15"</span>)</span>
<span id="cb148-1391"><a href="#cb148-1391" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb148-1392"><a href="#cb148-1392" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-1393"><a href="#cb148-1393" aria-hidden="true" tabindex="-1"></a><span class="co"># Dataset 4: Health records (long format, multiple records per pig)</span></span>
<span id="cb148-1394"><a href="#cb148-1394" aria-hidden="true" tabindex="-1"></a>health <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb148-1395"><a href="#cb148-1395" aria-hidden="true" tabindex="-1"></a>  <span class="at">pig_id =</span> <span class="fu">rep</span>(<span class="fu">sample</span>(<span class="fu">paste0</span>(<span class="st">"P"</span>, <span class="dv">1001</span><span class="sc">:</span><span class="dv">1050</span>), <span class="dv">30</span>), <span class="at">each =</span> <span class="dv">3</span>),</span>
<span id="cb148-1396"><a href="#cb148-1396" aria-hidden="true" tabindex="-1"></a>  <span class="at">check_date =</span> <span class="fu">rep</span>(<span class="fu">as.Date</span>(<span class="st">"2023-03-15"</span>) <span class="sc">+</span> <span class="fu">c</span>(<span class="dv">7</span>, <span class="dv">14</span>, <span class="dv">21</span>), <span class="at">times =</span> <span class="dv">30</span>),</span>
<span id="cb148-1397"><a href="#cb148-1397" aria-hidden="true" tabindex="-1"></a>  <span class="at">health_score =</span> <span class="fu">sample</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>, <span class="dv">90</span>, <span class="at">replace =</span> <span class="cn">TRUE</span>),</span>
<span id="cb148-1398"><a href="#cb148-1398" aria-hidden="true" tabindex="-1"></a>  <span class="at">temperature_C =</span> <span class="fu">rnorm</span>(<span class="dv">90</span>, <span class="at">mean =</span> <span class="dv">39</span>, <span class="at">sd =</span> <span class="fl">0.5</span>)</span>
<span id="cb148-1399"><a href="#cb148-1399" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb148-1400"><a href="#cb148-1400" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-1401"><a href="#cb148-1401" aria-hidden="true" tabindex="-1"></a><span class="co"># Save datasets</span></span>
<span id="cb148-1402"><a href="#cb148-1402" aria-hidden="true" tabindex="-1"></a><span class="fu">write_csv</span>(pigs, <span class="st">"pigs.csv"</span>)</span>
<span id="cb148-1403"><a href="#cb148-1403" aria-hidden="true" tabindex="-1"></a><span class="fu">write_csv</span>(feed_wide, <span class="st">"feed_wide.csv"</span>)</span>
<span id="cb148-1404"><a href="#cb148-1404" aria-hidden="true" tabindex="-1"></a><span class="fu">write_csv</span>(treatments, <span class="st">"treatments.csv"</span>)</span>
<span id="cb148-1405"><a href="#cb148-1405" aria-hidden="true" tabindex="-1"></a><span class="fu">write_csv</span>(health, <span class="st">"health.csv"</span>)</span>
<span id="cb148-1406"><a href="#cb148-1406" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb148-1407"><a href="#cb148-1407" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-1408"><a href="#cb148-1408" aria-hidden="true" tabindex="-1"></a><span class="fu">### Part 2: Data Reshaping (25 points)</span></span>
<span id="cb148-1409"><a href="#cb148-1409" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-1410"><a href="#cb148-1410" aria-hidden="true" tabindex="-1"></a>**Task 1** (10 points): Reshape <span class="in">`feed_wide`</span> from wide to long format</span>
<span id="cb148-1411"><a href="#cb148-1411" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Create columns: <span class="in">`pig_id`</span>, <span class="in">`week`</span>, <span class="in">`feed_consumed_kg`</span></span>
<span id="cb148-1412"><a href="#cb148-1412" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Convert week to numeric (remove "week_" prefix and "_kg" suffix)</span>
<span id="cb148-1413"><a href="#cb148-1413" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Show first 10 rows</span>
<span id="cb148-1414"><a href="#cb148-1414" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-1415"><a href="#cb148-1415" aria-hidden="true" tabindex="-1"></a>**Task 2** (10 points): Create a summary table showing average feed by week</span>
<span id="cb148-1416"><a href="#cb148-1416" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Calculate mean feed consumed for each week</span>
<span id="cb148-1417"><a href="#cb148-1417" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Reshape to wide format where weeks are columns</span>
<span id="cb148-1418"><a href="#cb148-1418" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Add a "total" column with sum across weeks</span>
<span id="cb148-1419"><a href="#cb148-1419" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-1420"><a href="#cb148-1420" aria-hidden="true" tabindex="-1"></a>**Task 3** (5 points): In the <span class="in">`health`</span> dataset, separate <span class="in">`check_date`</span> into <span class="in">`year`</span>, <span class="in">`month`</span>, <span class="in">`day`</span></span>
<span id="cb148-1421"><a href="#cb148-1421" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-1422"><a href="#cb148-1422" aria-hidden="true" tabindex="-1"></a><span class="fu">### Part 3: Joining Datasets (30 points)</span></span>
<span id="cb148-1423"><a href="#cb148-1423" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-1424"><a href="#cb148-1424" aria-hidden="true" tabindex="-1"></a>**Task 1** (10 points): Create a master dataset</span>
<span id="cb148-1425"><a href="#cb148-1425" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Start with <span class="in">`pigs`</span></span>
<span id="cb148-1426"><a href="#cb148-1426" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Add treatment information (keep all pigs)</span>
<span id="cb148-1427"><a href="#cb148-1427" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Add the reshaped feed data (long format)</span>
<span id="cb148-1428"><a href="#cb148-1428" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Show structure and first 15 rows</span>
<span id="cb148-1429"><a href="#cb148-1429" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-1430"><a href="#cb148-1430" aria-hidden="true" tabindex="-1"></a>**Task 2** (10 points): Analyze which pigs DON'T have health records</span>
<span id="cb148-1431"><a href="#cb148-1431" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Use an appropriate filtering join</span>
<span id="cb148-1432"><a href="#cb148-1432" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Show pig_id, breed, and initial_weight_kg</span>
<span id="cb148-1433"><a href="#cb148-1433" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>How many pigs lack health records?</span>
<span id="cb148-1434"><a href="#cb148-1434" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-1435"><a href="#cb148-1435" aria-hidden="true" tabindex="-1"></a>**Task 3** (10 points): Create a complete cases dataset</span>
<span id="cb148-1436"><a href="#cb148-1436" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Only include pigs that have:</span>
<span id="cb148-1437"><a href="#cb148-1437" aria-hidden="true" tabindex="-1"></a><span class="ss">  - </span>Treatment assignments</span>
<span id="cb148-1438"><a href="#cb148-1438" aria-hidden="true" tabindex="-1"></a><span class="ss">  - </span>Feed records for all 4 weeks</span>
<span id="cb148-1439"><a href="#cb148-1439" aria-hidden="true" tabindex="-1"></a><span class="ss">  - </span>At least one health record</span>
<span id="cb148-1440"><a href="#cb148-1440" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>How many pigs remain?</span>
<span id="cb148-1441"><a href="#cb148-1441" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>What's the average initial weight?</span>
<span id="cb148-1442"><a href="#cb148-1442" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-1443"><a href="#cb148-1443" aria-hidden="true" tabindex="-1"></a><span class="fu">### Part 4: Complex Joins (20 points)</span></span>
<span id="cb148-1444"><a href="#cb148-1444" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-1445"><a href="#cb148-1445" aria-hidden="true" tabindex="-1"></a>**Task 1** (10 points): Calculate total feed consumption per pig</span>
<span id="cb148-1446"><a href="#cb148-1446" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Sum feed_consumed_kg across all weeks for each pig</span>
<span id="cb148-1447"><a href="#cb148-1447" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Join with pig information and treatment</span>
<span id="cb148-1448"><a href="#cb148-1448" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Create a table showing mean total feed by breed and treatment</span>
<span id="cb148-1449"><a href="#cb148-1449" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Which breed × treatment combination consumed most feed?</span>
<span id="cb148-1450"><a href="#cb148-1450" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-1451"><a href="#cb148-1451" aria-hidden="true" tabindex="-1"></a>**Task 2** (10 points): Identify treatment effects</span>
<span id="cb148-1452"><a href="#cb148-1452" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Calculate average health_score for each pig</span>
<span id="cb148-1453"><a href="#cb148-1453" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Join with treatment information</span>
<span id="cb148-1454"><a href="#cb148-1454" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Compare average health scores across treatments</span>
<span id="cb148-1455"><a href="#cb148-1455" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Create a visualization (boxplot or violin plot)</span>
<span id="cb148-1456"><a href="#cb148-1456" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-1457"><a href="#cb148-1457" aria-hidden="true" tabindex="-1"></a><span class="fu">### Part 5: Iteration with purrr (20 points)</span></span>
<span id="cb148-1458"><a href="#cb148-1458" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-1459"><a href="#cb148-1459" aria-hidden="true" tabindex="-1"></a>**Task 1** (10 points): Calculate summary statistics for each breed</span>
<span id="cb148-1460"><a href="#cb148-1460" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Nest data by breed</span>
<span id="cb148-1461"><a href="#cb148-1461" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Use <span class="in">`map()`</span> to calculate for each breed:</span>
<span id="cb148-1462"><a href="#cb148-1462" aria-hidden="true" tabindex="-1"></a><span class="ss">  - </span>Number of pigs</span>
<span id="cb148-1463"><a href="#cb148-1463" aria-hidden="true" tabindex="-1"></a><span class="ss">  - </span>Mean initial weight</span>
<span id="cb148-1464"><a href="#cb148-1464" aria-hidden="true" tabindex="-1"></a><span class="ss">  - </span>Mean total feed consumed (if you calculated it in Part 4)</span>
<span id="cb148-1465"><a href="#cb148-1465" aria-hidden="true" tabindex="-1"></a><span class="ss">  - </span>Mean health score (if available)</span>
<span id="cb148-1466"><a href="#cb148-1466" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Unnest results into a summary table</span>
<span id="cb148-1467"><a href="#cb148-1467" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-1468"><a href="#cb148-1468" aria-hidden="true" tabindex="-1"></a>**Task 2** (10 points): Fit models to nested data</span>
<span id="cb148-1469"><a href="#cb148-1469" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Nest feed data by pig_id</span>
<span id="cb148-1470"><a href="#cb148-1470" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Fit a linear model of feed_consumed_kg ~ week for each pig</span>
<span id="cb148-1471"><a href="#cb148-1471" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Extract the slope (growth rate of feed consumption)</span>
<span id="cb148-1472"><a href="#cb148-1472" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Which pig has the highest feed growth rate?</span>
<span id="cb148-1473"><a href="#cb148-1473" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Which breed has the highest average feed growth rate?</span>
<span id="cb148-1474"><a href="#cb148-1474" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-1475"><a href="#cb148-1475" aria-hidden="true" tabindex="-1"></a><span class="fu">### Part 6: Reflection (5 points)</span></span>
<span id="cb148-1476"><a href="#cb148-1476" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-1477"><a href="#cb148-1477" aria-hidden="true" tabindex="-1"></a>Write 200-300 words addressing:</span>
<span id="cb148-1478"><a href="#cb148-1478" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Which type of join did you use most and why?</span>
<span id="cb148-1479"><a href="#cb148-1479" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>What was the most challenging aspect of reshaping the data?</span>
<span id="cb148-1480"><a href="#cb148-1480" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>When did you choose <span class="in">`map()`</span> vs a loop (if at all)?</span>
<span id="cb148-1481"><a href="#cb148-1481" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>What insights did you discover about the pig feeding trial?</span>
<span id="cb148-1482"><a href="#cb148-1482" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-1483"><a href="#cb148-1483" aria-hidden="true" tabindex="-1"></a><span class="fu">### Recommended YAML</span></span>
<span id="cb148-1484"><a href="#cb148-1484" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-1485"><a href="#cb148-1485" aria-hidden="true" tabindex="-1"></a><span class="in">```yaml</span></span>
<span id="cb148-1486"><a href="#cb148-1486" aria-hidden="true" tabindex="-1"></a><span class="pp">---</span></span>
<span id="cb148-1487"><a href="#cb148-1487" aria-hidden="true" tabindex="-1"></a><span class="fu">title</span><span class="kw">:</span><span class="at"> </span><span class="st">"Week 7 Homework: Multi-Table Data Integration"</span></span>
<span id="cb148-1488"><a href="#cb148-1488" aria-hidden="true" tabindex="-1"></a><span class="fu">author</span><span class="kw">:</span><span class="at"> </span><span class="st">"Your Name"</span></span>
<span id="cb148-1489"><a href="#cb148-1489" aria-hidden="true" tabindex="-1"></a><span class="fu">date</span><span class="kw">:</span><span class="at"> today</span></span>
<span id="cb148-1490"><a href="#cb148-1490" aria-hidden="true" tabindex="-1"></a><span class="fu">format</span><span class="kw">:</span></span>
<span id="cb148-1491"><a href="#cb148-1491" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">html</span><span class="kw">:</span></span>
<span id="cb148-1492"><a href="#cb148-1492" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">toc</span><span class="kw">:</span><span class="at"> </span><span class="ch">true</span></span>
<span id="cb148-1493"><a href="#cb148-1493" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">toc-depth</span><span class="kw">:</span><span class="at"> </span><span class="dv">3</span></span>
<span id="cb148-1494"><a href="#cb148-1494" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">code-fold</span><span class="kw">:</span><span class="at"> </span><span class="ch">false</span></span>
<span id="cb148-1495"><a href="#cb148-1495" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">theme</span><span class="kw">:</span><span class="at"> cosmo</span></span>
<span id="cb148-1496"><a href="#cb148-1496" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">embed-resources</span><span class="kw">:</span><span class="at"> </span><span class="ch">true</span></span>
<span id="cb148-1497"><a href="#cb148-1497" aria-hidden="true" tabindex="-1"></a><span class="fu">execute</span><span class="kw">:</span></span>
<span id="cb148-1498"><a href="#cb148-1498" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">warning</span><span class="kw">:</span><span class="at"> </span><span class="ch">false</span></span>
<span id="cb148-1499"><a href="#cb148-1499" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">message</span><span class="kw">:</span><span class="at"> </span><span class="ch">false</span></span>
<span id="cb148-1500"><a href="#cb148-1500" aria-hidden="true" tabindex="-1"></a><span class="pp">---</span></span>
<span id="cb148-1501"><a href="#cb148-1501" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb148-1502"><a href="#cb148-1502" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-1503"><a href="#cb148-1503" aria-hidden="true" tabindex="-1"></a><span class="fu">### Grading Rubric</span></span>
<span id="cb148-1504"><a href="#cb148-1504" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-1505"><a href="#cb148-1505" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Part 2: Data Reshaping (25%)**</span>
<span id="cb148-1506"><a href="#cb148-1506" aria-hidden="true" tabindex="-1"></a><span class="ss">  - </span>Correct pivoting to long format (10%)</span>
<span id="cb148-1507"><a href="#cb148-1507" aria-hidden="true" tabindex="-1"></a><span class="ss">  - </span>Summary table correctly reshaped (10%)</span>
<span id="cb148-1508"><a href="#cb148-1508" aria-hidden="true" tabindex="-1"></a><span class="ss">  - </span>Date separation correct (5%)</span>
<span id="cb148-1509"><a href="#cb148-1509" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-1510"><a href="#cb148-1510" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Part 3: Joining Datasets (30%)**</span>
<span id="cb148-1511"><a href="#cb148-1511" aria-hidden="true" tabindex="-1"></a><span class="ss">  - </span>Master dataset correctly created (10%)</span>
<span id="cb148-1512"><a href="#cb148-1512" aria-hidden="true" tabindex="-1"></a><span class="ss">  - </span>Anti-join to find missing health records (10%)</span>
<span id="cb148-1513"><a href="#cb148-1513" aria-hidden="true" tabindex="-1"></a><span class="ss">  - </span>Complete cases filtering correct (10%)</span>
<span id="cb148-1514"><a href="#cb148-1514" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-1515"><a href="#cb148-1515" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Part 4: Complex Joins (20%)**</span>
<span id="cb148-1516"><a href="#cb148-1516" aria-hidden="true" tabindex="-1"></a><span class="ss">  - </span>Total feed calculation and table (10%)</span>
<span id="cb148-1517"><a href="#cb148-1517" aria-hidden="true" tabindex="-1"></a><span class="ss">  - </span>Treatment effects analysis (10%)</span>
<span id="cb148-1518"><a href="#cb148-1518" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-1519"><a href="#cb148-1519" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Part 5: Iteration with purrr (20%)**</span>
<span id="cb148-1520"><a href="#cb148-1520" aria-hidden="true" tabindex="-1"></a><span class="ss">  - </span>Nested summaries by breed (10%)</span>
<span id="cb148-1521"><a href="#cb148-1521" aria-hidden="true" tabindex="-1"></a><span class="ss">  - </span>Model fitting with map (10%)</span>
<span id="cb148-1522"><a href="#cb148-1522" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-1523"><a href="#cb148-1523" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Part 6: Reflection (5%)**</span>
<span id="cb148-1524"><a href="#cb148-1524" aria-hidden="true" tabindex="-1"></a><span class="ss">  - </span>Thoughtful analysis of methods and insights</span>
<span id="cb148-1525"><a href="#cb148-1525" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-1526"><a href="#cb148-1526" aria-hidden="true" tabindex="-1"></a><span class="fu">### Bonus (+10 points)</span></span>
<span id="cb148-1527"><a href="#cb148-1527" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-1528"><a href="#cb148-1528" aria-hidden="true" tabindex="-1"></a><span class="ss">1. </span>Create a function that takes a pig_id and returns a plot of their feed consumption over time</span>
<span id="cb148-1529"><a href="#cb148-1529" aria-hidden="true" tabindex="-1"></a><span class="ss">2. </span>Use <span class="in">`map()`</span> to generate plots for all pigs in one breed</span>
<span id="cb148-1530"><a href="#cb148-1530" aria-hidden="true" tabindex="-1"></a><span class="ss">3. </span>Combine plots using patchwork (from Chapter 6)</span>
<span id="cb148-1531"><a href="#cb148-1531" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-1532"><a href="#cb148-1532" aria-hidden="true" tabindex="-1"></a>---</span>
<span id="cb148-1533"><a href="#cb148-1533" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-1534"><a href="#cb148-1534" aria-hidden="true" tabindex="-1"></a><span class="fu">## Additional Resources</span></span>
<span id="cb148-1535"><a href="#cb148-1535" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-1536"><a href="#cb148-1536" aria-hidden="true" tabindex="-1"></a><span class="fu">### Required Reading</span></span>
<span id="cb148-1537"><a href="#cb148-1537" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-1538"><a href="#cb148-1538" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span><span class="co">[</span><span class="ot">R for Data Science (2e)</span><span class="co">](https://r4ds.hadley.nz/)</span> - Chapters 19-21 (Joins, Tidy Data, Iteration)</span>
<span id="cb148-1539"><a href="#cb148-1539" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span><span class="co">[</span><span class="ot">tidyr documentation</span><span class="co">](https://tidyr.tidyverse.org/)</span></span>
<span id="cb148-1540"><a href="#cb148-1540" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span><span class="co">[</span><span class="ot">purrr documentation</span><span class="co">](https://purrr.tidyverse.org/)</span></span>
<span id="cb148-1541"><a href="#cb148-1541" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Wickham, H. (2014). "Tidy Data." *Journal of Statistical Software*, 59(10). <span class="co">[</span><span class="ot">Link</span><span class="co">](https://www.jstatsoft.org/article/view/v059i10)</span></span>
<span id="cb148-1542"><a href="#cb148-1542" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-1543"><a href="#cb148-1543" aria-hidden="true" tabindex="-1"></a><span class="fu">### Optional Reading</span></span>
<span id="cb148-1544"><a href="#cb148-1544" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-1545"><a href="#cb148-1545" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span><span class="co">[</span><span class="ot">Tidy Data Tutor</span><span class="co">](https://tidydatatutor.com/)</span> - Interactive visual guide</span>
<span id="cb148-1546"><a href="#cb148-1546" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span><span class="co">[</span><span class="ot">purrr tutorial</span><span class="co">](https://jennybc.github.io/purrr-tutorial/)</span> by Jenny Bryan</span>
<span id="cb148-1547"><a href="#cb148-1547" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span><span class="co">[</span><span class="ot">Relational Data chapter</span><span class="co">](https://r4ds.hadley.nz/joins.html)</span> from R4DS</span>
<span id="cb148-1548"><a href="#cb148-1548" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-1549"><a href="#cb148-1549" aria-hidden="true" tabindex="-1"></a><span class="fu">### Videos</span></span>
<span id="cb148-1550"><a href="#cb148-1550" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-1551"><a href="#cb148-1551" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>"Tidy Data and tidyr" by RStudio / Posit</span>
<span id="cb148-1552"><a href="#cb148-1552" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>"Iteration with purrr" by RStudio / Posit</span>
<span id="cb148-1553"><a href="#cb148-1553" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>"Row-oriented workflows" by Jenny Bryan</span>
<span id="cb148-1554"><a href="#cb148-1554" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-1555"><a href="#cb148-1555" aria-hidden="true" tabindex="-1"></a><span class="fu">### Cheat Sheets</span></span>
<span id="cb148-1556"><a href="#cb148-1556" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-1557"><a href="#cb148-1557" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span><span class="co">[</span><span class="ot">tidyr Cheat Sheet</span><span class="co">](https://rstudio.github.io/cheatsheets/tidyr.pdf)</span></span>
<span id="cb148-1558"><a href="#cb148-1558" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span><span class="co">[</span><span class="ot">purrr Cheat Sheet</span><span class="co">](https://rstudio.github.io/cheatsheets/purrr.pdf)</span></span>
<span id="cb148-1559"><a href="#cb148-1559" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span><span class="co">[</span><span class="ot">Data Import Cheat Sheet</span><span class="co">](https://rstudio.github.io/cheatsheets/data-import.pdf)</span></span>
<span id="cb148-1560"><a href="#cb148-1560" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-1561"><a href="#cb148-1561" aria-hidden="true" tabindex="-1"></a><span class="fu">### Interactive Learning</span></span>
<span id="cb148-1562"><a href="#cb148-1562" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-1563"><a href="#cb148-1563" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span><span class="co">[</span><span class="ot">RStudio Primers: Tidy Your Data</span><span class="co">](https://posit.cloud/learn/primers/4)</span></span>
<span id="cb148-1564"><a href="#cb148-1564" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span><span class="co">[</span><span class="ot">RStudio Primers: Iterate</span><span class="co">](https://posit.cloud/learn/primers/5)</span></span>
<span id="cb148-1565"><a href="#cb148-1565" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-1566"><a href="#cb148-1566" aria-hidden="true" tabindex="-1"></a><span class="fu">### Useful Websites</span></span>
<span id="cb148-1567"><a href="#cb148-1567" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-1568"><a href="#cb148-1568" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span><span class="co">[</span><span class="ot">Tidy Data Principles</span><span class="co">](https://tidyr.tidyverse.org/articles/tidy-data.html)</span></span>
<span id="cb148-1569"><a href="#cb148-1569" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span><span class="co">[</span><span class="ot">dplyr join vignette</span><span class="co">](https://dplyr.tidyverse.org/articles/two-table.html)</span></span>
<span id="cb148-1570"><a href="#cb148-1570" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span><span class="co">[</span><span class="ot">purrr GitHub</span><span class="co">](https://github.com/tidyverse/purrr)</span></span>
<span id="cb148-1571"><a href="#cb148-1571" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span><span class="co">[</span><span class="ot">Stack Overflow: tidyr tag</span><span class="co">](https://stackoverflow.com/questions/tagged/tidyr)</span></span>
<span id="cb148-1572"><a href="#cb148-1572" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-1573"><a href="#cb148-1573" aria-hidden="true" tabindex="-1"></a>---</span>
<span id="cb148-1574"><a href="#cb148-1574" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-1575"><a href="#cb148-1575" aria-hidden="true" tabindex="-1"></a>**Next Chapter**: <span class="co">[</span><span class="ot">Special Data Formats, Integration, and Course Wrap-up</span><span class="co">](ch08-special_formats.qmd)</span></span>
</code></pre></div><button title="Copy to Clipboard" class="code-copy-button" data-in-quarto-modal=""><i class="bi"></i></button></div>
</div></div></div></div></div>
</div> <!-- /content -->




</body></html>