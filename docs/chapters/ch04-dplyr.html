<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.8.24">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>4&nbsp; Data Manipulation with dplyr – Introduction to Data Science &amp; Statistics</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
html { -webkit-text-size-adjust: 100%; }
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<link href="../chapters/ch05-ggplot2_intro.html" rel="next">
<link href="../chapters/ch03-data_types_strings_dplyr.html" rel="prev">
<script src="../site_libs/quarto-html/quarto.js" type="module"></script>
<script src="../site_libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="../site_libs/quarto-html/axe/axe-check.js" type="module"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting-dc55a5b9e770e841cd82e46aadbfb9b0.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap-1aba93c23277590c02f57900b721ea1a.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<script src="../site_libs/quarto-diagram/mermaid.min.js"></script>
<script src="../site_libs/quarto-diagram/mermaid-init.js"></script>
<link href="../site_libs/quarto-diagram/mermaid.css" rel="stylesheet">


</head>

<body class="nav-sidebar docked quarto-light">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../chapters/ch01-foundations.html">Part 1: Introduction to Data Science</a></li><li class="breadcrumb-item"><a href="../chapters/ch04-dplyr.html"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Data Manipulation with dplyr</span></a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="Search" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation docked overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header sidebar-header-stacked">
      <a href="../index.html" class="sidebar-logo-link">
      </a>
    <div class="sidebar-title mb-0 py-0">
      <a href="../">Introduction to Data Science &amp; Statistics</a> 
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Welcome</span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true">
 <span class="menu-text">Part 1: Introduction to Data Science</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/ch01-foundations.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Foundations of Data Science &amp; Best Practices</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/ch02-r_rstudio_reading_data.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Getting Started with R, RStudio, and Reading Data</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/ch03-data_types_strings_dplyr.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Data Types, Strings, and Introduction to dplyr</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/ch04-dplyr.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Data Manipulation with dplyr</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/ch05-ggplot2_intro.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Introduction to Data Visualization with ggplot2</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/ch06-ggplot2_advanced.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Advanced ggplot2 and Multi-Panel Plots</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/ch07-tidyr_joins_purrr.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Data Reshaping, Joining, and Iteration</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/ch08-special_formats.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Special Data Formats, Integration, and Course Wrap-up</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="true">
 <span class="menu-text">Part 2: Introduction to Statistics</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/ch09-statistical_foundations.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">Week 9: Statistical Foundations and Study Design</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/ch10-descriptive_statistics.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">Week 10: Descriptive Statistics and Exploratory Data Analysis</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/ch11-probability_distributions.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">11</span>&nbsp; <span class="chapter-title">Week 11: Probability Distributions and Introduction to Inference</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/ch12-hypothesis_testing.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">12</span>&nbsp; <span class="chapter-title">Week 12: Hypothesis Testing Fundamentals</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/ch13-anova.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">13</span>&nbsp; <span class="chapter-title">Week 13: Analysis of Variance (ANOVA)</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/ch14-categorical_data.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">14</span>&nbsp; <span class="chapter-title">Week 14: Categorical Data Analysis</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/ch15-linear_regression.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">15</span>&nbsp; <span class="chapter-title">Week 15: Simple Linear Regression</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/ch16-multiple_regression.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">16</span>&nbsp; <span class="chapter-title">Week 16: Multiple Regression &amp; Course Integration</span></span></a>
  </div>
</li>
      </ul>
  </li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#learning-objectives" id="toc-learning-objectives" class="nav-link active" data-scroll-target="#learning-objectives"><span class="header-section-number">4.1</span> Learning Objectives</a></li>
  <li><a href="#introduction-to-dplyr-verbs" id="toc-introduction-to-dplyr-verbs" class="nav-link" data-scroll-target="#introduction-to-dplyr-verbs"><span class="header-section-number">4.2</span> Introduction to dplyr Verbs</a>
  <ul class="collapse">
  <li><a href="#the-five-main-dplyr-verbs" id="toc-the-five-main-dplyr-verbs" class="nav-link" data-scroll-target="#the-five-main-dplyr-verbs"><span class="header-section-number">4.2.1</span> The Five Main dplyr Verbs</a></li>
  </ul></li>
  <li><a href="#creating-and-modifying-variables-with-mutate" id="toc-creating-and-modifying-variables-with-mutate" class="nav-link" data-scroll-target="#creating-and-modifying-variables-with-mutate"><span class="header-section-number">4.3</span> Creating and Modifying Variables with <code>mutate()</code></a>
  <ul class="collapse">
  <li><a href="#basic-usage" id="toc-basic-usage" class="nav-link" data-scroll-target="#basic-usage"><span class="header-section-number">4.3.1</span> Basic Usage</a></li>
  <li><a href="#overwriting-existing-columns" id="toc-overwriting-existing-columns" class="nav-link" data-scroll-target="#overwriting-existing-columns"><span class="header-section-number">4.3.2</span> Overwriting Existing Columns</a></li>
  <li><a href="#using-new-columns-immediately" id="toc-using-new-columns-immediately" class="nav-link" data-scroll-target="#using-new-columns-immediately"><span class="header-section-number">4.3.3</span> Using New Columns Immediately</a></li>
  <li><a href="#useful-functions-inside-mutate" id="toc-useful-functions-inside-mutate" class="nav-link" data-scroll-target="#useful-functions-inside-mutate"><span class="header-section-number">4.3.4</span> Useful Functions Inside <code>mutate()</code></a></li>
  </ul></li>
  <li><a href="#conditional-operations" id="toc-conditional-operations" class="nav-link" data-scroll-target="#conditional-operations"><span class="header-section-number">4.4</span> Conditional Operations</a>
  <ul class="collapse">
  <li><a href="#simple-conditions-with-if_else" id="toc-simple-conditions-with-if_else" class="nav-link" data-scroll-target="#simple-conditions-with-if_else"><span class="header-section-number">4.4.1</span> Simple Conditions with <code>if_else()</code></a></li>
  <li><a href="#multiple-conditions-with-case_when" id="toc-multiple-conditions-with-case_when" class="nav-link" data-scroll-target="#multiple-conditions-with-case_when"><span class="header-section-number">4.4.2</span> Multiple Conditions with <code>case_when()</code></a></li>
  <li><a href="#real-world-example-creating-treatment-groups" id="toc-real-world-example-creating-treatment-groups" class="nav-link" data-scroll-target="#real-world-example-creating-treatment-groups"><span class="header-section-number">4.4.3</span> Real-World Example: Creating Treatment Groups</a></li>
  </ul></li>
  <li><a href="#sorting-data-with-arrange" id="toc-sorting-data-with-arrange" class="nav-link" data-scroll-target="#sorting-data-with-arrange"><span class="header-section-number">4.5</span> Sorting Data with <code>arrange()</code></a>
  <ul class="collapse">
  <li><a href="#basic-sorting" id="toc-basic-sorting" class="nav-link" data-scroll-target="#basic-sorting"><span class="header-section-number">4.5.1</span> Basic Sorting</a></li>
  <li><a href="#sorting-with-missing-values" id="toc-sorting-with-missing-values" class="nav-link" data-scroll-target="#sorting-with-missing-values"><span class="header-section-number">4.5.2</span> Sorting with Missing Values</a></li>
  </ul></li>
  <li><a href="#grouped-operations-with-group_by-and-summarise" id="toc-grouped-operations-with-group_by-and-summarise" class="nav-link" data-scroll-target="#grouped-operations-with-group_by-and-summarise"><span class="header-section-number">4.6</span> Grouped Operations with <code>group_by()</code> and <code>summarise()</code></a>
  <ul class="collapse">
  <li><a href="#understanding-group_by" id="toc-understanding-group_by" class="nav-link" data-scroll-target="#understanding-group_by"><span class="header-section-number">4.6.1</span> Understanding <code>group_by()</code></a></li>
  <li><a href="#summarizing-data-with-summarise" id="toc-summarizing-data-with-summarise" class="nav-link" data-scroll-target="#summarizing-data-with-summarise"><span class="header-section-number">4.6.2</span> Summarizing Data with <code>summarise()</code></a></li>
  <li><a href="#common-summary-functions" id="toc-common-summary-functions" class="nav-link" data-scroll-target="#common-summary-functions"><span class="header-section-number">4.6.3</span> Common Summary Functions</a></li>
  <li><a href="#grouping-by-multiple-variables" id="toc-grouping-by-multiple-variables" class="nav-link" data-scroll-target="#grouping-by-multiple-variables"><span class="header-section-number">4.6.4</span> Grouping by Multiple Variables</a></li>
  <li><a href="#multiple-summaries-at-once" id="toc-multiple-summaries-at-once" class="nav-link" data-scroll-target="#multiple-summaries-at-once"><span class="header-section-number">4.6.5</span> Multiple Summaries at Once</a></li>
  <li><a href="#filtering-on-grouped-data" id="toc-filtering-on-grouped-data" class="nav-link" data-scroll-target="#filtering-on-grouped-data"><span class="header-section-number">4.6.6</span> Filtering on Grouped Data</a></li>
  <li><a href="#mutating-on-grouped-data" id="toc-mutating-on-grouped-data" class="nav-link" data-scroll-target="#mutating-on-grouped-data"><span class="header-section-number">4.6.7</span> Mutating on Grouped Data</a></li>
  </ul></li>
  <li><a href="#helper-functions" id="toc-helper-functions" class="nav-link" data-scroll-target="#helper-functions"><span class="header-section-number">4.7</span> Helper Functions</a>
  <ul class="collapse">
  <li><a href="#counting-with-count" id="toc-counting-with-count" class="nav-link" data-scroll-target="#counting-with-count"><span class="header-section-number">4.7.1</span> Counting with <code>count()</code></a></li>
  <li><a href="#renaming-columns-with-rename" id="toc-renaming-columns-with-rename" class="nav-link" data-scroll-target="#renaming-columns-with-rename"><span class="header-section-number">4.7.2</span> Renaming Columns with <code>rename()</code></a></li>
  <li><a href="#reordering-columns-with-relocate" id="toc-reordering-columns-with-relocate" class="nav-link" data-scroll-target="#reordering-columns-with-relocate"><span class="header-section-number">4.7.3</span> Reordering Columns with <code>relocate()</code></a></li>
  </ul></li>
  <li><a href="#working-across-multiple-columns-with-across" id="toc-working-across-multiple-columns-with-across" class="nav-link" data-scroll-target="#working-across-multiple-columns-with-across"><span class="header-section-number">4.8</span> Working Across Multiple Columns with <code>across()</code></a>
  <ul class="collapse">
  <li><a href="#basic-usage-1" id="toc-basic-usage-1" class="nav-link" data-scroll-target="#basic-usage-1"><span class="header-section-number">4.8.1</span> Basic Usage</a></li>
  <li><a href="#selecting-columns-for-across" id="toc-selecting-columns-for-across" class="nav-link" data-scroll-target="#selecting-columns-for-across"><span class="header-section-number">4.8.2</span> Selecting Columns for <code>across()</code></a></li>
  <li><a href="#multiple-summaries-with-across" id="toc-multiple-summaries-with-across" class="nav-link" data-scroll-target="#multiple-summaries-with-across"><span class="header-section-number">4.8.3</span> Multiple Summaries with <code>across()</code></a></li>
  </ul></li>
  <li><a href="#handling-missing-data" id="toc-handling-missing-data" class="nav-link" data-scroll-target="#handling-missing-data"><span class="header-section-number">4.9</span> Handling Missing Data</a>
  <ul class="collapse">
  <li><a href="#detecting-missing-values" id="toc-detecting-missing-values" class="nav-link" data-scroll-target="#detecting-missing-values"><span class="header-section-number">4.9.1</span> Detecting Missing Values</a></li>
  <li><a href="#removing-missing-values-with-drop_na" id="toc-removing-missing-values-with-drop_na" class="nav-link" data-scroll-target="#removing-missing-values-with-drop_na"><span class="header-section-number">4.9.2</span> Removing Missing Values with <code>drop_na()</code></a></li>
  <li><a href="#replacing-missing-values-with-replace_na" id="toc-replacing-missing-values-with-replace_na" class="nav-link" data-scroll-target="#replacing-missing-values-with-replace_na"><span class="header-section-number">4.9.3</span> Replacing Missing Values with <code>replace_na()</code></a></li>
  <li><a href="#filling-missing-values-with-coalesce" id="toc-filling-missing-values-with-coalesce" class="nav-link" data-scroll-target="#filling-missing-values-with-coalesce"><span class="header-section-number">4.9.4</span> Filling Missing Values with <code>coalesce()</code></a></li>
  <li><a href="#handling-nas-in-calculations" id="toc-handling-nas-in-calculations" class="nav-link" data-scroll-target="#handling-nas-in-calculations"><span class="header-section-number">4.9.5</span> Handling NAs in Calculations</a></li>
  </ul></li>
  <li><a href="#window-functions" id="toc-window-functions" class="nav-link" data-scroll-target="#window-functions"><span class="header-section-number">4.10</span> Window Functions</a>
  <ul class="collapse">
  <li><a href="#ranking-functions" id="toc-ranking-functions" class="nav-link" data-scroll-target="#ranking-functions"><span class="header-section-number">4.10.1</span> Ranking Functions</a></li>
  <li><a href="#offset-functions-lag-and-lead" id="toc-offset-functions-lag-and-lead" class="nav-link" data-scroll-target="#offset-functions-lag-and-lead"><span class="header-section-number">4.10.2</span> Offset Functions: <code>lag()</code> and <code>lead()</code></a></li>
  <li><a href="#cumulative-functions" id="toc-cumulative-functions" class="nav-link" data-scroll-target="#cumulative-functions"><span class="header-section-number">4.10.3</span> Cumulative Functions</a></li>
  <li><a href="#real-world-example-growth-rates" id="toc-real-world-example-growth-rates" class="nav-link" data-scroll-target="#real-world-example-growth-rates"><span class="header-section-number">4.10.4</span> Real-World Example: Growth Rates</a></li>
  </ul></li>
  <li><a href="#putting-it-all-together-complex-pipelines" id="toc-putting-it-all-together-complex-pipelines" class="nav-link" data-scroll-target="#putting-it-all-together-complex-pipelines"><span class="header-section-number">4.11</span> Putting It All Together: Complex Pipelines</a></li>
  <li><a href="#summary" id="toc-summary" class="nav-link" data-scroll-target="#summary"><span class="header-section-number">4.12</span> Summary</a></li>
  <li><a href="#homework-assignment" id="toc-homework-assignment" class="nav-link" data-scroll-target="#homework-assignment"><span class="header-section-number">4.13</span> Homework Assignment</a>
  <ul class="collapse">
  <li><a href="#assignment-data-transformation-and-analysis" id="toc-assignment-data-transformation-and-analysis" class="nav-link" data-scroll-target="#assignment-data-transformation-and-analysis"><span class="header-section-number">4.13.1</span> Assignment: Data Transformation and Analysis</a></li>
  <li><a href="#recommended-yaml" id="toc-recommended-yaml" class="nav-link" data-scroll-target="#recommended-yaml"><span class="header-section-number">4.13.2</span> Recommended YAML</a></li>
  <li><a href="#grading-rubric" id="toc-grading-rubric" class="nav-link" data-scroll-target="#grading-rubric"><span class="header-section-number">4.13.3</span> Grading Rubric</a></li>
  <li><a href="#bonus-10-points" id="toc-bonus-10-points" class="nav-link" data-scroll-target="#bonus-10-points"><span class="header-section-number">4.13.4</span> Bonus (10 points)</a></li>
  </ul></li>
  <li><a href="#additional-resources" id="toc-additional-resources" class="nav-link" data-scroll-target="#additional-resources"><span class="header-section-number">4.14</span> Additional Resources</a>
  <ul class="collapse">
  <li><a href="#required-reading" id="toc-required-reading" class="nav-link" data-scroll-target="#required-reading"><span class="header-section-number">4.14.1</span> Required Reading</a></li>
  <li><a href="#optional-reading" id="toc-optional-reading" class="nav-link" data-scroll-target="#optional-reading"><span class="header-section-number">4.14.2</span> Optional Reading</a></li>
  <li><a href="#videos" id="toc-videos" class="nav-link" data-scroll-target="#videos"><span class="header-section-number">4.14.3</span> Videos</a></li>
  <li><a href="#cheat-sheets" id="toc-cheat-sheets" class="nav-link" data-scroll-target="#cheat-sheets"><span class="header-section-number">4.14.4</span> Cheat Sheets</a></li>
  <li><a href="#interactive-learning" id="toc-interactive-learning" class="nav-link" data-scroll-target="#interactive-learning"><span class="header-section-number">4.14.5</span> Interactive Learning</a></li>
  <li><a href="#useful-websites" id="toc-useful-websites" class="nav-link" data-scroll-target="#useful-websites"><span class="header-section-number">4.14.6</span> Useful Websites</a></li>
  </ul></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default"><nav class="quarto-page-breadcrumbs quarto-title-breadcrumbs d-none d-lg-block" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../chapters/ch01-foundations.html">Part 1: Introduction to Data Science</a></li><li class="breadcrumb-item"><a href="../chapters/ch04-dplyr.html"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Data Manipulation with dplyr</span></a></li></ol></nav>
<div class="quarto-title">
<div class="quarto-title-block"><div><h1 class="title"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Data Manipulation with dplyr</span></h1><button type="button" class="btn code-tools-button" id="quarto-code-tools-source"><i class="bi"></i> Code</button></div></div>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<section id="learning-objectives" class="level2" data-number="4.1">
<h2 data-number="4.1" class="anchored" data-anchor-id="learning-objectives"><span class="header-section-number">4.1</span> Learning Objectives</h2>
<p>By the end of this chapter, you will be able to:</p>
<ol type="1">
<li>Create and modify variables using <code>dplyr::mutate()</code></li>
<li>Sort data using <code>dplyr::arrange()</code> in ascending and descending order</li>
<li>Calculate summary statistics using <code>dplyr::summarise()</code></li>
<li>Perform grouped operations with <code>group_by()</code> and <code>summarise()</code></li>
<li>Use helper functions: <code>count()</code>, <code>rename()</code>, and <code>relocate()</code></li>
<li>Apply conditional logic with <code>if_else()</code> and <code>case_when()</code></li>
<li>Work across multiple columns efficiently using <code>across()</code></li>
<li>Handle missing data with <code>is.na()</code>, <code>drop_na()</code>, <code>replace_na()</code>, and <code>coalesce()</code></li>
<li>Use window functions: <code>lag()</code>, <code>lead()</code>, <code>cumsum()</code>, and <code>row_number()</code></li>
<li>Chain multiple dplyr operations into complex data transformation pipelines</li>
</ol>
<hr>
</section>
<section id="introduction-to-dplyr-verbs" class="level2" data-number="4.2">
<h2 data-number="4.2" class="anchored" data-anchor-id="introduction-to-dplyr-verbs"><span class="header-section-number">4.2</span> Introduction to dplyr Verbs</h2>
<p>In the previous chapter, you learned <code>select()</code> and <code>filter()</code> for choosing columns and rows. This chapter covers the remaining core dplyr verbs that complete your data manipulation toolkit.</p>
<section id="the-five-main-dplyr-verbs" class="level3" data-number="4.2.1">
<h3 data-number="4.2.1" class="anchored" data-anchor-id="the-five-main-dplyr-verbs"><span class="header-section-number">4.2.1</span> The Five Main dplyr Verbs</h3>
<div class="cell" data-layout-align="default">
<div class="cell-output-display">
<div>
<p></p><figure class="figure"><p></p>
<div>
<pre class="mermaid mermaid-js">flowchart TD
    A[dplyr Verbs] --&gt; B[select&lt;br/&gt;Pick columns]
    A --&gt; C[filter&lt;br/&gt;Pick rows]
    A --&gt; D[mutate&lt;br/&gt;Create/modify columns]
    A --&gt; E[arrange&lt;br/&gt;Sort rows]
    A --&gt; F[summarise&lt;br/&gt;Calculate summaries]

    B --&gt; B1["select(animal_id, weight)"]
    C --&gt; C1["filter(weight &gt; 450)"]
    D --&gt; D1["mutate(bmi = weight/height)"]
    E --&gt; E1["arrange(weight)"]
    F --&gt; F1["summarise(mean_weight = mean(weight))"]
</pre>
</div>
<p></p></figure><p></p>
</div>
</div>
</div>
<p><strong>This chapter focuses on</strong>: <code>mutate()</code>, <code>arrange()</code>, <code>summarise()</code>, and <code>group_by()</code></p>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
<span class="screen-reader-only">Note</span>Review: Data Used in This Chapter
</div>
</div>
<div class="callout-body-container callout-body">
<p>We’ll use animal science datasets throughout. Make sure you have these packages loaded:</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)  <span class="co"># Includes dplyr, ggplot2, tidyr, etc.</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(lubridate)  <span class="co"># For dates</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
</div>
</div>
<hr>
</section>
</section>
<section id="creating-and-modifying-variables-with-mutate" class="level2" data-number="4.3">
<h2 data-number="4.3" class="anchored" data-anchor-id="creating-and-modifying-variables-with-mutate"><span class="header-section-number">4.3</span> Creating and Modifying Variables with <code>mutate()</code></h2>
<p><code>mutate()</code> <strong>creates new columns</strong> or <strong>modifies existing columns</strong> in your data frame.</p>
<section id="basic-usage" class="level3" data-number="4.3.1">
<h3 data-number="4.3.1" class="anchored" data-anchor-id="basic-usage"><span class="header-section-number">4.3.1</span> Basic Usage</h3>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Create example cattle data</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>cattle <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">animal_id =</span> <span class="fu">c</span>(<span class="st">"H001"</span>, <span class="st">"H002"</span>, <span class="st">"H003"</span>, <span class="st">"J001"</span>, <span class="st">"J002"</span>),</span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">breed =</span> <span class="fu">c</span>(<span class="st">"Holstein"</span>, <span class="st">"Holstein"</span>, <span class="st">"Holstein"</span>, <span class="st">"Jersey"</span>, <span class="st">"Jersey"</span>),</span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">weight_kg =</span> <span class="fu">c</span>(<span class="dv">600</span>, <span class="dv">625</span>, <span class="dv">580</span>, <span class="dv">450</span>, <span class="dv">470</span>),</span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">height_cm =</span> <span class="fu">c</span>(<span class="dv">145</span>, <span class="dv">148</span>, <span class="dv">142</span>, <span class="dv">130</span>, <span class="dv">133</span>),</span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">age_months =</span> <span class="fu">c</span>(<span class="dv">30</span>, <span class="dv">36</span>, <span class="dv">28</span>, <span class="dv">30</span>, <span class="dv">32</span>)</span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a>cattle</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 5 × 5
  animal_id breed    weight_kg height_cm age_months
  &lt;chr&gt;     &lt;chr&gt;        &lt;dbl&gt;     &lt;dbl&gt;      &lt;dbl&gt;
1 H001      Holstein       600       145         30
2 H002      Holstein       625       148         36
3 H003      Holstein       580       142         28
4 J001      Jersey         450       130         30
5 J002      Jersey         470       133         32</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Create new column: weight in pounds</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>cattle <span class="sc">%&gt;%</span></span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">weight_lb =</span> weight_kg <span class="sc">*</span> <span class="fl">2.20462</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 5 × 6
  animal_id breed    weight_kg height_cm age_months weight_lb
  &lt;chr&gt;     &lt;chr&gt;        &lt;dbl&gt;     &lt;dbl&gt;      &lt;dbl&gt;     &lt;dbl&gt;
1 H001      Holstein       600       145         30     1323.
2 H002      Holstein       625       148         36     1378.
3 H003      Holstein       580       142         28     1279.
4 J001      Jersey         450       130         30      992.
5 J002      Jersey         470       133         32     1036.</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Create multiple new columns</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>cattle <span class="sc">%&gt;%</span></span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">weight_lb =</span> weight_kg <span class="sc">*</span> <span class="fl">2.20462</span>,</span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">height_m =</span> height_cm <span class="sc">/</span> <span class="dv">100</span>,</span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">bmi =</span> weight_kg <span class="sc">/</span> (height_m<span class="sc">^</span><span class="dv">2</span>)</span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a>  )</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 5 × 8
  animal_id breed    weight_kg height_cm age_months weight_lb height_m   bmi
  &lt;chr&gt;     &lt;chr&gt;        &lt;dbl&gt;     &lt;dbl&gt;      &lt;dbl&gt;     &lt;dbl&gt;    &lt;dbl&gt; &lt;dbl&gt;
1 H001      Holstein       600       145         30     1323.     1.45  285.
2 H002      Holstein       625       148         36     1378.     1.48  285.
3 H003      Holstein       580       142         28     1279.     1.42  288.
4 J001      Jersey         450       130         30      992.     1.3   266.
5 J002      Jersey         470       133         32     1036.     1.33  266.</code></pre>
</div>
</div>
<div class="callout callout-style-default callout-important callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
<span class="screen-reader-only">Important</span><code>mutate()</code> Adds Columns, Doesn’t Replace Data
</div>
</div>
<div class="callout-body-container callout-body">
<p><code>mutate()</code> returns a <strong>new data frame</strong>. To keep changes, assign the result:</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="co"># ❌ Changes are lost</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>cattle <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">weight_lb =</span> weight_kg <span class="sc">*</span> <span class="fl">2.20462</span>)</span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a><span class="co"># ✅ Save the result</span></span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a>cattle <span class="ot">&lt;-</span> cattle <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">weight_lb =</span> weight_kg <span class="sc">*</span> <span class="fl">2.20462</span>)</span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a><span class="co"># OR</span></span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a>cattle_with_lb <span class="ot">&lt;-</span> cattle <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">weight_lb =</span> weight_kg <span class="sc">*</span> <span class="fl">2.20462</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
</div>
</div>
</section>
<section id="overwriting-existing-columns" class="level3" data-number="4.3.2">
<h3 data-number="4.3.2" class="anchored" data-anchor-id="overwriting-existing-columns"><span class="header-section-number">4.3.2</span> Overwriting Existing Columns</h3>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Modify existing column: convert breed to uppercase</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>cattle <span class="sc">%&gt;%</span></span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">breed =</span> <span class="fu">str_to_upper</span>(breed))</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 5 × 5
  animal_id breed    weight_kg height_cm age_months
  &lt;chr&gt;     &lt;chr&gt;        &lt;dbl&gt;     &lt;dbl&gt;      &lt;dbl&gt;
1 H001      HOLSTEIN       600       145         30
2 H002      HOLSTEIN       625       148         36
3 H003      HOLSTEIN       580       142         28
4 J001      JERSEY         450       130         30
5 J002      JERSEY         470       133         32</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Round weight to nearest 10 kg</span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>cattle <span class="sc">%&gt;%</span></span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">weight_kg =</span> <span class="fu">round</span>(weight_kg <span class="sc">/</span> <span class="dv">10</span>) <span class="sc">*</span> <span class="dv">10</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 5 × 5
  animal_id breed    weight_kg height_cm age_months
  &lt;chr&gt;     &lt;chr&gt;        &lt;dbl&gt;     &lt;dbl&gt;      &lt;dbl&gt;
1 H001      Holstein       600       145         30
2 H002      Holstein       620       148         36
3 H003      Holstein       580       142         28
4 J001      Jersey         450       130         30
5 J002      Jersey         470       133         32</code></pre>
</div>
</div>
</section>
<section id="using-new-columns-immediately" class="level3" data-number="4.3.3">
<h3 data-number="4.3.3" class="anchored" data-anchor-id="using-new-columns-immediately"><span class="header-section-number">4.3.3</span> Using New Columns Immediately</h3>
<p>You can reference newly created columns within the same <code>mutate()</code>:</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>cattle <span class="sc">%&gt;%</span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">height_m =</span> height_cm <span class="sc">/</span> <span class="dv">100</span>,       <span class="co"># Create height_m</span></span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">bmi =</span> weight_kg <span class="sc">/</span> (height_m<span class="sc">^</span><span class="dv">2</span>)    <span class="co"># Use height_m immediately!</span></span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a>  )</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 5 × 7
  animal_id breed    weight_kg height_cm age_months height_m   bmi
  &lt;chr&gt;     &lt;chr&gt;        &lt;dbl&gt;     &lt;dbl&gt;      &lt;dbl&gt;    &lt;dbl&gt; &lt;dbl&gt;
1 H001      Holstein       600       145         30     1.45  285.
2 H002      Holstein       625       148         36     1.48  285.
3 H003      Holstein       580       142         28     1.42  288.
4 J001      Jersey         450       130         30     1.3   266.
5 J002      Jersey         470       133         32     1.33  266.</code></pre>
</div>
</div>
</section>
<section id="useful-functions-inside-mutate" class="level3" data-number="4.3.4">
<h3 data-number="4.3.4" class="anchored" data-anchor-id="useful-functions-inside-mutate"><span class="header-section-number">4.3.4</span> Useful Functions Inside <code>mutate()</code></h3>
<p>Common operations you’ll use with <code>mutate()</code>:</p>
<table class="caption-top table">
<colgroup>
<col style="width: 36%">
<col style="width: 33%">
<col style="width: 30%">
</colgroup>
<thead>
<tr class="header">
<th>Operation</th>
<th>Function</th>
<th>Example</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Math</td>
<td><code>+</code>, <code>-</code>, <code>*</code>, <code>/</code>, <code>^</code></td>
<td><code>weight_kg * 2.20462</code></td>
</tr>
<tr class="even">
<td>Rounding</td>
<td><code>round()</code>, <code>floor()</code>, <code>ceiling()</code></td>
<td><code>round(weight, 1)</code></td>
</tr>
<tr class="odd">
<td>Logarithms</td>
<td><code>log()</code>, <code>log10()</code>, <code>exp()</code></td>
<td><code>log(concentration)</code></td>
</tr>
<tr class="even">
<td>Ranking</td>
<td><code>min_rank()</code>, <code>dense_rank()</code></td>
<td><code>min_rank(desc(weight))</code></td>
</tr>
<tr class="odd">
<td>String functions</td>
<td><code>str_*()</code></td>
<td><code>str_to_upper(breed)</code></td>
</tr>
<tr class="even">
<td>Date functions</td>
<td><code>year()</code>, <code>month()</code>, <code>day()</code></td>
<td><code>year(birth_date)</code></td>
</tr>
<tr class="odd">
<td>Conditional</td>
<td><code>if_else()</code>, <code>case_when()</code></td>
<td><code>if_else(weight &gt; 500, "Heavy", "Light")</code></td>
</tr>
</tbody>
</table>
<hr>
</section>
</section>
<section id="conditional-operations" class="level2" data-number="4.4">
<h2 data-number="4.4" class="anchored" data-anchor-id="conditional-operations"><span class="header-section-number">4.4</span> Conditional Operations</h2>
<section id="simple-conditions-with-if_else" class="level3" data-number="4.4.1">
<h3 data-number="4.4.1" class="anchored" data-anchor-id="simple-conditions-with-if_else"><span class="header-section-number">4.4.1</span> Simple Conditions with <code>if_else()</code></h3>
<p><code>if_else()</code> creates values based on a TRUE/FALSE condition:</p>
<p><strong>Syntax</strong>: <code>if_else(condition, value_if_true, value_if_false)</code></p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Classify animals as heavy or light</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>cattle <span class="sc">%&gt;%</span></span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">weight_class =</span> <span class="fu">if_else</span>(weight_kg <span class="sc">&gt;</span> <span class="dv">500</span>, <span class="st">"Heavy"</span>, <span class="st">"Light"</span>)</span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a>  )</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 5 × 6
  animal_id breed    weight_kg height_cm age_months weight_class
  &lt;chr&gt;     &lt;chr&gt;        &lt;dbl&gt;     &lt;dbl&gt;      &lt;dbl&gt; &lt;chr&gt;       
1 H001      Holstein       600       145         30 Heavy       
2 H002      Holstein       625       148         36 Heavy       
3 H003      Holstein       580       142         28 Heavy       
4 J001      Jersey         450       130         30 Light       
5 J002      Jersey         470       133         32 Light       </code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Create logical column</span></span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>cattle <span class="sc">%&gt;%</span></span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">is_mature =</span> <span class="fu">if_else</span>(age_months <span class="sc">&gt;=</span> <span class="dv">30</span>, <span class="cn">TRUE</span>, <span class="cn">FALSE</span>)</span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a>  )</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 5 × 6
  animal_id breed    weight_kg height_cm age_months is_mature
  &lt;chr&gt;     &lt;chr&gt;        &lt;dbl&gt;     &lt;dbl&gt;      &lt;dbl&gt; &lt;lgl&gt;    
1 H001      Holstein       600       145         30 TRUE     
2 H002      Holstein       625       148         36 TRUE     
3 H003      Holstein       580       142         28 FALSE    
4 J001      Jersey         450       130         30 TRUE     
5 J002      Jersey         470       133         32 TRUE     </code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Can use existing values</span></span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>cattle <span class="sc">%&gt;%</span></span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">adjusted_weight =</span> <span class="fu">if_else</span>(breed <span class="sc">==</span> <span class="st">"Jersey"</span>,</span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a>                              weight_kg <span class="sc">*</span> <span class="fl">1.1</span>,  <span class="co"># Boost Jersey weights by 10%</span></span>
<span id="cb19-6"><a href="#cb19-6" aria-hidden="true" tabindex="-1"></a>                              weight_kg)        <span class="co"># Keep others same</span></span>
<span id="cb19-7"><a href="#cb19-7" aria-hidden="true" tabindex="-1"></a>  )</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 5 × 6
  animal_id breed    weight_kg height_cm age_months adjusted_weight
  &lt;chr&gt;     &lt;chr&gt;        &lt;dbl&gt;     &lt;dbl&gt;      &lt;dbl&gt;           &lt;dbl&gt;
1 H001      Holstein       600       145         30             600
2 H002      Holstein       625       148         36             625
3 H003      Holstein       580       142         28             580
4 J001      Jersey         450       130         30             495
5 J002      Jersey         470       133         32             517</code></pre>
</div>
</div>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
<span class="screen-reader-only">Tip</span><code>if_else()</code> vs base R <code>ifelse()</code>
</div>
</div>
<div class="callout-body-container callout-body">
<p>dplyr’s <code>if_else()</code> is stricter and safer than base R’s <code>ifelse()</code>:</p>
<ul>
<li><strong>Type safety</strong>: Both true and false values must be the same type</li>
<li><strong>NA handling</strong>: Explicit <code>missing</code> argument for NA values</li>
<li><strong>Speed</strong>: Faster for large datasets</li>
</ul>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="co"># ✅ Good (both character)</span></span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a><span class="fu">if_else</span>(condition, <span class="st">"yes"</span>, <span class="st">"no"</span>)</span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a><span class="co"># ❌ Error (different types)</span></span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a><span class="fu">if_else</span>(condition, <span class="st">"yes"</span>, <span class="dv">0</span>)</span>
<span id="cb21-6"><a href="#cb21-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-7"><a href="#cb21-7" aria-hidden="true" tabindex="-1"></a><span class="co"># ✅ With NAs</span></span>
<span id="cb21-8"><a href="#cb21-8" aria-hidden="true" tabindex="-1"></a><span class="fu">if_else</span>(condition, <span class="st">"yes"</span>, <span class="st">"no"</span>, <span class="at">missing =</span> <span class="st">"unknown"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
</div>
</div>
</section>
<section id="multiple-conditions-with-case_when" class="level3" data-number="4.4.2">
<h3 data-number="4.4.2" class="anchored" data-anchor-id="multiple-conditions-with-case_when"><span class="header-section-number">4.4.2</span> Multiple Conditions with <code>case_when()</code></h3>
<p>For multiple conditions, use <code>case_when()</code>:</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Classify into three weight categories</span></span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>cattle <span class="sc">%&gt;%</span></span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">weight_category =</span> <span class="fu">case_when</span>(</span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a>      weight_kg <span class="sc">&lt;</span> <span class="dv">500</span> <span class="sc">~</span> <span class="st">"Light"</span>,</span>
<span id="cb22-6"><a href="#cb22-6" aria-hidden="true" tabindex="-1"></a>      weight_kg <span class="sc">&lt;</span> <span class="dv">600</span> <span class="sc">~</span> <span class="st">"Medium"</span>,</span>
<span id="cb22-7"><a href="#cb22-7" aria-hidden="true" tabindex="-1"></a>      weight_kg <span class="sc">&gt;=</span> <span class="dv">600</span> <span class="sc">~</span> <span class="st">"Heavy"</span></span>
<span id="cb22-8"><a href="#cb22-8" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb22-9"><a href="#cb22-9" aria-hidden="true" tabindex="-1"></a>  )</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 5 × 6
  animal_id breed    weight_kg height_cm age_months weight_category
  &lt;chr&gt;     &lt;chr&gt;        &lt;dbl&gt;     &lt;dbl&gt;      &lt;dbl&gt; &lt;chr&gt;          
1 H001      Holstein       600       145         30 Heavy          
2 H002      Holstein       625       148         36 Heavy          
3 H003      Holstein       580       142         28 Medium         
4 J001      Jersey         450       130         30 Light          
5 J002      Jersey         470       133         32 Light          </code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Multiple factors</span></span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a>cattle <span class="sc">%&gt;%</span></span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">category =</span> <span class="fu">case_when</span>(</span>
<span id="cb24-5"><a href="#cb24-5" aria-hidden="true" tabindex="-1"></a>      breed <span class="sc">==</span> <span class="st">"Jersey"</span> <span class="sc">&amp;</span> weight_kg <span class="sc">&gt;</span> <span class="dv">450</span> <span class="sc">~</span> <span class="st">"Large Jersey"</span>,</span>
<span id="cb24-6"><a href="#cb24-6" aria-hidden="true" tabindex="-1"></a>      breed <span class="sc">==</span> <span class="st">"Jersey"</span> <span class="sc">&amp;</span> weight_kg <span class="sc">&lt;=</span> <span class="dv">450</span> <span class="sc">~</span> <span class="st">"Small Jersey"</span>,</span>
<span id="cb24-7"><a href="#cb24-7" aria-hidden="true" tabindex="-1"></a>      breed <span class="sc">==</span> <span class="st">"Holstein"</span> <span class="sc">&amp;</span> weight_kg <span class="sc">&gt;</span> <span class="dv">600</span> <span class="sc">~</span> <span class="st">"Large Holstein"</span>,</span>
<span id="cb24-8"><a href="#cb24-8" aria-hidden="true" tabindex="-1"></a>      breed <span class="sc">==</span> <span class="st">"Holstein"</span> <span class="sc">&amp;</span> weight_kg <span class="sc">&lt;=</span> <span class="dv">600</span> <span class="sc">~</span> <span class="st">"Small Holstein"</span>,</span>
<span id="cb24-9"><a href="#cb24-9" aria-hidden="true" tabindex="-1"></a>      <span class="cn">TRUE</span> <span class="sc">~</span> <span class="st">"Other"</span>  <span class="co"># Catch-all (like "else")</span></span>
<span id="cb24-10"><a href="#cb24-10" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb24-11"><a href="#cb24-11" aria-hidden="true" tabindex="-1"></a>  )</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 5 × 6
  animal_id breed    weight_kg height_cm age_months category      
  &lt;chr&gt;     &lt;chr&gt;        &lt;dbl&gt;     &lt;dbl&gt;      &lt;dbl&gt; &lt;chr&gt;         
1 H001      Holstein       600       145         30 Small Holstein
2 H002      Holstein       625       148         36 Large Holstein
3 H003      Holstein       580       142         28 Small Holstein
4 J001      Jersey         450       130         30 Small Jersey  
5 J002      Jersey         470       133         32 Large Jersey  </code></pre>
</div>
</div>
<p><strong>How <code>case_when()</code> works</strong>: 1. Evaluates conditions <strong>in order from top to bottom</strong> 2. Returns the value (<code>~</code> right side) for the <strong>first TRUE condition</strong> 3. Stops checking once a match is found 4. Use <code>TRUE ~ value</code> as a catch-all for everything else</p>
<div class="callout callout-style-default callout-warning callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
<span class="screen-reader-only">Warning</span>Order Matters in <code>case_when()</code>!
</div>
</div>
<div class="callout-body-container callout-body">
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb26"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="co"># ❌ WRONG: Everything becomes "Heavy"</span></span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a>cattle <span class="sc">%&gt;%</span></span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb26-4"><a href="#cb26-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">wrong =</span> <span class="fu">case_when</span>(</span>
<span id="cb26-5"><a href="#cb26-5" aria-hidden="true" tabindex="-1"></a>      weight_kg <span class="sc">&gt;</span> <span class="dv">0</span> <span class="sc">~</span> <span class="st">"Heavy"</span>,      <span class="co"># This matches EVERYTHING!</span></span>
<span id="cb26-6"><a href="#cb26-6" aria-hidden="true" tabindex="-1"></a>      weight_kg <span class="sc">&gt;</span> <span class="dv">500</span> <span class="sc">~</span> <span class="st">"Medium"</span>,   <span class="co"># Never reached</span></span>
<span id="cb26-7"><a href="#cb26-7" aria-hidden="true" tabindex="-1"></a>      <span class="cn">TRUE</span> <span class="sc">~</span> <span class="st">"Light"</span>                <span class="co"># Never reached</span></span>
<span id="cb26-8"><a href="#cb26-8" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb26-9"><a href="#cb26-9" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb26-10"><a href="#cb26-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(animal_id, weight_kg, wrong)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 5 × 3
  animal_id weight_kg wrong
  &lt;chr&gt;         &lt;dbl&gt; &lt;chr&gt;
1 H001            600 Heavy
2 H002            625 Heavy
3 H003            580 Heavy
4 J001            450 Heavy
5 J002            470 Heavy</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb28"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="co"># ✅ CORRECT: Specific conditions first</span></span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a>cattle <span class="sc">%&gt;%</span></span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">correct =</span> <span class="fu">case_when</span>(</span>
<span id="cb28-5"><a href="#cb28-5" aria-hidden="true" tabindex="-1"></a>      weight_kg <span class="sc">&gt;</span> <span class="dv">600</span> <span class="sc">~</span> <span class="st">"Heavy"</span>,</span>
<span id="cb28-6"><a href="#cb28-6" aria-hidden="true" tabindex="-1"></a>      weight_kg <span class="sc">&gt;</span> <span class="dv">500</span> <span class="sc">~</span> <span class="st">"Medium"</span>,</span>
<span id="cb28-7"><a href="#cb28-7" aria-hidden="true" tabindex="-1"></a>      <span class="cn">TRUE</span> <span class="sc">~</span> <span class="st">"Light"</span></span>
<span id="cb28-8"><a href="#cb28-8" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb28-9"><a href="#cb28-9" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb28-10"><a href="#cb28-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(animal_id, weight_kg, correct)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 5 × 3
  animal_id weight_kg correct
  &lt;chr&gt;         &lt;dbl&gt; &lt;chr&gt;  
1 H001            600 Medium 
2 H002            625 Heavy  
3 H003            580 Medium 
4 J001            450 Light  
5 J002            470 Light  </code></pre>
</div>
</div>
<p><strong>Rule</strong>: Put specific conditions before general ones!</p>
</div>
</div>
</section>
<section id="real-world-example-creating-treatment-groups" class="level3" data-number="4.4.3">
<h3 data-number="4.4.3" class="anchored" data-anchor-id="real-world-example-creating-treatment-groups"><span class="header-section-number">4.4.3</span> Real-World Example: Creating Treatment Groups</h3>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb30"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Create feed trial data</span></span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a>feed_trial <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">animal_id =</span> <span class="fu">sprintf</span>(<span class="st">"A%03d"</span>, <span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>),</span>
<span id="cb30-4"><a href="#cb30-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">baseline_weight =</span> <span class="fu">c</span>(<span class="dv">450</span>, <span class="dv">480</span>, <span class="dv">445</span>, <span class="dv">490</span>, <span class="dv">455</span>, <span class="dv">470</span>, <span class="dv">460</span>, <span class="dv">475</span>, <span class="dv">465</span>, <span class="dv">485</span>),</span>
<span id="cb30-5"><a href="#cb30-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">age_months =</span> <span class="fu">c</span>(<span class="dv">24</span>, <span class="dv">30</span>, <span class="dv">22</span>, <span class="dv">32</span>, <span class="dv">26</span>, <span class="dv">28</span>, <span class="dv">24</span>, <span class="dv">30</span>, <span class="dv">26</span>, <span class="dv">31</span>),</span>
<span id="cb30-6"><a href="#cb30-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">sex =</span> <span class="fu">c</span>(<span class="st">"F"</span>, <span class="st">"F"</span>, <span class="st">"M"</span>, <span class="st">"F"</span>, <span class="st">"M"</span>, <span class="st">"F"</span>, <span class="st">"F"</span>, <span class="st">"M"</span>, <span class="st">"F"</span>, <span class="st">"M"</span>)</span>
<span id="cb30-7"><a href="#cb30-7" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb30-8"><a href="#cb30-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-9"><a href="#cb30-9" aria-hidden="true" tabindex="-1"></a>feed_trial</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 10 × 4
   animal_id baseline_weight age_months sex  
   &lt;chr&gt;               &lt;dbl&gt;      &lt;dbl&gt; &lt;chr&gt;
 1 A001                  450         24 F    
 2 A002                  480         30 F    
 3 A003                  445         22 M    
 4 A004                  490         32 F    
 5 A005                  455         26 M    
 6 A006                  470         28 F    
 7 A007                  460         24 F    
 8 A008                  475         30 M    
 9 A009                  465         26 F    
10 A010                  485         31 M    </code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb32"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Assign animals to treatment groups based on multiple factors</span></span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a>feed_trial_assigned <span class="ot">&lt;-</span> feed_trial <span class="sc">%&gt;%</span></span>
<span id="cb32-3"><a href="#cb32-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb32-4"><a href="#cb32-4" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Age category</span></span>
<span id="cb32-5"><a href="#cb32-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">age_group =</span> <span class="fu">case_when</span>(</span>
<span id="cb32-6"><a href="#cb32-6" aria-hidden="true" tabindex="-1"></a>      age_months <span class="sc">&lt;</span> <span class="dv">26</span> <span class="sc">~</span> <span class="st">"Young"</span>,</span>
<span id="cb32-7"><a href="#cb32-7" aria-hidden="true" tabindex="-1"></a>      age_months <span class="sc">&lt;=</span> <span class="dv">30</span> <span class="sc">~</span> <span class="st">"Adult"</span>,</span>
<span id="cb32-8"><a href="#cb32-8" aria-hidden="true" tabindex="-1"></a>      <span class="cn">TRUE</span> <span class="sc">~</span> <span class="st">"Mature"</span></span>
<span id="cb32-9"><a href="#cb32-9" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb32-10"><a href="#cb32-10" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Weight category</span></span>
<span id="cb32-11"><a href="#cb32-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">weight_group =</span> <span class="fu">if_else</span>(baseline_weight <span class="sc">&gt;</span> <span class="dv">470</span>, <span class="st">"Heavy"</span>, <span class="st">"Light"</span>),</span>
<span id="cb32-12"><a href="#cb32-12" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Treatment assignment (balanced by sex and weight)</span></span>
<span id="cb32-13"><a href="#cb32-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">treatment =</span> <span class="fu">case_when</span>(</span>
<span id="cb32-14"><a href="#cb32-14" aria-hidden="true" tabindex="-1"></a>      sex <span class="sc">==</span> <span class="st">"F"</span> <span class="sc">&amp;</span> baseline_weight <span class="sc">&gt;</span> <span class="dv">470</span> <span class="sc">~</span> <span class="st">"A"</span>,</span>
<span id="cb32-15"><a href="#cb32-15" aria-hidden="true" tabindex="-1"></a>      sex <span class="sc">==</span> <span class="st">"F"</span> <span class="sc">&amp;</span> baseline_weight <span class="sc">&lt;=</span> <span class="dv">470</span> <span class="sc">~</span> <span class="st">"B"</span>,</span>
<span id="cb32-16"><a href="#cb32-16" aria-hidden="true" tabindex="-1"></a>      sex <span class="sc">==</span> <span class="st">"M"</span> <span class="sc">&amp;</span> baseline_weight <span class="sc">&gt;</span> <span class="dv">470</span> <span class="sc">~</span> <span class="st">"B"</span>,</span>
<span id="cb32-17"><a href="#cb32-17" aria-hidden="true" tabindex="-1"></a>      sex <span class="sc">==</span> <span class="st">"M"</span> <span class="sc">&amp;</span> baseline_weight <span class="sc">&lt;=</span> <span class="dv">470</span> <span class="sc">~</span> <span class="st">"A"</span></span>
<span id="cb32-18"><a href="#cb32-18" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb32-19"><a href="#cb32-19" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb32-20"><a href="#cb32-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-21"><a href="#cb32-21" aria-hidden="true" tabindex="-1"></a>feed_trial_assigned</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 10 × 7
   animal_id baseline_weight age_months sex   age_group weight_group treatment
   &lt;chr&gt;               &lt;dbl&gt;      &lt;dbl&gt; &lt;chr&gt; &lt;chr&gt;     &lt;chr&gt;        &lt;chr&gt;    
 1 A001                  450         24 F     Young     Light        B        
 2 A002                  480         30 F     Adult     Heavy        A        
 3 A003                  445         22 M     Young     Light        A        
 4 A004                  490         32 F     Mature    Heavy        A        
 5 A005                  455         26 M     Adult     Light        A        
 6 A006                  470         28 F     Adult     Light        B        
 7 A007                  460         24 F     Young     Light        B        
 8 A008                  475         30 M     Adult     Heavy        B        
 9 A009                  465         26 F     Adult     Light        B        
10 A010                  485         31 M     Mature    Heavy        B        </code></pre>
</div>
</div>
<hr>
</section>
</section>
<section id="sorting-data-with-arrange" class="level2" data-number="4.5">
<h2 data-number="4.5" class="anchored" data-anchor-id="sorting-data-with-arrange"><span class="header-section-number">4.5</span> Sorting Data with <code>arrange()</code></h2>
<p><code>arrange()</code> <strong>sorts rows</strong> by one or more columns.</p>
<section id="basic-sorting" class="level3" data-number="4.5.1">
<h3 data-number="4.5.1" class="anchored" data-anchor-id="basic-sorting"><span class="header-section-number">4.5.1</span> Basic Sorting</h3>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb34"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Sort by weight (ascending, lightest first)</span></span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a>cattle <span class="sc">%&gt;%</span></span>
<span id="cb34-3"><a href="#cb34-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(weight_kg)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 5 × 5
  animal_id breed    weight_kg height_cm age_months
  &lt;chr&gt;     &lt;chr&gt;        &lt;dbl&gt;     &lt;dbl&gt;      &lt;dbl&gt;
1 J001      Jersey         450       130         30
2 J002      Jersey         470       133         32
3 H003      Holstein       580       142         28
4 H001      Holstein       600       145         30
5 H002      Holstein       625       148         36</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb36"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Sort by weight (descending, heaviest first)</span></span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a>cattle <span class="sc">%&gt;%</span></span>
<span id="cb36-3"><a href="#cb36-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(weight_kg))</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 5 × 5
  animal_id breed    weight_kg height_cm age_months
  &lt;chr&gt;     &lt;chr&gt;        &lt;dbl&gt;     &lt;dbl&gt;      &lt;dbl&gt;
1 H002      Holstein       625       148         36
2 H001      Holstein       600       145         30
3 H003      Holstein       580       142         28
4 J002      Jersey         470       133         32
5 J001      Jersey         450       130         30</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb38"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Sort by breed, then by weight within breed</span></span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a>cattle <span class="sc">%&gt;%</span></span>
<span id="cb38-3"><a href="#cb38-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(breed, weight_kg)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 5 × 5
  animal_id breed    weight_kg height_cm age_months
  &lt;chr&gt;     &lt;chr&gt;        &lt;dbl&gt;     &lt;dbl&gt;      &lt;dbl&gt;
1 H003      Holstein       580       142         28
2 H001      Holstein       600       145         30
3 H002      Holstein       625       148         36
4 J001      Jersey         450       130         30
5 J002      Jersey         470       133         32</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb40"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Sort by breed (ascending), weight (descending)</span></span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a>cattle <span class="sc">%&gt;%</span></span>
<span id="cb40-3"><a href="#cb40-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(breed, <span class="fu">desc</span>(weight_kg))</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 5 × 5
  animal_id breed    weight_kg height_cm age_months
  &lt;chr&gt;     &lt;chr&gt;        &lt;dbl&gt;     &lt;dbl&gt;      &lt;dbl&gt;
1 H002      Holstein       625       148         36
2 H001      Holstein       600       145         30
3 H003      Holstein       580       142         28
4 J002      Jersey         470       133         32
5 J001      Jersey         450       130         30</code></pre>
</div>
</div>
</section>
<section id="sorting-with-missing-values" class="level3" data-number="4.5.2">
<h3 data-number="4.5.2" class="anchored" data-anchor-id="sorting-with-missing-values"><span class="header-section-number">4.5.2</span> Sorting with Missing Values</h3>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb42"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Data with missing weights</span></span>
<span id="cb42-2"><a href="#cb42-2" aria-hidden="true" tabindex="-1"></a>cattle_na <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb42-3"><a href="#cb42-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">animal_id =</span> <span class="fu">c</span>(<span class="st">"H001"</span>, <span class="st">"H002"</span>, <span class="st">"H003"</span>, <span class="st">"H004"</span>, <span class="st">"H005"</span>),</span>
<span id="cb42-4"><a href="#cb42-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">weight_kg =</span> <span class="fu">c</span>(<span class="dv">600</span>, <span class="cn">NA</span>, <span class="dv">580</span>, <span class="dv">625</span>, <span class="cn">NA</span>)</span>
<span id="cb42-5"><a href="#cb42-5" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb42-6"><a href="#cb42-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-7"><a href="#cb42-7" aria-hidden="true" tabindex="-1"></a>cattle_na</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 5 × 2
  animal_id weight_kg
  &lt;chr&gt;         &lt;dbl&gt;
1 H001            600
2 H002             NA
3 H003            580
4 H004            625
5 H005             NA</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb44"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a><span class="co"># By default, NAs go to the end</span></span>
<span id="cb44-2"><a href="#cb44-2" aria-hidden="true" tabindex="-1"></a>cattle_na <span class="sc">%&gt;%</span></span>
<span id="cb44-3"><a href="#cb44-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(weight_kg)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 5 × 2
  animal_id weight_kg
  &lt;chr&gt;         &lt;dbl&gt;
1 H003            580
2 H001            600
3 H004            625
4 H002             NA
5 H005             NA</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb46"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Descending: NAs still at the end</span></span>
<span id="cb46-2"><a href="#cb46-2" aria-hidden="true" tabindex="-1"></a>cattle_na <span class="sc">%&gt;%</span></span>
<span id="cb46-3"><a href="#cb46-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(weight_kg))</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 5 × 2
  animal_id weight_kg
  &lt;chr&gt;         &lt;dbl&gt;
1 H004            625
2 H001            600
3 H003            580
4 H002             NA
5 H005             NA</code></pre>
</div>
</div>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
<span class="screen-reader-only">Tip</span>Use <code>arrange()</code> to Check Your Work
</div>
</div>
<div class="callout-body-container callout-body">
<p>When creating or modifying columns, sort to verify results:</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb48"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Did the weight classification work correctly?</span></span>
<span id="cb48-2"><a href="#cb48-2" aria-hidden="true" tabindex="-1"></a>cattle <span class="sc">%&gt;%</span></span>
<span id="cb48-3"><a href="#cb48-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">weight_class =</span> <span class="fu">if_else</span>(weight_kg <span class="sc">&gt;</span> <span class="dv">500</span>, <span class="st">"Heavy"</span>, <span class="st">"Light"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb48-4"><a href="#cb48-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(weight_kg) <span class="sc">%&gt;%</span></span>
<span id="cb48-5"><a href="#cb48-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(animal_id, weight_kg, weight_class)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 5 × 3
  animal_id weight_kg weight_class
  &lt;chr&gt;         &lt;dbl&gt; &lt;chr&gt;       
1 J001            450 Light       
2 J002            470 Light       
3 H003            580 Heavy       
4 H001            600 Heavy       
5 H002            625 Heavy       </code></pre>
</div>
</div>
<p>Sorting makes it easy to spot errors!</p>
</div>
</div>
<hr>
</section>
</section>
<section id="grouped-operations-with-group_by-and-summarise" class="level2" data-number="4.6">
<h2 data-number="4.6" class="anchored" data-anchor-id="grouped-operations-with-group_by-and-summarise"><span class="header-section-number">4.6</span> Grouped Operations with <code>group_by()</code> and <code>summarise()</code></h2>
<p>The real power of dplyr comes from <strong>grouped operations</strong>: calculating summaries for each group separately.</p>
<section id="understanding-group_by" class="level3" data-number="4.6.1">
<h3 data-number="4.6.1" class="anchored" data-anchor-id="understanding-group_by"><span class="header-section-number">4.6.1</span> Understanding <code>group_by()</code></h3>
<p><code>group_by()</code> doesn’t change your data—it adds invisible grouping information:</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb50"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Create farm data with multiple breeds and farms</span></span>
<span id="cb50-2"><a href="#cb50-2" aria-hidden="true" tabindex="-1"></a>farm_data <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb50-3"><a href="#cb50-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">animal_id =</span> <span class="fu">sprintf</span>(<span class="st">"A%03d"</span>, <span class="dv">1</span><span class="sc">:</span><span class="dv">12</span>),</span>
<span id="cb50-4"><a href="#cb50-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">breed =</span> <span class="fu">rep</span>(<span class="fu">c</span>(<span class="st">"Holstein"</span>, <span class="st">"Jersey"</span>, <span class="st">"Angus"</span>), <span class="at">each =</span> <span class="dv">4</span>),</span>
<span id="cb50-5"><a href="#cb50-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">farm =</span> <span class="fu">rep</span>(<span class="fu">c</span>(<span class="st">"North"</span>, <span class="st">"South"</span>), <span class="dv">6</span>),</span>
<span id="cb50-6"><a href="#cb50-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">weight_kg =</span> <span class="fu">c</span>(<span class="dv">600</span>, <span class="dv">620</span>, <span class="dv">590</span>, <span class="dv">610</span>, <span class="dv">450</span>, <span class="dv">470</span>, <span class="dv">455</span>, <span class="dv">465</span>,</span>
<span id="cb50-7"><a href="#cb50-7" aria-hidden="true" tabindex="-1"></a>                <span class="dv">550</span>, <span class="dv">570</span>, <span class="dv">540</span>, <span class="dv">560</span>)</span>
<span id="cb50-8"><a href="#cb50-8" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb50-9"><a href="#cb50-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-10"><a href="#cb50-10" aria-hidden="true" tabindex="-1"></a>farm_data</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 12 × 4
   animal_id breed    farm  weight_kg
   &lt;chr&gt;     &lt;chr&gt;    &lt;chr&gt;     &lt;dbl&gt;
 1 A001      Holstein North       600
 2 A002      Holstein South       620
 3 A003      Holstein North       590
 4 A004      Holstein South       610
 5 A005      Jersey   North       450
 6 A006      Jersey   South       470
 7 A007      Jersey   North       455
 8 A008      Jersey   South       465
 9 A009      Angus    North       550
10 A010      Angus    South       570
11 A011      Angus    North       540
12 A012      Angus    South       560</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb52"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Group by breed</span></span>
<span id="cb52-2"><a href="#cb52-2" aria-hidden="true" tabindex="-1"></a>farm_data <span class="sc">%&gt;%</span></span>
<span id="cb52-3"><a href="#cb52-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(breed)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 12 × 4
# Groups:   breed [3]
   animal_id breed    farm  weight_kg
   &lt;chr&gt;     &lt;chr&gt;    &lt;chr&gt;     &lt;dbl&gt;
 1 A001      Holstein North       600
 2 A002      Holstein South       620
 3 A003      Holstein North       590
 4 A004      Holstein South       610
 5 A005      Jersey   North       450
 6 A006      Jersey   South       470
 7 A007      Jersey   North       455
 8 A008      Jersey   South       465
 9 A009      Angus    North       550
10 A010      Angus    South       570
11 A011      Angus    North       540
12 A012      Angus    South       560</code></pre>
</div>
</div>
<p>Notice: “Groups: breed [3]” in the output. The data looks the same, but it’s now grouped!</p>
</section>
<section id="summarizing-data-with-summarise" class="level3" data-number="4.6.2">
<h3 data-number="4.6.2" class="anchored" data-anchor-id="summarizing-data-with-summarise"><span class="header-section-number">4.6.2</span> Summarizing Data with <code>summarise()</code></h3>
<p><code>summarise()</code> (or <code>summarize()</code>) calculates summary statistics:</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb54"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Overall mean weight (no grouping)</span></span>
<span id="cb54-2"><a href="#cb54-2" aria-hidden="true" tabindex="-1"></a>farm_data <span class="sc">%&gt;%</span></span>
<span id="cb54-3"><a href="#cb54-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(</span>
<span id="cb54-4"><a href="#cb54-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">mean_weight =</span> <span class="fu">mean</span>(weight_kg),</span>
<span id="cb54-5"><a href="#cb54-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">sd_weight =</span> <span class="fu">sd</span>(weight_kg),</span>
<span id="cb54-6"><a href="#cb54-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">n =</span> <span class="fu">n</span>()  <span class="co"># n() counts rows</span></span>
<span id="cb54-7"><a href="#cb54-7" aria-hidden="true" tabindex="-1"></a>  )</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1 × 3
  mean_weight sd_weight     n
        &lt;dbl&gt;     &lt;dbl&gt; &lt;int&gt;
1         540      63.7    12</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb56"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb56-1"><a href="#cb56-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Mean weight BY BREED</span></span>
<span id="cb56-2"><a href="#cb56-2" aria-hidden="true" tabindex="-1"></a>farm_data <span class="sc">%&gt;%</span></span>
<span id="cb56-3"><a href="#cb56-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(breed) <span class="sc">%&gt;%</span></span>
<span id="cb56-4"><a href="#cb56-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(</span>
<span id="cb56-5"><a href="#cb56-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">mean_weight =</span> <span class="fu">mean</span>(weight_kg),</span>
<span id="cb56-6"><a href="#cb56-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">sd_weight =</span> <span class="fu">sd</span>(weight_kg),</span>
<span id="cb56-7"><a href="#cb56-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">n =</span> <span class="fu">n</span>()</span>
<span id="cb56-8"><a href="#cb56-8" aria-hidden="true" tabindex="-1"></a>  )</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 4
  breed    mean_weight sd_weight     n
  &lt;chr&gt;          &lt;dbl&gt;     &lt;dbl&gt; &lt;int&gt;
1 Angus            555     12.9      4
2 Holstein         605     12.9      4
3 Jersey           460      9.13     4</code></pre>
</div>
</div>
<div class="callout callout-style-default callout-important callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
<span class="screen-reader-only">Important</span>The <code>group_by()</code> + <code>summarise()</code> Pattern
</div>
</div>
<div class="callout-body-container callout-body">
<p>This is one of the most powerful patterns in data analysis:</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb58"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb58-1"><a href="#cb58-1" aria-hidden="true" tabindex="-1"></a>data <span class="sc">%&gt;%</span></span>
<span id="cb58-2"><a href="#cb58-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(category_column) <span class="sc">%&gt;%</span></span>
<span id="cb58-3"><a href="#cb58-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(</span>
<span id="cb58-4"><a href="#cb58-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">summary_name =</span> <span class="fu">summary_function</span>(numeric_column)</span>
<span id="cb58-5"><a href="#cb58-5" aria-hidden="true" tabindex="-1"></a>  )</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p><strong>Read as</strong>: “For each category, calculate the summary”</p>
</div>
</div>
</section>
<section id="common-summary-functions" class="level3" data-number="4.6.3">
<h3 data-number="4.6.3" class="anchored" data-anchor-id="common-summary-functions"><span class="header-section-number">4.6.3</span> Common Summary Functions</h3>
<table class="caption-top table">
<thead>
<tr class="header">
<th>Function</th>
<th>What it does</th>
<th>Example</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><code>mean()</code></td>
<td>Average</td>
<td><code>mean(weight)</code></td>
</tr>
<tr class="even">
<td><code>median()</code></td>
<td>Median (50th percentile)</td>
<td><code>median(weight)</code></td>
</tr>
<tr class="odd">
<td><code>sd()</code></td>
<td>Standard deviation</td>
<td><code>sd(weight)</code></td>
</tr>
<tr class="even">
<td><code>var()</code></td>
<td>Variance</td>
<td><code>var(weight)</code></td>
</tr>
<tr class="odd">
<td><code>min()</code></td>
<td>Minimum value</td>
<td><code>min(weight)</code></td>
</tr>
<tr class="even">
<td><code>max()</code></td>
<td>Maximum value</td>
<td><code>max(weight)</code></td>
</tr>
<tr class="odd">
<td><code>sum()</code></td>
<td>Sum of all values</td>
<td><code>sum(milk_yield)</code></td>
</tr>
<tr class="even">
<td><code>n()</code></td>
<td>Count of rows</td>
<td><code>n()</code></td>
</tr>
<tr class="odd">
<td><code>n_distinct()</code></td>
<td>Count unique values</td>
<td><code>n_distinct(animal_id)</code></td>
</tr>
<tr class="even">
<td><code>first()</code></td>
<td>First value</td>
<td><code>first(weight)</code></td>
</tr>
<tr class="odd">
<td><code>last()</code></td>
<td>Last value</td>
<td><code>last(weight)</code></td>
</tr>
</tbody>
</table>
</section>
<section id="grouping-by-multiple-variables" class="level3" data-number="4.6.4">
<h3 data-number="4.6.4" class="anchored" data-anchor-id="grouping-by-multiple-variables"><span class="header-section-number">4.6.4</span> Grouping by Multiple Variables</h3>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb59"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb59-1"><a href="#cb59-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Mean weight by breed AND farm</span></span>
<span id="cb59-2"><a href="#cb59-2" aria-hidden="true" tabindex="-1"></a>farm_data <span class="sc">%&gt;%</span></span>
<span id="cb59-3"><a href="#cb59-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(breed, farm) <span class="sc">%&gt;%</span></span>
<span id="cb59-4"><a href="#cb59-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(</span>
<span id="cb59-5"><a href="#cb59-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">mean_weight =</span> <span class="fu">mean</span>(weight_kg),</span>
<span id="cb59-6"><a href="#cb59-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">n =</span> <span class="fu">n</span>(),</span>
<span id="cb59-7"><a href="#cb59-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">.groups =</span> <span class="st">"drop"</span>  <span class="co"># Remove grouping after summarise</span></span>
<span id="cb59-8"><a href="#cb59-8" aria-hidden="true" tabindex="-1"></a>  )</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 × 4
  breed    farm  mean_weight     n
  &lt;chr&gt;    &lt;chr&gt;       &lt;dbl&gt; &lt;int&gt;
1 Angus    North        545      2
2 Angus    South        565      2
3 Holstein North        595      2
4 Holstein South        615      2
5 Jersey   North        452.     2
6 Jersey   South        468.     2</code></pre>
</div>
</div>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
<span class="screen-reader-only">Note</span>The <code>.groups</code> Argument
</div>
</div>
<div class="callout-body-container callout-body">
<p>After <code>summarise()</code>, data remains grouped by all but the last grouping variable. This can cause unexpected behavior!</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb61"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb61-1"><a href="#cb61-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Recommended: explicitly drop groups</span></span>
<span id="cb61-2"><a href="#cb61-2" aria-hidden="true" tabindex="-1"></a>data <span class="sc">%&gt;%</span></span>
<span id="cb61-3"><a href="#cb61-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(var1, var2) <span class="sc">%&gt;%</span></span>
<span id="cb61-4"><a href="#cb61-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">mean_x =</span> <span class="fu">mean</span>(x), <span class="at">.groups =</span> <span class="st">"drop"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p><strong>Options</strong>: - <code>.groups = "drop"</code>: Remove all grouping (recommended) - <code>.groups = "keep"</code>: Keep all grouping - <code>.groups = "drop_last"</code>: Drop last grouping variable (default)</p>
</div>
</div>
</section>
<section id="multiple-summaries-at-once" class="level3" data-number="4.6.5">
<h3 data-number="4.6.5" class="anchored" data-anchor-id="multiple-summaries-at-once"><span class="header-section-number">4.6.5</span> Multiple Summaries at Once</h3>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb62"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb62-1"><a href="#cb62-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Comprehensive summary by breed</span></span>
<span id="cb62-2"><a href="#cb62-2" aria-hidden="true" tabindex="-1"></a>farm_data <span class="sc">%&gt;%</span></span>
<span id="cb62-3"><a href="#cb62-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(breed) <span class="sc">%&gt;%</span></span>
<span id="cb62-4"><a href="#cb62-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(</span>
<span id="cb62-5"><a href="#cb62-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">n =</span> <span class="fu">n</span>(),</span>
<span id="cb62-6"><a href="#cb62-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">mean_weight =</span> <span class="fu">mean</span>(weight_kg),</span>
<span id="cb62-7"><a href="#cb62-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">sd_weight =</span> <span class="fu">sd</span>(weight_kg),</span>
<span id="cb62-8"><a href="#cb62-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">min_weight =</span> <span class="fu">min</span>(weight_kg),</span>
<span id="cb62-9"><a href="#cb62-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">max_weight =</span> <span class="fu">max</span>(weight_kg),</span>
<span id="cb62-10"><a href="#cb62-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">median_weight =</span> <span class="fu">median</span>(weight_kg),</span>
<span id="cb62-11"><a href="#cb62-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">.groups =</span> <span class="st">"drop"</span></span>
<span id="cb62-12"><a href="#cb62-12" aria-hidden="true" tabindex="-1"></a>  )</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 7
  breed        n mean_weight sd_weight min_weight max_weight median_weight
  &lt;chr&gt;    &lt;int&gt;       &lt;dbl&gt;     &lt;dbl&gt;      &lt;dbl&gt;      &lt;dbl&gt;         &lt;dbl&gt;
1 Angus        4         555     12.9         540        570           555
2 Holstein     4         605     12.9         590        620           605
3 Jersey       4         460      9.13        450        470           460</code></pre>
</div>
</div>
</section>
<section id="filtering-on-grouped-data" class="level3" data-number="4.6.6">
<h3 data-number="4.6.6" class="anchored" data-anchor-id="filtering-on-grouped-data"><span class="header-section-number">4.6.6</span> Filtering on Grouped Data</h3>
<p><code>filter()</code> works with groups too:</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb64"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb64-1"><a href="#cb64-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Keep only animals heavier than the breed average</span></span>
<span id="cb64-2"><a href="#cb64-2" aria-hidden="true" tabindex="-1"></a>farm_data <span class="sc">%&gt;%</span></span>
<span id="cb64-3"><a href="#cb64-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(breed) <span class="sc">%&gt;%</span></span>
<span id="cb64-4"><a href="#cb64-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(weight_kg <span class="sc">&gt;</span> <span class="fu">mean</span>(weight_kg)) <span class="sc">%&gt;%</span></span>
<span id="cb64-5"><a href="#cb64-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>()  <span class="co"># Remove grouping when done</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 × 4
  animal_id breed    farm  weight_kg
  &lt;chr&gt;     &lt;chr&gt;    &lt;chr&gt;     &lt;dbl&gt;
1 A002      Holstein South       620
2 A004      Holstein South       610
3 A006      Jersey   South       470
4 A008      Jersey   South       465
5 A010      Angus    South       570
6 A012      Angus    South       560</code></pre>
</div>
</div>
</section>
<section id="mutating-on-grouped-data" class="level3" data-number="4.6.7">
<h3 data-number="4.6.7" class="anchored" data-anchor-id="mutating-on-grouped-data"><span class="header-section-number">4.6.7</span> Mutating on Grouped Data</h3>
<p><code>mutate()</code> calculates within groups:</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb66"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb66-1"><a href="#cb66-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate deviation from breed mean</span></span>
<span id="cb66-2"><a href="#cb66-2" aria-hidden="true" tabindex="-1"></a>farm_data <span class="sc">%&gt;%</span></span>
<span id="cb66-3"><a href="#cb66-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(breed) <span class="sc">%&gt;%</span></span>
<span id="cb66-4"><a href="#cb66-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb66-5"><a href="#cb66-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">breed_mean =</span> <span class="fu">mean</span>(weight_kg),</span>
<span id="cb66-6"><a href="#cb66-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">deviation =</span> weight_kg <span class="sc">-</span> breed_mean</span>
<span id="cb66-7"><a href="#cb66-7" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb66-8"><a href="#cb66-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span></span>
<span id="cb66-9"><a href="#cb66-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(breed, animal_id)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 12 × 6
   animal_id breed    farm  weight_kg breed_mean deviation
   &lt;chr&gt;     &lt;chr&gt;    &lt;chr&gt;     &lt;dbl&gt;      &lt;dbl&gt;     &lt;dbl&gt;
 1 A009      Angus    North       550        555        -5
 2 A010      Angus    South       570        555        15
 3 A011      Angus    North       540        555       -15
 4 A012      Angus    South       560        555         5
 5 A001      Holstein North       600        605        -5
 6 A002      Holstein South       620        605        15
 7 A003      Holstein North       590        605       -15
 8 A004      Holstein South       610        605         5
 9 A005      Jersey   North       450        460       -10
10 A006      Jersey   South       470        460        10
11 A007      Jersey   North       455        460        -5
12 A008      Jersey   South       465        460         5</code></pre>
</div>
</div>
<hr>
</section>
</section>
<section id="helper-functions" class="level2" data-number="4.7">
<h2 data-number="4.7" class="anchored" data-anchor-id="helper-functions"><span class="header-section-number">4.7</span> Helper Functions</h2>
<section id="counting-with-count" class="level3" data-number="4.7.1">
<h3 data-number="4.7.1" class="anchored" data-anchor-id="counting-with-count"><span class="header-section-number">4.7.1</span> Counting with <code>count()</code></h3>
<p><code>count()</code> is a shortcut for <code>group_by()</code> + <code>summarise()</code> + <code>n()</code>:</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb68"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb68-1"><a href="#cb68-1" aria-hidden="true" tabindex="-1"></a><span class="co"># How many animals per breed?</span></span>
<span id="cb68-2"><a href="#cb68-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Long way</span></span>
<span id="cb68-3"><a href="#cb68-3" aria-hidden="true" tabindex="-1"></a>farm_data <span class="sc">%&gt;%</span></span>
<span id="cb68-4"><a href="#cb68-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(breed) <span class="sc">%&gt;%</span></span>
<span id="cb68-5"><a href="#cb68-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">n =</span> <span class="fu">n</span>(), <span class="at">.groups =</span> <span class="st">"drop"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 2
  breed        n
  &lt;chr&gt;    &lt;int&gt;
1 Angus        4
2 Holstein     4
3 Jersey       4</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb70"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb70-1"><a href="#cb70-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Short way with count()</span></span>
<span id="cb70-2"><a href="#cb70-2" aria-hidden="true" tabindex="-1"></a>farm_data <span class="sc">%&gt;%</span></span>
<span id="cb70-3"><a href="#cb70-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(breed)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 2
  breed        n
  &lt;chr&gt;    &lt;int&gt;
1 Angus        4
2 Holstein     4
3 Jersey       4</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb72"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb72-1"><a href="#cb72-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Count by multiple variables</span></span>
<span id="cb72-2"><a href="#cb72-2" aria-hidden="true" tabindex="-1"></a>farm_data <span class="sc">%&gt;%</span></span>
<span id="cb72-3"><a href="#cb72-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(breed, farm)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 × 3
  breed    farm      n
  &lt;chr&gt;    &lt;chr&gt; &lt;int&gt;
1 Angus    North     2
2 Angus    South     2
3 Holstein North     2
4 Holstein South     2
5 Jersey   North     2
6 Jersey   South     2</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb74"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb74-1"><a href="#cb74-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Sort by count (most common first)</span></span>
<span id="cb74-2"><a href="#cb74-2" aria-hidden="true" tabindex="-1"></a>farm_data <span class="sc">%&gt;%</span></span>
<span id="cb74-3"><a href="#cb74-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(breed, <span class="at">sort =</span> <span class="cn">TRUE</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 2
  breed        n
  &lt;chr&gt;    &lt;int&gt;
1 Angus        4
2 Holstein     4
3 Jersey       4</code></pre>
</div>
</div>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
<span class="screen-reader-only">Tip</span><code>count()</code> Pro Tips
</div>
</div>
<div class="callout-body-container callout-body">
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb76"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb76-1"><a href="#cb76-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Rename the count column</span></span>
<span id="cb76-2"><a href="#cb76-2" aria-hidden="true" tabindex="-1"></a>farm_data <span class="sc">%&gt;%</span></span>
<span id="cb76-3"><a href="#cb76-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(breed, <span class="at">name =</span> <span class="st">"number_of_animals"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 2
  breed    number_of_animals
  &lt;chr&gt;                &lt;int&gt;
1 Angus                    4
2 Holstein                 4
3 Jersey                   4</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb78"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb78-1"><a href="#cb78-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Add a total row (using add_tally)</span></span>
<span id="cb78-2"><a href="#cb78-2" aria-hidden="true" tabindex="-1"></a>farm_data <span class="sc">%&gt;%</span></span>
<span id="cb78-3"><a href="#cb78-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(breed) <span class="sc">%&gt;%</span></span>
<span id="cb78-4"><a href="#cb78-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">proportion =</span> n <span class="sc">/</span> <span class="fu">sum</span>(n))</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 3
  breed        n proportion
  &lt;chr&gt;    &lt;int&gt;      &lt;dbl&gt;
1 Angus        4      0.333
2 Holstein     4      0.333
3 Jersey       4      0.333</code></pre>
</div>
</div>
</div>
</div>
</section>
<section id="renaming-columns-with-rename" class="level3" data-number="4.7.2">
<h3 data-number="4.7.2" class="anchored" data-anchor-id="renaming-columns-with-rename"><span class="header-section-number">4.7.2</span> Renaming Columns with <code>rename()</code></h3>
<p><code>rename()</code> changes column names:</p>
<p><strong>Syntax</strong>: <code>rename(new_name = old_name)</code></p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb80"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb80-1"><a href="#cb80-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Rename columns</span></span>
<span id="cb80-2"><a href="#cb80-2" aria-hidden="true" tabindex="-1"></a>cattle <span class="sc">%&gt;%</span></span>
<span id="cb80-3"><a href="#cb80-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(</span>
<span id="cb80-4"><a href="#cb80-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">id =</span> animal_id,</span>
<span id="cb80-5"><a href="#cb80-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">weight =</span> weight_kg,</span>
<span id="cb80-6"><a href="#cb80-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">height =</span> height_cm</span>
<span id="cb80-7"><a href="#cb80-7" aria-hidden="true" tabindex="-1"></a>  )</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 5 × 5
  id    breed    weight height age_months
  &lt;chr&gt; &lt;chr&gt;     &lt;dbl&gt;  &lt;dbl&gt;      &lt;dbl&gt;
1 H001  Holstein    600    145         30
2 H002  Holstein    625    148         36
3 H003  Holstein    580    142         28
4 J001  Jersey      450    130         30
5 J002  Jersey      470    133         32</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb82"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb82-1"><a href="#cb82-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Rename with a function</span></span>
<span id="cb82-2"><a href="#cb82-2" aria-hidden="true" tabindex="-1"></a>cattle <span class="sc">%&gt;%</span></span>
<span id="cb82-3"><a href="#cb82-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename_with</span>(str_to_upper)  <span class="co"># All columns to uppercase</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 5 × 5
  ANIMAL_ID BREED    WEIGHT_KG HEIGHT_CM AGE_MONTHS
  &lt;chr&gt;     &lt;chr&gt;        &lt;dbl&gt;     &lt;dbl&gt;      &lt;dbl&gt;
1 H001      Holstein       600       145         30
2 H002      Holstein       625       148         36
3 H003      Holstein       580       142         28
4 J001      Jersey         450       130         30
5 J002      Jersey         470       133         32</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb84"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb84-1"><a href="#cb84-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Rename specific columns with a function</span></span>
<span id="cb84-2"><a href="#cb84-2" aria-hidden="true" tabindex="-1"></a>cattle <span class="sc">%&gt;%</span></span>
<span id="cb84-3"><a href="#cb84-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename_with</span>(str_to_upper, <span class="fu">starts_with</span>(<span class="st">"weight"</span>))</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 5 × 5
  animal_id breed    WEIGHT_KG height_cm age_months
  &lt;chr&gt;     &lt;chr&gt;        &lt;dbl&gt;     &lt;dbl&gt;      &lt;dbl&gt;
1 H001      Holstein       600       145         30
2 H002      Holstein       625       148         36
3 H003      Holstein       580       142         28
4 J001      Jersey         450       130         30
5 J002      Jersey         470       133         32</code></pre>
</div>
</div>
</section>
<section id="reordering-columns-with-relocate" class="level3" data-number="4.7.3">
<h3 data-number="4.7.3" class="anchored" data-anchor-id="reordering-columns-with-relocate"><span class="header-section-number">4.7.3</span> Reordering Columns with <code>relocate()</code></h3>
<p><code>relocate()</code> moves columns to different positions:</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb86"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb86-1"><a href="#cb86-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Move breed to the front</span></span>
<span id="cb86-2"><a href="#cb86-2" aria-hidden="true" tabindex="-1"></a>cattle <span class="sc">%&gt;%</span></span>
<span id="cb86-3"><a href="#cb86-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">relocate</span>(breed)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 5 × 5
  breed    animal_id weight_kg height_cm age_months
  &lt;chr&gt;    &lt;chr&gt;         &lt;dbl&gt;     &lt;dbl&gt;      &lt;dbl&gt;
1 Holstein H001            600       145         30
2 Holstein H002            625       148         36
3 Holstein H003            580       142         28
4 Jersey   J001            450       130         30
5 Jersey   J002            470       133         32</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb88"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb88-1"><a href="#cb88-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Move weight_kg to the end</span></span>
<span id="cb88-2"><a href="#cb88-2" aria-hidden="true" tabindex="-1"></a>cattle <span class="sc">%&gt;%</span></span>
<span id="cb88-3"><a href="#cb88-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">relocate</span>(weight_kg, <span class="at">.after =</span> <span class="fu">last_col</span>())</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 5 × 5
  animal_id breed    height_cm age_months weight_kg
  &lt;chr&gt;     &lt;chr&gt;        &lt;dbl&gt;      &lt;dbl&gt;     &lt;dbl&gt;
1 H001      Holstein       145         30       600
2 H002      Holstein       148         36       625
3 H003      Holstein       142         28       580
4 J001      Jersey         130         30       450
5 J002      Jersey         133         32       470</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb90"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb90-1"><a href="#cb90-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Move height_cm before breed</span></span>
<span id="cb90-2"><a href="#cb90-2" aria-hidden="true" tabindex="-1"></a>cattle <span class="sc">%&gt;%</span></span>
<span id="cb90-3"><a href="#cb90-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">relocate</span>(height_cm, <span class="at">.before =</span> breed)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 5 × 5
  animal_id height_cm breed    weight_kg age_months
  &lt;chr&gt;         &lt;dbl&gt; &lt;chr&gt;        &lt;dbl&gt;      &lt;dbl&gt;
1 H001            145 Holstein       600         30
2 H002            148 Holstein       625         36
3 H003            142 Holstein       580         28
4 J001            130 Jersey         450         30
5 J002            133 Jersey         470         32</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb92"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb92-1"><a href="#cb92-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Move all numeric columns to the front</span></span>
<span id="cb92-2"><a href="#cb92-2" aria-hidden="true" tabindex="-1"></a>cattle <span class="sc">%&gt;%</span></span>
<span id="cb92-3"><a href="#cb92-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">relocate</span>(<span class="fu">where</span>(is.numeric))</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 5 × 5
  weight_kg height_cm age_months animal_id breed   
      &lt;dbl&gt;     &lt;dbl&gt;      &lt;dbl&gt; &lt;chr&gt;     &lt;chr&gt;   
1       600       145         30 H001      Holstein
2       625       148         36 H002      Holstein
3       580       142         28 H003      Holstein
4       450       130         30 J001      Jersey  
5       470       133         32 J002      Jersey  </code></pre>
</div>
</div>
<hr>
</section>
</section>
<section id="working-across-multiple-columns-with-across" class="level2" data-number="4.8">
<h2 data-number="4.8" class="anchored" data-anchor-id="working-across-multiple-columns-with-across"><span class="header-section-number">4.8</span> Working Across Multiple Columns with <code>across()</code></h2>
<p><code>across()</code> applies the same operation to multiple columns at once.</p>
<section id="basic-usage-1" class="level3" data-number="4.8.1">
<h3 data-number="4.8.1" class="anchored" data-anchor-id="basic-usage-1"><span class="header-section-number">4.8.1</span> Basic Usage</h3>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb94"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb94-1"><a href="#cb94-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Create test data</span></span>
<span id="cb94-2"><a href="#cb94-2" aria-hidden="true" tabindex="-1"></a>test_data <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb94-3"><a href="#cb94-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">animal_id =</span> <span class="fu">c</span>(<span class="st">"A001"</span>, <span class="st">"A002"</span>, <span class="st">"A003"</span>),</span>
<span id="cb94-4"><a href="#cb94-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">weight_kg =</span> <span class="fu">c</span>(<span class="fl">600.123</span>, <span class="fl">450.456</span>, <span class="fl">550.789</span>),</span>
<span id="cb94-5"><a href="#cb94-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">height_cm =</span> <span class="fu">c</span>(<span class="fl">145.678</span>, <span class="fl">130.234</span>, <span class="fl">140.567</span>),</span>
<span id="cb94-6"><a href="#cb94-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">age_months =</span> <span class="fu">c</span>(<span class="fl">30.5</span>, <span class="fl">28.3</span>, <span class="fl">32.1</span>)</span>
<span id="cb94-7"><a href="#cb94-7" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb94-8"><a href="#cb94-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-9"><a href="#cb94-9" aria-hidden="true" tabindex="-1"></a>test_data</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 4
  animal_id weight_kg height_cm age_months
  &lt;chr&gt;         &lt;dbl&gt;     &lt;dbl&gt;      &lt;dbl&gt;
1 A001           600.      146.       30.5
2 A002           450.      130.       28.3
3 A003           551.      141.       32.1</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb96"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb96-1"><a href="#cb96-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Round all numeric columns to 1 decimal place</span></span>
<span id="cb96-2"><a href="#cb96-2" aria-hidden="true" tabindex="-1"></a>test_data <span class="sc">%&gt;%</span></span>
<span id="cb96-3"><a href="#cb96-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="fu">across</span>(<span class="fu">where</span>(is.numeric), round, <span class="dv">1</span>))</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 4
  animal_id weight_kg height_cm age_months
  &lt;chr&gt;         &lt;dbl&gt;     &lt;dbl&gt;      &lt;dbl&gt;
1 A001           600.      146.       30.5
2 A002           450.      130.       28.3
3 A003           551.      141.       32.1</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb98"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb98-1"><a href="#cb98-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Convert all character columns to uppercase</span></span>
<span id="cb98-2"><a href="#cb98-2" aria-hidden="true" tabindex="-1"></a>farm_data <span class="sc">%&gt;%</span></span>
<span id="cb98-3"><a href="#cb98-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="fu">across</span>(<span class="fu">where</span>(is.character), str_to_upper)) <span class="sc">%&gt;%</span></span>
<span id="cb98-4"><a href="#cb98-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">head</span>(<span class="dv">3</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 4
  animal_id breed    farm  weight_kg
  &lt;chr&gt;     &lt;chr&gt;    &lt;chr&gt;     &lt;dbl&gt;
1 A001      HOLSTEIN NORTH       600
2 A002      HOLSTEIN SOUTH       620
3 A003      HOLSTEIN NORTH       590</code></pre>
</div>
</div>
</section>
<section id="selecting-columns-for-across" class="level3" data-number="4.8.2">
<h3 data-number="4.8.2" class="anchored" data-anchor-id="selecting-columns-for-across"><span class="header-section-number">4.8.2</span> Selecting Columns for <code>across()</code></h3>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb100"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb100-1"><a href="#cb100-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Apply to specific columns</span></span>
<span id="cb100-2"><a href="#cb100-2" aria-hidden="true" tabindex="-1"></a>test_data <span class="sc">%&gt;%</span></span>
<span id="cb100-3"><a href="#cb100-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="fu">across</span>(<span class="fu">c</span>(weight_kg, height_cm), round, <span class="dv">1</span>))</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 4
  animal_id weight_kg height_cm age_months
  &lt;chr&gt;         &lt;dbl&gt;     &lt;dbl&gt;      &lt;dbl&gt;
1 A001           600.      146.       30.5
2 A002           450.      130.       28.3
3 A003           551.      141.       32.1</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb102"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb102-1"><a href="#cb102-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Apply to columns matching a pattern</span></span>
<span id="cb102-2"><a href="#cb102-2" aria-hidden="true" tabindex="-1"></a>test_data <span class="sc">%&gt;%</span></span>
<span id="cb102-3"><a href="#cb102-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="fu">across</span>(<span class="fu">ends_with</span>(<span class="st">"_kg"</span>), <span class="sc">~</span> . <span class="sc">*</span> <span class="fl">2.20462</span>))  <span class="co"># Convert kg to lb</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 4
  animal_id weight_kg height_cm age_months
  &lt;chr&gt;         &lt;dbl&gt;     &lt;dbl&gt;      &lt;dbl&gt;
1 A001          1323.      146.       30.5
2 A002           993.      130.       28.3
3 A003          1214.      141.       32.1</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb104"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb104-1"><a href="#cb104-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Apply to all except some columns</span></span>
<span id="cb104-2"><a href="#cb104-2" aria-hidden="true" tabindex="-1"></a>test_data <span class="sc">%&gt;%</span></span>
<span id="cb104-3"><a href="#cb104-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="fu">across</span>(<span class="sc">-</span>animal_id, round, <span class="dv">0</span>))</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 4
  animal_id weight_kg height_cm age_months
  &lt;chr&gt;         &lt;dbl&gt;     &lt;dbl&gt;      &lt;dbl&gt;
1 A001            600       146         30
2 A002            450       130         28
3 A003            551       141         32</code></pre>
</div>
</div>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
<span class="screen-reader-only">Note</span>Anonymous Functions with <code>across()</code>
</div>
</div>
<div class="callout-body-container callout-body">
<p>The <code>~</code> creates an anonymous function, and <code>.</code> represents each column:</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb106"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb106-1"><a href="#cb106-1" aria-hidden="true" tabindex="-1"></a><span class="co"># These are equivalent:</span></span>
<span id="cb106-2"><a href="#cb106-2" aria-hidden="true" tabindex="-1"></a><span class="fu">across</span>(cols, <span class="sc">~</span> <span class="fu">round</span>(., <span class="dv">1</span>))</span>
<span id="cb106-3"><a href="#cb106-3" aria-hidden="true" tabindex="-1"></a><span class="fu">across</span>(cols, round, <span class="dv">1</span>)</span>
<span id="cb106-4"><a href="#cb106-4" aria-hidden="true" tabindex="-1"></a><span class="fu">across</span>(cols, <span class="cf">function</span>(x) <span class="fu">round</span>(x, <span class="dv">1</span>))</span>
<span id="cb106-5"><a href="#cb106-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-6"><a href="#cb106-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Use ~ when you need more complex operations:</span></span>
<span id="cb106-7"><a href="#cb106-7" aria-hidden="true" tabindex="-1"></a><span class="fu">across</span>(cols, <span class="sc">~</span> . <span class="sc">*</span> <span class="dv">2</span> <span class="sc">+</span> <span class="dv">1</span>)</span>
<span id="cb106-8"><a href="#cb106-8" aria-hidden="true" tabindex="-1"></a><span class="fu">across</span>(cols, <span class="sc">~</span> <span class="fu">if_else</span>(. <span class="sc">&gt;</span> <span class="dv">100</span>, ., . <span class="sc">*</span> <span class="dv">2</span>))</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
</div>
</div>
</section>
<section id="multiple-summaries-with-across" class="level3" data-number="4.8.3">
<h3 data-number="4.8.3" class="anchored" data-anchor-id="multiple-summaries-with-across"><span class="header-section-number">4.8.3</span> Multiple Summaries with <code>across()</code></h3>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb107"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb107-1"><a href="#cb107-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate multiple summaries for multiple columns</span></span>
<span id="cb107-2"><a href="#cb107-2" aria-hidden="true" tabindex="-1"></a>farm_data <span class="sc">%&gt;%</span></span>
<span id="cb107-3"><a href="#cb107-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(breed) <span class="sc">%&gt;%</span></span>
<span id="cb107-4"><a href="#cb107-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(</span>
<span id="cb107-5"><a href="#cb107-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">across</span>(</span>
<span id="cb107-6"><a href="#cb107-6" aria-hidden="true" tabindex="-1"></a>      weight_kg,</span>
<span id="cb107-7"><a href="#cb107-7" aria-hidden="true" tabindex="-1"></a>      <span class="fu">list</span>(</span>
<span id="cb107-8"><a href="#cb107-8" aria-hidden="true" tabindex="-1"></a>        <span class="at">mean =</span> mean,</span>
<span id="cb107-9"><a href="#cb107-9" aria-hidden="true" tabindex="-1"></a>        <span class="at">sd =</span> sd,</span>
<span id="cb107-10"><a href="#cb107-10" aria-hidden="true" tabindex="-1"></a>        <span class="at">min =</span> min,</span>
<span id="cb107-11"><a href="#cb107-11" aria-hidden="true" tabindex="-1"></a>        <span class="at">max =</span> max</span>
<span id="cb107-12"><a href="#cb107-12" aria-hidden="true" tabindex="-1"></a>      )</span>
<span id="cb107-13"><a href="#cb107-13" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb107-14"><a href="#cb107-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">n =</span> <span class="fu">n</span>(),</span>
<span id="cb107-15"><a href="#cb107-15" aria-hidden="true" tabindex="-1"></a>    <span class="at">.groups =</span> <span class="st">"drop"</span></span>
<span id="cb107-16"><a href="#cb107-16" aria-hidden="true" tabindex="-1"></a>  )</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 6
  breed    weight_kg_mean weight_kg_sd weight_kg_min weight_kg_max     n
  &lt;chr&gt;             &lt;dbl&gt;        &lt;dbl&gt;         &lt;dbl&gt;         &lt;dbl&gt; &lt;int&gt;
1 Angus               555        12.9            540           570     4
2 Holstein            605        12.9            590           620     4
3 Jersey              460         9.13           450           470     4</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb109"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb109-1"><a href="#cb109-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Cleaner column names</span></span>
<span id="cb109-2"><a href="#cb109-2" aria-hidden="true" tabindex="-1"></a>farm_data <span class="sc">%&gt;%</span></span>
<span id="cb109-3"><a href="#cb109-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(breed) <span class="sc">%&gt;%</span></span>
<span id="cb109-4"><a href="#cb109-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(</span>
<span id="cb109-5"><a href="#cb109-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">across</span>(</span>
<span id="cb109-6"><a href="#cb109-6" aria-hidden="true" tabindex="-1"></a>      weight_kg,</span>
<span id="cb109-7"><a href="#cb109-7" aria-hidden="true" tabindex="-1"></a>      <span class="fu">list</span>(</span>
<span id="cb109-8"><a href="#cb109-8" aria-hidden="true" tabindex="-1"></a>        <span class="at">mean =</span> mean,</span>
<span id="cb109-9"><a href="#cb109-9" aria-hidden="true" tabindex="-1"></a>        <span class="at">sd =</span> sd</span>
<span id="cb109-10"><a href="#cb109-10" aria-hidden="true" tabindex="-1"></a>      ),</span>
<span id="cb109-11"><a href="#cb109-11" aria-hidden="true" tabindex="-1"></a>      <span class="at">.names =</span> <span class="st">"{.col}_{.fn}"</span>  <span class="co"># Creates: weight_kg_mean, weight_kg_sd</span></span>
<span id="cb109-12"><a href="#cb109-12" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb109-13"><a href="#cb109-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">.groups =</span> <span class="st">"drop"</span></span>
<span id="cb109-14"><a href="#cb109-14" aria-hidden="true" tabindex="-1"></a>  )</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 3
  breed    weight_kg_mean weight_kg_sd
  &lt;chr&gt;             &lt;dbl&gt;        &lt;dbl&gt;
1 Angus               555        12.9 
2 Holstein            605        12.9 
3 Jersey              460         9.13</code></pre>
</div>
</div>
<hr>
</section>
</section>
<section id="handling-missing-data" class="level2" data-number="4.9">
<h2 data-number="4.9" class="anchored" data-anchor-id="handling-missing-data"><span class="header-section-number">4.9</span> Handling Missing Data</h2>
<p>Missing data (<code>NA</code>) is common in real datasets. dplyr provides several tools to handle it.</p>
<section id="detecting-missing-values" class="level3" data-number="4.9.1">
<h3 data-number="4.9.1" class="anchored" data-anchor-id="detecting-missing-values"><span class="header-section-number">4.9.1</span> Detecting Missing Values</h3>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb111"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb111-1"><a href="#cb111-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Create data with missing values</span></span>
<span id="cb111-2"><a href="#cb111-2" aria-hidden="true" tabindex="-1"></a>cattle_missing <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb111-3"><a href="#cb111-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">animal_id =</span> <span class="fu">c</span>(<span class="st">"H001"</span>, <span class="st">"H002"</span>, <span class="st">"H003"</span>, <span class="st">"H004"</span>, <span class="st">"H005"</span>),</span>
<span id="cb111-4"><a href="#cb111-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">breed =</span> <span class="fu">c</span>(<span class="st">"Holstein"</span>, <span class="st">"Jersey"</span>, <span class="cn">NA</span>, <span class="st">"Angus"</span>, <span class="st">"Holstein"</span>),</span>
<span id="cb111-5"><a href="#cb111-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">weight_kg =</span> <span class="fu">c</span>(<span class="dv">600</span>, <span class="cn">NA</span>, <span class="dv">580</span>, <span class="dv">625</span>, <span class="cn">NA</span>),</span>
<span id="cb111-6"><a href="#cb111-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">age_months =</span> <span class="fu">c</span>(<span class="dv">30</span>, <span class="dv">28</span>, <span class="cn">NA</span>, <span class="dv">32</span>, <span class="dv">26</span>)</span>
<span id="cb111-7"><a href="#cb111-7" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb111-8"><a href="#cb111-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb111-9"><a href="#cb111-9" aria-hidden="true" tabindex="-1"></a>cattle_missing</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 5 × 4
  animal_id breed    weight_kg age_months
  &lt;chr&gt;     &lt;chr&gt;        &lt;dbl&gt;      &lt;dbl&gt;
1 H001      Holstein       600         30
2 H002      Jersey          NA         28
3 H003      &lt;NA&gt;           580         NA
4 H004      Angus          625         32
5 H005      Holstein        NA         26</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb113"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb113-1"><a href="#cb113-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Check for missing values</span></span>
<span id="cb113-2"><a href="#cb113-2" aria-hidden="true" tabindex="-1"></a>cattle_missing <span class="sc">%&gt;%</span></span>
<span id="cb113-3"><a href="#cb113-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb113-4"><a href="#cb113-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">breed_is_missing =</span> <span class="fu">is.na</span>(breed),</span>
<span id="cb113-5"><a href="#cb113-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">weight_is_missing =</span> <span class="fu">is.na</span>(weight_kg)</span>
<span id="cb113-6"><a href="#cb113-6" aria-hidden="true" tabindex="-1"></a>  )</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 5 × 6
  animal_id breed    weight_kg age_months breed_is_missing weight_is_missing
  &lt;chr&gt;     &lt;chr&gt;        &lt;dbl&gt;      &lt;dbl&gt; &lt;lgl&gt;            &lt;lgl&gt;            
1 H001      Holstein       600         30 FALSE            FALSE            
2 H002      Jersey          NA         28 FALSE            TRUE             
3 H003      &lt;NA&gt;           580         NA TRUE             FALSE            
4 H004      Angus          625         32 FALSE            FALSE            
5 H005      Holstein        NA         26 FALSE            TRUE             </code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb115"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb115-1"><a href="#cb115-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Count missing values per column</span></span>
<span id="cb115-2"><a href="#cb115-2" aria-hidden="true" tabindex="-1"></a>cattle_missing <span class="sc">%&gt;%</span></span>
<span id="cb115-3"><a href="#cb115-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(</span>
<span id="cb115-4"><a href="#cb115-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">across</span>(<span class="fu">everything</span>(), <span class="sc">~</span> <span class="fu">sum</span>(<span class="fu">is.na</span>(.)))</span>
<span id="cb115-5"><a href="#cb115-5" aria-hidden="true" tabindex="-1"></a>  )</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1 × 4
  animal_id breed weight_kg age_months
      &lt;int&gt; &lt;int&gt;     &lt;int&gt;      &lt;int&gt;
1         0     1         2          1</code></pre>
</div>
</div>
</section>
<section id="removing-missing-values-with-drop_na" class="level3" data-number="4.9.2">
<h3 data-number="4.9.2" class="anchored" data-anchor-id="removing-missing-values-with-drop_na"><span class="header-section-number">4.9.2</span> Removing Missing Values with <code>drop_na()</code></h3>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb117"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb117-1"><a href="#cb117-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Remove rows with ANY missing values</span></span>
<span id="cb117-2"><a href="#cb117-2" aria-hidden="true" tabindex="-1"></a>cattle_missing <span class="sc">%&gt;%</span></span>
<span id="cb117-3"><a href="#cb117-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">drop_na</span>()</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 2 × 4
  animal_id breed    weight_kg age_months
  &lt;chr&gt;     &lt;chr&gt;        &lt;dbl&gt;      &lt;dbl&gt;
1 H001      Holstein       600         30
2 H004      Angus          625         32</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb119"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb119-1"><a href="#cb119-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Remove rows with missing values in specific columns</span></span>
<span id="cb119-2"><a href="#cb119-2" aria-hidden="true" tabindex="-1"></a>cattle_missing <span class="sc">%&gt;%</span></span>
<span id="cb119-3"><a href="#cb119-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">drop_na</span>(weight_kg)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 4
  animal_id breed    weight_kg age_months
  &lt;chr&gt;     &lt;chr&gt;        &lt;dbl&gt;      &lt;dbl&gt;
1 H001      Holstein       600         30
2 H003      &lt;NA&gt;           580         NA
3 H004      Angus          625         32</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb121"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb121-1"><a href="#cb121-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Remove rows missing BOTH weight and age</span></span>
<span id="cb121-2"><a href="#cb121-2" aria-hidden="true" tabindex="-1"></a>cattle_missing <span class="sc">%&gt;%</span></span>
<span id="cb121-3"><a href="#cb121-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">drop_na</span>(weight_kg, age_months)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 2 × 4
  animal_id breed    weight_kg age_months
  &lt;chr&gt;     &lt;chr&gt;        &lt;dbl&gt;      &lt;dbl&gt;
1 H001      Holstein       600         30
2 H004      Angus          625         32</code></pre>
</div>
</div>
<div class="callout callout-style-default callout-warning callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
<span class="screen-reader-only">Warning</span>Be Careful When Dropping NAs!
</div>
</div>
<div class="callout-body-container callout-body">
<p>Removing missing data can: - Reduce sample size significantly - Introduce bias if missingness isn’t random - Lose valuable information in other columns</p>
<p><strong>Better approach</strong>: Understand WHY data is missing, then decide how to handle it.</p>
</div>
</div>
</section>
<section id="replacing-missing-values-with-replace_na" class="level3" data-number="4.9.3">
<h3 data-number="4.9.3" class="anchored" data-anchor-id="replacing-missing-values-with-replace_na"><span class="header-section-number">4.9.3</span> Replacing Missing Values with <code>replace_na()</code></h3>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb123"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb123-1"><a href="#cb123-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Replace NAs with specific values</span></span>
<span id="cb123-2"><a href="#cb123-2" aria-hidden="true" tabindex="-1"></a>cattle_missing <span class="sc">%&gt;%</span></span>
<span id="cb123-3"><a href="#cb123-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb123-4"><a href="#cb123-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">breed =</span> <span class="fu">replace_na</span>(breed, <span class="st">"Unknown"</span>),</span>
<span id="cb123-5"><a href="#cb123-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">weight_kg =</span> <span class="fu">replace_na</span>(weight_kg, <span class="dv">0</span>)</span>
<span id="cb123-6"><a href="#cb123-6" aria-hidden="true" tabindex="-1"></a>  )</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 5 × 4
  animal_id breed    weight_kg age_months
  &lt;chr&gt;     &lt;chr&gt;        &lt;dbl&gt;      &lt;dbl&gt;
1 H001      Holstein       600         30
2 H002      Jersey           0         28
3 H003      Unknown        580         NA
4 H004      Angus          625         32
5 H005      Holstein         0         26</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb125"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb125-1"><a href="#cb125-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Replace NAs in multiple columns</span></span>
<span id="cb125-2"><a href="#cb125-2" aria-hidden="true" tabindex="-1"></a>cattle_missing <span class="sc">%&gt;%</span></span>
<span id="cb125-3"><a href="#cb125-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb125-4"><a href="#cb125-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">across</span>(</span>
<span id="cb125-5"><a href="#cb125-5" aria-hidden="true" tabindex="-1"></a>      <span class="fu">where</span>(is.numeric),</span>
<span id="cb125-6"><a href="#cb125-6" aria-hidden="true" tabindex="-1"></a>      <span class="sc">~</span> <span class="fu">replace_na</span>(., <span class="fu">mean</span>(., <span class="at">na.rm =</span> <span class="cn">TRUE</span>))  <span class="co"># Replace with column mean</span></span>
<span id="cb125-7"><a href="#cb125-7" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb125-8"><a href="#cb125-8" aria-hidden="true" tabindex="-1"></a>  )</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 5 × 4
  animal_id breed    weight_kg age_months
  &lt;chr&gt;     &lt;chr&gt;        &lt;dbl&gt;      &lt;dbl&gt;
1 H001      Holstein      600          30
2 H002      Jersey        602.         28
3 H003      &lt;NA&gt;          580          29
4 H004      Angus         625          32
5 H005      Holstein      602.         26</code></pre>
</div>
</div>
</section>
<section id="filling-missing-values-with-coalesce" class="level3" data-number="4.9.4">
<h3 data-number="4.9.4" class="anchored" data-anchor-id="filling-missing-values-with-coalesce"><span class="header-section-number">4.9.4</span> Filling Missing Values with <code>coalesce()</code></h3>
<p><code>coalesce()</code> returns the first non-missing value:</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb127"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb127-1"><a href="#cb127-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Multiple weight measurements, use first available</span></span>
<span id="cb127-2"><a href="#cb127-2" aria-hidden="true" tabindex="-1"></a>weights <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb127-3"><a href="#cb127-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">animal_id =</span> <span class="fu">c</span>(<span class="st">"A001"</span>, <span class="st">"A002"</span>, <span class="st">"A003"</span>, <span class="st">"A004"</span>),</span>
<span id="cb127-4"><a href="#cb127-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">weight_measurement1 =</span> <span class="fu">c</span>(<span class="dv">600</span>, <span class="cn">NA</span>, <span class="dv">580</span>, <span class="cn">NA</span>),</span>
<span id="cb127-5"><a href="#cb127-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">weight_measurement2 =</span> <span class="fu">c</span>(<span class="dv">605</span>, <span class="dv">450</span>, <span class="cn">NA</span>, <span class="dv">625</span>),</span>
<span id="cb127-6"><a href="#cb127-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">weight_measurement3 =</span> <span class="fu">c</span>(<span class="cn">NA</span>, <span class="dv">455</span>, <span class="dv">585</span>, <span class="dv">630</span>)</span>
<span id="cb127-7"><a href="#cb127-7" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb127-8"><a href="#cb127-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb127-9"><a href="#cb127-9" aria-hidden="true" tabindex="-1"></a>weights</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 4 × 4
  animal_id weight_measurement1 weight_measurement2 weight_measurement3
  &lt;chr&gt;                   &lt;dbl&gt;               &lt;dbl&gt;               &lt;dbl&gt;
1 A001                      600                 605                  NA
2 A002                       NA                 450                 455
3 A003                      580                  NA                 585
4 A004                       NA                 625                 630</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb129"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb129-1"><a href="#cb129-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Use first non-missing weight</span></span>
<span id="cb129-2"><a href="#cb129-2" aria-hidden="true" tabindex="-1"></a>weights <span class="sc">%&gt;%</span></span>
<span id="cb129-3"><a href="#cb129-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb129-4"><a href="#cb129-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">weight_final =</span> <span class="fu">coalesce</span>(weight_measurement1,</span>
<span id="cb129-5"><a href="#cb129-5" aria-hidden="true" tabindex="-1"></a>                           weight_measurement2,</span>
<span id="cb129-6"><a href="#cb129-6" aria-hidden="true" tabindex="-1"></a>                           weight_measurement3)</span>
<span id="cb129-7"><a href="#cb129-7" aria-hidden="true" tabindex="-1"></a>  )</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 4 × 5
  animal_id weight_measurement1 weight_measurement2 weight_measurement3
  &lt;chr&gt;                   &lt;dbl&gt;               &lt;dbl&gt;               &lt;dbl&gt;
1 A001                      600                 605                  NA
2 A002                       NA                 450                 455
3 A003                      580                  NA                 585
4 A004                       NA                 625                 630
# ℹ 1 more variable: weight_final &lt;dbl&gt;</code></pre>
</div>
</div>
</section>
<section id="handling-nas-in-calculations" class="level3" data-number="4.9.5">
<h3 data-number="4.9.5" class="anchored" data-anchor-id="handling-nas-in-calculations"><span class="header-section-number">4.9.5</span> Handling NAs in Calculations</h3>
<p>Most R functions return <code>NA</code> if any input is <code>NA</code>:</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb131"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb131-1"><a href="#cb131-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Mean returns NA if any value is NA</span></span>
<span id="cb131-2"><a href="#cb131-2" aria-hidden="true" tabindex="-1"></a><span class="fu">mean</span>(<span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>, <span class="cn">NA</span>, <span class="dv">4</span>))</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] NA</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb133"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb133-1"><a href="#cb133-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Use na.rm = TRUE to remove NAs before calculating</span></span>
<span id="cb133-2"><a href="#cb133-2" aria-hidden="true" tabindex="-1"></a><span class="fu">mean</span>(<span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>, <span class="cn">NA</span>, <span class="dv">4</span>), <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 2.333333</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb135"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb135-1"><a href="#cb135-1" aria-hidden="true" tabindex="-1"></a><span class="co"># In a summarise</span></span>
<span id="cb135-2"><a href="#cb135-2" aria-hidden="true" tabindex="-1"></a>cattle_missing <span class="sc">%&gt;%</span></span>
<span id="cb135-3"><a href="#cb135-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(</span>
<span id="cb135-4"><a href="#cb135-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">mean_weight_with_na =</span> <span class="fu">mean</span>(weight_kg),           <span class="co"># Returns NA</span></span>
<span id="cb135-5"><a href="#cb135-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">mean_weight_removed =</span> <span class="fu">mean</span>(weight_kg, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)  <span class="co"># Calculates mean</span></span>
<span id="cb135-6"><a href="#cb135-6" aria-hidden="true" tabindex="-1"></a>  )</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1 × 2
  mean_weight_with_na mean_weight_removed
                &lt;dbl&gt;               &lt;dbl&gt;
1                  NA                602.</code></pre>
</div>
</div>
<hr>
</section>
</section>
<section id="window-functions" class="level2" data-number="4.10">
<h2 data-number="4.10" class="anchored" data-anchor-id="window-functions"><span class="header-section-number">4.10</span> Window Functions</h2>
<p><strong>Window functions</strong> operate on groups of rows and return a value for each row (unlike <code>summarise()</code> which returns one value per group).</p>
<section id="ranking-functions" class="level3" data-number="4.10.1">
<h3 data-number="4.10.1" class="anchored" data-anchor-id="ranking-functions"><span class="header-section-number">4.10.1</span> Ranking Functions</h3>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb137"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb137-1"><a href="#cb137-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Create competition data</span></span>
<span id="cb137-2"><a href="#cb137-2" aria-hidden="true" tabindex="-1"></a>competition <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb137-3"><a href="#cb137-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">animal_id =</span> <span class="fu">sprintf</span>(<span class="st">"A%03d"</span>, <span class="dv">1</span><span class="sc">:</span><span class="dv">8</span>),</span>
<span id="cb137-4"><a href="#cb137-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">breed =</span> <span class="fu">rep</span>(<span class="fu">c</span>(<span class="st">"Holstein"</span>, <span class="st">"Jersey"</span>), <span class="at">each =</span> <span class="dv">4</span>),</span>
<span id="cb137-5"><a href="#cb137-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">score =</span> <span class="fu">c</span>(<span class="dv">92</span>, <span class="dv">88</span>, <span class="dv">88</span>, <span class="dv">85</span>, <span class="dv">78</span>, <span class="dv">76</span>, <span class="dv">76</span>, <span class="dv">74</span>)</span>
<span id="cb137-6"><a href="#cb137-6" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb137-7"><a href="#cb137-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb137-8"><a href="#cb137-8" aria-hidden="true" tabindex="-1"></a>competition</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 8 × 3
  animal_id breed    score
  &lt;chr&gt;     &lt;chr&gt;    &lt;dbl&gt;
1 A001      Holstein    92
2 A002      Holstein    88
3 A003      Holstein    88
4 A004      Holstein    85
5 A005      Jersey      78
6 A006      Jersey      76
7 A007      Jersey      76
8 A008      Jersey      74</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb139"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb139-1"><a href="#cb139-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Rank animals by score</span></span>
<span id="cb139-2"><a href="#cb139-2" aria-hidden="true" tabindex="-1"></a>competition <span class="sc">%&gt;%</span></span>
<span id="cb139-3"><a href="#cb139-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb139-4"><a href="#cb139-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">rank =</span> <span class="fu">min_rank</span>(<span class="fu">desc</span>(score)),        <span class="co"># Rank (ties get same rank, gaps after)</span></span>
<span id="cb139-5"><a href="#cb139-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">dense =</span> <span class="fu">dense_rank</span>(<span class="fu">desc</span>(score)),     <span class="co"># Dense rank (ties, no gaps)</span></span>
<span id="cb139-6"><a href="#cb139-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">row_num =</span> <span class="fu">row_number</span>(<span class="fu">desc</span>(score)),   <span class="co"># Row number (no ties, arbitrary order)</span></span>
<span id="cb139-7"><a href="#cb139-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">percentile =</span> <span class="fu">percent_rank</span>(<span class="fu">desc</span>(score))  <span class="co"># Percentile (0 to 1)</span></span>
<span id="cb139-8"><a href="#cb139-8" aria-hidden="true" tabindex="-1"></a>  )</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 8 × 7
  animal_id breed    score  rank dense row_num percentile
  &lt;chr&gt;     &lt;chr&gt;    &lt;dbl&gt; &lt;int&gt; &lt;int&gt;   &lt;int&gt;      &lt;dbl&gt;
1 A001      Holstein    92     1     1       1      0    
2 A002      Holstein    88     2     2       2      0.143
3 A003      Holstein    88     2     2       3      0.143
4 A004      Holstein    85     4     3       4      0.429
5 A005      Jersey      78     5     4       5      0.571
6 A006      Jersey      76     6     5       6      0.714
7 A007      Jersey      76     6     5       7      0.714
8 A008      Jersey      74     8     6       8      1    </code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb141"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb141-1"><a href="#cb141-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Rank within breed</span></span>
<span id="cb141-2"><a href="#cb141-2" aria-hidden="true" tabindex="-1"></a>competition <span class="sc">%&gt;%</span></span>
<span id="cb141-3"><a href="#cb141-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(breed) <span class="sc">%&gt;%</span></span>
<span id="cb141-4"><a href="#cb141-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb141-5"><a href="#cb141-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">breed_rank =</span> <span class="fu">min_rank</span>(<span class="fu">desc</span>(score))</span>
<span id="cb141-6"><a href="#cb141-6" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb141-7"><a href="#cb141-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span></span>
<span id="cb141-8"><a href="#cb141-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(breed, breed_rank)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 8 × 4
  animal_id breed    score breed_rank
  &lt;chr&gt;     &lt;chr&gt;    &lt;dbl&gt;      &lt;int&gt;
1 A001      Holstein    92          1
2 A002      Holstein    88          2
3 A003      Holstein    88          2
4 A004      Holstein    85          4
5 A005      Jersey      78          1
6 A006      Jersey      76          2
7 A007      Jersey      76          2
8 A008      Jersey      74          4</code></pre>
</div>
</div>
</section>
<section id="offset-functions-lag-and-lead" class="level3" data-number="4.10.2">
<h3 data-number="4.10.2" class="anchored" data-anchor-id="offset-functions-lag-and-lead"><span class="header-section-number">4.10.2</span> Offset Functions: <code>lag()</code> and <code>lead()</code></h3>
<p><code>lag()</code> and <code>lead()</code> access previous or next values:</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb143"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb143-1"><a href="#cb143-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Weight measurements over time</span></span>
<span id="cb143-2"><a href="#cb143-2" aria-hidden="true" tabindex="-1"></a>growth <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb143-3"><a href="#cb143-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">animal_id =</span> <span class="fu">rep</span>(<span class="st">"A001"</span>, <span class="dv">5</span>),</span>
<span id="cb143-4"><a href="#cb143-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">week =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>,</span>
<span id="cb143-5"><a href="#cb143-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">weight_kg =</span> <span class="fu">c</span>(<span class="dv">450</span>, <span class="dv">465</span>, <span class="dv">478</span>, <span class="dv">492</span>, <span class="dv">505</span>)</span>
<span id="cb143-6"><a href="#cb143-6" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb143-7"><a href="#cb143-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb143-8"><a href="#cb143-8" aria-hidden="true" tabindex="-1"></a>growth</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 5 × 3
  animal_id  week weight_kg
  &lt;chr&gt;     &lt;int&gt;     &lt;dbl&gt;
1 A001          1       450
2 A001          2       465
3 A001          3       478
4 A001          4       492
5 A001          5       505</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb145"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb145-1"><a href="#cb145-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate weight change from previous week</span></span>
<span id="cb145-2"><a href="#cb145-2" aria-hidden="true" tabindex="-1"></a>growth <span class="sc">%&gt;%</span></span>
<span id="cb145-3"><a href="#cb145-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb145-4"><a href="#cb145-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">previous_weight =</span> <span class="fu">lag</span>(weight_kg),           <span class="co"># Previous row</span></span>
<span id="cb145-5"><a href="#cb145-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">weight_gain =</span> weight_kg <span class="sc">-</span> <span class="fu">lag</span>(weight_kg),  <span class="co"># Change from previous</span></span>
<span id="cb145-6"><a href="#cb145-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">next_weight =</span> <span class="fu">lead</span>(weight_kg)              <span class="co"># Next row</span></span>
<span id="cb145-7"><a href="#cb145-7" aria-hidden="true" tabindex="-1"></a>  )</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 5 × 6
  animal_id  week weight_kg previous_weight weight_gain next_weight
  &lt;chr&gt;     &lt;int&gt;     &lt;dbl&gt;           &lt;dbl&gt;       &lt;dbl&gt;       &lt;dbl&gt;
1 A001          1       450              NA          NA         465
2 A001          2       465             450          15         478
3 A001          3       478             465          13         492
4 A001          4       492             478          14         505
5 A001          5       505             492          13          NA</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb147"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb147-1"><a href="#cb147-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Lag by multiple rows</span></span>
<span id="cb147-2"><a href="#cb147-2" aria-hidden="true" tabindex="-1"></a>growth <span class="sc">%&gt;%</span></span>
<span id="cb147-3"><a href="#cb147-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb147-4"><a href="#cb147-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">two_weeks_ago =</span> <span class="fu">lag</span>(weight_kg, <span class="at">n =</span> <span class="dv">2</span>)</span>
<span id="cb147-5"><a href="#cb147-5" aria-hidden="true" tabindex="-1"></a>  )</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 5 × 4
  animal_id  week weight_kg two_weeks_ago
  &lt;chr&gt;     &lt;int&gt;     &lt;dbl&gt;         &lt;dbl&gt;
1 A001          1       450            NA
2 A001          2       465            NA
3 A001          3       478           450
4 A001          4       492           465
5 A001          5       505           478</code></pre>
</div>
</div>
</section>
<section id="cumulative-functions" class="level3" data-number="4.10.3">
<h3 data-number="4.10.3" class="anchored" data-anchor-id="cumulative-functions"><span class="header-section-number">4.10.3</span> Cumulative Functions</h3>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb149"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb149-1"><a href="#cb149-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Running totals</span></span>
<span id="cb149-2"><a href="#cb149-2" aria-hidden="true" tabindex="-1"></a>milk_production <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb149-3"><a href="#cb149-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">day =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">7</span>,</span>
<span id="cb149-4"><a href="#cb149-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">milk_liters =</span> <span class="fu">c</span>(<span class="dv">25</span>, <span class="dv">28</span>, <span class="dv">26</span>, <span class="dv">29</span>, <span class="dv">27</span>, <span class="dv">30</span>, <span class="dv">28</span>)</span>
<span id="cb149-5"><a href="#cb149-5" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb149-6"><a href="#cb149-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb149-7"><a href="#cb149-7" aria-hidden="true" tabindex="-1"></a>milk_production</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 7 × 2
    day milk_liters
  &lt;int&gt;       &lt;dbl&gt;
1     1          25
2     2          28
3     3          26
4     4          29
5     5          27
6     6          30
7     7          28</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb151"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb151-1"><a href="#cb151-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Cumulative statistics</span></span>
<span id="cb151-2"><a href="#cb151-2" aria-hidden="true" tabindex="-1"></a>milk_production <span class="sc">%&gt;%</span></span>
<span id="cb151-3"><a href="#cb151-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb151-4"><a href="#cb151-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">cumulative_milk =</span> <span class="fu">cumsum</span>(milk_liters),      <span class="co"># Running total</span></span>
<span id="cb151-5"><a href="#cb151-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">running_mean =</span> <span class="fu">cummean</span>(milk_liters),        <span class="co"># Running mean</span></span>
<span id="cb151-6"><a href="#cb151-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">running_min =</span> <span class="fu">cummin</span>(milk_liters),          <span class="co"># Running minimum</span></span>
<span id="cb151-7"><a href="#cb151-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">running_max =</span> <span class="fu">cummax</span>(milk_liters)           <span class="co"># Running maximum</span></span>
<span id="cb151-8"><a href="#cb151-8" aria-hidden="true" tabindex="-1"></a>  )</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 7 × 6
    day milk_liters cumulative_milk running_mean running_min running_max
  &lt;int&gt;       &lt;dbl&gt;           &lt;dbl&gt;        &lt;dbl&gt;       &lt;dbl&gt;       &lt;dbl&gt;
1     1          25              25         25            25          25
2     2          28              53         26.5          25          28
3     3          26              79         26.3          25          28
4     4          29             108         27            25          29
5     5          27             135         27            25          29
6     6          30             165         27.5          25          30
7     7          28             193         27.6          25          30</code></pre>
</div>
</div>
</section>
<section id="real-world-example-growth-rates" class="level3" data-number="4.10.4">
<h3 data-number="4.10.4" class="anchored" data-anchor-id="real-world-example-growth-rates"><span class="header-section-number">4.10.4</span> Real-World Example: Growth Rates</h3>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb153"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb153-1"><a href="#cb153-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Multiple animals, multiple measurements</span></span>
<span id="cb153-2"><a href="#cb153-2" aria-hidden="true" tabindex="-1"></a>growth_data <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb153-3"><a href="#cb153-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">animal_id =</span> <span class="fu">rep</span>(<span class="fu">c</span>(<span class="st">"A001"</span>, <span class="st">"A002"</span>, <span class="st">"A003"</span>), <span class="at">each =</span> <span class="dv">4</span>),</span>
<span id="cb153-4"><a href="#cb153-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">week =</span> <span class="fu">rep</span>(<span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">4</span>, <span class="dv">8</span>, <span class="dv">12</span>), <span class="dv">3</span>),</span>
<span id="cb153-5"><a href="#cb153-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">weight_kg =</span> <span class="fu">c</span>(</span>
<span id="cb153-6"><a href="#cb153-6" aria-hidden="true" tabindex="-1"></a>    <span class="co"># A001</span></span>
<span id="cb153-7"><a href="#cb153-7" aria-hidden="true" tabindex="-1"></a>    <span class="dv">450</span>, <span class="dv">485</span>, <span class="dv">518</span>, <span class="dv">548</span>,</span>
<span id="cb153-8"><a href="#cb153-8" aria-hidden="true" tabindex="-1"></a>    <span class="co"># A002</span></span>
<span id="cb153-9"><a href="#cb153-9" aria-hidden="true" tabindex="-1"></a>    <span class="dv">445</span>, <span class="dv">475</span>, <span class="dv">502</span>, <span class="dv">530</span>,</span>
<span id="cb153-10"><a href="#cb153-10" aria-hidden="true" tabindex="-1"></a>    <span class="co"># A003</span></span>
<span id="cb153-11"><a href="#cb153-11" aria-hidden="true" tabindex="-1"></a>    <span class="dv">455</span>, <span class="dv">492</span>, <span class="dv">525</span>, <span class="dv">556</span></span>
<span id="cb153-12"><a href="#cb153-12" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb153-13"><a href="#cb153-13" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb153-14"><a href="#cb153-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb153-15"><a href="#cb153-15" aria-hidden="true" tabindex="-1"></a>growth_data</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 12 × 3
   animal_id  week weight_kg
   &lt;chr&gt;     &lt;dbl&gt;     &lt;dbl&gt;
 1 A001          0       450
 2 A001          4       485
 3 A001          8       518
 4 A001         12       548
 5 A002          0       445
 6 A002          4       475
 7 A002          8       502
 8 A002         12       530
 9 A003          0       455
10 A003          4       492
11 A003          8       525
12 A003         12       556</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb155"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb155-1"><a href="#cb155-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate growth metrics for each animal</span></span>
<span id="cb155-2"><a href="#cb155-2" aria-hidden="true" tabindex="-1"></a>growth_summary <span class="ot">&lt;-</span> growth_data <span class="sc">%&gt;%</span></span>
<span id="cb155-3"><a href="#cb155-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(animal_id) <span class="sc">%&gt;%</span></span>
<span id="cb155-4"><a href="#cb155-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb155-5"><a href="#cb155-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">previous_weight =</span> <span class="fu">lag</span>(weight_kg),</span>
<span id="cb155-6"><a href="#cb155-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">weight_gain =</span> weight_kg <span class="sc">-</span> <span class="fu">lag</span>(weight_kg),</span>
<span id="cb155-7"><a href="#cb155-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">weeks_elapsed =</span> week <span class="sc">-</span> <span class="fu">lag</span>(week),</span>
<span id="cb155-8"><a href="#cb155-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">daily_gain =</span> weight_gain <span class="sc">/</span> (weeks_elapsed <span class="sc">*</span> <span class="dv">7</span>),</span>
<span id="cb155-9"><a href="#cb155-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">total_gain =</span> weight_kg <span class="sc">-</span> <span class="fu">first</span>(weight_kg),</span>
<span id="cb155-10"><a href="#cb155-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">cumulative_gain =</span> <span class="fu">cumsum</span>(<span class="fu">replace_na</span>(weight_gain, <span class="dv">0</span>))</span>
<span id="cb155-11"><a href="#cb155-11" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb155-12"><a href="#cb155-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>()</span>
<span id="cb155-13"><a href="#cb155-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb155-14"><a href="#cb155-14" aria-hidden="true" tabindex="-1"></a>growth_summary</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 12 × 9
   animal_id  week weight_kg previous_weight weight_gain weeks_elapsed
   &lt;chr&gt;     &lt;dbl&gt;     &lt;dbl&gt;           &lt;dbl&gt;       &lt;dbl&gt;         &lt;dbl&gt;
 1 A001          0       450              NA          NA            NA
 2 A001          4       485             450          35             4
 3 A001          8       518             485          33             4
 4 A001         12       548             518          30             4
 5 A002          0       445              NA          NA            NA
 6 A002          4       475             445          30             4
 7 A002          8       502             475          27             4
 8 A002         12       530             502          28             4
 9 A003          0       455              NA          NA            NA
10 A003          4       492             455          37             4
11 A003          8       525             492          33             4
12 A003         12       556             525          31             4
# ℹ 3 more variables: daily_gain &lt;dbl&gt;, total_gain &lt;dbl&gt;, cumulative_gain &lt;dbl&gt;</code></pre>
</div>
</div>
<hr>
</section>
</section>
<section id="putting-it-all-together-complex-pipelines" class="level2" data-number="4.11">
<h2 data-number="4.11" class="anchored" data-anchor-id="putting-it-all-together-complex-pipelines"><span class="header-section-number">4.11</span> Putting It All Together: Complex Pipelines</h2>
<p>Real data analysis often requires chaining many operations. Here’s a comprehensive example:</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb157"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb157-1"><a href="#cb157-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Create realistic farm data</span></span>
<span id="cb157-2"><a href="#cb157-2" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">123</span>)</span>
<span id="cb157-3"><a href="#cb157-3" aria-hidden="true" tabindex="-1"></a>farm_complete <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb157-4"><a href="#cb157-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">animal_id =</span> <span class="fu">sprintf</span>(<span class="st">"F%04d"</span>, <span class="dv">1</span><span class="sc">:</span><span class="dv">100</span>),</span>
<span id="cb157-5"><a href="#cb157-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">farm =</span> <span class="fu">sample</span>(<span class="fu">c</span>(<span class="st">"North"</span>, <span class="st">"South"</span>, <span class="st">"East"</span>, <span class="st">"West"</span>), <span class="dv">100</span>, <span class="at">replace =</span> <span class="cn">TRUE</span>),</span>
<span id="cb157-6"><a href="#cb157-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">breed =</span> <span class="fu">sample</span>(<span class="fu">c</span>(<span class="st">"Holstein"</span>, <span class="st">"Jersey"</span>, <span class="st">"Angus"</span>, <span class="st">"Hereford"</span>), <span class="dv">100</span>,</span>
<span id="cb157-7"><a href="#cb157-7" aria-hidden="true" tabindex="-1"></a>                 <span class="at">replace =</span> <span class="cn">TRUE</span>, <span class="at">prob =</span> <span class="fu">c</span>(<span class="fl">0.4</span>, <span class="fl">0.3</span>, <span class="fl">0.2</span>, <span class="fl">0.1</span>)),</span>
<span id="cb157-8"><a href="#cb157-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">sex =</span> <span class="fu">sample</span>(<span class="fu">c</span>(<span class="st">"M"</span>, <span class="st">"F"</span>), <span class="dv">100</span>, <span class="at">replace =</span> <span class="cn">TRUE</span>),</span>
<span id="cb157-9"><a href="#cb157-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">birth_date =</span> <span class="fu">as.Date</span>(<span class="st">"2022-01-01"</span>) <span class="sc">+</span> <span class="fu">sample</span>(<span class="dv">0</span><span class="sc">:</span><span class="dv">365</span>, <span class="dv">100</span>, <span class="at">replace =</span> <span class="cn">TRUE</span>),</span>
<span id="cb157-10"><a href="#cb157-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">weight_kg =</span> <span class="fu">rnorm</span>(<span class="dv">100</span>, <span class="at">mean =</span> <span class="dv">500</span>, <span class="at">sd =</span> <span class="dv">80</span>),</span>
<span id="cb157-11"><a href="#cb157-11" aria-hidden="true" tabindex="-1"></a>  <span class="at">health_status =</span> <span class="fu">sample</span>(<span class="fu">c</span>(<span class="st">"Good"</span>, <span class="st">"Fair"</span>, <span class="st">"Poor"</span>, <span class="cn">NA</span>), <span class="dv">100</span>,</span>
<span id="cb157-12"><a href="#cb157-12" aria-hidden="true" tabindex="-1"></a>                        <span class="at">replace =</span> <span class="cn">TRUE</span>, <span class="at">prob =</span> <span class="fu">c</span>(<span class="fl">0.7</span>, <span class="fl">0.2</span>, <span class="fl">0.05</span>, <span class="fl">0.05</span>))</span>
<span id="cb157-13"><a href="#cb157-13" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb157-14"><a href="#cb157-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb157-15"><a href="#cb157-15" aria-hidden="true" tabindex="-1"></a><span class="co"># Preview</span></span>
<span id="cb157-16"><a href="#cb157-16" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(farm_complete, <span class="dv">3</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 7
  animal_id farm  breed    sex   birth_date weight_kg health_status
  &lt;chr&gt;     &lt;chr&gt; &lt;chr&gt;    &lt;chr&gt; &lt;date&gt;         &lt;dbl&gt; &lt;chr&gt;        
1 F0001     East  Jersey   F     2022-08-06      397. Fair         
2 F0002     East  Holstein F     2022-04-16      454. Good         
3 F0003     East  Jersey   F     2022-07-05      549. Good         </code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb159"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb159-1"><a href="#cb159-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Complex analysis pipeline</span></span>
<span id="cb159-2"><a href="#cb159-2" aria-hidden="true" tabindex="-1"></a>analysis_result <span class="ot">&lt;-</span> farm_complete <span class="sc">%&gt;%</span></span>
<span id="cb159-3"><a href="#cb159-3" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Data cleaning</span></span>
<span id="cb159-4"><a href="#cb159-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">drop_na</span>(health_status) <span class="sc">%&gt;%</span>                    <span class="co"># Remove missing health status</span></span>
<span id="cb159-5"><a href="#cb159-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(health_status <span class="sc">!=</span> <span class="st">"Poor"</span>) <span class="sc">%&gt;%</span>           <span class="co"># Exclude poor health</span></span>
<span id="cb159-6"><a href="#cb159-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb159-7"><a href="#cb159-7" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Calculate age</span></span>
<span id="cb159-8"><a href="#cb159-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">age_days =</span> <span class="fu">as.numeric</span>(<span class="fu">Sys.Date</span>() <span class="sc">-</span> birth_date),</span>
<span id="cb159-9"><a href="#cb159-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">age_months =</span> age_days <span class="sc">/</span> <span class="fl">30.44</span>,</span>
<span id="cb159-10"><a href="#cb159-10" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Standardize breed names</span></span>
<span id="cb159-11"><a href="#cb159-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">breed =</span> <span class="fu">str_to_title</span>(breed),</span>
<span id="cb159-12"><a href="#cb159-12" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Weight categories</span></span>
<span id="cb159-13"><a href="#cb159-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">weight_class =</span> <span class="fu">case_when</span>(</span>
<span id="cb159-14"><a href="#cb159-14" aria-hidden="true" tabindex="-1"></a>      weight_kg <span class="sc">&lt;</span> <span class="dv">450</span> <span class="sc">~</span> <span class="st">"Light"</span>,</span>
<span id="cb159-15"><a href="#cb159-15" aria-hidden="true" tabindex="-1"></a>      weight_kg <span class="sc">&lt;</span> <span class="dv">550</span> <span class="sc">~</span> <span class="st">"Medium"</span>,</span>
<span id="cb159-16"><a href="#cb159-16" aria-hidden="true" tabindex="-1"></a>      <span class="cn">TRUE</span> <span class="sc">~</span> <span class="st">"Heavy"</span></span>
<span id="cb159-17"><a href="#cb159-17" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb159-18"><a href="#cb159-18" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Round weight</span></span>
<span id="cb159-19"><a href="#cb159-19" aria-hidden="true" tabindex="-1"></a>    <span class="at">weight_kg =</span> <span class="fu">round</span>(weight_kg, <span class="dv">1</span>)</span>
<span id="cb159-20"><a href="#cb159-20" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb159-21"><a href="#cb159-21" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Filter to mature animals only</span></span>
<span id="cb159-22"><a href="#cb159-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(age_months <span class="sc">&gt;=</span> <span class="dv">10</span>) <span class="sc">%&gt;%</span></span>
<span id="cb159-23"><a href="#cb159-23" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Group analysis</span></span>
<span id="cb159-24"><a href="#cb159-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(farm, breed) <span class="sc">%&gt;%</span></span>
<span id="cb159-25"><a href="#cb159-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(</span>
<span id="cb159-26"><a href="#cb159-26" aria-hidden="true" tabindex="-1"></a>    <span class="at">n =</span> <span class="fu">n</span>(),</span>
<span id="cb159-27"><a href="#cb159-27" aria-hidden="true" tabindex="-1"></a>    <span class="at">mean_weight =</span> <span class="fu">round</span>(<span class="fu">mean</span>(weight_kg), <span class="dv">1</span>),</span>
<span id="cb159-28"><a href="#cb159-28" aria-hidden="true" tabindex="-1"></a>    <span class="at">sd_weight =</span> <span class="fu">round</span>(<span class="fu">sd</span>(weight_kg), <span class="dv">1</span>),</span>
<span id="cb159-29"><a href="#cb159-29" aria-hidden="true" tabindex="-1"></a>    <span class="at">min_weight =</span> <span class="fu">min</span>(weight_kg),</span>
<span id="cb159-30"><a href="#cb159-30" aria-hidden="true" tabindex="-1"></a>    <span class="at">max_weight =</span> <span class="fu">max</span>(weight_kg),</span>
<span id="cb159-31"><a href="#cb159-31" aria-hidden="true" tabindex="-1"></a>    <span class="at">prop_heavy =</span> <span class="fu">mean</span>(weight_class <span class="sc">==</span> <span class="st">"Heavy"</span>),</span>
<span id="cb159-32"><a href="#cb159-32" aria-hidden="true" tabindex="-1"></a>    <span class="at">.groups =</span> <span class="st">"drop"</span></span>
<span id="cb159-33"><a href="#cb159-33" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb159-34"><a href="#cb159-34" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Filter to groups with at least 3 animals</span></span>
<span id="cb159-35"><a href="#cb159-35" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(n <span class="sc">&gt;=</span> <span class="dv">3</span>) <span class="sc">%&gt;%</span></span>
<span id="cb159-36"><a href="#cb159-36" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Sort by mean weight</span></span>
<span id="cb159-37"><a href="#cb159-37" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(mean_weight)) <span class="sc">%&gt;%</span></span>
<span id="cb159-38"><a href="#cb159-38" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Add ranking</span></span>
<span id="cb159-39"><a href="#cb159-39" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">rank =</span> <span class="fu">row_number</span>())</span>
<span id="cb159-40"><a href="#cb159-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb159-41"><a href="#cb159-41" aria-hidden="true" tabindex="-1"></a>analysis_result</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 13 × 9
   farm  breed        n mean_weight sd_weight min_weight max_weight prop_heavy
   &lt;chr&gt; &lt;chr&gt;    &lt;int&gt;       &lt;dbl&gt;     &lt;dbl&gt;      &lt;dbl&gt;      &lt;dbl&gt;      &lt;dbl&gt;
 1 North Hereford     4        549.      47.1       485.       599.     0.75  
 2 North Jersey       6        538.      64.3       438.       628.     0.5   
 3 South Holstein     8        538.      89.1       443.       663      0.375 
 4 North Holstein    13        532.      72.7       409        683.     0.385 
 5 East  Angus        6        529.      70.5       440.       604      0.5   
 6 East  Jersey      10        500       99.9       339.       649.     0.3   
 7 West  Holstein     6        492.     105.        367.       652.     0.333 
 8 South Jersey      12        482.      71.9       362.       660.     0.0833
 9 West  Jersey       5        481.      60.4       395.       559.     0.2   
10 West  Hereford     3        463.      50         419.       517      0     
11 South Angus        3        461.      17.1       441.       471.     0     
12 West  Angus        3        457.      59.1       392.       507.     0     
13 East  Holstein     9        452.      77.7       360.       577      0.111 
# ℹ 1 more variable: rank &lt;int&gt;</code></pre>
</div>
</div>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
<span class="screen-reader-only">Tip</span>Complex Pipeline Best Practices
</div>
</div>
<div class="callout-body-container callout-body">
<ol type="1">
<li><strong>Comment your steps</strong>: Explain what each section does</li>
<li><strong>One operation per line</strong>: Easier to read and debug</li>
<li><strong>Use intermediate results</strong>: Break very long pipes into steps</li>
<li><strong>Check intermediate output</strong>: Run the pipe up to a certain point to verify</li>
<li><strong>Consistent indentation</strong>: 2 spaces after pipe</li>
</ol>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb161"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb161-1"><a href="#cb161-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Good structure</span></span>
<span id="cb161-2"><a href="#cb161-2" aria-hidden="true" tabindex="-1"></a>result <span class="ot">&lt;-</span> data <span class="sc">%&gt;%</span></span>
<span id="cb161-3"><a href="#cb161-3" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Step 1: Clean data</span></span>
<span id="cb161-4"><a href="#cb161-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(important_var)) <span class="sc">%&gt;%</span></span>
<span id="cb161-5"><a href="#cb161-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">clean_var =</span> <span class="fu">str_trim</span>(var)) <span class="sc">%&gt;%</span></span>
<span id="cb161-6"><a href="#cb161-6" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Step 2: Calculate new variables</span></span>
<span id="cb161-7"><a href="#cb161-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb161-8"><a href="#cb161-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">var1 =</span> calculation1,</span>
<span id="cb161-9"><a href="#cb161-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">var2 =</span> calculation2</span>
<span id="cb161-10"><a href="#cb161-10" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb161-11"><a href="#cb161-11" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Step 3: Summarize by group</span></span>
<span id="cb161-12"><a href="#cb161-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(category) <span class="sc">%&gt;%</span></span>
<span id="cb161-13"><a href="#cb161-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(</span>
<span id="cb161-14"><a href="#cb161-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">mean_value =</span> <span class="fu">mean</span>(value),</span>
<span id="cb161-15"><a href="#cb161-15" aria-hidden="true" tabindex="-1"></a>    <span class="at">.groups =</span> <span class="st">"drop"</span></span>
<span id="cb161-16"><a href="#cb161-16" aria-hidden="true" tabindex="-1"></a>  )</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
</div>
</div>
<hr>
</section>
<section id="summary" class="level2" data-number="4.12">
<h2 data-number="4.12" class="anchored" data-anchor-id="summary"><span class="header-section-number">4.12</span> Summary</h2>
<p>This chapter covered powerful dplyr verbs for data manipulation:</p>
<ul>
<li><strong><code>mutate()</code></strong> creates and modifies columns, works with functions and calculations</li>
<li><strong><code>if_else()</code></strong> applies simple conditional logic (if/then/else)</li>
<li><strong><code>case_when()</code></strong> handles multiple conditions elegantly (replaces nested if_else)</li>
<li><strong><code>arrange()</code></strong> sorts data by one or more columns in ascending or descending order</li>
<li><strong><code>summarise()</code></strong> calculates summary statistics (mean, sd, min, max, count, etc.)</li>
<li><strong><code>group_by()</code></strong> + <code>summarise()</code> performs grouped operations (summaries by category)</li>
<li><strong><code>count()</code></strong> quickly counts observations per group</li>
<li><strong><code>rename()</code></strong> changes column names; <code>relocate()</code> reorders columns</li>
<li><strong><code>across()</code></strong> applies functions to multiple columns efficiently</li>
<li><strong>Missing data</strong> can be detected (<code>is.na()</code>), removed (<code>drop_na()</code>), or replaced (<code>replace_na()</code>, <code>coalesce()</code>)</li>
<li><strong>Window functions</strong> (<code>lag()</code>, <code>lead()</code>, <code>cumsum()</code>, ranking) operate within groups</li>
<li><strong>Complex pipelines</strong> chain many operations together for complete data transformations</li>
</ul>
<p><strong>Key Principle</strong>: Start simple, build complexity gradually, and always check your work!</p>
<p><strong>Next chapter</strong>: Data visualization with ggplot2!</p>
<hr>
</section>
<section id="homework-assignment" class="level2" data-number="4.13">
<h2 data-number="4.13" class="anchored" data-anchor-id="homework-assignment"><span class="header-section-number">4.13</span> Homework Assignment</h2>
<section id="assignment-data-transformation-and-analysis" class="level3" data-number="4.13.1">
<h3 data-number="4.13.1" class="anchored" data-anchor-id="assignment-data-transformation-and-analysis"><span class="header-section-number">4.13.1</span> Assignment: Data Transformation and Analysis</h3>
<p><strong>Due</strong>: Before Week 5</p>
<section id="part-1-creating-variables-25-points" class="level4" data-number="4.13.1.1">
<h4 data-number="4.13.1.1" class="anchored" data-anchor-id="part-1-creating-variables-25-points"><span class="header-section-number">4.13.1.1</span> Part 1: Creating Variables (25 points)</h4>
<p>You will receive a dataset called <code>pig_growth.csv</code> with the following columns: - <code>pig_id</code>: Pig identifier - <code>birth_date</code>: Date of birth (YYYY-MM-DD) - <code>breed</code>: Pig breed - <code>sex</code>: M or F - <code>weight_day0</code>: Birth weight (kg) - <code>weight_day28</code>: Weight at 28 days (kg) - <code>weight_day56</code>: Weight at 56 days (kg) - <code>feed_type</code>: Type of feed given</p>
<p>Tasks:</p>
<ol type="1">
<li><strong>Read the data</strong> and examine its structure</li>
<li><strong>Create new variables</strong> using <code>mutate()</code>:
<ul>
<li><code>age_days</code>: Calculate age in days from birth_date to today</li>
<li><code>gain_0_28</code>: Weight gain from day 0 to day 28</li>
<li><code>gain_28_56</code>: Weight gain from day 28 to day 56</li>
<li><code>adg_0_28</code>: Average daily gain for first period (gain / 28)</li>
<li><code>adg_28_56</code>: Average daily gain for second period (gain / 28)</li>
</ul></li>
<li><strong>Create categorical variables</strong>:
<ul>
<li><code>birth_weight_class</code>: “Low” (&lt;1.2 kg), “Normal” (1.2-1.6 kg), “High” (&gt;1.6 kg)</li>
<li><code>sex_label</code>: Convert “M” to “Male”, “F” to “Female”</li>
</ul></li>
<li><strong>Round</strong> all weight and gain variables to 2 decimal places</li>
</ol>
</section>
<section id="part-2-conditional-logic-25-points" class="level4" data-number="4.13.1.2">
<h4 data-number="4.13.1.2" class="anchored" data-anchor-id="part-2-conditional-logic-25-points"><span class="header-section-number">4.13.1.2</span> Part 2: Conditional Logic (25 points)</h4>
<p>Using your data with new variables:</p>
<ol type="1">
<li><strong>Create a performance category</strong> using <code>case_when()</code>:
<ul>
<li>“Excellent”: adg_28_56 &gt; 0.50 kg/day AND weight_day56 &gt; 18 kg</li>
<li>“Good”: adg_28_56 &gt; 0.45 kg/day</li>
<li>“Fair”: adg_28_56 &gt; 0.40 kg/day</li>
<li>“Poor”: everything else</li>
</ul></li>
<li><strong>Create a treatment recommendation</strong> using conditional logic:
<ul>
<li>If performance is “Poor” AND sex is “M”: “Supplement + Monitor”</li>
<li>If performance is “Poor” AND sex is “F”: “Supplement”</li>
<li>If performance is “Fair”: “Monitor”</li>
<li>Otherwise: “Continue”</li>
</ul></li>
<li><strong>Identify concerning cases</strong>:
<ul>
<li>Create a logical variable <code>needs_attention</code> that is TRUE if:
<ul>
<li>Weight gain in second period is LESS than first period, OR</li>
<li>Current weight is below 12 kg</li>
</ul></li>
</ul></li>
</ol>
</section>
<section id="part-3-grouped-summaries-30-points" class="level4" data-number="4.13.1.3">
<h4 data-number="4.13.1.3" class="anchored" data-anchor-id="part-3-grouped-summaries-30-points"><span class="header-section-number">4.13.1.3</span> Part 3: Grouped Summaries (30 points)</h4>
<p>Calculate comprehensive summary statistics:</p>
<ol type="1">
<li><strong>Overall summaries</strong> (no grouping):
<ul>
<li>Number of pigs</li>
<li>Mean birth weight, day 28 weight, day 56 weight</li>
<li>Mean ADG for both periods</li>
<li>Number and proportion needing attention</li>
</ul></li>
<li><strong>Summaries by breed</strong>:
<ul>
<li>Count of pigs per breed</li>
<li>Mean ADG (both periods) per breed</li>
<li>SD of ADG per breed</li>
<li>Min and max day 56 weight per breed</li>
</ul></li>
<li><strong>Summaries by feed type AND sex</strong>:
<ul>
<li>Count per combination</li>
<li>Mean day 56 weight</li>
<li>Proportion in each performance category</li>
</ul></li>
<li><strong>Summaries by performance category</strong>:
<ul>
<li>Count per category</li>
<li>Mean ADG in period 2</li>
<li>What proportion of each category is male vs female?</li>
</ul></li>
</ol>
<p><strong>Hint</strong>: Use <code>group_by()</code> + <code>summarise()</code> for each question. You may need <code>across()</code> for multiple columns.</p>
</section>
<section id="part-4-complex-pipeline-20-points" class="level4" data-number="4.13.1.4">
<h4 data-number="4.13.1.4" class="anchored" data-anchor-id="part-4-complex-pipeline-20-points"><span class="header-section-number">4.13.1.4</span> Part 4: Complex Pipeline (20 points)</h4>
<p>Create ONE pipeline that:</p>
<ol type="1">
<li>Starts with the raw data</li>
<li>Removes any pigs with missing weight measurements</li>
<li>Calculates all new variables from Part 1</li>
<li>Creates categories from Part 2</li>
<li>Filters to pigs with birth_weight_class == “Normal”</li>
<li>Filters to feed_type “A” or “B” only</li>
<li>Groups by feed_type and sex</li>
<li>Calculates mean day 56 weight and ADG for period 2</li>
<li>Arranges by mean day 56 weight (descending)</li>
<li>Adds a rank column</li>
</ol>
<p>Show: - The complete pipeline (with comments explaining each step) - The final output - How many rows in the final result?</p>
</section>
</section>
<section id="recommended-yaml" class="level3" data-number="4.13.2">
<h3 data-number="4.13.2" class="anchored" data-anchor-id="recommended-yaml"><span class="header-section-number">4.13.2</span> Recommended YAML</h3>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb162"><pre class="sourceCode yaml code-with-copy"><code class="sourceCode yaml"><span id="cb162-1"><a href="#cb162-1" aria-hidden="true" tabindex="-1"></a><span class="pp">---</span></span>
<span id="cb162-2"><a href="#cb162-2" aria-hidden="true" tabindex="-1"></a><span class="fu">title</span><span class="kw">:</span><span class="at"> </span><span class="st">"Week 4 Homework: Data Manipulation with dplyr"</span></span>
<span id="cb162-3"><a href="#cb162-3" aria-hidden="true" tabindex="-1"></a><span class="fu">author</span><span class="kw">:</span><span class="at"> </span><span class="st">"Your Name"</span></span>
<span id="cb162-4"><a href="#cb162-4" aria-hidden="true" tabindex="-1"></a><span class="fu">date</span><span class="kw">:</span><span class="at"> today</span></span>
<span id="cb162-5"><a href="#cb162-5" aria-hidden="true" tabindex="-1"></a><span class="fu">format</span><span class="kw">:</span></span>
<span id="cb162-6"><a href="#cb162-6" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">html</span><span class="kw">:</span></span>
<span id="cb162-7"><a href="#cb162-7" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">toc</span><span class="kw">:</span><span class="at"> </span><span class="ch">true</span></span>
<span id="cb162-8"><a href="#cb162-8" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">toc-depth</span><span class="kw">:</span><span class="at"> </span><span class="dv">3</span></span>
<span id="cb162-9"><a href="#cb162-9" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">code-fold</span><span class="kw">:</span><span class="at"> </span><span class="ch">false</span></span>
<span id="cb162-10"><a href="#cb162-10" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">theme</span><span class="kw">:</span><span class="at"> cosmo</span></span>
<span id="cb162-11"><a href="#cb162-11" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">embed-resources</span><span class="kw">:</span><span class="at"> </span><span class="ch">true</span></span>
<span id="cb162-12"><a href="#cb162-12" aria-hidden="true" tabindex="-1"></a><span class="fu">execute</span><span class="kw">:</span></span>
<span id="cb162-13"><a href="#cb162-13" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">warning</span><span class="kw">:</span><span class="at"> </span><span class="ch">false</span></span>
<span id="cb162-14"><a href="#cb162-14" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">message</span><span class="kw">:</span><span class="at"> </span><span class="ch">false</span></span>
<span id="cb162-15"><a href="#cb162-15" aria-hidden="true" tabindex="-1"></a><span class="pp">---</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</section>
<section id="grading-rubric" class="level3" data-number="4.13.3">
<h3 data-number="4.13.3" class="anchored" data-anchor-id="grading-rubric"><span class="header-section-number">4.13.3</span> Grading Rubric</h3>
<ul>
<li><strong>Part 1: Creating Variables (25%)</strong>:
<ul>
<li>All variables created correctly (15%)</li>
<li>Proper use of <code>mutate()</code> (5%)</li>
<li>Rounding applied correctly (5%)</li>
</ul></li>
<li><strong>Part 2: Conditional Logic (25%)</strong>:
<ul>
<li>Performance category correct (10%)</li>
<li>Treatment recommendation correct (8%)</li>
<li>Needs attention logic correct (7%)</li>
</ul></li>
<li><strong>Part 3: Grouped Summaries (30%)</strong>:
<ul>
<li>Overall summaries (8%)</li>
<li>Breed summaries (8%)</li>
<li>Feed/sex summaries (7%)</li>
<li>Performance category summaries (7%)</li>
</ul></li>
<li><strong>Part 4: Complex Pipeline (20%)</strong>:
<ul>
<li>Pipeline executes correctly (12%)</li>
<li>All steps included (5%)</li>
<li>Clear comments and documentation (3%)</li>
</ul></li>
</ul>
</section>
<section id="bonus-10-points" class="level3" data-number="4.13.4">
<h3 data-number="4.13.4" class="anchored" data-anchor-id="bonus-10-points"><span class="header-section-number">4.13.4</span> Bonus (10 points)</h3>
<ol type="1">
<li><strong>Window functions</strong>:
<ul>
<li>For each pig, calculate the difference between their day 56 weight and the breed average day 56 weight</li>
<li>Rank pigs within their breed by day 56 weight</li>
</ul></li>
<li><strong>Advanced grouping</strong>:
<ul>
<li>Identify the top 3 breeds by mean ADG in period 2</li>
<li>For just those breeds, create a detailed summary with all statistics</li>
</ul></li>
</ol>
<hr>
</section>
</section>
<section id="additional-resources" class="level2" data-number="4.14">
<h2 data-number="4.14" class="anchored" data-anchor-id="additional-resources"><span class="header-section-number">4.14</span> Additional Resources</h2>
<section id="required-reading" class="level3" data-number="4.14.1">
<h3 data-number="4.14.1" class="anchored" data-anchor-id="required-reading"><span class="header-section-number">4.14.1</span> Required Reading</h3>
<ul>
<li><a href="https://r4ds.hadley.nz/">R for Data Science (2e)</a> - Chapters 3-5: Data transformation</li>
<li><a href="https://dplyr.tidyverse.org/">dplyr documentation</a></li>
<li><a href="https://dplyr.tidyverse.org/articles/dplyr.html">dplyr vignettes</a> - Introduction to dplyr</li>
</ul>
</section>
<section id="optional-reading" class="level3" data-number="4.14.2">
<h3 data-number="4.14.2" class="anchored" data-anchor-id="optional-reading"><span class="header-section-number">4.14.2</span> Optional Reading</h3>
<ul>
<li>Wickham, H., et al.&nbsp;(2019). “Welcome to the Tidyverse.” <em>Journal of Open Source Software</em>, 4(43), 1686. <a href="https://joss.theoj.org/papers/10.21105/joss.01686">Link</a></li>
<li><a href="https://dplyr.tidyverse.org/articles/programming.html">Programming with dplyr</a> - Advanced techniques</li>
<li><a href="https://dplyr.tidyverse.org/articles/rowwise.html">Row-wise operations</a> - Working row-by-row</li>
</ul>
</section>
<section id="videos" class="level3" data-number="4.14.3">
<h3 data-number="4.14.3" class="anchored" data-anchor-id="videos"><span class="header-section-number">4.14.3</span> Videos</h3>
<ul>
<li>“Data Manipulation in R” by StatQuest with Josh Starmer</li>
<li>“dplyr Tutorial” by RStudio / Posit</li>
<li>“Tidy Data and tidyr” by RStudio / Posit</li>
<li>“grouped operations in dplyr” by Data Science Dojo</li>
</ul>
</section>
<section id="cheat-sheets" class="level3" data-number="4.14.4">
<h3 data-number="4.14.4" class="anchored" data-anchor-id="cheat-sheets"><span class="header-section-number">4.14.4</span> Cheat Sheets</h3>
<ul>
<li><a href="https://rstudio.github.io/cheatsheets/data-transformation.pdf">dplyr Cheat Sheet</a></li>
<li><a href="https://rstudio.github.io/cheatsheets/tidyr.pdf">tidyr Cheat Sheet</a></li>
</ul>
</section>
<section id="interactive-learning" class="level3" data-number="4.14.5">
<h3 data-number="4.14.5" class="anchored" data-anchor-id="interactive-learning"><span class="header-section-number">4.14.5</span> Interactive Learning</h3>
<ul>
<li><a href="https://r4ds.hadley.nz/">dplyr exercises on R for Data Science</a></li>
<li><a href="https://posit.cloud/learn/primers/2">RStudio Primers: Work with Data</a></li>
</ul>
</section>
<section id="useful-websites" class="level3" data-number="4.14.6">
<h3 data-number="4.14.6" class="anchored" data-anchor-id="useful-websites"><span class="header-section-number">4.14.6</span> Useful Websites</h3>
<ul>
<li><a href="https://www.tidyverse.org/">Tidyverse</a> - Main tidyverse homepage</li>
<li><a href="https://stackoverflow.com/questions/tagged/dplyr">Stack Overflow: dplyr</a> - Q&amp;A community</li>
<li><a href="https://community.rstudio.com/">RStudio Community</a> - Friendly help forum</li>
<li><a href="https://github.com/tidyverse/dplyr">dplyr GitHub</a> - Source code and issues</li>
</ul>
<hr>
<p><strong>Next Chapter</strong>: <a href="../chapters/ch05-ggplot2_intro.html">Introduction to Data Visualization with ggplot2</a></p>


<!-- -->

</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    const icon = "";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
      const outerScaffold = trigger.parentElement.cloneNode(true);
      const codeEl = outerScaffold.querySelector('code');
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
    const viewSource = window.document.getElementById('quarto-view-source') ||
                       window.document.getElementById('quarto-code-tools-source');
    if (viewSource) {
      const sourceUrl = viewSource.getAttribute("data-quarto-source-url");
      viewSource.addEventListener("click", function(e) {
        if (sourceUrl) {
          // rstudio viewer pane
          if (/\bcapabilities=\b/.test(window.location)) {
            window.open(sourceUrl);
          } else {
            window.location.href = sourceUrl;
          }
        } else {
          const modal = new bootstrap.Modal(document.getElementById('quarto-embedded-source-code-modal'));
          modal.show();
        }
        return false;
      });
    }
    function toggleCodeHandler(show) {
      return function(e) {
        const detailsSrc = window.document.querySelectorAll(".cell > details > .sourceCode");
        for (let i=0; i<detailsSrc.length; i++) {
          const details = detailsSrc[i].parentElement;
          if (show) {
            details.open = true;
          } else {
            details.removeAttribute("open");
          }
        }
        const cellCodeDivs = window.document.querySelectorAll(".cell > .sourceCode");
        const fromCls = show ? "hidden" : "unhidden";
        const toCls = show ? "unhidden" : "hidden";
        for (let i=0; i<cellCodeDivs.length; i++) {
          const codeDiv = cellCodeDivs[i];
          if (codeDiv.classList.contains(fromCls)) {
            codeDiv.classList.remove(fromCls);
            codeDiv.classList.add(toCls);
          } 
        }
        return false;
      }
    }
    const hideAllCode = window.document.getElementById("quarto-hide-all-code");
    if (hideAllCode) {
      hideAllCode.addEventListener("click", toggleCodeHandler(false));
    }
    const showAllCode = window.document.getElementById("quarto-show-all-code");
    if (showAllCode) {
      showAllCode.addEventListener("click", toggleCodeHandler(true));
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp('/' + window.location.host + '/');
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
            // target, if specified
            link.setAttribute("target", "_blank");
            if (link.getAttribute("rel") === null) {
              link.setAttribute("rel", "noopener");
            }
            // default icon
            link.classList.add("external");
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="../chapters/ch03-data_types_strings_dplyr.html" class="pagination-link" aria-label="Data Types, Strings, and Introduction to dplyr">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Data Types, Strings, and Introduction to dplyr</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="../chapters/ch05-ggplot2_intro.html" class="pagination-link" aria-label="Introduction to Data Visualization with ggplot2">
        <span class="nav-page-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Introduction to Data Visualization with ggplot2</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav><div class="modal fade" id="quarto-embedded-source-code-modal" tabindex="-1" aria-labelledby="quarto-embedded-source-code-modal-label" aria-hidden="true"><div class="modal-dialog modal-dialog-scrollable"><div class="modal-content"><div class="modal-header"><h5 class="modal-title" id="quarto-embedded-source-code-modal-label">Source Code</h5><button class="btn-close" data-bs-dismiss="modal"></button></div><div class="modal-body"><div class="">
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb163" data-shortcodes="false"><pre class="sourceCode markdown code-with-copy"><code class="sourceCode markdown"><span id="cb163-1"><a href="#cb163-1" aria-hidden="true" tabindex="-1"></a><span class="fu"># Data Manipulation with dplyr</span></span>
<span id="cb163-2"><a href="#cb163-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb163-3"><a href="#cb163-3" aria-hidden="true" tabindex="-1"></a><span class="fu">## Learning Objectives</span></span>
<span id="cb163-4"><a href="#cb163-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb163-5"><a href="#cb163-5" aria-hidden="true" tabindex="-1"></a>By the end of this chapter, you will be able to:</span>
<span id="cb163-6"><a href="#cb163-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb163-7"><a href="#cb163-7" aria-hidden="true" tabindex="-1"></a><span class="ss">1. </span>Create and modify variables using <span class="in">`dplyr::mutate()`</span></span>
<span id="cb163-8"><a href="#cb163-8" aria-hidden="true" tabindex="-1"></a><span class="ss">2. </span>Sort data using <span class="in">`dplyr::arrange()`</span> in ascending and descending order</span>
<span id="cb163-9"><a href="#cb163-9" aria-hidden="true" tabindex="-1"></a><span class="ss">3. </span>Calculate summary statistics using <span class="in">`dplyr::summarise()`</span></span>
<span id="cb163-10"><a href="#cb163-10" aria-hidden="true" tabindex="-1"></a><span class="ss">4. </span>Perform grouped operations with <span class="in">`group_by()`</span> and <span class="in">`summarise()`</span></span>
<span id="cb163-11"><a href="#cb163-11" aria-hidden="true" tabindex="-1"></a><span class="ss">5. </span>Use helper functions: <span class="in">`count()`</span>, <span class="in">`rename()`</span>, and <span class="in">`relocate()`</span></span>
<span id="cb163-12"><a href="#cb163-12" aria-hidden="true" tabindex="-1"></a><span class="ss">6. </span>Apply conditional logic with <span class="in">`if_else()`</span> and <span class="in">`case_when()`</span></span>
<span id="cb163-13"><a href="#cb163-13" aria-hidden="true" tabindex="-1"></a><span class="ss">7. </span>Work across multiple columns efficiently using <span class="in">`across()`</span></span>
<span id="cb163-14"><a href="#cb163-14" aria-hidden="true" tabindex="-1"></a><span class="ss">8. </span>Handle missing data with <span class="in">`is.na()`</span>, <span class="in">`drop_na()`</span>, <span class="in">`replace_na()`</span>, and <span class="in">`coalesce()`</span></span>
<span id="cb163-15"><a href="#cb163-15" aria-hidden="true" tabindex="-1"></a><span class="ss">9. </span>Use window functions: <span class="in">`lag()`</span>, <span class="in">`lead()`</span>, <span class="in">`cumsum()`</span>, and <span class="in">`row_number()`</span></span>
<span id="cb163-16"><a href="#cb163-16" aria-hidden="true" tabindex="-1"></a><span class="ss">10. </span>Chain multiple dplyr operations into complex data transformation pipelines</span>
<span id="cb163-17"><a href="#cb163-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb163-18"><a href="#cb163-18" aria-hidden="true" tabindex="-1"></a>---</span>
<span id="cb163-19"><a href="#cb163-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb163-20"><a href="#cb163-20" aria-hidden="true" tabindex="-1"></a><span class="fu">## Introduction to dplyr Verbs</span></span>
<span id="cb163-21"><a href="#cb163-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb163-22"><a href="#cb163-22" aria-hidden="true" tabindex="-1"></a>In the previous chapter, you learned <span class="in">`select()`</span> and <span class="in">`filter()`</span> for choosing columns and rows. This chapter covers the remaining core dplyr verbs that complete your data manipulation toolkit.</span>
<span id="cb163-23"><a href="#cb163-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb163-24"><a href="#cb163-24" aria-hidden="true" tabindex="-1"></a><span class="fu">### The Five Main dplyr Verbs</span></span>
<span id="cb163-25"><a href="#cb163-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb163-28"><a href="#cb163-28" aria-hidden="true" tabindex="-1"></a><span class="in">```{mermaid}</span></span>
<span id="cb163-29"><a href="#cb163-29" aria-hidden="true" tabindex="-1"></a>flowchart TD</span>
<span id="cb163-30"><a href="#cb163-30" aria-hidden="true" tabindex="-1"></a>    A[dplyr Verbs] --&gt; B[<span class="fu">select</span>&lt;br/&gt;Pick columns]</span>
<span id="cb163-31"><a href="#cb163-31" aria-hidden="true" tabindex="-1"></a>    A --&gt; C[filter&lt;br/&gt;Pick rows]</span>
<span id="cb163-32"><a href="#cb163-32" aria-hidden="true" tabindex="-1"></a>    A --&gt; D[mutate&lt;br/&gt;Create/modify columns]</span>
<span id="cb163-33"><a href="#cb163-33" aria-hidden="true" tabindex="-1"></a>    A --&gt; E[arrange&lt;br/&gt;Sort rows]</span>
<span id="cb163-34"><a href="#cb163-34" aria-hidden="true" tabindex="-1"></a>    A --&gt; F[summarise&lt;br/&gt;Calculate summaries]</span>
<span id="cb163-35"><a href="#cb163-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb163-36"><a href="#cb163-36" aria-hidden="true" tabindex="-1"></a>    B --&gt; B1[<span class="ot">"</span><span class="st">select(animal_id, weight)</span><span class="ot">"</span>]</span>
<span id="cb163-37"><a href="#cb163-37" aria-hidden="true" tabindex="-1"></a>    C --&gt; C1[<span class="ot">"</span><span class="st">filter(weight &gt; 450)</span><span class="ot">"</span>]</span>
<span id="cb163-38"><a href="#cb163-38" aria-hidden="true" tabindex="-1"></a>    D --&gt; D1[<span class="ot">"</span><span class="st">mutate(bmi = weight/height)</span><span class="ot">"</span>]</span>
<span id="cb163-39"><a href="#cb163-39" aria-hidden="true" tabindex="-1"></a>    E --&gt; E1[<span class="ot">"</span><span class="st">arrange(weight)</span><span class="ot">"</span>]</span>
<span id="cb163-40"><a href="#cb163-40" aria-hidden="true" tabindex="-1"></a>    F --&gt; F1[<span class="ot">"</span><span class="st">summarise(mean_weight = mean(weight))</span><span class="ot">"</span>]</span>
<span id="cb163-41"><a href="#cb163-41" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb163-42"><a href="#cb163-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb163-43"><a href="#cb163-43" aria-hidden="true" tabindex="-1"></a>**This chapter focuses on**: <span class="in">`mutate()`</span>, <span class="in">`arrange()`</span>, <span class="in">`summarise()`</span>, and <span class="in">`group_by()`</span></span>
<span id="cb163-44"><a href="#cb163-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb163-45"><a href="#cb163-45" aria-hidden="true" tabindex="-1"></a>::: {.callout-note}</span>
<span id="cb163-46"><a href="#cb163-46" aria-hidden="true" tabindex="-1"></a><span class="fu">## Review: Data Used in This Chapter</span></span>
<span id="cb163-47"><a href="#cb163-47" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb163-48"><a href="#cb163-48" aria-hidden="true" tabindex="-1"></a>We'll use animal science datasets throughout. Make sure you have these packages loaded:</span>
<span id="cb163-49"><a href="#cb163-49" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb163-52"><a href="#cb163-52" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb163-53"><a href="#cb163-53" aria-hidden="true" tabindex="-1"></a><span class="co">#| eval: true</span></span>
<span id="cb163-54"><a href="#cb163-54" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: true</span></span>
<span id="cb163-55"><a href="#cb163-55" aria-hidden="true" tabindex="-1"></a><span class="co">#| message: false</span></span>
<span id="cb163-56"><a href="#cb163-56" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb163-57"><a href="#cb163-57" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)  <span class="co"># Includes dplyr, ggplot2, tidyr, etc.</span></span>
<span id="cb163-58"><a href="#cb163-58" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(lubridate)  <span class="co"># For dates</span></span>
<span id="cb163-59"><a href="#cb163-59" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb163-60"><a href="#cb163-60" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb163-61"><a href="#cb163-61" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb163-62"><a href="#cb163-62" aria-hidden="true" tabindex="-1"></a>---</span>
<span id="cb163-63"><a href="#cb163-63" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb163-64"><a href="#cb163-64" aria-hidden="true" tabindex="-1"></a><span class="fu">## Creating and Modifying Variables with `mutate()`</span></span>
<span id="cb163-65"><a href="#cb163-65" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb163-66"><a href="#cb163-66" aria-hidden="true" tabindex="-1"></a><span class="in">`mutate()`</span> **creates new columns** or **modifies existing columns** in your data frame.</span>
<span id="cb163-67"><a href="#cb163-67" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb163-68"><a href="#cb163-68" aria-hidden="true" tabindex="-1"></a><span class="fu">### Basic Usage</span></span>
<span id="cb163-69"><a href="#cb163-69" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb163-72"><a href="#cb163-72" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb163-73"><a href="#cb163-73" aria-hidden="true" tabindex="-1"></a><span class="co">#| eval: true</span></span>
<span id="cb163-74"><a href="#cb163-74" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: true</span></span>
<span id="cb163-75"><a href="#cb163-75" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb163-76"><a href="#cb163-76" aria-hidden="true" tabindex="-1"></a><span class="co"># Create example cattle data</span></span>
<span id="cb163-77"><a href="#cb163-77" aria-hidden="true" tabindex="-1"></a>cattle <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb163-78"><a href="#cb163-78" aria-hidden="true" tabindex="-1"></a>  <span class="at">animal_id =</span> <span class="fu">c</span>(<span class="st">"H001"</span>, <span class="st">"H002"</span>, <span class="st">"H003"</span>, <span class="st">"J001"</span>, <span class="st">"J002"</span>),</span>
<span id="cb163-79"><a href="#cb163-79" aria-hidden="true" tabindex="-1"></a>  <span class="at">breed =</span> <span class="fu">c</span>(<span class="st">"Holstein"</span>, <span class="st">"Holstein"</span>, <span class="st">"Holstein"</span>, <span class="st">"Jersey"</span>, <span class="st">"Jersey"</span>),</span>
<span id="cb163-80"><a href="#cb163-80" aria-hidden="true" tabindex="-1"></a>  <span class="at">weight_kg =</span> <span class="fu">c</span>(<span class="dv">600</span>, <span class="dv">625</span>, <span class="dv">580</span>, <span class="dv">450</span>, <span class="dv">470</span>),</span>
<span id="cb163-81"><a href="#cb163-81" aria-hidden="true" tabindex="-1"></a>  <span class="at">height_cm =</span> <span class="fu">c</span>(<span class="dv">145</span>, <span class="dv">148</span>, <span class="dv">142</span>, <span class="dv">130</span>, <span class="dv">133</span>),</span>
<span id="cb163-82"><a href="#cb163-82" aria-hidden="true" tabindex="-1"></a>  <span class="at">age_months =</span> <span class="fu">c</span>(<span class="dv">30</span>, <span class="dv">36</span>, <span class="dv">28</span>, <span class="dv">30</span>, <span class="dv">32</span>)</span>
<span id="cb163-83"><a href="#cb163-83" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb163-84"><a href="#cb163-84" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb163-85"><a href="#cb163-85" aria-hidden="true" tabindex="-1"></a>cattle</span>
<span id="cb163-86"><a href="#cb163-86" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb163-87"><a href="#cb163-87" aria-hidden="true" tabindex="-1"></a><span class="co"># Create new column: weight in pounds</span></span>
<span id="cb163-88"><a href="#cb163-88" aria-hidden="true" tabindex="-1"></a>cattle <span class="sc">%&gt;%</span></span>
<span id="cb163-89"><a href="#cb163-89" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">weight_lb =</span> weight_kg <span class="sc">*</span> <span class="fl">2.20462</span>)</span>
<span id="cb163-90"><a href="#cb163-90" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb163-91"><a href="#cb163-91" aria-hidden="true" tabindex="-1"></a><span class="co"># Create multiple new columns</span></span>
<span id="cb163-92"><a href="#cb163-92" aria-hidden="true" tabindex="-1"></a>cattle <span class="sc">%&gt;%</span></span>
<span id="cb163-93"><a href="#cb163-93" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb163-94"><a href="#cb163-94" aria-hidden="true" tabindex="-1"></a>    <span class="at">weight_lb =</span> weight_kg <span class="sc">*</span> <span class="fl">2.20462</span>,</span>
<span id="cb163-95"><a href="#cb163-95" aria-hidden="true" tabindex="-1"></a>    <span class="at">height_m =</span> height_cm <span class="sc">/</span> <span class="dv">100</span>,</span>
<span id="cb163-96"><a href="#cb163-96" aria-hidden="true" tabindex="-1"></a>    <span class="at">bmi =</span> weight_kg <span class="sc">/</span> (height_m<span class="sc">^</span><span class="dv">2</span>)</span>
<span id="cb163-97"><a href="#cb163-97" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb163-98"><a href="#cb163-98" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb163-99"><a href="#cb163-99" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb163-100"><a href="#cb163-100" aria-hidden="true" tabindex="-1"></a>::: {.callout-important}</span>
<span id="cb163-101"><a href="#cb163-101" aria-hidden="true" tabindex="-1"></a><span class="fu">## `mutate()` Adds Columns, Doesn't Replace Data</span></span>
<span id="cb163-102"><a href="#cb163-102" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb163-103"><a href="#cb163-103" aria-hidden="true" tabindex="-1"></a><span class="in">`mutate()`</span> returns a **new data frame**. To keep changes, assign the result:</span>
<span id="cb163-104"><a href="#cb163-104" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb163-107"><a href="#cb163-107" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb163-108"><a href="#cb163-108" aria-hidden="true" tabindex="-1"></a><span class="co">#| eval: false</span></span>
<span id="cb163-109"><a href="#cb163-109" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: true</span></span>
<span id="cb163-110"><a href="#cb163-110" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb163-111"><a href="#cb163-111" aria-hidden="true" tabindex="-1"></a><span class="co"># ❌ Changes are lost</span></span>
<span id="cb163-112"><a href="#cb163-112" aria-hidden="true" tabindex="-1"></a>cattle <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">weight_lb =</span> weight_kg <span class="sc">*</span> <span class="fl">2.20462</span>)</span>
<span id="cb163-113"><a href="#cb163-113" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb163-114"><a href="#cb163-114" aria-hidden="true" tabindex="-1"></a><span class="co"># ✅ Save the result</span></span>
<span id="cb163-115"><a href="#cb163-115" aria-hidden="true" tabindex="-1"></a>cattle <span class="ot">&lt;-</span> cattle <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">weight_lb =</span> weight_kg <span class="sc">*</span> <span class="fl">2.20462</span>)</span>
<span id="cb163-116"><a href="#cb163-116" aria-hidden="true" tabindex="-1"></a><span class="co"># OR</span></span>
<span id="cb163-117"><a href="#cb163-117" aria-hidden="true" tabindex="-1"></a>cattle_with_lb <span class="ot">&lt;-</span> cattle <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">weight_lb =</span> weight_kg <span class="sc">*</span> <span class="fl">2.20462</span>)</span>
<span id="cb163-118"><a href="#cb163-118" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb163-119"><a href="#cb163-119" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb163-120"><a href="#cb163-120" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb163-121"><a href="#cb163-121" aria-hidden="true" tabindex="-1"></a><span class="fu">### Overwriting Existing Columns</span></span>
<span id="cb163-122"><a href="#cb163-122" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb163-125"><a href="#cb163-125" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb163-126"><a href="#cb163-126" aria-hidden="true" tabindex="-1"></a><span class="co">#| eval: true</span></span>
<span id="cb163-127"><a href="#cb163-127" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: true</span></span>
<span id="cb163-128"><a href="#cb163-128" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb163-129"><a href="#cb163-129" aria-hidden="true" tabindex="-1"></a><span class="co"># Modify existing column: convert breed to uppercase</span></span>
<span id="cb163-130"><a href="#cb163-130" aria-hidden="true" tabindex="-1"></a>cattle <span class="sc">%&gt;%</span></span>
<span id="cb163-131"><a href="#cb163-131" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">breed =</span> <span class="fu">str_to_upper</span>(breed))</span>
<span id="cb163-132"><a href="#cb163-132" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb163-133"><a href="#cb163-133" aria-hidden="true" tabindex="-1"></a><span class="co"># Round weight to nearest 10 kg</span></span>
<span id="cb163-134"><a href="#cb163-134" aria-hidden="true" tabindex="-1"></a>cattle <span class="sc">%&gt;%</span></span>
<span id="cb163-135"><a href="#cb163-135" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">weight_kg =</span> <span class="fu">round</span>(weight_kg <span class="sc">/</span> <span class="dv">10</span>) <span class="sc">*</span> <span class="dv">10</span>)</span>
<span id="cb163-136"><a href="#cb163-136" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb163-137"><a href="#cb163-137" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb163-138"><a href="#cb163-138" aria-hidden="true" tabindex="-1"></a><span class="fu">### Using New Columns Immediately</span></span>
<span id="cb163-139"><a href="#cb163-139" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb163-140"><a href="#cb163-140" aria-hidden="true" tabindex="-1"></a>You can reference newly created columns within the same <span class="in">`mutate()`</span>:</span>
<span id="cb163-141"><a href="#cb163-141" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb163-144"><a href="#cb163-144" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb163-145"><a href="#cb163-145" aria-hidden="true" tabindex="-1"></a><span class="co">#| eval: true</span></span>
<span id="cb163-146"><a href="#cb163-146" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: true</span></span>
<span id="cb163-147"><a href="#cb163-147" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb163-148"><a href="#cb163-148" aria-hidden="true" tabindex="-1"></a>cattle <span class="sc">%&gt;%</span></span>
<span id="cb163-149"><a href="#cb163-149" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb163-150"><a href="#cb163-150" aria-hidden="true" tabindex="-1"></a>    <span class="at">height_m =</span> height_cm <span class="sc">/</span> <span class="dv">100</span>,       <span class="co"># Create height_m</span></span>
<span id="cb163-151"><a href="#cb163-151" aria-hidden="true" tabindex="-1"></a>    <span class="at">bmi =</span> weight_kg <span class="sc">/</span> (height_m<span class="sc">^</span><span class="dv">2</span>)    <span class="co"># Use height_m immediately!</span></span>
<span id="cb163-152"><a href="#cb163-152" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb163-153"><a href="#cb163-153" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb163-154"><a href="#cb163-154" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb163-155"><a href="#cb163-155" aria-hidden="true" tabindex="-1"></a><span class="fu">### Useful Functions Inside `mutate()`</span></span>
<span id="cb163-156"><a href="#cb163-156" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb163-157"><a href="#cb163-157" aria-hidden="true" tabindex="-1"></a>Common operations you'll use with <span class="in">`mutate()`</span>:</span>
<span id="cb163-158"><a href="#cb163-158" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb163-159"><a href="#cb163-159" aria-hidden="true" tabindex="-1"></a><span class="pp">|</span> Operation <span class="pp">|</span> Function <span class="pp">|</span> Example <span class="pp">|</span></span>
<span id="cb163-160"><a href="#cb163-160" aria-hidden="true" tabindex="-1"></a><span class="pp">|-----------|----------|---------|</span></span>
<span id="cb163-161"><a href="#cb163-161" aria-hidden="true" tabindex="-1"></a><span class="pp">|</span> Math <span class="pp">|</span> <span class="in">`+`</span>, <span class="in">`-`</span>, <span class="in">`*`</span>, <span class="in">`/`</span>, <span class="in">`^`</span> <span class="pp">|</span> <span class="in">`weight_kg * 2.20462`</span> <span class="pp">|</span></span>
<span id="cb163-162"><a href="#cb163-162" aria-hidden="true" tabindex="-1"></a><span class="pp">|</span> Rounding <span class="pp">|</span> <span class="in">`round()`</span>, <span class="in">`floor()`</span>, <span class="in">`ceiling()`</span> <span class="pp">|</span> <span class="in">`round(weight, 1)`</span> <span class="pp">|</span></span>
<span id="cb163-163"><a href="#cb163-163" aria-hidden="true" tabindex="-1"></a><span class="pp">|</span> Logarithms <span class="pp">|</span> <span class="in">`log()`</span>, <span class="in">`log10()`</span>, <span class="in">`exp()`</span> <span class="pp">|</span> <span class="in">`log(concentration)`</span> <span class="pp">|</span></span>
<span id="cb163-164"><a href="#cb163-164" aria-hidden="true" tabindex="-1"></a><span class="pp">|</span> Ranking <span class="pp">|</span> <span class="in">`min_rank()`</span>, <span class="in">`dense_rank()`</span> <span class="pp">|</span> <span class="in">`min_rank(desc(weight))`</span> <span class="pp">|</span></span>
<span id="cb163-165"><a href="#cb163-165" aria-hidden="true" tabindex="-1"></a><span class="pp">|</span> String functions <span class="pp">|</span> <span class="in">`str_*()`</span> <span class="pp">|</span> <span class="in">`str_to_upper(breed)`</span> <span class="pp">|</span></span>
<span id="cb163-166"><a href="#cb163-166" aria-hidden="true" tabindex="-1"></a><span class="pp">|</span> Date functions <span class="pp">|</span> <span class="in">`year()`</span>, <span class="in">`month()`</span>, <span class="in">`day()`</span> <span class="pp">|</span> <span class="in">`year(birth_date)`</span> <span class="pp">|</span></span>
<span id="cb163-167"><a href="#cb163-167" aria-hidden="true" tabindex="-1"></a><span class="pp">|</span> Conditional <span class="pp">|</span> <span class="in">`if_else()`</span>, <span class="in">`case_when()`</span> <span class="pp">|</span> <span class="in">`if_else(weight &gt; 500, "Heavy", "Light")`</span> <span class="pp">|</span></span>
<span id="cb163-168"><a href="#cb163-168" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb163-169"><a href="#cb163-169" aria-hidden="true" tabindex="-1"></a>---</span>
<span id="cb163-170"><a href="#cb163-170" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb163-171"><a href="#cb163-171" aria-hidden="true" tabindex="-1"></a><span class="fu">## Conditional Operations</span></span>
<span id="cb163-172"><a href="#cb163-172" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb163-173"><a href="#cb163-173" aria-hidden="true" tabindex="-1"></a><span class="fu">### Simple Conditions with `if_else()`</span></span>
<span id="cb163-174"><a href="#cb163-174" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb163-175"><a href="#cb163-175" aria-hidden="true" tabindex="-1"></a><span class="in">`if_else()`</span> creates values based on a TRUE/FALSE condition:</span>
<span id="cb163-176"><a href="#cb163-176" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb163-177"><a href="#cb163-177" aria-hidden="true" tabindex="-1"></a>**Syntax**: <span class="in">`if_else(condition, value_if_true, value_if_false)`</span></span>
<span id="cb163-178"><a href="#cb163-178" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb163-181"><a href="#cb163-181" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb163-182"><a href="#cb163-182" aria-hidden="true" tabindex="-1"></a><span class="co">#| eval: true</span></span>
<span id="cb163-183"><a href="#cb163-183" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: true</span></span>
<span id="cb163-184"><a href="#cb163-184" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb163-185"><a href="#cb163-185" aria-hidden="true" tabindex="-1"></a><span class="co"># Classify animals as heavy or light</span></span>
<span id="cb163-186"><a href="#cb163-186" aria-hidden="true" tabindex="-1"></a>cattle <span class="sc">%&gt;%</span></span>
<span id="cb163-187"><a href="#cb163-187" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb163-188"><a href="#cb163-188" aria-hidden="true" tabindex="-1"></a>    <span class="at">weight_class =</span> <span class="fu">if_else</span>(weight_kg <span class="sc">&gt;</span> <span class="dv">500</span>, <span class="st">"Heavy"</span>, <span class="st">"Light"</span>)</span>
<span id="cb163-189"><a href="#cb163-189" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb163-190"><a href="#cb163-190" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb163-191"><a href="#cb163-191" aria-hidden="true" tabindex="-1"></a><span class="co"># Create logical column</span></span>
<span id="cb163-192"><a href="#cb163-192" aria-hidden="true" tabindex="-1"></a>cattle <span class="sc">%&gt;%</span></span>
<span id="cb163-193"><a href="#cb163-193" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb163-194"><a href="#cb163-194" aria-hidden="true" tabindex="-1"></a>    <span class="at">is_mature =</span> <span class="fu">if_else</span>(age_months <span class="sc">&gt;=</span> <span class="dv">30</span>, <span class="cn">TRUE</span>, <span class="cn">FALSE</span>)</span>
<span id="cb163-195"><a href="#cb163-195" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb163-196"><a href="#cb163-196" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb163-197"><a href="#cb163-197" aria-hidden="true" tabindex="-1"></a><span class="co"># Can use existing values</span></span>
<span id="cb163-198"><a href="#cb163-198" aria-hidden="true" tabindex="-1"></a>cattle <span class="sc">%&gt;%</span></span>
<span id="cb163-199"><a href="#cb163-199" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb163-200"><a href="#cb163-200" aria-hidden="true" tabindex="-1"></a>    <span class="at">adjusted_weight =</span> <span class="fu">if_else</span>(breed <span class="sc">==</span> <span class="st">"Jersey"</span>,</span>
<span id="cb163-201"><a href="#cb163-201" aria-hidden="true" tabindex="-1"></a>                              weight_kg <span class="sc">*</span> <span class="fl">1.1</span>,  <span class="co"># Boost Jersey weights by 10%</span></span>
<span id="cb163-202"><a href="#cb163-202" aria-hidden="true" tabindex="-1"></a>                              weight_kg)        <span class="co"># Keep others same</span></span>
<span id="cb163-203"><a href="#cb163-203" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb163-204"><a href="#cb163-204" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb163-205"><a href="#cb163-205" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb163-206"><a href="#cb163-206" aria-hidden="true" tabindex="-1"></a>::: {.callout-tip}</span>
<span id="cb163-207"><a href="#cb163-207" aria-hidden="true" tabindex="-1"></a><span class="fu">## `if_else()` vs base R `ifelse()`</span></span>
<span id="cb163-208"><a href="#cb163-208" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb163-209"><a href="#cb163-209" aria-hidden="true" tabindex="-1"></a>dplyr's <span class="in">`if_else()`</span> is stricter and safer than base R's <span class="in">`ifelse()`</span>:</span>
<span id="cb163-210"><a href="#cb163-210" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb163-211"><a href="#cb163-211" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Type safety**: Both true and false values must be the same type</span>
<span id="cb163-212"><a href="#cb163-212" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**NA handling**: Explicit <span class="in">`missing`</span> argument for NA values</span>
<span id="cb163-213"><a href="#cb163-213" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Speed**: Faster for large datasets</span>
<span id="cb163-214"><a href="#cb163-214" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb163-217"><a href="#cb163-217" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb163-218"><a href="#cb163-218" aria-hidden="true" tabindex="-1"></a><span class="co">#| eval: false</span></span>
<span id="cb163-219"><a href="#cb163-219" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: true</span></span>
<span id="cb163-220"><a href="#cb163-220" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb163-221"><a href="#cb163-221" aria-hidden="true" tabindex="-1"></a><span class="co"># ✅ Good (both character)</span></span>
<span id="cb163-222"><a href="#cb163-222" aria-hidden="true" tabindex="-1"></a><span class="fu">if_else</span>(condition, <span class="st">"yes"</span>, <span class="st">"no"</span>)</span>
<span id="cb163-223"><a href="#cb163-223" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb163-224"><a href="#cb163-224" aria-hidden="true" tabindex="-1"></a><span class="co"># ❌ Error (different types)</span></span>
<span id="cb163-225"><a href="#cb163-225" aria-hidden="true" tabindex="-1"></a><span class="fu">if_else</span>(condition, <span class="st">"yes"</span>, <span class="dv">0</span>)</span>
<span id="cb163-226"><a href="#cb163-226" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb163-227"><a href="#cb163-227" aria-hidden="true" tabindex="-1"></a><span class="co"># ✅ With NAs</span></span>
<span id="cb163-228"><a href="#cb163-228" aria-hidden="true" tabindex="-1"></a><span class="fu">if_else</span>(condition, <span class="st">"yes"</span>, <span class="st">"no"</span>, <span class="at">missing =</span> <span class="st">"unknown"</span>)</span>
<span id="cb163-229"><a href="#cb163-229" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb163-230"><a href="#cb163-230" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb163-231"><a href="#cb163-231" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb163-232"><a href="#cb163-232" aria-hidden="true" tabindex="-1"></a><span class="fu">### Multiple Conditions with `case_when()`</span></span>
<span id="cb163-233"><a href="#cb163-233" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb163-234"><a href="#cb163-234" aria-hidden="true" tabindex="-1"></a>For multiple conditions, use <span class="in">`case_when()`</span>:</span>
<span id="cb163-235"><a href="#cb163-235" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb163-238"><a href="#cb163-238" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb163-239"><a href="#cb163-239" aria-hidden="true" tabindex="-1"></a><span class="co">#| eval: true</span></span>
<span id="cb163-240"><a href="#cb163-240" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: true</span></span>
<span id="cb163-241"><a href="#cb163-241" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb163-242"><a href="#cb163-242" aria-hidden="true" tabindex="-1"></a><span class="co"># Classify into three weight categories</span></span>
<span id="cb163-243"><a href="#cb163-243" aria-hidden="true" tabindex="-1"></a>cattle <span class="sc">%&gt;%</span></span>
<span id="cb163-244"><a href="#cb163-244" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb163-245"><a href="#cb163-245" aria-hidden="true" tabindex="-1"></a>    <span class="at">weight_category =</span> <span class="fu">case_when</span>(</span>
<span id="cb163-246"><a href="#cb163-246" aria-hidden="true" tabindex="-1"></a>      weight_kg <span class="sc">&lt;</span> <span class="dv">500</span> <span class="sc">~</span> <span class="st">"Light"</span>,</span>
<span id="cb163-247"><a href="#cb163-247" aria-hidden="true" tabindex="-1"></a>      weight_kg <span class="sc">&lt;</span> <span class="dv">600</span> <span class="sc">~</span> <span class="st">"Medium"</span>,</span>
<span id="cb163-248"><a href="#cb163-248" aria-hidden="true" tabindex="-1"></a>      weight_kg <span class="sc">&gt;=</span> <span class="dv">600</span> <span class="sc">~</span> <span class="st">"Heavy"</span></span>
<span id="cb163-249"><a href="#cb163-249" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb163-250"><a href="#cb163-250" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb163-251"><a href="#cb163-251" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb163-252"><a href="#cb163-252" aria-hidden="true" tabindex="-1"></a><span class="co"># Multiple factors</span></span>
<span id="cb163-253"><a href="#cb163-253" aria-hidden="true" tabindex="-1"></a>cattle <span class="sc">%&gt;%</span></span>
<span id="cb163-254"><a href="#cb163-254" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb163-255"><a href="#cb163-255" aria-hidden="true" tabindex="-1"></a>    <span class="at">category =</span> <span class="fu">case_when</span>(</span>
<span id="cb163-256"><a href="#cb163-256" aria-hidden="true" tabindex="-1"></a>      breed <span class="sc">==</span> <span class="st">"Jersey"</span> <span class="sc">&amp;</span> weight_kg <span class="sc">&gt;</span> <span class="dv">450</span> <span class="sc">~</span> <span class="st">"Large Jersey"</span>,</span>
<span id="cb163-257"><a href="#cb163-257" aria-hidden="true" tabindex="-1"></a>      breed <span class="sc">==</span> <span class="st">"Jersey"</span> <span class="sc">&amp;</span> weight_kg <span class="sc">&lt;=</span> <span class="dv">450</span> <span class="sc">~</span> <span class="st">"Small Jersey"</span>,</span>
<span id="cb163-258"><a href="#cb163-258" aria-hidden="true" tabindex="-1"></a>      breed <span class="sc">==</span> <span class="st">"Holstein"</span> <span class="sc">&amp;</span> weight_kg <span class="sc">&gt;</span> <span class="dv">600</span> <span class="sc">~</span> <span class="st">"Large Holstein"</span>,</span>
<span id="cb163-259"><a href="#cb163-259" aria-hidden="true" tabindex="-1"></a>      breed <span class="sc">==</span> <span class="st">"Holstein"</span> <span class="sc">&amp;</span> weight_kg <span class="sc">&lt;=</span> <span class="dv">600</span> <span class="sc">~</span> <span class="st">"Small Holstein"</span>,</span>
<span id="cb163-260"><a href="#cb163-260" aria-hidden="true" tabindex="-1"></a>      <span class="cn">TRUE</span> <span class="sc">~</span> <span class="st">"Other"</span>  <span class="co"># Catch-all (like "else")</span></span>
<span id="cb163-261"><a href="#cb163-261" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb163-262"><a href="#cb163-262" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb163-263"><a href="#cb163-263" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb163-264"><a href="#cb163-264" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb163-265"><a href="#cb163-265" aria-hidden="true" tabindex="-1"></a>**How `case_when()` works**:</span>
<span id="cb163-266"><a href="#cb163-266" aria-hidden="true" tabindex="-1"></a><span class="ss">1. </span>Evaluates conditions **in order from top to bottom**</span>
<span id="cb163-267"><a href="#cb163-267" aria-hidden="true" tabindex="-1"></a><span class="ss">2. </span>Returns the value (<span class="in">`~`</span> right side) for the **first TRUE condition**</span>
<span id="cb163-268"><a href="#cb163-268" aria-hidden="true" tabindex="-1"></a><span class="ss">3. </span>Stops checking once a match is found</span>
<span id="cb163-269"><a href="#cb163-269" aria-hidden="true" tabindex="-1"></a><span class="ss">4. </span>Use <span class="in">`TRUE ~ value`</span> as a catch-all for everything else</span>
<span id="cb163-270"><a href="#cb163-270" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb163-271"><a href="#cb163-271" aria-hidden="true" tabindex="-1"></a>::: {.callout-warning}</span>
<span id="cb163-272"><a href="#cb163-272" aria-hidden="true" tabindex="-1"></a><span class="fu">## Order Matters in `case_when()`!</span></span>
<span id="cb163-273"><a href="#cb163-273" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb163-276"><a href="#cb163-276" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb163-277"><a href="#cb163-277" aria-hidden="true" tabindex="-1"></a><span class="co">#| eval: true</span></span>
<span id="cb163-278"><a href="#cb163-278" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: true</span></span>
<span id="cb163-279"><a href="#cb163-279" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb163-280"><a href="#cb163-280" aria-hidden="true" tabindex="-1"></a><span class="co"># ❌ WRONG: Everything becomes "Heavy"</span></span>
<span id="cb163-281"><a href="#cb163-281" aria-hidden="true" tabindex="-1"></a>cattle <span class="sc">%&gt;%</span></span>
<span id="cb163-282"><a href="#cb163-282" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb163-283"><a href="#cb163-283" aria-hidden="true" tabindex="-1"></a>    <span class="at">wrong =</span> <span class="fu">case_when</span>(</span>
<span id="cb163-284"><a href="#cb163-284" aria-hidden="true" tabindex="-1"></a>      weight_kg <span class="sc">&gt;</span> <span class="dv">0</span> <span class="sc">~</span> <span class="st">"Heavy"</span>,      <span class="co"># This matches EVERYTHING!</span></span>
<span id="cb163-285"><a href="#cb163-285" aria-hidden="true" tabindex="-1"></a>      weight_kg <span class="sc">&gt;</span> <span class="dv">500</span> <span class="sc">~</span> <span class="st">"Medium"</span>,   <span class="co"># Never reached</span></span>
<span id="cb163-286"><a href="#cb163-286" aria-hidden="true" tabindex="-1"></a>      <span class="cn">TRUE</span> <span class="sc">~</span> <span class="st">"Light"</span>                <span class="co"># Never reached</span></span>
<span id="cb163-287"><a href="#cb163-287" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb163-288"><a href="#cb163-288" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb163-289"><a href="#cb163-289" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(animal_id, weight_kg, wrong)</span>
<span id="cb163-290"><a href="#cb163-290" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb163-291"><a href="#cb163-291" aria-hidden="true" tabindex="-1"></a><span class="co"># ✅ CORRECT: Specific conditions first</span></span>
<span id="cb163-292"><a href="#cb163-292" aria-hidden="true" tabindex="-1"></a>cattle <span class="sc">%&gt;%</span></span>
<span id="cb163-293"><a href="#cb163-293" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb163-294"><a href="#cb163-294" aria-hidden="true" tabindex="-1"></a>    <span class="at">correct =</span> <span class="fu">case_when</span>(</span>
<span id="cb163-295"><a href="#cb163-295" aria-hidden="true" tabindex="-1"></a>      weight_kg <span class="sc">&gt;</span> <span class="dv">600</span> <span class="sc">~</span> <span class="st">"Heavy"</span>,</span>
<span id="cb163-296"><a href="#cb163-296" aria-hidden="true" tabindex="-1"></a>      weight_kg <span class="sc">&gt;</span> <span class="dv">500</span> <span class="sc">~</span> <span class="st">"Medium"</span>,</span>
<span id="cb163-297"><a href="#cb163-297" aria-hidden="true" tabindex="-1"></a>      <span class="cn">TRUE</span> <span class="sc">~</span> <span class="st">"Light"</span></span>
<span id="cb163-298"><a href="#cb163-298" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb163-299"><a href="#cb163-299" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb163-300"><a href="#cb163-300" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(animal_id, weight_kg, correct)</span>
<span id="cb163-301"><a href="#cb163-301" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb163-302"><a href="#cb163-302" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb163-303"><a href="#cb163-303" aria-hidden="true" tabindex="-1"></a>**Rule**: Put specific conditions before general ones!</span>
<span id="cb163-304"><a href="#cb163-304" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb163-305"><a href="#cb163-305" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb163-306"><a href="#cb163-306" aria-hidden="true" tabindex="-1"></a><span class="fu">### Real-World Example: Creating Treatment Groups</span></span>
<span id="cb163-307"><a href="#cb163-307" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb163-310"><a href="#cb163-310" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb163-311"><a href="#cb163-311" aria-hidden="true" tabindex="-1"></a><span class="co">#| eval: true</span></span>
<span id="cb163-312"><a href="#cb163-312" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: true</span></span>
<span id="cb163-313"><a href="#cb163-313" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb163-314"><a href="#cb163-314" aria-hidden="true" tabindex="-1"></a><span class="co"># Create feed trial data</span></span>
<span id="cb163-315"><a href="#cb163-315" aria-hidden="true" tabindex="-1"></a>feed_trial <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb163-316"><a href="#cb163-316" aria-hidden="true" tabindex="-1"></a>  <span class="at">animal_id =</span> <span class="fu">sprintf</span>(<span class="st">"A%03d"</span>, <span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>),</span>
<span id="cb163-317"><a href="#cb163-317" aria-hidden="true" tabindex="-1"></a>  <span class="at">baseline_weight =</span> <span class="fu">c</span>(<span class="dv">450</span>, <span class="dv">480</span>, <span class="dv">445</span>, <span class="dv">490</span>, <span class="dv">455</span>, <span class="dv">470</span>, <span class="dv">460</span>, <span class="dv">475</span>, <span class="dv">465</span>, <span class="dv">485</span>),</span>
<span id="cb163-318"><a href="#cb163-318" aria-hidden="true" tabindex="-1"></a>  <span class="at">age_months =</span> <span class="fu">c</span>(<span class="dv">24</span>, <span class="dv">30</span>, <span class="dv">22</span>, <span class="dv">32</span>, <span class="dv">26</span>, <span class="dv">28</span>, <span class="dv">24</span>, <span class="dv">30</span>, <span class="dv">26</span>, <span class="dv">31</span>),</span>
<span id="cb163-319"><a href="#cb163-319" aria-hidden="true" tabindex="-1"></a>  <span class="at">sex =</span> <span class="fu">c</span>(<span class="st">"F"</span>, <span class="st">"F"</span>, <span class="st">"M"</span>, <span class="st">"F"</span>, <span class="st">"M"</span>, <span class="st">"F"</span>, <span class="st">"F"</span>, <span class="st">"M"</span>, <span class="st">"F"</span>, <span class="st">"M"</span>)</span>
<span id="cb163-320"><a href="#cb163-320" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb163-321"><a href="#cb163-321" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb163-322"><a href="#cb163-322" aria-hidden="true" tabindex="-1"></a>feed_trial</span>
<span id="cb163-323"><a href="#cb163-323" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb163-324"><a href="#cb163-324" aria-hidden="true" tabindex="-1"></a><span class="co"># Assign animals to treatment groups based on multiple factors</span></span>
<span id="cb163-325"><a href="#cb163-325" aria-hidden="true" tabindex="-1"></a>feed_trial_assigned <span class="ot">&lt;-</span> feed_trial <span class="sc">%&gt;%</span></span>
<span id="cb163-326"><a href="#cb163-326" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb163-327"><a href="#cb163-327" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Age category</span></span>
<span id="cb163-328"><a href="#cb163-328" aria-hidden="true" tabindex="-1"></a>    <span class="at">age_group =</span> <span class="fu">case_when</span>(</span>
<span id="cb163-329"><a href="#cb163-329" aria-hidden="true" tabindex="-1"></a>      age_months <span class="sc">&lt;</span> <span class="dv">26</span> <span class="sc">~</span> <span class="st">"Young"</span>,</span>
<span id="cb163-330"><a href="#cb163-330" aria-hidden="true" tabindex="-1"></a>      age_months <span class="sc">&lt;=</span> <span class="dv">30</span> <span class="sc">~</span> <span class="st">"Adult"</span>,</span>
<span id="cb163-331"><a href="#cb163-331" aria-hidden="true" tabindex="-1"></a>      <span class="cn">TRUE</span> <span class="sc">~</span> <span class="st">"Mature"</span></span>
<span id="cb163-332"><a href="#cb163-332" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb163-333"><a href="#cb163-333" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Weight category</span></span>
<span id="cb163-334"><a href="#cb163-334" aria-hidden="true" tabindex="-1"></a>    <span class="at">weight_group =</span> <span class="fu">if_else</span>(baseline_weight <span class="sc">&gt;</span> <span class="dv">470</span>, <span class="st">"Heavy"</span>, <span class="st">"Light"</span>),</span>
<span id="cb163-335"><a href="#cb163-335" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Treatment assignment (balanced by sex and weight)</span></span>
<span id="cb163-336"><a href="#cb163-336" aria-hidden="true" tabindex="-1"></a>    <span class="at">treatment =</span> <span class="fu">case_when</span>(</span>
<span id="cb163-337"><a href="#cb163-337" aria-hidden="true" tabindex="-1"></a>      sex <span class="sc">==</span> <span class="st">"F"</span> <span class="sc">&amp;</span> baseline_weight <span class="sc">&gt;</span> <span class="dv">470</span> <span class="sc">~</span> <span class="st">"A"</span>,</span>
<span id="cb163-338"><a href="#cb163-338" aria-hidden="true" tabindex="-1"></a>      sex <span class="sc">==</span> <span class="st">"F"</span> <span class="sc">&amp;</span> baseline_weight <span class="sc">&lt;=</span> <span class="dv">470</span> <span class="sc">~</span> <span class="st">"B"</span>,</span>
<span id="cb163-339"><a href="#cb163-339" aria-hidden="true" tabindex="-1"></a>      sex <span class="sc">==</span> <span class="st">"M"</span> <span class="sc">&amp;</span> baseline_weight <span class="sc">&gt;</span> <span class="dv">470</span> <span class="sc">~</span> <span class="st">"B"</span>,</span>
<span id="cb163-340"><a href="#cb163-340" aria-hidden="true" tabindex="-1"></a>      sex <span class="sc">==</span> <span class="st">"M"</span> <span class="sc">&amp;</span> baseline_weight <span class="sc">&lt;=</span> <span class="dv">470</span> <span class="sc">~</span> <span class="st">"A"</span></span>
<span id="cb163-341"><a href="#cb163-341" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb163-342"><a href="#cb163-342" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb163-343"><a href="#cb163-343" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb163-344"><a href="#cb163-344" aria-hidden="true" tabindex="-1"></a>feed_trial_assigned</span>
<span id="cb163-345"><a href="#cb163-345" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb163-346"><a href="#cb163-346" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb163-347"><a href="#cb163-347" aria-hidden="true" tabindex="-1"></a>---</span>
<span id="cb163-348"><a href="#cb163-348" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb163-349"><a href="#cb163-349" aria-hidden="true" tabindex="-1"></a><span class="fu">## Sorting Data with `arrange()`</span></span>
<span id="cb163-350"><a href="#cb163-350" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb163-351"><a href="#cb163-351" aria-hidden="true" tabindex="-1"></a><span class="in">`arrange()`</span> **sorts rows** by one or more columns.</span>
<span id="cb163-352"><a href="#cb163-352" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb163-353"><a href="#cb163-353" aria-hidden="true" tabindex="-1"></a><span class="fu">### Basic Sorting</span></span>
<span id="cb163-354"><a href="#cb163-354" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb163-357"><a href="#cb163-357" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb163-358"><a href="#cb163-358" aria-hidden="true" tabindex="-1"></a><span class="co">#| eval: true</span></span>
<span id="cb163-359"><a href="#cb163-359" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: true</span></span>
<span id="cb163-360"><a href="#cb163-360" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb163-361"><a href="#cb163-361" aria-hidden="true" tabindex="-1"></a><span class="co"># Sort by weight (ascending, lightest first)</span></span>
<span id="cb163-362"><a href="#cb163-362" aria-hidden="true" tabindex="-1"></a>cattle <span class="sc">%&gt;%</span></span>
<span id="cb163-363"><a href="#cb163-363" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(weight_kg)</span>
<span id="cb163-364"><a href="#cb163-364" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb163-365"><a href="#cb163-365" aria-hidden="true" tabindex="-1"></a><span class="co"># Sort by weight (descending, heaviest first)</span></span>
<span id="cb163-366"><a href="#cb163-366" aria-hidden="true" tabindex="-1"></a>cattle <span class="sc">%&gt;%</span></span>
<span id="cb163-367"><a href="#cb163-367" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(weight_kg))</span>
<span id="cb163-368"><a href="#cb163-368" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb163-369"><a href="#cb163-369" aria-hidden="true" tabindex="-1"></a><span class="co"># Sort by breed, then by weight within breed</span></span>
<span id="cb163-370"><a href="#cb163-370" aria-hidden="true" tabindex="-1"></a>cattle <span class="sc">%&gt;%</span></span>
<span id="cb163-371"><a href="#cb163-371" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(breed, weight_kg)</span>
<span id="cb163-372"><a href="#cb163-372" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb163-373"><a href="#cb163-373" aria-hidden="true" tabindex="-1"></a><span class="co"># Sort by breed (ascending), weight (descending)</span></span>
<span id="cb163-374"><a href="#cb163-374" aria-hidden="true" tabindex="-1"></a>cattle <span class="sc">%&gt;%</span></span>
<span id="cb163-375"><a href="#cb163-375" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(breed, <span class="fu">desc</span>(weight_kg))</span>
<span id="cb163-376"><a href="#cb163-376" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb163-377"><a href="#cb163-377" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb163-378"><a href="#cb163-378" aria-hidden="true" tabindex="-1"></a><span class="fu">### Sorting with Missing Values</span></span>
<span id="cb163-379"><a href="#cb163-379" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb163-382"><a href="#cb163-382" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb163-383"><a href="#cb163-383" aria-hidden="true" tabindex="-1"></a><span class="co">#| eval: true</span></span>
<span id="cb163-384"><a href="#cb163-384" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: true</span></span>
<span id="cb163-385"><a href="#cb163-385" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb163-386"><a href="#cb163-386" aria-hidden="true" tabindex="-1"></a><span class="co"># Data with missing weights</span></span>
<span id="cb163-387"><a href="#cb163-387" aria-hidden="true" tabindex="-1"></a>cattle_na <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb163-388"><a href="#cb163-388" aria-hidden="true" tabindex="-1"></a>  <span class="at">animal_id =</span> <span class="fu">c</span>(<span class="st">"H001"</span>, <span class="st">"H002"</span>, <span class="st">"H003"</span>, <span class="st">"H004"</span>, <span class="st">"H005"</span>),</span>
<span id="cb163-389"><a href="#cb163-389" aria-hidden="true" tabindex="-1"></a>  <span class="at">weight_kg =</span> <span class="fu">c</span>(<span class="dv">600</span>, <span class="cn">NA</span>, <span class="dv">580</span>, <span class="dv">625</span>, <span class="cn">NA</span>)</span>
<span id="cb163-390"><a href="#cb163-390" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb163-391"><a href="#cb163-391" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb163-392"><a href="#cb163-392" aria-hidden="true" tabindex="-1"></a>cattle_na</span>
<span id="cb163-393"><a href="#cb163-393" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb163-394"><a href="#cb163-394" aria-hidden="true" tabindex="-1"></a><span class="co"># By default, NAs go to the end</span></span>
<span id="cb163-395"><a href="#cb163-395" aria-hidden="true" tabindex="-1"></a>cattle_na <span class="sc">%&gt;%</span></span>
<span id="cb163-396"><a href="#cb163-396" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(weight_kg)</span>
<span id="cb163-397"><a href="#cb163-397" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb163-398"><a href="#cb163-398" aria-hidden="true" tabindex="-1"></a><span class="co"># Descending: NAs still at the end</span></span>
<span id="cb163-399"><a href="#cb163-399" aria-hidden="true" tabindex="-1"></a>cattle_na <span class="sc">%&gt;%</span></span>
<span id="cb163-400"><a href="#cb163-400" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(weight_kg))</span>
<span id="cb163-401"><a href="#cb163-401" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb163-402"><a href="#cb163-402" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb163-403"><a href="#cb163-403" aria-hidden="true" tabindex="-1"></a>::: {.callout-tip}</span>
<span id="cb163-404"><a href="#cb163-404" aria-hidden="true" tabindex="-1"></a><span class="fu">## Use `arrange()` to Check Your Work</span></span>
<span id="cb163-405"><a href="#cb163-405" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb163-406"><a href="#cb163-406" aria-hidden="true" tabindex="-1"></a>When creating or modifying columns, sort to verify results:</span>
<span id="cb163-407"><a href="#cb163-407" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb163-410"><a href="#cb163-410" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb163-411"><a href="#cb163-411" aria-hidden="true" tabindex="-1"></a><span class="co">#| eval: true</span></span>
<span id="cb163-412"><a href="#cb163-412" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: true</span></span>
<span id="cb163-413"><a href="#cb163-413" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb163-414"><a href="#cb163-414" aria-hidden="true" tabindex="-1"></a><span class="co"># Did the weight classification work correctly?</span></span>
<span id="cb163-415"><a href="#cb163-415" aria-hidden="true" tabindex="-1"></a>cattle <span class="sc">%&gt;%</span></span>
<span id="cb163-416"><a href="#cb163-416" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">weight_class =</span> <span class="fu">if_else</span>(weight_kg <span class="sc">&gt;</span> <span class="dv">500</span>, <span class="st">"Heavy"</span>, <span class="st">"Light"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb163-417"><a href="#cb163-417" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(weight_kg) <span class="sc">%&gt;%</span></span>
<span id="cb163-418"><a href="#cb163-418" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(animal_id, weight_kg, weight_class)</span>
<span id="cb163-419"><a href="#cb163-419" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb163-420"><a href="#cb163-420" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb163-421"><a href="#cb163-421" aria-hidden="true" tabindex="-1"></a>Sorting makes it easy to spot errors!</span>
<span id="cb163-422"><a href="#cb163-422" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb163-423"><a href="#cb163-423" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb163-424"><a href="#cb163-424" aria-hidden="true" tabindex="-1"></a>---</span>
<span id="cb163-425"><a href="#cb163-425" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb163-426"><a href="#cb163-426" aria-hidden="true" tabindex="-1"></a><span class="fu">## Grouped Operations with `group_by()` and `summarise()`</span></span>
<span id="cb163-427"><a href="#cb163-427" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb163-428"><a href="#cb163-428" aria-hidden="true" tabindex="-1"></a>The real power of dplyr comes from **grouped operations**: calculating summaries for each group separately.</span>
<span id="cb163-429"><a href="#cb163-429" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb163-430"><a href="#cb163-430" aria-hidden="true" tabindex="-1"></a><span class="fu">### Understanding `group_by()`</span></span>
<span id="cb163-431"><a href="#cb163-431" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb163-432"><a href="#cb163-432" aria-hidden="true" tabindex="-1"></a><span class="in">`group_by()`</span> doesn't change your data—it adds invisible grouping information:</span>
<span id="cb163-433"><a href="#cb163-433" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb163-436"><a href="#cb163-436" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb163-437"><a href="#cb163-437" aria-hidden="true" tabindex="-1"></a><span class="co">#| eval: true</span></span>
<span id="cb163-438"><a href="#cb163-438" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: true</span></span>
<span id="cb163-439"><a href="#cb163-439" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb163-440"><a href="#cb163-440" aria-hidden="true" tabindex="-1"></a><span class="co"># Create farm data with multiple breeds and farms</span></span>
<span id="cb163-441"><a href="#cb163-441" aria-hidden="true" tabindex="-1"></a>farm_data <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb163-442"><a href="#cb163-442" aria-hidden="true" tabindex="-1"></a>  <span class="at">animal_id =</span> <span class="fu">sprintf</span>(<span class="st">"A%03d"</span>, <span class="dv">1</span><span class="sc">:</span><span class="dv">12</span>),</span>
<span id="cb163-443"><a href="#cb163-443" aria-hidden="true" tabindex="-1"></a>  <span class="at">breed =</span> <span class="fu">rep</span>(<span class="fu">c</span>(<span class="st">"Holstein"</span>, <span class="st">"Jersey"</span>, <span class="st">"Angus"</span>), <span class="at">each =</span> <span class="dv">4</span>),</span>
<span id="cb163-444"><a href="#cb163-444" aria-hidden="true" tabindex="-1"></a>  <span class="at">farm =</span> <span class="fu">rep</span>(<span class="fu">c</span>(<span class="st">"North"</span>, <span class="st">"South"</span>), <span class="dv">6</span>),</span>
<span id="cb163-445"><a href="#cb163-445" aria-hidden="true" tabindex="-1"></a>  <span class="at">weight_kg =</span> <span class="fu">c</span>(<span class="dv">600</span>, <span class="dv">620</span>, <span class="dv">590</span>, <span class="dv">610</span>, <span class="dv">450</span>, <span class="dv">470</span>, <span class="dv">455</span>, <span class="dv">465</span>,</span>
<span id="cb163-446"><a href="#cb163-446" aria-hidden="true" tabindex="-1"></a>                <span class="dv">550</span>, <span class="dv">570</span>, <span class="dv">540</span>, <span class="dv">560</span>)</span>
<span id="cb163-447"><a href="#cb163-447" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb163-448"><a href="#cb163-448" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb163-449"><a href="#cb163-449" aria-hidden="true" tabindex="-1"></a>farm_data</span>
<span id="cb163-450"><a href="#cb163-450" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb163-451"><a href="#cb163-451" aria-hidden="true" tabindex="-1"></a><span class="co"># Group by breed</span></span>
<span id="cb163-452"><a href="#cb163-452" aria-hidden="true" tabindex="-1"></a>farm_data <span class="sc">%&gt;%</span></span>
<span id="cb163-453"><a href="#cb163-453" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(breed)</span>
<span id="cb163-454"><a href="#cb163-454" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb163-455"><a href="#cb163-455" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb163-456"><a href="#cb163-456" aria-hidden="true" tabindex="-1"></a>Notice: "Groups: breed <span class="co">[</span><span class="ot">3</span><span class="co">]</span>" in the output. The data looks the same, but it's now grouped!</span>
<span id="cb163-457"><a href="#cb163-457" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb163-458"><a href="#cb163-458" aria-hidden="true" tabindex="-1"></a><span class="fu">### Summarizing Data with `summarise()`</span></span>
<span id="cb163-459"><a href="#cb163-459" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb163-460"><a href="#cb163-460" aria-hidden="true" tabindex="-1"></a><span class="in">`summarise()`</span> (or <span class="in">`summarize()`</span>) calculates summary statistics:</span>
<span id="cb163-461"><a href="#cb163-461" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb163-464"><a href="#cb163-464" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb163-465"><a href="#cb163-465" aria-hidden="true" tabindex="-1"></a><span class="co">#| eval: true</span></span>
<span id="cb163-466"><a href="#cb163-466" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: true</span></span>
<span id="cb163-467"><a href="#cb163-467" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb163-468"><a href="#cb163-468" aria-hidden="true" tabindex="-1"></a><span class="co"># Overall mean weight (no grouping)</span></span>
<span id="cb163-469"><a href="#cb163-469" aria-hidden="true" tabindex="-1"></a>farm_data <span class="sc">%&gt;%</span></span>
<span id="cb163-470"><a href="#cb163-470" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(</span>
<span id="cb163-471"><a href="#cb163-471" aria-hidden="true" tabindex="-1"></a>    <span class="at">mean_weight =</span> <span class="fu">mean</span>(weight_kg),</span>
<span id="cb163-472"><a href="#cb163-472" aria-hidden="true" tabindex="-1"></a>    <span class="at">sd_weight =</span> <span class="fu">sd</span>(weight_kg),</span>
<span id="cb163-473"><a href="#cb163-473" aria-hidden="true" tabindex="-1"></a>    <span class="at">n =</span> <span class="fu">n</span>()  <span class="co"># n() counts rows</span></span>
<span id="cb163-474"><a href="#cb163-474" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb163-475"><a href="#cb163-475" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb163-476"><a href="#cb163-476" aria-hidden="true" tabindex="-1"></a><span class="co"># Mean weight BY BREED</span></span>
<span id="cb163-477"><a href="#cb163-477" aria-hidden="true" tabindex="-1"></a>farm_data <span class="sc">%&gt;%</span></span>
<span id="cb163-478"><a href="#cb163-478" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(breed) <span class="sc">%&gt;%</span></span>
<span id="cb163-479"><a href="#cb163-479" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(</span>
<span id="cb163-480"><a href="#cb163-480" aria-hidden="true" tabindex="-1"></a>    <span class="at">mean_weight =</span> <span class="fu">mean</span>(weight_kg),</span>
<span id="cb163-481"><a href="#cb163-481" aria-hidden="true" tabindex="-1"></a>    <span class="at">sd_weight =</span> <span class="fu">sd</span>(weight_kg),</span>
<span id="cb163-482"><a href="#cb163-482" aria-hidden="true" tabindex="-1"></a>    <span class="at">n =</span> <span class="fu">n</span>()</span>
<span id="cb163-483"><a href="#cb163-483" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb163-484"><a href="#cb163-484" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb163-485"><a href="#cb163-485" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb163-486"><a href="#cb163-486" aria-hidden="true" tabindex="-1"></a>::: {.callout-important}</span>
<span id="cb163-487"><a href="#cb163-487" aria-hidden="true" tabindex="-1"></a><span class="fu">## The `group_by()` + `summarise()` Pattern</span></span>
<span id="cb163-488"><a href="#cb163-488" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb163-489"><a href="#cb163-489" aria-hidden="true" tabindex="-1"></a>This is one of the most powerful patterns in data analysis:</span>
<span id="cb163-490"><a href="#cb163-490" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb163-493"><a href="#cb163-493" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb163-494"><a href="#cb163-494" aria-hidden="true" tabindex="-1"></a><span class="co">#| eval: false</span></span>
<span id="cb163-495"><a href="#cb163-495" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: true</span></span>
<span id="cb163-496"><a href="#cb163-496" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb163-497"><a href="#cb163-497" aria-hidden="true" tabindex="-1"></a>data <span class="sc">%&gt;%</span></span>
<span id="cb163-498"><a href="#cb163-498" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(category_column) <span class="sc">%&gt;%</span></span>
<span id="cb163-499"><a href="#cb163-499" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(</span>
<span id="cb163-500"><a href="#cb163-500" aria-hidden="true" tabindex="-1"></a>    <span class="at">summary_name =</span> <span class="fu">summary_function</span>(numeric_column)</span>
<span id="cb163-501"><a href="#cb163-501" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb163-502"><a href="#cb163-502" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb163-503"><a href="#cb163-503" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb163-504"><a href="#cb163-504" aria-hidden="true" tabindex="-1"></a>**Read as**: "For each category, calculate the summary"</span>
<span id="cb163-505"><a href="#cb163-505" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb163-506"><a href="#cb163-506" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb163-507"><a href="#cb163-507" aria-hidden="true" tabindex="-1"></a><span class="fu">### Common Summary Functions</span></span>
<span id="cb163-508"><a href="#cb163-508" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb163-509"><a href="#cb163-509" aria-hidden="true" tabindex="-1"></a><span class="pp">|</span> Function <span class="pp">|</span> What it does <span class="pp">|</span> Example <span class="pp">|</span></span>
<span id="cb163-510"><a href="#cb163-510" aria-hidden="true" tabindex="-1"></a><span class="pp">|----------|-------------|---------|</span></span>
<span id="cb163-511"><a href="#cb163-511" aria-hidden="true" tabindex="-1"></a><span class="pp">|</span> <span class="in">`mean()`</span> <span class="pp">|</span> Average <span class="pp">|</span> <span class="in">`mean(weight)`</span> <span class="pp">|</span></span>
<span id="cb163-512"><a href="#cb163-512" aria-hidden="true" tabindex="-1"></a><span class="pp">|</span> <span class="in">`median()`</span> <span class="pp">|</span> Median (50th percentile) <span class="pp">|</span> <span class="in">`median(weight)`</span> <span class="pp">|</span></span>
<span id="cb163-513"><a href="#cb163-513" aria-hidden="true" tabindex="-1"></a><span class="pp">|</span> <span class="in">`sd()`</span> <span class="pp">|</span> Standard deviation <span class="pp">|</span> <span class="in">`sd(weight)`</span> <span class="pp">|</span></span>
<span id="cb163-514"><a href="#cb163-514" aria-hidden="true" tabindex="-1"></a><span class="pp">|</span> <span class="in">`var()`</span> <span class="pp">|</span> Variance <span class="pp">|</span> <span class="in">`var(weight)`</span> <span class="pp">|</span></span>
<span id="cb163-515"><a href="#cb163-515" aria-hidden="true" tabindex="-1"></a><span class="pp">|</span> <span class="in">`min()`</span> <span class="pp">|</span> Minimum value <span class="pp">|</span> <span class="in">`min(weight)`</span> <span class="pp">|</span></span>
<span id="cb163-516"><a href="#cb163-516" aria-hidden="true" tabindex="-1"></a><span class="pp">|</span> <span class="in">`max()`</span> <span class="pp">|</span> Maximum value <span class="pp">|</span> <span class="in">`max(weight)`</span> <span class="pp">|</span></span>
<span id="cb163-517"><a href="#cb163-517" aria-hidden="true" tabindex="-1"></a><span class="pp">|</span> <span class="in">`sum()`</span> <span class="pp">|</span> Sum of all values <span class="pp">|</span> <span class="in">`sum(milk_yield)`</span> <span class="pp">|</span></span>
<span id="cb163-518"><a href="#cb163-518" aria-hidden="true" tabindex="-1"></a><span class="pp">|</span> <span class="in">`n()`</span> <span class="pp">|</span> Count of rows <span class="pp">|</span> <span class="in">`n()`</span> <span class="pp">|</span></span>
<span id="cb163-519"><a href="#cb163-519" aria-hidden="true" tabindex="-1"></a><span class="pp">|</span> <span class="in">`n_distinct()`</span> <span class="pp">|</span> Count unique values <span class="pp">|</span> <span class="in">`n_distinct(animal_id)`</span> <span class="pp">|</span></span>
<span id="cb163-520"><a href="#cb163-520" aria-hidden="true" tabindex="-1"></a><span class="pp">|</span> <span class="in">`first()`</span> <span class="pp">|</span> First value <span class="pp">|</span> <span class="in">`first(weight)`</span> <span class="pp">|</span></span>
<span id="cb163-521"><a href="#cb163-521" aria-hidden="true" tabindex="-1"></a><span class="pp">|</span> <span class="in">`last()`</span> <span class="pp">|</span> Last value <span class="pp">|</span> <span class="in">`last(weight)`</span> <span class="pp">|</span></span>
<span id="cb163-522"><a href="#cb163-522" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb163-523"><a href="#cb163-523" aria-hidden="true" tabindex="-1"></a><span class="fu">### Grouping by Multiple Variables</span></span>
<span id="cb163-524"><a href="#cb163-524" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb163-527"><a href="#cb163-527" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb163-528"><a href="#cb163-528" aria-hidden="true" tabindex="-1"></a><span class="co">#| eval: true</span></span>
<span id="cb163-529"><a href="#cb163-529" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: true</span></span>
<span id="cb163-530"><a href="#cb163-530" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb163-531"><a href="#cb163-531" aria-hidden="true" tabindex="-1"></a><span class="co"># Mean weight by breed AND farm</span></span>
<span id="cb163-532"><a href="#cb163-532" aria-hidden="true" tabindex="-1"></a>farm_data <span class="sc">%&gt;%</span></span>
<span id="cb163-533"><a href="#cb163-533" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(breed, farm) <span class="sc">%&gt;%</span></span>
<span id="cb163-534"><a href="#cb163-534" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(</span>
<span id="cb163-535"><a href="#cb163-535" aria-hidden="true" tabindex="-1"></a>    <span class="at">mean_weight =</span> <span class="fu">mean</span>(weight_kg),</span>
<span id="cb163-536"><a href="#cb163-536" aria-hidden="true" tabindex="-1"></a>    <span class="at">n =</span> <span class="fu">n</span>(),</span>
<span id="cb163-537"><a href="#cb163-537" aria-hidden="true" tabindex="-1"></a>    <span class="at">.groups =</span> <span class="st">"drop"</span>  <span class="co"># Remove grouping after summarise</span></span>
<span id="cb163-538"><a href="#cb163-538" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb163-539"><a href="#cb163-539" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb163-540"><a href="#cb163-540" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb163-541"><a href="#cb163-541" aria-hidden="true" tabindex="-1"></a>::: {.callout-note}</span>
<span id="cb163-542"><a href="#cb163-542" aria-hidden="true" tabindex="-1"></a><span class="fu">## The `.groups` Argument</span></span>
<span id="cb163-543"><a href="#cb163-543" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb163-544"><a href="#cb163-544" aria-hidden="true" tabindex="-1"></a>After <span class="in">`summarise()`</span>, data remains grouped by all but the last grouping variable. This can cause unexpected behavior!</span>
<span id="cb163-545"><a href="#cb163-545" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb163-548"><a href="#cb163-548" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb163-549"><a href="#cb163-549" aria-hidden="true" tabindex="-1"></a><span class="co">#| eval: false</span></span>
<span id="cb163-550"><a href="#cb163-550" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: true</span></span>
<span id="cb163-551"><a href="#cb163-551" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb163-552"><a href="#cb163-552" aria-hidden="true" tabindex="-1"></a><span class="co"># Recommended: explicitly drop groups</span></span>
<span id="cb163-553"><a href="#cb163-553" aria-hidden="true" tabindex="-1"></a>data <span class="sc">%&gt;%</span></span>
<span id="cb163-554"><a href="#cb163-554" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(var1, var2) <span class="sc">%&gt;%</span></span>
<span id="cb163-555"><a href="#cb163-555" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">mean_x =</span> <span class="fu">mean</span>(x), <span class="at">.groups =</span> <span class="st">"drop"</span>)</span>
<span id="cb163-556"><a href="#cb163-556" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb163-557"><a href="#cb163-557" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb163-558"><a href="#cb163-558" aria-hidden="true" tabindex="-1"></a>**Options**:</span>
<span id="cb163-559"><a href="#cb163-559" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span><span class="in">`.groups = "drop"`</span>: Remove all grouping (recommended)</span>
<span id="cb163-560"><a href="#cb163-560" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span><span class="in">`.groups = "keep"`</span>: Keep all grouping</span>
<span id="cb163-561"><a href="#cb163-561" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span><span class="in">`.groups = "drop_last"`</span>: Drop last grouping variable (default)</span>
<span id="cb163-562"><a href="#cb163-562" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb163-563"><a href="#cb163-563" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb163-564"><a href="#cb163-564" aria-hidden="true" tabindex="-1"></a><span class="fu">### Multiple Summaries at Once</span></span>
<span id="cb163-565"><a href="#cb163-565" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb163-568"><a href="#cb163-568" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb163-569"><a href="#cb163-569" aria-hidden="true" tabindex="-1"></a><span class="co">#| eval: true</span></span>
<span id="cb163-570"><a href="#cb163-570" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: true</span></span>
<span id="cb163-571"><a href="#cb163-571" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb163-572"><a href="#cb163-572" aria-hidden="true" tabindex="-1"></a><span class="co"># Comprehensive summary by breed</span></span>
<span id="cb163-573"><a href="#cb163-573" aria-hidden="true" tabindex="-1"></a>farm_data <span class="sc">%&gt;%</span></span>
<span id="cb163-574"><a href="#cb163-574" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(breed) <span class="sc">%&gt;%</span></span>
<span id="cb163-575"><a href="#cb163-575" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(</span>
<span id="cb163-576"><a href="#cb163-576" aria-hidden="true" tabindex="-1"></a>    <span class="at">n =</span> <span class="fu">n</span>(),</span>
<span id="cb163-577"><a href="#cb163-577" aria-hidden="true" tabindex="-1"></a>    <span class="at">mean_weight =</span> <span class="fu">mean</span>(weight_kg),</span>
<span id="cb163-578"><a href="#cb163-578" aria-hidden="true" tabindex="-1"></a>    <span class="at">sd_weight =</span> <span class="fu">sd</span>(weight_kg),</span>
<span id="cb163-579"><a href="#cb163-579" aria-hidden="true" tabindex="-1"></a>    <span class="at">min_weight =</span> <span class="fu">min</span>(weight_kg),</span>
<span id="cb163-580"><a href="#cb163-580" aria-hidden="true" tabindex="-1"></a>    <span class="at">max_weight =</span> <span class="fu">max</span>(weight_kg),</span>
<span id="cb163-581"><a href="#cb163-581" aria-hidden="true" tabindex="-1"></a>    <span class="at">median_weight =</span> <span class="fu">median</span>(weight_kg),</span>
<span id="cb163-582"><a href="#cb163-582" aria-hidden="true" tabindex="-1"></a>    <span class="at">.groups =</span> <span class="st">"drop"</span></span>
<span id="cb163-583"><a href="#cb163-583" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb163-584"><a href="#cb163-584" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb163-585"><a href="#cb163-585" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb163-586"><a href="#cb163-586" aria-hidden="true" tabindex="-1"></a><span class="fu">### Filtering on Grouped Data</span></span>
<span id="cb163-587"><a href="#cb163-587" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb163-588"><a href="#cb163-588" aria-hidden="true" tabindex="-1"></a><span class="in">`filter()`</span> works with groups too:</span>
<span id="cb163-589"><a href="#cb163-589" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb163-592"><a href="#cb163-592" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb163-593"><a href="#cb163-593" aria-hidden="true" tabindex="-1"></a><span class="co">#| eval: true</span></span>
<span id="cb163-594"><a href="#cb163-594" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: true</span></span>
<span id="cb163-595"><a href="#cb163-595" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb163-596"><a href="#cb163-596" aria-hidden="true" tabindex="-1"></a><span class="co"># Keep only animals heavier than the breed average</span></span>
<span id="cb163-597"><a href="#cb163-597" aria-hidden="true" tabindex="-1"></a>farm_data <span class="sc">%&gt;%</span></span>
<span id="cb163-598"><a href="#cb163-598" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(breed) <span class="sc">%&gt;%</span></span>
<span id="cb163-599"><a href="#cb163-599" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(weight_kg <span class="sc">&gt;</span> <span class="fu">mean</span>(weight_kg)) <span class="sc">%&gt;%</span></span>
<span id="cb163-600"><a href="#cb163-600" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>()  <span class="co"># Remove grouping when done</span></span>
<span id="cb163-601"><a href="#cb163-601" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb163-602"><a href="#cb163-602" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb163-603"><a href="#cb163-603" aria-hidden="true" tabindex="-1"></a><span class="fu">### Mutating on Grouped Data</span></span>
<span id="cb163-604"><a href="#cb163-604" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb163-605"><a href="#cb163-605" aria-hidden="true" tabindex="-1"></a><span class="in">`mutate()`</span> calculates within groups:</span>
<span id="cb163-606"><a href="#cb163-606" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb163-609"><a href="#cb163-609" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb163-610"><a href="#cb163-610" aria-hidden="true" tabindex="-1"></a><span class="co">#| eval: true</span></span>
<span id="cb163-611"><a href="#cb163-611" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: true</span></span>
<span id="cb163-612"><a href="#cb163-612" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb163-613"><a href="#cb163-613" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate deviation from breed mean</span></span>
<span id="cb163-614"><a href="#cb163-614" aria-hidden="true" tabindex="-1"></a>farm_data <span class="sc">%&gt;%</span></span>
<span id="cb163-615"><a href="#cb163-615" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(breed) <span class="sc">%&gt;%</span></span>
<span id="cb163-616"><a href="#cb163-616" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb163-617"><a href="#cb163-617" aria-hidden="true" tabindex="-1"></a>    <span class="at">breed_mean =</span> <span class="fu">mean</span>(weight_kg),</span>
<span id="cb163-618"><a href="#cb163-618" aria-hidden="true" tabindex="-1"></a>    <span class="at">deviation =</span> weight_kg <span class="sc">-</span> breed_mean</span>
<span id="cb163-619"><a href="#cb163-619" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb163-620"><a href="#cb163-620" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span></span>
<span id="cb163-621"><a href="#cb163-621" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(breed, animal_id)</span>
<span id="cb163-622"><a href="#cb163-622" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb163-623"><a href="#cb163-623" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb163-624"><a href="#cb163-624" aria-hidden="true" tabindex="-1"></a>---</span>
<span id="cb163-625"><a href="#cb163-625" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb163-626"><a href="#cb163-626" aria-hidden="true" tabindex="-1"></a><span class="fu">## Helper Functions</span></span>
<span id="cb163-627"><a href="#cb163-627" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb163-628"><a href="#cb163-628" aria-hidden="true" tabindex="-1"></a><span class="fu">### Counting with `count()`</span></span>
<span id="cb163-629"><a href="#cb163-629" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb163-630"><a href="#cb163-630" aria-hidden="true" tabindex="-1"></a><span class="in">`count()`</span> is a shortcut for <span class="in">`group_by()`</span> + <span class="in">`summarise()`</span> + <span class="in">`n()`</span>:</span>
<span id="cb163-631"><a href="#cb163-631" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb163-634"><a href="#cb163-634" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb163-635"><a href="#cb163-635" aria-hidden="true" tabindex="-1"></a><span class="co">#| eval: true</span></span>
<span id="cb163-636"><a href="#cb163-636" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: true</span></span>
<span id="cb163-637"><a href="#cb163-637" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb163-638"><a href="#cb163-638" aria-hidden="true" tabindex="-1"></a><span class="co"># How many animals per breed?</span></span>
<span id="cb163-639"><a href="#cb163-639" aria-hidden="true" tabindex="-1"></a><span class="co"># Long way</span></span>
<span id="cb163-640"><a href="#cb163-640" aria-hidden="true" tabindex="-1"></a>farm_data <span class="sc">%&gt;%</span></span>
<span id="cb163-641"><a href="#cb163-641" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(breed) <span class="sc">%&gt;%</span></span>
<span id="cb163-642"><a href="#cb163-642" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">n =</span> <span class="fu">n</span>(), <span class="at">.groups =</span> <span class="st">"drop"</span>)</span>
<span id="cb163-643"><a href="#cb163-643" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb163-644"><a href="#cb163-644" aria-hidden="true" tabindex="-1"></a><span class="co"># Short way with count()</span></span>
<span id="cb163-645"><a href="#cb163-645" aria-hidden="true" tabindex="-1"></a>farm_data <span class="sc">%&gt;%</span></span>
<span id="cb163-646"><a href="#cb163-646" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(breed)</span>
<span id="cb163-647"><a href="#cb163-647" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb163-648"><a href="#cb163-648" aria-hidden="true" tabindex="-1"></a><span class="co"># Count by multiple variables</span></span>
<span id="cb163-649"><a href="#cb163-649" aria-hidden="true" tabindex="-1"></a>farm_data <span class="sc">%&gt;%</span></span>
<span id="cb163-650"><a href="#cb163-650" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(breed, farm)</span>
<span id="cb163-651"><a href="#cb163-651" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb163-652"><a href="#cb163-652" aria-hidden="true" tabindex="-1"></a><span class="co"># Sort by count (most common first)</span></span>
<span id="cb163-653"><a href="#cb163-653" aria-hidden="true" tabindex="-1"></a>farm_data <span class="sc">%&gt;%</span></span>
<span id="cb163-654"><a href="#cb163-654" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(breed, <span class="at">sort =</span> <span class="cn">TRUE</span>)</span>
<span id="cb163-655"><a href="#cb163-655" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb163-656"><a href="#cb163-656" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb163-657"><a href="#cb163-657" aria-hidden="true" tabindex="-1"></a>::: {.callout-tip}</span>
<span id="cb163-658"><a href="#cb163-658" aria-hidden="true" tabindex="-1"></a><span class="fu">## `count()` Pro Tips</span></span>
<span id="cb163-659"><a href="#cb163-659" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb163-662"><a href="#cb163-662" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb163-663"><a href="#cb163-663" aria-hidden="true" tabindex="-1"></a><span class="co">#| eval: true</span></span>
<span id="cb163-664"><a href="#cb163-664" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: true</span></span>
<span id="cb163-665"><a href="#cb163-665" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb163-666"><a href="#cb163-666" aria-hidden="true" tabindex="-1"></a><span class="co"># Rename the count column</span></span>
<span id="cb163-667"><a href="#cb163-667" aria-hidden="true" tabindex="-1"></a>farm_data <span class="sc">%&gt;%</span></span>
<span id="cb163-668"><a href="#cb163-668" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(breed, <span class="at">name =</span> <span class="st">"number_of_animals"</span>)</span>
<span id="cb163-669"><a href="#cb163-669" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb163-670"><a href="#cb163-670" aria-hidden="true" tabindex="-1"></a><span class="co"># Add a total row (using add_tally)</span></span>
<span id="cb163-671"><a href="#cb163-671" aria-hidden="true" tabindex="-1"></a>farm_data <span class="sc">%&gt;%</span></span>
<span id="cb163-672"><a href="#cb163-672" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(breed) <span class="sc">%&gt;%</span></span>
<span id="cb163-673"><a href="#cb163-673" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">proportion =</span> n <span class="sc">/</span> <span class="fu">sum</span>(n))</span>
<span id="cb163-674"><a href="#cb163-674" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb163-675"><a href="#cb163-675" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb163-676"><a href="#cb163-676" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb163-677"><a href="#cb163-677" aria-hidden="true" tabindex="-1"></a><span class="fu">### Renaming Columns with `rename()`</span></span>
<span id="cb163-678"><a href="#cb163-678" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb163-679"><a href="#cb163-679" aria-hidden="true" tabindex="-1"></a><span class="in">`rename()`</span> changes column names:</span>
<span id="cb163-680"><a href="#cb163-680" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb163-681"><a href="#cb163-681" aria-hidden="true" tabindex="-1"></a>**Syntax**: <span class="in">`rename(new_name = old_name)`</span></span>
<span id="cb163-682"><a href="#cb163-682" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb163-685"><a href="#cb163-685" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb163-686"><a href="#cb163-686" aria-hidden="true" tabindex="-1"></a><span class="co">#| eval: true</span></span>
<span id="cb163-687"><a href="#cb163-687" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: true</span></span>
<span id="cb163-688"><a href="#cb163-688" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb163-689"><a href="#cb163-689" aria-hidden="true" tabindex="-1"></a><span class="co"># Rename columns</span></span>
<span id="cb163-690"><a href="#cb163-690" aria-hidden="true" tabindex="-1"></a>cattle <span class="sc">%&gt;%</span></span>
<span id="cb163-691"><a href="#cb163-691" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(</span>
<span id="cb163-692"><a href="#cb163-692" aria-hidden="true" tabindex="-1"></a>    <span class="at">id =</span> animal_id,</span>
<span id="cb163-693"><a href="#cb163-693" aria-hidden="true" tabindex="-1"></a>    <span class="at">weight =</span> weight_kg,</span>
<span id="cb163-694"><a href="#cb163-694" aria-hidden="true" tabindex="-1"></a>    <span class="at">height =</span> height_cm</span>
<span id="cb163-695"><a href="#cb163-695" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb163-696"><a href="#cb163-696" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb163-697"><a href="#cb163-697" aria-hidden="true" tabindex="-1"></a><span class="co"># Rename with a function</span></span>
<span id="cb163-698"><a href="#cb163-698" aria-hidden="true" tabindex="-1"></a>cattle <span class="sc">%&gt;%</span></span>
<span id="cb163-699"><a href="#cb163-699" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename_with</span>(str_to_upper)  <span class="co"># All columns to uppercase</span></span>
<span id="cb163-700"><a href="#cb163-700" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb163-701"><a href="#cb163-701" aria-hidden="true" tabindex="-1"></a><span class="co"># Rename specific columns with a function</span></span>
<span id="cb163-702"><a href="#cb163-702" aria-hidden="true" tabindex="-1"></a>cattle <span class="sc">%&gt;%</span></span>
<span id="cb163-703"><a href="#cb163-703" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename_with</span>(str_to_upper, <span class="fu">starts_with</span>(<span class="st">"weight"</span>))</span>
<span id="cb163-704"><a href="#cb163-704" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb163-705"><a href="#cb163-705" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb163-706"><a href="#cb163-706" aria-hidden="true" tabindex="-1"></a><span class="fu">### Reordering Columns with `relocate()`</span></span>
<span id="cb163-707"><a href="#cb163-707" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb163-708"><a href="#cb163-708" aria-hidden="true" tabindex="-1"></a><span class="in">`relocate()`</span> moves columns to different positions:</span>
<span id="cb163-709"><a href="#cb163-709" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb163-712"><a href="#cb163-712" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb163-713"><a href="#cb163-713" aria-hidden="true" tabindex="-1"></a><span class="co">#| eval: true</span></span>
<span id="cb163-714"><a href="#cb163-714" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: true</span></span>
<span id="cb163-715"><a href="#cb163-715" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb163-716"><a href="#cb163-716" aria-hidden="true" tabindex="-1"></a><span class="co"># Move breed to the front</span></span>
<span id="cb163-717"><a href="#cb163-717" aria-hidden="true" tabindex="-1"></a>cattle <span class="sc">%&gt;%</span></span>
<span id="cb163-718"><a href="#cb163-718" aria-hidden="true" tabindex="-1"></a>  <span class="fu">relocate</span>(breed)</span>
<span id="cb163-719"><a href="#cb163-719" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb163-720"><a href="#cb163-720" aria-hidden="true" tabindex="-1"></a><span class="co"># Move weight_kg to the end</span></span>
<span id="cb163-721"><a href="#cb163-721" aria-hidden="true" tabindex="-1"></a>cattle <span class="sc">%&gt;%</span></span>
<span id="cb163-722"><a href="#cb163-722" aria-hidden="true" tabindex="-1"></a>  <span class="fu">relocate</span>(weight_kg, <span class="at">.after =</span> <span class="fu">last_col</span>())</span>
<span id="cb163-723"><a href="#cb163-723" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb163-724"><a href="#cb163-724" aria-hidden="true" tabindex="-1"></a><span class="co"># Move height_cm before breed</span></span>
<span id="cb163-725"><a href="#cb163-725" aria-hidden="true" tabindex="-1"></a>cattle <span class="sc">%&gt;%</span></span>
<span id="cb163-726"><a href="#cb163-726" aria-hidden="true" tabindex="-1"></a>  <span class="fu">relocate</span>(height_cm, <span class="at">.before =</span> breed)</span>
<span id="cb163-727"><a href="#cb163-727" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb163-728"><a href="#cb163-728" aria-hidden="true" tabindex="-1"></a><span class="co"># Move all numeric columns to the front</span></span>
<span id="cb163-729"><a href="#cb163-729" aria-hidden="true" tabindex="-1"></a>cattle <span class="sc">%&gt;%</span></span>
<span id="cb163-730"><a href="#cb163-730" aria-hidden="true" tabindex="-1"></a>  <span class="fu">relocate</span>(<span class="fu">where</span>(is.numeric))</span>
<span id="cb163-731"><a href="#cb163-731" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb163-732"><a href="#cb163-732" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb163-733"><a href="#cb163-733" aria-hidden="true" tabindex="-1"></a>---</span>
<span id="cb163-734"><a href="#cb163-734" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb163-735"><a href="#cb163-735" aria-hidden="true" tabindex="-1"></a><span class="fu">## Working Across Multiple Columns with `across()`</span></span>
<span id="cb163-736"><a href="#cb163-736" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb163-737"><a href="#cb163-737" aria-hidden="true" tabindex="-1"></a><span class="in">`across()`</span> applies the same operation to multiple columns at once.</span>
<span id="cb163-738"><a href="#cb163-738" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb163-739"><a href="#cb163-739" aria-hidden="true" tabindex="-1"></a><span class="fu">### Basic Usage</span></span>
<span id="cb163-740"><a href="#cb163-740" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb163-743"><a href="#cb163-743" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb163-744"><a href="#cb163-744" aria-hidden="true" tabindex="-1"></a><span class="co">#| eval: true</span></span>
<span id="cb163-745"><a href="#cb163-745" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: true</span></span>
<span id="cb163-746"><a href="#cb163-746" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb163-747"><a href="#cb163-747" aria-hidden="true" tabindex="-1"></a><span class="co"># Create test data</span></span>
<span id="cb163-748"><a href="#cb163-748" aria-hidden="true" tabindex="-1"></a>test_data <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb163-749"><a href="#cb163-749" aria-hidden="true" tabindex="-1"></a>  <span class="at">animal_id =</span> <span class="fu">c</span>(<span class="st">"A001"</span>, <span class="st">"A002"</span>, <span class="st">"A003"</span>),</span>
<span id="cb163-750"><a href="#cb163-750" aria-hidden="true" tabindex="-1"></a>  <span class="at">weight_kg =</span> <span class="fu">c</span>(<span class="fl">600.123</span>, <span class="fl">450.456</span>, <span class="fl">550.789</span>),</span>
<span id="cb163-751"><a href="#cb163-751" aria-hidden="true" tabindex="-1"></a>  <span class="at">height_cm =</span> <span class="fu">c</span>(<span class="fl">145.678</span>, <span class="fl">130.234</span>, <span class="fl">140.567</span>),</span>
<span id="cb163-752"><a href="#cb163-752" aria-hidden="true" tabindex="-1"></a>  <span class="at">age_months =</span> <span class="fu">c</span>(<span class="fl">30.5</span>, <span class="fl">28.3</span>, <span class="fl">32.1</span>)</span>
<span id="cb163-753"><a href="#cb163-753" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb163-754"><a href="#cb163-754" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb163-755"><a href="#cb163-755" aria-hidden="true" tabindex="-1"></a>test_data</span>
<span id="cb163-756"><a href="#cb163-756" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb163-757"><a href="#cb163-757" aria-hidden="true" tabindex="-1"></a><span class="co"># Round all numeric columns to 1 decimal place</span></span>
<span id="cb163-758"><a href="#cb163-758" aria-hidden="true" tabindex="-1"></a>test_data <span class="sc">%&gt;%</span></span>
<span id="cb163-759"><a href="#cb163-759" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="fu">across</span>(<span class="fu">where</span>(is.numeric), round, <span class="dv">1</span>))</span>
<span id="cb163-760"><a href="#cb163-760" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb163-761"><a href="#cb163-761" aria-hidden="true" tabindex="-1"></a><span class="co"># Convert all character columns to uppercase</span></span>
<span id="cb163-762"><a href="#cb163-762" aria-hidden="true" tabindex="-1"></a>farm_data <span class="sc">%&gt;%</span></span>
<span id="cb163-763"><a href="#cb163-763" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="fu">across</span>(<span class="fu">where</span>(is.character), str_to_upper)) <span class="sc">%&gt;%</span></span>
<span id="cb163-764"><a href="#cb163-764" aria-hidden="true" tabindex="-1"></a>  <span class="fu">head</span>(<span class="dv">3</span>)</span>
<span id="cb163-765"><a href="#cb163-765" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb163-766"><a href="#cb163-766" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb163-767"><a href="#cb163-767" aria-hidden="true" tabindex="-1"></a><span class="fu">### Selecting Columns for `across()`</span></span>
<span id="cb163-768"><a href="#cb163-768" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb163-771"><a href="#cb163-771" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb163-772"><a href="#cb163-772" aria-hidden="true" tabindex="-1"></a><span class="co">#| eval: true</span></span>
<span id="cb163-773"><a href="#cb163-773" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: true</span></span>
<span id="cb163-774"><a href="#cb163-774" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb163-775"><a href="#cb163-775" aria-hidden="true" tabindex="-1"></a><span class="co"># Apply to specific columns</span></span>
<span id="cb163-776"><a href="#cb163-776" aria-hidden="true" tabindex="-1"></a>test_data <span class="sc">%&gt;%</span></span>
<span id="cb163-777"><a href="#cb163-777" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="fu">across</span>(<span class="fu">c</span>(weight_kg, height_cm), round, <span class="dv">1</span>))</span>
<span id="cb163-778"><a href="#cb163-778" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb163-779"><a href="#cb163-779" aria-hidden="true" tabindex="-1"></a><span class="co"># Apply to columns matching a pattern</span></span>
<span id="cb163-780"><a href="#cb163-780" aria-hidden="true" tabindex="-1"></a>test_data <span class="sc">%&gt;%</span></span>
<span id="cb163-781"><a href="#cb163-781" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="fu">across</span>(<span class="fu">ends_with</span>(<span class="st">"_kg"</span>), <span class="sc">~</span> . <span class="sc">*</span> <span class="fl">2.20462</span>))  <span class="co"># Convert kg to lb</span></span>
<span id="cb163-782"><a href="#cb163-782" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb163-783"><a href="#cb163-783" aria-hidden="true" tabindex="-1"></a><span class="co"># Apply to all except some columns</span></span>
<span id="cb163-784"><a href="#cb163-784" aria-hidden="true" tabindex="-1"></a>test_data <span class="sc">%&gt;%</span></span>
<span id="cb163-785"><a href="#cb163-785" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="fu">across</span>(<span class="sc">-</span>animal_id, round, <span class="dv">0</span>))</span>
<span id="cb163-786"><a href="#cb163-786" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb163-787"><a href="#cb163-787" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb163-788"><a href="#cb163-788" aria-hidden="true" tabindex="-1"></a>::: {.callout-note}</span>
<span id="cb163-789"><a href="#cb163-789" aria-hidden="true" tabindex="-1"></a><span class="fu">## Anonymous Functions with `across()`</span></span>
<span id="cb163-790"><a href="#cb163-790" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb163-791"><a href="#cb163-791" aria-hidden="true" tabindex="-1"></a>The <span class="in">`~`</span> creates an anonymous function, and <span class="in">`.`</span> represents each column:</span>
<span id="cb163-792"><a href="#cb163-792" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb163-795"><a href="#cb163-795" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb163-796"><a href="#cb163-796" aria-hidden="true" tabindex="-1"></a><span class="co">#| eval: false</span></span>
<span id="cb163-797"><a href="#cb163-797" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: true</span></span>
<span id="cb163-798"><a href="#cb163-798" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb163-799"><a href="#cb163-799" aria-hidden="true" tabindex="-1"></a><span class="co"># These are equivalent:</span></span>
<span id="cb163-800"><a href="#cb163-800" aria-hidden="true" tabindex="-1"></a><span class="fu">across</span>(cols, <span class="sc">~</span> <span class="fu">round</span>(., <span class="dv">1</span>))</span>
<span id="cb163-801"><a href="#cb163-801" aria-hidden="true" tabindex="-1"></a><span class="fu">across</span>(cols, round, <span class="dv">1</span>)</span>
<span id="cb163-802"><a href="#cb163-802" aria-hidden="true" tabindex="-1"></a><span class="fu">across</span>(cols, <span class="cf">function</span>(x) <span class="fu">round</span>(x, <span class="dv">1</span>))</span>
<span id="cb163-803"><a href="#cb163-803" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb163-804"><a href="#cb163-804" aria-hidden="true" tabindex="-1"></a><span class="co"># Use ~ when you need more complex operations:</span></span>
<span id="cb163-805"><a href="#cb163-805" aria-hidden="true" tabindex="-1"></a><span class="fu">across</span>(cols, <span class="sc">~</span> . <span class="sc">*</span> <span class="dv">2</span> <span class="sc">+</span> <span class="dv">1</span>)</span>
<span id="cb163-806"><a href="#cb163-806" aria-hidden="true" tabindex="-1"></a><span class="fu">across</span>(cols, <span class="sc">~</span> <span class="fu">if_else</span>(. <span class="sc">&gt;</span> <span class="dv">100</span>, ., . <span class="sc">*</span> <span class="dv">2</span>))</span>
<span id="cb163-807"><a href="#cb163-807" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb163-808"><a href="#cb163-808" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb163-809"><a href="#cb163-809" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb163-810"><a href="#cb163-810" aria-hidden="true" tabindex="-1"></a><span class="fu">### Multiple Summaries with `across()`</span></span>
<span id="cb163-811"><a href="#cb163-811" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb163-814"><a href="#cb163-814" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb163-815"><a href="#cb163-815" aria-hidden="true" tabindex="-1"></a><span class="co">#| eval: true</span></span>
<span id="cb163-816"><a href="#cb163-816" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: true</span></span>
<span id="cb163-817"><a href="#cb163-817" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb163-818"><a href="#cb163-818" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate multiple summaries for multiple columns</span></span>
<span id="cb163-819"><a href="#cb163-819" aria-hidden="true" tabindex="-1"></a>farm_data <span class="sc">%&gt;%</span></span>
<span id="cb163-820"><a href="#cb163-820" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(breed) <span class="sc">%&gt;%</span></span>
<span id="cb163-821"><a href="#cb163-821" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(</span>
<span id="cb163-822"><a href="#cb163-822" aria-hidden="true" tabindex="-1"></a>    <span class="fu">across</span>(</span>
<span id="cb163-823"><a href="#cb163-823" aria-hidden="true" tabindex="-1"></a>      weight_kg,</span>
<span id="cb163-824"><a href="#cb163-824" aria-hidden="true" tabindex="-1"></a>      <span class="fu">list</span>(</span>
<span id="cb163-825"><a href="#cb163-825" aria-hidden="true" tabindex="-1"></a>        <span class="at">mean =</span> mean,</span>
<span id="cb163-826"><a href="#cb163-826" aria-hidden="true" tabindex="-1"></a>        <span class="at">sd =</span> sd,</span>
<span id="cb163-827"><a href="#cb163-827" aria-hidden="true" tabindex="-1"></a>        <span class="at">min =</span> min,</span>
<span id="cb163-828"><a href="#cb163-828" aria-hidden="true" tabindex="-1"></a>        <span class="at">max =</span> max</span>
<span id="cb163-829"><a href="#cb163-829" aria-hidden="true" tabindex="-1"></a>      )</span>
<span id="cb163-830"><a href="#cb163-830" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb163-831"><a href="#cb163-831" aria-hidden="true" tabindex="-1"></a>    <span class="at">n =</span> <span class="fu">n</span>(),</span>
<span id="cb163-832"><a href="#cb163-832" aria-hidden="true" tabindex="-1"></a>    <span class="at">.groups =</span> <span class="st">"drop"</span></span>
<span id="cb163-833"><a href="#cb163-833" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb163-834"><a href="#cb163-834" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb163-835"><a href="#cb163-835" aria-hidden="true" tabindex="-1"></a><span class="co"># Cleaner column names</span></span>
<span id="cb163-836"><a href="#cb163-836" aria-hidden="true" tabindex="-1"></a>farm_data <span class="sc">%&gt;%</span></span>
<span id="cb163-837"><a href="#cb163-837" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(breed) <span class="sc">%&gt;%</span></span>
<span id="cb163-838"><a href="#cb163-838" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(</span>
<span id="cb163-839"><a href="#cb163-839" aria-hidden="true" tabindex="-1"></a>    <span class="fu">across</span>(</span>
<span id="cb163-840"><a href="#cb163-840" aria-hidden="true" tabindex="-1"></a>      weight_kg,</span>
<span id="cb163-841"><a href="#cb163-841" aria-hidden="true" tabindex="-1"></a>      <span class="fu">list</span>(</span>
<span id="cb163-842"><a href="#cb163-842" aria-hidden="true" tabindex="-1"></a>        <span class="at">mean =</span> mean,</span>
<span id="cb163-843"><a href="#cb163-843" aria-hidden="true" tabindex="-1"></a>        <span class="at">sd =</span> sd</span>
<span id="cb163-844"><a href="#cb163-844" aria-hidden="true" tabindex="-1"></a>      ),</span>
<span id="cb163-845"><a href="#cb163-845" aria-hidden="true" tabindex="-1"></a>      <span class="at">.names =</span> <span class="st">"{.col}_{.fn}"</span>  <span class="co"># Creates: weight_kg_mean, weight_kg_sd</span></span>
<span id="cb163-846"><a href="#cb163-846" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb163-847"><a href="#cb163-847" aria-hidden="true" tabindex="-1"></a>    <span class="at">.groups =</span> <span class="st">"drop"</span></span>
<span id="cb163-848"><a href="#cb163-848" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb163-849"><a href="#cb163-849" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb163-850"><a href="#cb163-850" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb163-851"><a href="#cb163-851" aria-hidden="true" tabindex="-1"></a>---</span>
<span id="cb163-852"><a href="#cb163-852" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb163-853"><a href="#cb163-853" aria-hidden="true" tabindex="-1"></a><span class="fu">## Handling Missing Data</span></span>
<span id="cb163-854"><a href="#cb163-854" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb163-855"><a href="#cb163-855" aria-hidden="true" tabindex="-1"></a>Missing data (<span class="in">`NA`</span>) is common in real datasets. dplyr provides several tools to handle it.</span>
<span id="cb163-856"><a href="#cb163-856" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb163-857"><a href="#cb163-857" aria-hidden="true" tabindex="-1"></a><span class="fu">### Detecting Missing Values</span></span>
<span id="cb163-858"><a href="#cb163-858" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb163-861"><a href="#cb163-861" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb163-862"><a href="#cb163-862" aria-hidden="true" tabindex="-1"></a><span class="co">#| eval: true</span></span>
<span id="cb163-863"><a href="#cb163-863" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: true</span></span>
<span id="cb163-864"><a href="#cb163-864" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb163-865"><a href="#cb163-865" aria-hidden="true" tabindex="-1"></a><span class="co"># Create data with missing values</span></span>
<span id="cb163-866"><a href="#cb163-866" aria-hidden="true" tabindex="-1"></a>cattle_missing <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb163-867"><a href="#cb163-867" aria-hidden="true" tabindex="-1"></a>  <span class="at">animal_id =</span> <span class="fu">c</span>(<span class="st">"H001"</span>, <span class="st">"H002"</span>, <span class="st">"H003"</span>, <span class="st">"H004"</span>, <span class="st">"H005"</span>),</span>
<span id="cb163-868"><a href="#cb163-868" aria-hidden="true" tabindex="-1"></a>  <span class="at">breed =</span> <span class="fu">c</span>(<span class="st">"Holstein"</span>, <span class="st">"Jersey"</span>, <span class="cn">NA</span>, <span class="st">"Angus"</span>, <span class="st">"Holstein"</span>),</span>
<span id="cb163-869"><a href="#cb163-869" aria-hidden="true" tabindex="-1"></a>  <span class="at">weight_kg =</span> <span class="fu">c</span>(<span class="dv">600</span>, <span class="cn">NA</span>, <span class="dv">580</span>, <span class="dv">625</span>, <span class="cn">NA</span>),</span>
<span id="cb163-870"><a href="#cb163-870" aria-hidden="true" tabindex="-1"></a>  <span class="at">age_months =</span> <span class="fu">c</span>(<span class="dv">30</span>, <span class="dv">28</span>, <span class="cn">NA</span>, <span class="dv">32</span>, <span class="dv">26</span>)</span>
<span id="cb163-871"><a href="#cb163-871" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb163-872"><a href="#cb163-872" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb163-873"><a href="#cb163-873" aria-hidden="true" tabindex="-1"></a>cattle_missing</span>
<span id="cb163-874"><a href="#cb163-874" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb163-875"><a href="#cb163-875" aria-hidden="true" tabindex="-1"></a><span class="co"># Check for missing values</span></span>
<span id="cb163-876"><a href="#cb163-876" aria-hidden="true" tabindex="-1"></a>cattle_missing <span class="sc">%&gt;%</span></span>
<span id="cb163-877"><a href="#cb163-877" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb163-878"><a href="#cb163-878" aria-hidden="true" tabindex="-1"></a>    <span class="at">breed_is_missing =</span> <span class="fu">is.na</span>(breed),</span>
<span id="cb163-879"><a href="#cb163-879" aria-hidden="true" tabindex="-1"></a>    <span class="at">weight_is_missing =</span> <span class="fu">is.na</span>(weight_kg)</span>
<span id="cb163-880"><a href="#cb163-880" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb163-881"><a href="#cb163-881" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb163-882"><a href="#cb163-882" aria-hidden="true" tabindex="-1"></a><span class="co"># Count missing values per column</span></span>
<span id="cb163-883"><a href="#cb163-883" aria-hidden="true" tabindex="-1"></a>cattle_missing <span class="sc">%&gt;%</span></span>
<span id="cb163-884"><a href="#cb163-884" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(</span>
<span id="cb163-885"><a href="#cb163-885" aria-hidden="true" tabindex="-1"></a>    <span class="fu">across</span>(<span class="fu">everything</span>(), <span class="sc">~</span> <span class="fu">sum</span>(<span class="fu">is.na</span>(.)))</span>
<span id="cb163-886"><a href="#cb163-886" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb163-887"><a href="#cb163-887" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb163-888"><a href="#cb163-888" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb163-889"><a href="#cb163-889" aria-hidden="true" tabindex="-1"></a><span class="fu">### Removing Missing Values with `drop_na()`</span></span>
<span id="cb163-890"><a href="#cb163-890" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb163-893"><a href="#cb163-893" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb163-894"><a href="#cb163-894" aria-hidden="true" tabindex="-1"></a><span class="co">#| eval: true</span></span>
<span id="cb163-895"><a href="#cb163-895" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: true</span></span>
<span id="cb163-896"><a href="#cb163-896" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb163-897"><a href="#cb163-897" aria-hidden="true" tabindex="-1"></a><span class="co"># Remove rows with ANY missing values</span></span>
<span id="cb163-898"><a href="#cb163-898" aria-hidden="true" tabindex="-1"></a>cattle_missing <span class="sc">%&gt;%</span></span>
<span id="cb163-899"><a href="#cb163-899" aria-hidden="true" tabindex="-1"></a>  <span class="fu">drop_na</span>()</span>
<span id="cb163-900"><a href="#cb163-900" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb163-901"><a href="#cb163-901" aria-hidden="true" tabindex="-1"></a><span class="co"># Remove rows with missing values in specific columns</span></span>
<span id="cb163-902"><a href="#cb163-902" aria-hidden="true" tabindex="-1"></a>cattle_missing <span class="sc">%&gt;%</span></span>
<span id="cb163-903"><a href="#cb163-903" aria-hidden="true" tabindex="-1"></a>  <span class="fu">drop_na</span>(weight_kg)</span>
<span id="cb163-904"><a href="#cb163-904" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb163-905"><a href="#cb163-905" aria-hidden="true" tabindex="-1"></a><span class="co"># Remove rows missing BOTH weight and age</span></span>
<span id="cb163-906"><a href="#cb163-906" aria-hidden="true" tabindex="-1"></a>cattle_missing <span class="sc">%&gt;%</span></span>
<span id="cb163-907"><a href="#cb163-907" aria-hidden="true" tabindex="-1"></a>  <span class="fu">drop_na</span>(weight_kg, age_months)</span>
<span id="cb163-908"><a href="#cb163-908" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb163-909"><a href="#cb163-909" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb163-910"><a href="#cb163-910" aria-hidden="true" tabindex="-1"></a>::: {.callout-warning}</span>
<span id="cb163-911"><a href="#cb163-911" aria-hidden="true" tabindex="-1"></a><span class="fu">## Be Careful When Dropping NAs!</span></span>
<span id="cb163-912"><a href="#cb163-912" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb163-913"><a href="#cb163-913" aria-hidden="true" tabindex="-1"></a>Removing missing data can:</span>
<span id="cb163-914"><a href="#cb163-914" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Reduce sample size significantly</span>
<span id="cb163-915"><a href="#cb163-915" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Introduce bias if missingness isn't random</span>
<span id="cb163-916"><a href="#cb163-916" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Lose valuable information in other columns</span>
<span id="cb163-917"><a href="#cb163-917" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb163-918"><a href="#cb163-918" aria-hidden="true" tabindex="-1"></a>**Better approach**: Understand WHY data is missing, then decide how to handle it.</span>
<span id="cb163-919"><a href="#cb163-919" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb163-920"><a href="#cb163-920" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb163-921"><a href="#cb163-921" aria-hidden="true" tabindex="-1"></a><span class="fu">### Replacing Missing Values with `replace_na()`</span></span>
<span id="cb163-922"><a href="#cb163-922" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb163-925"><a href="#cb163-925" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb163-926"><a href="#cb163-926" aria-hidden="true" tabindex="-1"></a><span class="co">#| eval: true</span></span>
<span id="cb163-927"><a href="#cb163-927" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: true</span></span>
<span id="cb163-928"><a href="#cb163-928" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb163-929"><a href="#cb163-929" aria-hidden="true" tabindex="-1"></a><span class="co"># Replace NAs with specific values</span></span>
<span id="cb163-930"><a href="#cb163-930" aria-hidden="true" tabindex="-1"></a>cattle_missing <span class="sc">%&gt;%</span></span>
<span id="cb163-931"><a href="#cb163-931" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb163-932"><a href="#cb163-932" aria-hidden="true" tabindex="-1"></a>    <span class="at">breed =</span> <span class="fu">replace_na</span>(breed, <span class="st">"Unknown"</span>),</span>
<span id="cb163-933"><a href="#cb163-933" aria-hidden="true" tabindex="-1"></a>    <span class="at">weight_kg =</span> <span class="fu">replace_na</span>(weight_kg, <span class="dv">0</span>)</span>
<span id="cb163-934"><a href="#cb163-934" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb163-935"><a href="#cb163-935" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb163-936"><a href="#cb163-936" aria-hidden="true" tabindex="-1"></a><span class="co"># Replace NAs in multiple columns</span></span>
<span id="cb163-937"><a href="#cb163-937" aria-hidden="true" tabindex="-1"></a>cattle_missing <span class="sc">%&gt;%</span></span>
<span id="cb163-938"><a href="#cb163-938" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb163-939"><a href="#cb163-939" aria-hidden="true" tabindex="-1"></a>    <span class="fu">across</span>(</span>
<span id="cb163-940"><a href="#cb163-940" aria-hidden="true" tabindex="-1"></a>      <span class="fu">where</span>(is.numeric),</span>
<span id="cb163-941"><a href="#cb163-941" aria-hidden="true" tabindex="-1"></a>      <span class="sc">~</span> <span class="fu">replace_na</span>(., <span class="fu">mean</span>(., <span class="at">na.rm =</span> <span class="cn">TRUE</span>))  <span class="co"># Replace with column mean</span></span>
<span id="cb163-942"><a href="#cb163-942" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb163-943"><a href="#cb163-943" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb163-944"><a href="#cb163-944" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb163-945"><a href="#cb163-945" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb163-946"><a href="#cb163-946" aria-hidden="true" tabindex="-1"></a><span class="fu">### Filling Missing Values with `coalesce()`</span></span>
<span id="cb163-947"><a href="#cb163-947" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb163-948"><a href="#cb163-948" aria-hidden="true" tabindex="-1"></a><span class="in">`coalesce()`</span> returns the first non-missing value:</span>
<span id="cb163-949"><a href="#cb163-949" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb163-952"><a href="#cb163-952" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb163-953"><a href="#cb163-953" aria-hidden="true" tabindex="-1"></a><span class="co">#| eval: true</span></span>
<span id="cb163-954"><a href="#cb163-954" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: true</span></span>
<span id="cb163-955"><a href="#cb163-955" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb163-956"><a href="#cb163-956" aria-hidden="true" tabindex="-1"></a><span class="co"># Multiple weight measurements, use first available</span></span>
<span id="cb163-957"><a href="#cb163-957" aria-hidden="true" tabindex="-1"></a>weights <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb163-958"><a href="#cb163-958" aria-hidden="true" tabindex="-1"></a>  <span class="at">animal_id =</span> <span class="fu">c</span>(<span class="st">"A001"</span>, <span class="st">"A002"</span>, <span class="st">"A003"</span>, <span class="st">"A004"</span>),</span>
<span id="cb163-959"><a href="#cb163-959" aria-hidden="true" tabindex="-1"></a>  <span class="at">weight_measurement1 =</span> <span class="fu">c</span>(<span class="dv">600</span>, <span class="cn">NA</span>, <span class="dv">580</span>, <span class="cn">NA</span>),</span>
<span id="cb163-960"><a href="#cb163-960" aria-hidden="true" tabindex="-1"></a>  <span class="at">weight_measurement2 =</span> <span class="fu">c</span>(<span class="dv">605</span>, <span class="dv">450</span>, <span class="cn">NA</span>, <span class="dv">625</span>),</span>
<span id="cb163-961"><a href="#cb163-961" aria-hidden="true" tabindex="-1"></a>  <span class="at">weight_measurement3 =</span> <span class="fu">c</span>(<span class="cn">NA</span>, <span class="dv">455</span>, <span class="dv">585</span>, <span class="dv">630</span>)</span>
<span id="cb163-962"><a href="#cb163-962" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb163-963"><a href="#cb163-963" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb163-964"><a href="#cb163-964" aria-hidden="true" tabindex="-1"></a>weights</span>
<span id="cb163-965"><a href="#cb163-965" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb163-966"><a href="#cb163-966" aria-hidden="true" tabindex="-1"></a><span class="co"># Use first non-missing weight</span></span>
<span id="cb163-967"><a href="#cb163-967" aria-hidden="true" tabindex="-1"></a>weights <span class="sc">%&gt;%</span></span>
<span id="cb163-968"><a href="#cb163-968" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb163-969"><a href="#cb163-969" aria-hidden="true" tabindex="-1"></a>    <span class="at">weight_final =</span> <span class="fu">coalesce</span>(weight_measurement1,</span>
<span id="cb163-970"><a href="#cb163-970" aria-hidden="true" tabindex="-1"></a>                           weight_measurement2,</span>
<span id="cb163-971"><a href="#cb163-971" aria-hidden="true" tabindex="-1"></a>                           weight_measurement3)</span>
<span id="cb163-972"><a href="#cb163-972" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb163-973"><a href="#cb163-973" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb163-974"><a href="#cb163-974" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb163-975"><a href="#cb163-975" aria-hidden="true" tabindex="-1"></a><span class="fu">### Handling NAs in Calculations</span></span>
<span id="cb163-976"><a href="#cb163-976" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb163-977"><a href="#cb163-977" aria-hidden="true" tabindex="-1"></a>Most R functions return <span class="in">`NA`</span> if any input is <span class="in">`NA`</span>:</span>
<span id="cb163-978"><a href="#cb163-978" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb163-981"><a href="#cb163-981" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb163-982"><a href="#cb163-982" aria-hidden="true" tabindex="-1"></a><span class="co">#| eval: true</span></span>
<span id="cb163-983"><a href="#cb163-983" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: true</span></span>
<span id="cb163-984"><a href="#cb163-984" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb163-985"><a href="#cb163-985" aria-hidden="true" tabindex="-1"></a><span class="co"># Mean returns NA if any value is NA</span></span>
<span id="cb163-986"><a href="#cb163-986" aria-hidden="true" tabindex="-1"></a><span class="fu">mean</span>(<span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>, <span class="cn">NA</span>, <span class="dv">4</span>))</span>
<span id="cb163-987"><a href="#cb163-987" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb163-988"><a href="#cb163-988" aria-hidden="true" tabindex="-1"></a><span class="co"># Use na.rm = TRUE to remove NAs before calculating</span></span>
<span id="cb163-989"><a href="#cb163-989" aria-hidden="true" tabindex="-1"></a><span class="fu">mean</span>(<span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>, <span class="cn">NA</span>, <span class="dv">4</span>), <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb163-990"><a href="#cb163-990" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb163-991"><a href="#cb163-991" aria-hidden="true" tabindex="-1"></a><span class="co"># In a summarise</span></span>
<span id="cb163-992"><a href="#cb163-992" aria-hidden="true" tabindex="-1"></a>cattle_missing <span class="sc">%&gt;%</span></span>
<span id="cb163-993"><a href="#cb163-993" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(</span>
<span id="cb163-994"><a href="#cb163-994" aria-hidden="true" tabindex="-1"></a>    <span class="at">mean_weight_with_na =</span> <span class="fu">mean</span>(weight_kg),           <span class="co"># Returns NA</span></span>
<span id="cb163-995"><a href="#cb163-995" aria-hidden="true" tabindex="-1"></a>    <span class="at">mean_weight_removed =</span> <span class="fu">mean</span>(weight_kg, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)  <span class="co"># Calculates mean</span></span>
<span id="cb163-996"><a href="#cb163-996" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb163-997"><a href="#cb163-997" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb163-998"><a href="#cb163-998" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb163-999"><a href="#cb163-999" aria-hidden="true" tabindex="-1"></a>---</span>
<span id="cb163-1000"><a href="#cb163-1000" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb163-1001"><a href="#cb163-1001" aria-hidden="true" tabindex="-1"></a><span class="fu">## Window Functions</span></span>
<span id="cb163-1002"><a href="#cb163-1002" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb163-1003"><a href="#cb163-1003" aria-hidden="true" tabindex="-1"></a>**Window functions** operate on groups of rows and return a value for each row (unlike <span class="in">`summarise()`</span> which returns one value per group).</span>
<span id="cb163-1004"><a href="#cb163-1004" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb163-1005"><a href="#cb163-1005" aria-hidden="true" tabindex="-1"></a><span class="fu">### Ranking Functions</span></span>
<span id="cb163-1006"><a href="#cb163-1006" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb163-1009"><a href="#cb163-1009" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb163-1010"><a href="#cb163-1010" aria-hidden="true" tabindex="-1"></a><span class="co">#| eval: true</span></span>
<span id="cb163-1011"><a href="#cb163-1011" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: true</span></span>
<span id="cb163-1012"><a href="#cb163-1012" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb163-1013"><a href="#cb163-1013" aria-hidden="true" tabindex="-1"></a><span class="co"># Create competition data</span></span>
<span id="cb163-1014"><a href="#cb163-1014" aria-hidden="true" tabindex="-1"></a>competition <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb163-1015"><a href="#cb163-1015" aria-hidden="true" tabindex="-1"></a>  <span class="at">animal_id =</span> <span class="fu">sprintf</span>(<span class="st">"A%03d"</span>, <span class="dv">1</span><span class="sc">:</span><span class="dv">8</span>),</span>
<span id="cb163-1016"><a href="#cb163-1016" aria-hidden="true" tabindex="-1"></a>  <span class="at">breed =</span> <span class="fu">rep</span>(<span class="fu">c</span>(<span class="st">"Holstein"</span>, <span class="st">"Jersey"</span>), <span class="at">each =</span> <span class="dv">4</span>),</span>
<span id="cb163-1017"><a href="#cb163-1017" aria-hidden="true" tabindex="-1"></a>  <span class="at">score =</span> <span class="fu">c</span>(<span class="dv">92</span>, <span class="dv">88</span>, <span class="dv">88</span>, <span class="dv">85</span>, <span class="dv">78</span>, <span class="dv">76</span>, <span class="dv">76</span>, <span class="dv">74</span>)</span>
<span id="cb163-1018"><a href="#cb163-1018" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb163-1019"><a href="#cb163-1019" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb163-1020"><a href="#cb163-1020" aria-hidden="true" tabindex="-1"></a>competition</span>
<span id="cb163-1021"><a href="#cb163-1021" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb163-1022"><a href="#cb163-1022" aria-hidden="true" tabindex="-1"></a><span class="co"># Rank animals by score</span></span>
<span id="cb163-1023"><a href="#cb163-1023" aria-hidden="true" tabindex="-1"></a>competition <span class="sc">%&gt;%</span></span>
<span id="cb163-1024"><a href="#cb163-1024" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb163-1025"><a href="#cb163-1025" aria-hidden="true" tabindex="-1"></a>    <span class="at">rank =</span> <span class="fu">min_rank</span>(<span class="fu">desc</span>(score)),        <span class="co"># Rank (ties get same rank, gaps after)</span></span>
<span id="cb163-1026"><a href="#cb163-1026" aria-hidden="true" tabindex="-1"></a>    <span class="at">dense =</span> <span class="fu">dense_rank</span>(<span class="fu">desc</span>(score)),     <span class="co"># Dense rank (ties, no gaps)</span></span>
<span id="cb163-1027"><a href="#cb163-1027" aria-hidden="true" tabindex="-1"></a>    <span class="at">row_num =</span> <span class="fu">row_number</span>(<span class="fu">desc</span>(score)),   <span class="co"># Row number (no ties, arbitrary order)</span></span>
<span id="cb163-1028"><a href="#cb163-1028" aria-hidden="true" tabindex="-1"></a>    <span class="at">percentile =</span> <span class="fu">percent_rank</span>(<span class="fu">desc</span>(score))  <span class="co"># Percentile (0 to 1)</span></span>
<span id="cb163-1029"><a href="#cb163-1029" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb163-1030"><a href="#cb163-1030" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb163-1031"><a href="#cb163-1031" aria-hidden="true" tabindex="-1"></a><span class="co"># Rank within breed</span></span>
<span id="cb163-1032"><a href="#cb163-1032" aria-hidden="true" tabindex="-1"></a>competition <span class="sc">%&gt;%</span></span>
<span id="cb163-1033"><a href="#cb163-1033" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(breed) <span class="sc">%&gt;%</span></span>
<span id="cb163-1034"><a href="#cb163-1034" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb163-1035"><a href="#cb163-1035" aria-hidden="true" tabindex="-1"></a>    <span class="at">breed_rank =</span> <span class="fu">min_rank</span>(<span class="fu">desc</span>(score))</span>
<span id="cb163-1036"><a href="#cb163-1036" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb163-1037"><a href="#cb163-1037" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span></span>
<span id="cb163-1038"><a href="#cb163-1038" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(breed, breed_rank)</span>
<span id="cb163-1039"><a href="#cb163-1039" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb163-1040"><a href="#cb163-1040" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb163-1041"><a href="#cb163-1041" aria-hidden="true" tabindex="-1"></a><span class="fu">### Offset Functions: `lag()` and `lead()`</span></span>
<span id="cb163-1042"><a href="#cb163-1042" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb163-1043"><a href="#cb163-1043" aria-hidden="true" tabindex="-1"></a><span class="in">`lag()`</span> and <span class="in">`lead()`</span> access previous or next values:</span>
<span id="cb163-1044"><a href="#cb163-1044" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb163-1047"><a href="#cb163-1047" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb163-1048"><a href="#cb163-1048" aria-hidden="true" tabindex="-1"></a><span class="co">#| eval: true</span></span>
<span id="cb163-1049"><a href="#cb163-1049" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: true</span></span>
<span id="cb163-1050"><a href="#cb163-1050" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb163-1051"><a href="#cb163-1051" aria-hidden="true" tabindex="-1"></a><span class="co"># Weight measurements over time</span></span>
<span id="cb163-1052"><a href="#cb163-1052" aria-hidden="true" tabindex="-1"></a>growth <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb163-1053"><a href="#cb163-1053" aria-hidden="true" tabindex="-1"></a>  <span class="at">animal_id =</span> <span class="fu">rep</span>(<span class="st">"A001"</span>, <span class="dv">5</span>),</span>
<span id="cb163-1054"><a href="#cb163-1054" aria-hidden="true" tabindex="-1"></a>  <span class="at">week =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>,</span>
<span id="cb163-1055"><a href="#cb163-1055" aria-hidden="true" tabindex="-1"></a>  <span class="at">weight_kg =</span> <span class="fu">c</span>(<span class="dv">450</span>, <span class="dv">465</span>, <span class="dv">478</span>, <span class="dv">492</span>, <span class="dv">505</span>)</span>
<span id="cb163-1056"><a href="#cb163-1056" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb163-1057"><a href="#cb163-1057" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb163-1058"><a href="#cb163-1058" aria-hidden="true" tabindex="-1"></a>growth</span>
<span id="cb163-1059"><a href="#cb163-1059" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb163-1060"><a href="#cb163-1060" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate weight change from previous week</span></span>
<span id="cb163-1061"><a href="#cb163-1061" aria-hidden="true" tabindex="-1"></a>growth <span class="sc">%&gt;%</span></span>
<span id="cb163-1062"><a href="#cb163-1062" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb163-1063"><a href="#cb163-1063" aria-hidden="true" tabindex="-1"></a>    <span class="at">previous_weight =</span> <span class="fu">lag</span>(weight_kg),           <span class="co"># Previous row</span></span>
<span id="cb163-1064"><a href="#cb163-1064" aria-hidden="true" tabindex="-1"></a>    <span class="at">weight_gain =</span> weight_kg <span class="sc">-</span> <span class="fu">lag</span>(weight_kg),  <span class="co"># Change from previous</span></span>
<span id="cb163-1065"><a href="#cb163-1065" aria-hidden="true" tabindex="-1"></a>    <span class="at">next_weight =</span> <span class="fu">lead</span>(weight_kg)              <span class="co"># Next row</span></span>
<span id="cb163-1066"><a href="#cb163-1066" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb163-1067"><a href="#cb163-1067" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb163-1068"><a href="#cb163-1068" aria-hidden="true" tabindex="-1"></a><span class="co"># Lag by multiple rows</span></span>
<span id="cb163-1069"><a href="#cb163-1069" aria-hidden="true" tabindex="-1"></a>growth <span class="sc">%&gt;%</span></span>
<span id="cb163-1070"><a href="#cb163-1070" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb163-1071"><a href="#cb163-1071" aria-hidden="true" tabindex="-1"></a>    <span class="at">two_weeks_ago =</span> <span class="fu">lag</span>(weight_kg, <span class="at">n =</span> <span class="dv">2</span>)</span>
<span id="cb163-1072"><a href="#cb163-1072" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb163-1073"><a href="#cb163-1073" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb163-1074"><a href="#cb163-1074" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb163-1075"><a href="#cb163-1075" aria-hidden="true" tabindex="-1"></a><span class="fu">### Cumulative Functions</span></span>
<span id="cb163-1076"><a href="#cb163-1076" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb163-1079"><a href="#cb163-1079" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb163-1080"><a href="#cb163-1080" aria-hidden="true" tabindex="-1"></a><span class="co">#| eval: true</span></span>
<span id="cb163-1081"><a href="#cb163-1081" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: true</span></span>
<span id="cb163-1082"><a href="#cb163-1082" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb163-1083"><a href="#cb163-1083" aria-hidden="true" tabindex="-1"></a><span class="co"># Running totals</span></span>
<span id="cb163-1084"><a href="#cb163-1084" aria-hidden="true" tabindex="-1"></a>milk_production <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb163-1085"><a href="#cb163-1085" aria-hidden="true" tabindex="-1"></a>  <span class="at">day =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">7</span>,</span>
<span id="cb163-1086"><a href="#cb163-1086" aria-hidden="true" tabindex="-1"></a>  <span class="at">milk_liters =</span> <span class="fu">c</span>(<span class="dv">25</span>, <span class="dv">28</span>, <span class="dv">26</span>, <span class="dv">29</span>, <span class="dv">27</span>, <span class="dv">30</span>, <span class="dv">28</span>)</span>
<span id="cb163-1087"><a href="#cb163-1087" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb163-1088"><a href="#cb163-1088" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb163-1089"><a href="#cb163-1089" aria-hidden="true" tabindex="-1"></a>milk_production</span>
<span id="cb163-1090"><a href="#cb163-1090" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb163-1091"><a href="#cb163-1091" aria-hidden="true" tabindex="-1"></a><span class="co"># Cumulative statistics</span></span>
<span id="cb163-1092"><a href="#cb163-1092" aria-hidden="true" tabindex="-1"></a>milk_production <span class="sc">%&gt;%</span></span>
<span id="cb163-1093"><a href="#cb163-1093" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb163-1094"><a href="#cb163-1094" aria-hidden="true" tabindex="-1"></a>    <span class="at">cumulative_milk =</span> <span class="fu">cumsum</span>(milk_liters),      <span class="co"># Running total</span></span>
<span id="cb163-1095"><a href="#cb163-1095" aria-hidden="true" tabindex="-1"></a>    <span class="at">running_mean =</span> <span class="fu">cummean</span>(milk_liters),        <span class="co"># Running mean</span></span>
<span id="cb163-1096"><a href="#cb163-1096" aria-hidden="true" tabindex="-1"></a>    <span class="at">running_min =</span> <span class="fu">cummin</span>(milk_liters),          <span class="co"># Running minimum</span></span>
<span id="cb163-1097"><a href="#cb163-1097" aria-hidden="true" tabindex="-1"></a>    <span class="at">running_max =</span> <span class="fu">cummax</span>(milk_liters)           <span class="co"># Running maximum</span></span>
<span id="cb163-1098"><a href="#cb163-1098" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb163-1099"><a href="#cb163-1099" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb163-1100"><a href="#cb163-1100" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb163-1101"><a href="#cb163-1101" aria-hidden="true" tabindex="-1"></a><span class="fu">### Real-World Example: Growth Rates</span></span>
<span id="cb163-1102"><a href="#cb163-1102" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb163-1105"><a href="#cb163-1105" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb163-1106"><a href="#cb163-1106" aria-hidden="true" tabindex="-1"></a><span class="co">#| eval: true</span></span>
<span id="cb163-1107"><a href="#cb163-1107" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: true</span></span>
<span id="cb163-1108"><a href="#cb163-1108" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb163-1109"><a href="#cb163-1109" aria-hidden="true" tabindex="-1"></a><span class="co"># Multiple animals, multiple measurements</span></span>
<span id="cb163-1110"><a href="#cb163-1110" aria-hidden="true" tabindex="-1"></a>growth_data <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb163-1111"><a href="#cb163-1111" aria-hidden="true" tabindex="-1"></a>  <span class="at">animal_id =</span> <span class="fu">rep</span>(<span class="fu">c</span>(<span class="st">"A001"</span>, <span class="st">"A002"</span>, <span class="st">"A003"</span>), <span class="at">each =</span> <span class="dv">4</span>),</span>
<span id="cb163-1112"><a href="#cb163-1112" aria-hidden="true" tabindex="-1"></a>  <span class="at">week =</span> <span class="fu">rep</span>(<span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">4</span>, <span class="dv">8</span>, <span class="dv">12</span>), <span class="dv">3</span>),</span>
<span id="cb163-1113"><a href="#cb163-1113" aria-hidden="true" tabindex="-1"></a>  <span class="at">weight_kg =</span> <span class="fu">c</span>(</span>
<span id="cb163-1114"><a href="#cb163-1114" aria-hidden="true" tabindex="-1"></a>    <span class="co"># A001</span></span>
<span id="cb163-1115"><a href="#cb163-1115" aria-hidden="true" tabindex="-1"></a>    <span class="dv">450</span>, <span class="dv">485</span>, <span class="dv">518</span>, <span class="dv">548</span>,</span>
<span id="cb163-1116"><a href="#cb163-1116" aria-hidden="true" tabindex="-1"></a>    <span class="co"># A002</span></span>
<span id="cb163-1117"><a href="#cb163-1117" aria-hidden="true" tabindex="-1"></a>    <span class="dv">445</span>, <span class="dv">475</span>, <span class="dv">502</span>, <span class="dv">530</span>,</span>
<span id="cb163-1118"><a href="#cb163-1118" aria-hidden="true" tabindex="-1"></a>    <span class="co"># A003</span></span>
<span id="cb163-1119"><a href="#cb163-1119" aria-hidden="true" tabindex="-1"></a>    <span class="dv">455</span>, <span class="dv">492</span>, <span class="dv">525</span>, <span class="dv">556</span></span>
<span id="cb163-1120"><a href="#cb163-1120" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb163-1121"><a href="#cb163-1121" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb163-1122"><a href="#cb163-1122" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb163-1123"><a href="#cb163-1123" aria-hidden="true" tabindex="-1"></a>growth_data</span>
<span id="cb163-1124"><a href="#cb163-1124" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb163-1125"><a href="#cb163-1125" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate growth metrics for each animal</span></span>
<span id="cb163-1126"><a href="#cb163-1126" aria-hidden="true" tabindex="-1"></a>growth_summary <span class="ot">&lt;-</span> growth_data <span class="sc">%&gt;%</span></span>
<span id="cb163-1127"><a href="#cb163-1127" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(animal_id) <span class="sc">%&gt;%</span></span>
<span id="cb163-1128"><a href="#cb163-1128" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb163-1129"><a href="#cb163-1129" aria-hidden="true" tabindex="-1"></a>    <span class="at">previous_weight =</span> <span class="fu">lag</span>(weight_kg),</span>
<span id="cb163-1130"><a href="#cb163-1130" aria-hidden="true" tabindex="-1"></a>    <span class="at">weight_gain =</span> weight_kg <span class="sc">-</span> <span class="fu">lag</span>(weight_kg),</span>
<span id="cb163-1131"><a href="#cb163-1131" aria-hidden="true" tabindex="-1"></a>    <span class="at">weeks_elapsed =</span> week <span class="sc">-</span> <span class="fu">lag</span>(week),</span>
<span id="cb163-1132"><a href="#cb163-1132" aria-hidden="true" tabindex="-1"></a>    <span class="at">daily_gain =</span> weight_gain <span class="sc">/</span> (weeks_elapsed <span class="sc">*</span> <span class="dv">7</span>),</span>
<span id="cb163-1133"><a href="#cb163-1133" aria-hidden="true" tabindex="-1"></a>    <span class="at">total_gain =</span> weight_kg <span class="sc">-</span> <span class="fu">first</span>(weight_kg),</span>
<span id="cb163-1134"><a href="#cb163-1134" aria-hidden="true" tabindex="-1"></a>    <span class="at">cumulative_gain =</span> <span class="fu">cumsum</span>(<span class="fu">replace_na</span>(weight_gain, <span class="dv">0</span>))</span>
<span id="cb163-1135"><a href="#cb163-1135" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb163-1136"><a href="#cb163-1136" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>()</span>
<span id="cb163-1137"><a href="#cb163-1137" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb163-1138"><a href="#cb163-1138" aria-hidden="true" tabindex="-1"></a>growth_summary</span>
<span id="cb163-1139"><a href="#cb163-1139" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb163-1140"><a href="#cb163-1140" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb163-1141"><a href="#cb163-1141" aria-hidden="true" tabindex="-1"></a>---</span>
<span id="cb163-1142"><a href="#cb163-1142" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb163-1143"><a href="#cb163-1143" aria-hidden="true" tabindex="-1"></a><span class="fu">## Putting It All Together: Complex Pipelines</span></span>
<span id="cb163-1144"><a href="#cb163-1144" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb163-1145"><a href="#cb163-1145" aria-hidden="true" tabindex="-1"></a>Real data analysis often requires chaining many operations. Here's a comprehensive example:</span>
<span id="cb163-1146"><a href="#cb163-1146" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb163-1149"><a href="#cb163-1149" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb163-1150"><a href="#cb163-1150" aria-hidden="true" tabindex="-1"></a><span class="co">#| eval: true</span></span>
<span id="cb163-1151"><a href="#cb163-1151" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: true</span></span>
<span id="cb163-1152"><a href="#cb163-1152" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb163-1153"><a href="#cb163-1153" aria-hidden="true" tabindex="-1"></a><span class="co"># Create realistic farm data</span></span>
<span id="cb163-1154"><a href="#cb163-1154" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">123</span>)</span>
<span id="cb163-1155"><a href="#cb163-1155" aria-hidden="true" tabindex="-1"></a>farm_complete <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb163-1156"><a href="#cb163-1156" aria-hidden="true" tabindex="-1"></a>  <span class="at">animal_id =</span> <span class="fu">sprintf</span>(<span class="st">"F%04d"</span>, <span class="dv">1</span><span class="sc">:</span><span class="dv">100</span>),</span>
<span id="cb163-1157"><a href="#cb163-1157" aria-hidden="true" tabindex="-1"></a>  <span class="at">farm =</span> <span class="fu">sample</span>(<span class="fu">c</span>(<span class="st">"North"</span>, <span class="st">"South"</span>, <span class="st">"East"</span>, <span class="st">"West"</span>), <span class="dv">100</span>, <span class="at">replace =</span> <span class="cn">TRUE</span>),</span>
<span id="cb163-1158"><a href="#cb163-1158" aria-hidden="true" tabindex="-1"></a>  <span class="at">breed =</span> <span class="fu">sample</span>(<span class="fu">c</span>(<span class="st">"Holstein"</span>, <span class="st">"Jersey"</span>, <span class="st">"Angus"</span>, <span class="st">"Hereford"</span>), <span class="dv">100</span>,</span>
<span id="cb163-1159"><a href="#cb163-1159" aria-hidden="true" tabindex="-1"></a>                 <span class="at">replace =</span> <span class="cn">TRUE</span>, <span class="at">prob =</span> <span class="fu">c</span>(<span class="fl">0.4</span>, <span class="fl">0.3</span>, <span class="fl">0.2</span>, <span class="fl">0.1</span>)),</span>
<span id="cb163-1160"><a href="#cb163-1160" aria-hidden="true" tabindex="-1"></a>  <span class="at">sex =</span> <span class="fu">sample</span>(<span class="fu">c</span>(<span class="st">"M"</span>, <span class="st">"F"</span>), <span class="dv">100</span>, <span class="at">replace =</span> <span class="cn">TRUE</span>),</span>
<span id="cb163-1161"><a href="#cb163-1161" aria-hidden="true" tabindex="-1"></a>  <span class="at">birth_date =</span> <span class="fu">as.Date</span>(<span class="st">"2022-01-01"</span>) <span class="sc">+</span> <span class="fu">sample</span>(<span class="dv">0</span><span class="sc">:</span><span class="dv">365</span>, <span class="dv">100</span>, <span class="at">replace =</span> <span class="cn">TRUE</span>),</span>
<span id="cb163-1162"><a href="#cb163-1162" aria-hidden="true" tabindex="-1"></a>  <span class="at">weight_kg =</span> <span class="fu">rnorm</span>(<span class="dv">100</span>, <span class="at">mean =</span> <span class="dv">500</span>, <span class="at">sd =</span> <span class="dv">80</span>),</span>
<span id="cb163-1163"><a href="#cb163-1163" aria-hidden="true" tabindex="-1"></a>  <span class="at">health_status =</span> <span class="fu">sample</span>(<span class="fu">c</span>(<span class="st">"Good"</span>, <span class="st">"Fair"</span>, <span class="st">"Poor"</span>, <span class="cn">NA</span>), <span class="dv">100</span>,</span>
<span id="cb163-1164"><a href="#cb163-1164" aria-hidden="true" tabindex="-1"></a>                        <span class="at">replace =</span> <span class="cn">TRUE</span>, <span class="at">prob =</span> <span class="fu">c</span>(<span class="fl">0.7</span>, <span class="fl">0.2</span>, <span class="fl">0.05</span>, <span class="fl">0.05</span>))</span>
<span id="cb163-1165"><a href="#cb163-1165" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb163-1166"><a href="#cb163-1166" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb163-1167"><a href="#cb163-1167" aria-hidden="true" tabindex="-1"></a><span class="co"># Preview</span></span>
<span id="cb163-1168"><a href="#cb163-1168" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(farm_complete, <span class="dv">3</span>)</span>
<span id="cb163-1169"><a href="#cb163-1169" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb163-1170"><a href="#cb163-1170" aria-hidden="true" tabindex="-1"></a><span class="co"># Complex analysis pipeline</span></span>
<span id="cb163-1171"><a href="#cb163-1171" aria-hidden="true" tabindex="-1"></a>analysis_result <span class="ot">&lt;-</span> farm_complete <span class="sc">%&gt;%</span></span>
<span id="cb163-1172"><a href="#cb163-1172" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Data cleaning</span></span>
<span id="cb163-1173"><a href="#cb163-1173" aria-hidden="true" tabindex="-1"></a>  <span class="fu">drop_na</span>(health_status) <span class="sc">%&gt;%</span>                    <span class="co"># Remove missing health status</span></span>
<span id="cb163-1174"><a href="#cb163-1174" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(health_status <span class="sc">!=</span> <span class="st">"Poor"</span>) <span class="sc">%&gt;%</span>           <span class="co"># Exclude poor health</span></span>
<span id="cb163-1175"><a href="#cb163-1175" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb163-1176"><a href="#cb163-1176" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Calculate age</span></span>
<span id="cb163-1177"><a href="#cb163-1177" aria-hidden="true" tabindex="-1"></a>    <span class="at">age_days =</span> <span class="fu">as.numeric</span>(<span class="fu">Sys.Date</span>() <span class="sc">-</span> birth_date),</span>
<span id="cb163-1178"><a href="#cb163-1178" aria-hidden="true" tabindex="-1"></a>    <span class="at">age_months =</span> age_days <span class="sc">/</span> <span class="fl">30.44</span>,</span>
<span id="cb163-1179"><a href="#cb163-1179" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Standardize breed names</span></span>
<span id="cb163-1180"><a href="#cb163-1180" aria-hidden="true" tabindex="-1"></a>    <span class="at">breed =</span> <span class="fu">str_to_title</span>(breed),</span>
<span id="cb163-1181"><a href="#cb163-1181" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Weight categories</span></span>
<span id="cb163-1182"><a href="#cb163-1182" aria-hidden="true" tabindex="-1"></a>    <span class="at">weight_class =</span> <span class="fu">case_when</span>(</span>
<span id="cb163-1183"><a href="#cb163-1183" aria-hidden="true" tabindex="-1"></a>      weight_kg <span class="sc">&lt;</span> <span class="dv">450</span> <span class="sc">~</span> <span class="st">"Light"</span>,</span>
<span id="cb163-1184"><a href="#cb163-1184" aria-hidden="true" tabindex="-1"></a>      weight_kg <span class="sc">&lt;</span> <span class="dv">550</span> <span class="sc">~</span> <span class="st">"Medium"</span>,</span>
<span id="cb163-1185"><a href="#cb163-1185" aria-hidden="true" tabindex="-1"></a>      <span class="cn">TRUE</span> <span class="sc">~</span> <span class="st">"Heavy"</span></span>
<span id="cb163-1186"><a href="#cb163-1186" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb163-1187"><a href="#cb163-1187" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Round weight</span></span>
<span id="cb163-1188"><a href="#cb163-1188" aria-hidden="true" tabindex="-1"></a>    <span class="at">weight_kg =</span> <span class="fu">round</span>(weight_kg, <span class="dv">1</span>)</span>
<span id="cb163-1189"><a href="#cb163-1189" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb163-1190"><a href="#cb163-1190" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Filter to mature animals only</span></span>
<span id="cb163-1191"><a href="#cb163-1191" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(age_months <span class="sc">&gt;=</span> <span class="dv">10</span>) <span class="sc">%&gt;%</span></span>
<span id="cb163-1192"><a href="#cb163-1192" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Group analysis</span></span>
<span id="cb163-1193"><a href="#cb163-1193" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(farm, breed) <span class="sc">%&gt;%</span></span>
<span id="cb163-1194"><a href="#cb163-1194" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(</span>
<span id="cb163-1195"><a href="#cb163-1195" aria-hidden="true" tabindex="-1"></a>    <span class="at">n =</span> <span class="fu">n</span>(),</span>
<span id="cb163-1196"><a href="#cb163-1196" aria-hidden="true" tabindex="-1"></a>    <span class="at">mean_weight =</span> <span class="fu">round</span>(<span class="fu">mean</span>(weight_kg), <span class="dv">1</span>),</span>
<span id="cb163-1197"><a href="#cb163-1197" aria-hidden="true" tabindex="-1"></a>    <span class="at">sd_weight =</span> <span class="fu">round</span>(<span class="fu">sd</span>(weight_kg), <span class="dv">1</span>),</span>
<span id="cb163-1198"><a href="#cb163-1198" aria-hidden="true" tabindex="-1"></a>    <span class="at">min_weight =</span> <span class="fu">min</span>(weight_kg),</span>
<span id="cb163-1199"><a href="#cb163-1199" aria-hidden="true" tabindex="-1"></a>    <span class="at">max_weight =</span> <span class="fu">max</span>(weight_kg),</span>
<span id="cb163-1200"><a href="#cb163-1200" aria-hidden="true" tabindex="-1"></a>    <span class="at">prop_heavy =</span> <span class="fu">mean</span>(weight_class <span class="sc">==</span> <span class="st">"Heavy"</span>),</span>
<span id="cb163-1201"><a href="#cb163-1201" aria-hidden="true" tabindex="-1"></a>    <span class="at">.groups =</span> <span class="st">"drop"</span></span>
<span id="cb163-1202"><a href="#cb163-1202" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb163-1203"><a href="#cb163-1203" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Filter to groups with at least 3 animals</span></span>
<span id="cb163-1204"><a href="#cb163-1204" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(n <span class="sc">&gt;=</span> <span class="dv">3</span>) <span class="sc">%&gt;%</span></span>
<span id="cb163-1205"><a href="#cb163-1205" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Sort by mean weight</span></span>
<span id="cb163-1206"><a href="#cb163-1206" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(mean_weight)) <span class="sc">%&gt;%</span></span>
<span id="cb163-1207"><a href="#cb163-1207" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Add ranking</span></span>
<span id="cb163-1208"><a href="#cb163-1208" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">rank =</span> <span class="fu">row_number</span>())</span>
<span id="cb163-1209"><a href="#cb163-1209" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb163-1210"><a href="#cb163-1210" aria-hidden="true" tabindex="-1"></a>analysis_result</span>
<span id="cb163-1211"><a href="#cb163-1211" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb163-1212"><a href="#cb163-1212" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb163-1213"><a href="#cb163-1213" aria-hidden="true" tabindex="-1"></a>::: {.callout-tip}</span>
<span id="cb163-1214"><a href="#cb163-1214" aria-hidden="true" tabindex="-1"></a><span class="fu">## Complex Pipeline Best Practices</span></span>
<span id="cb163-1215"><a href="#cb163-1215" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb163-1216"><a href="#cb163-1216" aria-hidden="true" tabindex="-1"></a><span class="ss">1. </span>**Comment your steps**: Explain what each section does</span>
<span id="cb163-1217"><a href="#cb163-1217" aria-hidden="true" tabindex="-1"></a><span class="ss">2. </span>**One operation per line**: Easier to read and debug</span>
<span id="cb163-1218"><a href="#cb163-1218" aria-hidden="true" tabindex="-1"></a><span class="ss">3. </span>**Use intermediate results**: Break very long pipes into steps</span>
<span id="cb163-1219"><a href="#cb163-1219" aria-hidden="true" tabindex="-1"></a><span class="ss">4. </span>**Check intermediate output**: Run the pipe up to a certain point to verify</span>
<span id="cb163-1220"><a href="#cb163-1220" aria-hidden="true" tabindex="-1"></a><span class="ss">5. </span>**Consistent indentation**: 2 spaces after pipe</span>
<span id="cb163-1221"><a href="#cb163-1221" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb163-1224"><a href="#cb163-1224" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb163-1225"><a href="#cb163-1225" aria-hidden="true" tabindex="-1"></a><span class="co">#| eval: false</span></span>
<span id="cb163-1226"><a href="#cb163-1226" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: true</span></span>
<span id="cb163-1227"><a href="#cb163-1227" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb163-1228"><a href="#cb163-1228" aria-hidden="true" tabindex="-1"></a><span class="co"># Good structure</span></span>
<span id="cb163-1229"><a href="#cb163-1229" aria-hidden="true" tabindex="-1"></a>result <span class="ot">&lt;-</span> data <span class="sc">%&gt;%</span></span>
<span id="cb163-1230"><a href="#cb163-1230" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Step 1: Clean data</span></span>
<span id="cb163-1231"><a href="#cb163-1231" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(important_var)) <span class="sc">%&gt;%</span></span>
<span id="cb163-1232"><a href="#cb163-1232" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">clean_var =</span> <span class="fu">str_trim</span>(var)) <span class="sc">%&gt;%</span></span>
<span id="cb163-1233"><a href="#cb163-1233" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Step 2: Calculate new variables</span></span>
<span id="cb163-1234"><a href="#cb163-1234" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb163-1235"><a href="#cb163-1235" aria-hidden="true" tabindex="-1"></a>    <span class="at">var1 =</span> calculation1,</span>
<span id="cb163-1236"><a href="#cb163-1236" aria-hidden="true" tabindex="-1"></a>    <span class="at">var2 =</span> calculation2</span>
<span id="cb163-1237"><a href="#cb163-1237" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb163-1238"><a href="#cb163-1238" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Step 3: Summarize by group</span></span>
<span id="cb163-1239"><a href="#cb163-1239" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(category) <span class="sc">%&gt;%</span></span>
<span id="cb163-1240"><a href="#cb163-1240" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(</span>
<span id="cb163-1241"><a href="#cb163-1241" aria-hidden="true" tabindex="-1"></a>    <span class="at">mean_value =</span> <span class="fu">mean</span>(value),</span>
<span id="cb163-1242"><a href="#cb163-1242" aria-hidden="true" tabindex="-1"></a>    <span class="at">.groups =</span> <span class="st">"drop"</span></span>
<span id="cb163-1243"><a href="#cb163-1243" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb163-1244"><a href="#cb163-1244" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb163-1245"><a href="#cb163-1245" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb163-1246"><a href="#cb163-1246" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb163-1247"><a href="#cb163-1247" aria-hidden="true" tabindex="-1"></a>---</span>
<span id="cb163-1248"><a href="#cb163-1248" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb163-1249"><a href="#cb163-1249" aria-hidden="true" tabindex="-1"></a><span class="fu">## Summary</span></span>
<span id="cb163-1250"><a href="#cb163-1250" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb163-1251"><a href="#cb163-1251" aria-hidden="true" tabindex="-1"></a>This chapter covered powerful dplyr verbs for data manipulation:</span>
<span id="cb163-1252"><a href="#cb163-1252" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb163-1253"><a href="#cb163-1253" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**`mutate()`** creates and modifies columns, works with functions and calculations</span>
<span id="cb163-1254"><a href="#cb163-1254" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**`if_else()`** applies simple conditional logic (if/then/else)</span>
<span id="cb163-1255"><a href="#cb163-1255" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**`case_when()`** handles multiple conditions elegantly (replaces nested if_else)</span>
<span id="cb163-1256"><a href="#cb163-1256" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**`arrange()`** sorts data by one or more columns in ascending or descending order</span>
<span id="cb163-1257"><a href="#cb163-1257" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**`summarise()`** calculates summary statistics (mean, sd, min, max, count, etc.)</span>
<span id="cb163-1258"><a href="#cb163-1258" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**`group_by()`** + <span class="in">`summarise()`</span> performs grouped operations (summaries by category)</span>
<span id="cb163-1259"><a href="#cb163-1259" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**`count()`** quickly counts observations per group</span>
<span id="cb163-1260"><a href="#cb163-1260" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**`rename()`** changes column names; <span class="in">`relocate()`</span> reorders columns</span>
<span id="cb163-1261"><a href="#cb163-1261" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**`across()`** applies functions to multiple columns efficiently</span>
<span id="cb163-1262"><a href="#cb163-1262" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Missing data** can be detected (<span class="in">`is.na()`</span>), removed (<span class="in">`drop_na()`</span>), or replaced (<span class="in">`replace_na()`</span>, <span class="in">`coalesce()`</span>)</span>
<span id="cb163-1263"><a href="#cb163-1263" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Window functions** (<span class="in">`lag()`</span>, <span class="in">`lead()`</span>, <span class="in">`cumsum()`</span>, ranking) operate within groups</span>
<span id="cb163-1264"><a href="#cb163-1264" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Complex pipelines** chain many operations together for complete data transformations</span>
<span id="cb163-1265"><a href="#cb163-1265" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb163-1266"><a href="#cb163-1266" aria-hidden="true" tabindex="-1"></a>**Key Principle**: Start simple, build complexity gradually, and always check your work!</span>
<span id="cb163-1267"><a href="#cb163-1267" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb163-1268"><a href="#cb163-1268" aria-hidden="true" tabindex="-1"></a>**Next chapter**: Data visualization with ggplot2!</span>
<span id="cb163-1269"><a href="#cb163-1269" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb163-1270"><a href="#cb163-1270" aria-hidden="true" tabindex="-1"></a>---</span>
<span id="cb163-1271"><a href="#cb163-1271" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb163-1272"><a href="#cb163-1272" aria-hidden="true" tabindex="-1"></a><span class="fu">## Homework Assignment</span></span>
<span id="cb163-1273"><a href="#cb163-1273" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb163-1274"><a href="#cb163-1274" aria-hidden="true" tabindex="-1"></a><span class="fu">### Assignment: Data Transformation and Analysis</span></span>
<span id="cb163-1275"><a href="#cb163-1275" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb163-1276"><a href="#cb163-1276" aria-hidden="true" tabindex="-1"></a>**Due**: Before Week 5</span>
<span id="cb163-1277"><a href="#cb163-1277" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb163-1278"><a href="#cb163-1278" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Part 1: Creating Variables (25 points)</span></span>
<span id="cb163-1279"><a href="#cb163-1279" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb163-1280"><a href="#cb163-1280" aria-hidden="true" tabindex="-1"></a>You will receive a dataset called <span class="in">`pig_growth.csv`</span> with the following columns:</span>
<span id="cb163-1281"><a href="#cb163-1281" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span><span class="in">`pig_id`</span>: Pig identifier</span>
<span id="cb163-1282"><a href="#cb163-1282" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span><span class="in">`birth_date`</span>: Date of birth (YYYY-MM-DD)</span>
<span id="cb163-1283"><a href="#cb163-1283" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span><span class="in">`breed`</span>: Pig breed</span>
<span id="cb163-1284"><a href="#cb163-1284" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span><span class="in">`sex`</span>: M or F</span>
<span id="cb163-1285"><a href="#cb163-1285" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span><span class="in">`weight_day0`</span>: Birth weight (kg)</span>
<span id="cb163-1286"><a href="#cb163-1286" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span><span class="in">`weight_day28`</span>: Weight at 28 days (kg)</span>
<span id="cb163-1287"><a href="#cb163-1287" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span><span class="in">`weight_day56`</span>: Weight at 56 days (kg)</span>
<span id="cb163-1288"><a href="#cb163-1288" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span><span class="in">`feed_type`</span>: Type of feed given</span>
<span id="cb163-1289"><a href="#cb163-1289" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb163-1290"><a href="#cb163-1290" aria-hidden="true" tabindex="-1"></a>Tasks:</span>
<span id="cb163-1291"><a href="#cb163-1291" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb163-1292"><a href="#cb163-1292" aria-hidden="true" tabindex="-1"></a><span class="ss">1. </span>**Read the data** and examine its structure</span>
<span id="cb163-1293"><a href="#cb163-1293" aria-hidden="true" tabindex="-1"></a><span class="ss">2. </span>**Create new variables** using <span class="in">`mutate()`</span>:</span>
<span id="cb163-1294"><a href="#cb163-1294" aria-hidden="true" tabindex="-1"></a><span class="ss">   - </span><span class="in">`age_days`</span>: Calculate age in days from birth_date to today</span>
<span id="cb163-1295"><a href="#cb163-1295" aria-hidden="true" tabindex="-1"></a><span class="ss">   - </span><span class="in">`gain_0_28`</span>: Weight gain from day 0 to day 28</span>
<span id="cb163-1296"><a href="#cb163-1296" aria-hidden="true" tabindex="-1"></a><span class="ss">   - </span><span class="in">`gain_28_56`</span>: Weight gain from day 28 to day 56</span>
<span id="cb163-1297"><a href="#cb163-1297" aria-hidden="true" tabindex="-1"></a><span class="ss">   - </span><span class="in">`adg_0_28`</span>: Average daily gain for first period (gain / 28)</span>
<span id="cb163-1298"><a href="#cb163-1298" aria-hidden="true" tabindex="-1"></a><span class="ss">   - </span><span class="in">`adg_28_56`</span>: Average daily gain for second period (gain / 28)</span>
<span id="cb163-1299"><a href="#cb163-1299" aria-hidden="true" tabindex="-1"></a><span class="ss">3. </span>**Create categorical variables**:</span>
<span id="cb163-1300"><a href="#cb163-1300" aria-hidden="true" tabindex="-1"></a><span class="ss">   - </span><span class="in">`birth_weight_class`</span>: "Low" (&lt;1.2 kg), "Normal" (1.2-1.6 kg), "High" (&gt;1.6 kg)</span>
<span id="cb163-1301"><a href="#cb163-1301" aria-hidden="true" tabindex="-1"></a><span class="ss">   - </span><span class="in">`sex_label`</span>: Convert "M" to "Male", "F" to "Female"</span>
<span id="cb163-1302"><a href="#cb163-1302" aria-hidden="true" tabindex="-1"></a><span class="ss">4. </span>**Round** all weight and gain variables to 2 decimal places</span>
<span id="cb163-1303"><a href="#cb163-1303" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb163-1304"><a href="#cb163-1304" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Part 2: Conditional Logic (25 points)</span></span>
<span id="cb163-1305"><a href="#cb163-1305" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb163-1306"><a href="#cb163-1306" aria-hidden="true" tabindex="-1"></a>Using your data with new variables:</span>
<span id="cb163-1307"><a href="#cb163-1307" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb163-1308"><a href="#cb163-1308" aria-hidden="true" tabindex="-1"></a><span class="ss">1. </span>**Create a performance category** using <span class="in">`case_when()`</span>:</span>
<span id="cb163-1309"><a href="#cb163-1309" aria-hidden="true" tabindex="-1"></a><span class="ss">   - </span>"Excellent": adg_28_56 &gt; 0.50 kg/day AND weight_day56 &gt; 18 kg</span>
<span id="cb163-1310"><a href="#cb163-1310" aria-hidden="true" tabindex="-1"></a><span class="ss">   - </span>"Good": adg_28_56 &gt; 0.45 kg/day</span>
<span id="cb163-1311"><a href="#cb163-1311" aria-hidden="true" tabindex="-1"></a><span class="ss">   - </span>"Fair": adg_28_56 &gt; 0.40 kg/day</span>
<span id="cb163-1312"><a href="#cb163-1312" aria-hidden="true" tabindex="-1"></a><span class="ss">   - </span>"Poor": everything else</span>
<span id="cb163-1313"><a href="#cb163-1313" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb163-1314"><a href="#cb163-1314" aria-hidden="true" tabindex="-1"></a><span class="ss">2. </span>**Create a treatment recommendation** using conditional logic:</span>
<span id="cb163-1315"><a href="#cb163-1315" aria-hidden="true" tabindex="-1"></a><span class="ss">   - </span>If performance is "Poor" AND sex is "M": "Supplement + Monitor"</span>
<span id="cb163-1316"><a href="#cb163-1316" aria-hidden="true" tabindex="-1"></a><span class="ss">   - </span>If performance is "Poor" AND sex is "F": "Supplement"</span>
<span id="cb163-1317"><a href="#cb163-1317" aria-hidden="true" tabindex="-1"></a><span class="ss">   - </span>If performance is "Fair": "Monitor"</span>
<span id="cb163-1318"><a href="#cb163-1318" aria-hidden="true" tabindex="-1"></a><span class="ss">   - </span>Otherwise: "Continue"</span>
<span id="cb163-1319"><a href="#cb163-1319" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb163-1320"><a href="#cb163-1320" aria-hidden="true" tabindex="-1"></a><span class="ss">3. </span>**Identify concerning cases**:</span>
<span id="cb163-1321"><a href="#cb163-1321" aria-hidden="true" tabindex="-1"></a><span class="ss">   - </span>Create a logical variable <span class="in">`needs_attention`</span> that is TRUE if:</span>
<span id="cb163-1322"><a href="#cb163-1322" aria-hidden="true" tabindex="-1"></a><span class="ss">     - </span>Weight gain in second period is LESS than first period, OR</span>
<span id="cb163-1323"><a href="#cb163-1323" aria-hidden="true" tabindex="-1"></a><span class="ss">     - </span>Current weight is below 12 kg</span>
<span id="cb163-1324"><a href="#cb163-1324" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb163-1325"><a href="#cb163-1325" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Part 3: Grouped Summaries (30 points)</span></span>
<span id="cb163-1326"><a href="#cb163-1326" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb163-1327"><a href="#cb163-1327" aria-hidden="true" tabindex="-1"></a>Calculate comprehensive summary statistics:</span>
<span id="cb163-1328"><a href="#cb163-1328" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb163-1329"><a href="#cb163-1329" aria-hidden="true" tabindex="-1"></a><span class="ss">1. </span>**Overall summaries** (no grouping):</span>
<span id="cb163-1330"><a href="#cb163-1330" aria-hidden="true" tabindex="-1"></a><span class="ss">   - </span>Number of pigs</span>
<span id="cb163-1331"><a href="#cb163-1331" aria-hidden="true" tabindex="-1"></a><span class="ss">   - </span>Mean birth weight, day 28 weight, day 56 weight</span>
<span id="cb163-1332"><a href="#cb163-1332" aria-hidden="true" tabindex="-1"></a><span class="ss">   - </span>Mean ADG for both periods</span>
<span id="cb163-1333"><a href="#cb163-1333" aria-hidden="true" tabindex="-1"></a><span class="ss">   - </span>Number and proportion needing attention</span>
<span id="cb163-1334"><a href="#cb163-1334" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb163-1335"><a href="#cb163-1335" aria-hidden="true" tabindex="-1"></a><span class="ss">2. </span>**Summaries by breed**:</span>
<span id="cb163-1336"><a href="#cb163-1336" aria-hidden="true" tabindex="-1"></a><span class="ss">   - </span>Count of pigs per breed</span>
<span id="cb163-1337"><a href="#cb163-1337" aria-hidden="true" tabindex="-1"></a><span class="ss">   - </span>Mean ADG (both periods) per breed</span>
<span id="cb163-1338"><a href="#cb163-1338" aria-hidden="true" tabindex="-1"></a><span class="ss">   - </span>SD of ADG per breed</span>
<span id="cb163-1339"><a href="#cb163-1339" aria-hidden="true" tabindex="-1"></a><span class="ss">   - </span>Min and max day 56 weight per breed</span>
<span id="cb163-1340"><a href="#cb163-1340" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb163-1341"><a href="#cb163-1341" aria-hidden="true" tabindex="-1"></a><span class="ss">3. </span>**Summaries by feed type AND sex**:</span>
<span id="cb163-1342"><a href="#cb163-1342" aria-hidden="true" tabindex="-1"></a><span class="ss">   - </span>Count per combination</span>
<span id="cb163-1343"><a href="#cb163-1343" aria-hidden="true" tabindex="-1"></a><span class="ss">   - </span>Mean day 56 weight</span>
<span id="cb163-1344"><a href="#cb163-1344" aria-hidden="true" tabindex="-1"></a><span class="ss">   - </span>Proportion in each performance category</span>
<span id="cb163-1345"><a href="#cb163-1345" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb163-1346"><a href="#cb163-1346" aria-hidden="true" tabindex="-1"></a><span class="ss">4. </span>**Summaries by performance category**:</span>
<span id="cb163-1347"><a href="#cb163-1347" aria-hidden="true" tabindex="-1"></a><span class="ss">   - </span>Count per category</span>
<span id="cb163-1348"><a href="#cb163-1348" aria-hidden="true" tabindex="-1"></a><span class="ss">   - </span>Mean ADG in period 2</span>
<span id="cb163-1349"><a href="#cb163-1349" aria-hidden="true" tabindex="-1"></a><span class="ss">   - </span>What proportion of each category is male vs female?</span>
<span id="cb163-1350"><a href="#cb163-1350" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb163-1351"><a href="#cb163-1351" aria-hidden="true" tabindex="-1"></a>**Hint**: Use <span class="in">`group_by()`</span> + <span class="in">`summarise()`</span> for each question. You may need <span class="in">`across()`</span> for multiple columns.</span>
<span id="cb163-1352"><a href="#cb163-1352" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb163-1353"><a href="#cb163-1353" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Part 4: Complex Pipeline (20 points)</span></span>
<span id="cb163-1354"><a href="#cb163-1354" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb163-1355"><a href="#cb163-1355" aria-hidden="true" tabindex="-1"></a>Create ONE pipeline that:</span>
<span id="cb163-1356"><a href="#cb163-1356" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb163-1357"><a href="#cb163-1357" aria-hidden="true" tabindex="-1"></a><span class="ss">1. </span>Starts with the raw data</span>
<span id="cb163-1358"><a href="#cb163-1358" aria-hidden="true" tabindex="-1"></a><span class="ss">2. </span>Removes any pigs with missing weight measurements</span>
<span id="cb163-1359"><a href="#cb163-1359" aria-hidden="true" tabindex="-1"></a><span class="ss">3. </span>Calculates all new variables from Part 1</span>
<span id="cb163-1360"><a href="#cb163-1360" aria-hidden="true" tabindex="-1"></a><span class="ss">4. </span>Creates categories from Part 2</span>
<span id="cb163-1361"><a href="#cb163-1361" aria-hidden="true" tabindex="-1"></a><span class="ss">5. </span>Filters to pigs with birth_weight_class == "Normal"</span>
<span id="cb163-1362"><a href="#cb163-1362" aria-hidden="true" tabindex="-1"></a><span class="ss">6. </span>Filters to feed_type "A" or "B" only</span>
<span id="cb163-1363"><a href="#cb163-1363" aria-hidden="true" tabindex="-1"></a><span class="ss">7. </span>Groups by feed_type and sex</span>
<span id="cb163-1364"><a href="#cb163-1364" aria-hidden="true" tabindex="-1"></a><span class="ss">8. </span>Calculates mean day 56 weight and ADG for period 2</span>
<span id="cb163-1365"><a href="#cb163-1365" aria-hidden="true" tabindex="-1"></a><span class="ss">9. </span>Arranges by mean day 56 weight (descending)</span>
<span id="cb163-1366"><a href="#cb163-1366" aria-hidden="true" tabindex="-1"></a><span class="ss">10. </span>Adds a rank column</span>
<span id="cb163-1367"><a href="#cb163-1367" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb163-1368"><a href="#cb163-1368" aria-hidden="true" tabindex="-1"></a>Show:</span>
<span id="cb163-1369"><a href="#cb163-1369" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>The complete pipeline (with comments explaining each step)</span>
<span id="cb163-1370"><a href="#cb163-1370" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>The final output</span>
<span id="cb163-1371"><a href="#cb163-1371" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>How many rows in the final result?</span>
<span id="cb163-1372"><a href="#cb163-1372" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb163-1373"><a href="#cb163-1373" aria-hidden="true" tabindex="-1"></a><span class="fu">### Recommended YAML</span></span>
<span id="cb163-1374"><a href="#cb163-1374" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb163-1375"><a href="#cb163-1375" aria-hidden="true" tabindex="-1"></a><span class="in">```yaml</span></span>
<span id="cb163-1376"><a href="#cb163-1376" aria-hidden="true" tabindex="-1"></a><span class="pp">---</span></span>
<span id="cb163-1377"><a href="#cb163-1377" aria-hidden="true" tabindex="-1"></a><span class="fu">title</span><span class="kw">:</span><span class="at"> </span><span class="st">"Week 4 Homework: Data Manipulation with dplyr"</span></span>
<span id="cb163-1378"><a href="#cb163-1378" aria-hidden="true" tabindex="-1"></a><span class="fu">author</span><span class="kw">:</span><span class="at"> </span><span class="st">"Your Name"</span></span>
<span id="cb163-1379"><a href="#cb163-1379" aria-hidden="true" tabindex="-1"></a><span class="fu">date</span><span class="kw">:</span><span class="at"> today</span></span>
<span id="cb163-1380"><a href="#cb163-1380" aria-hidden="true" tabindex="-1"></a><span class="fu">format</span><span class="kw">:</span></span>
<span id="cb163-1381"><a href="#cb163-1381" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">html</span><span class="kw">:</span></span>
<span id="cb163-1382"><a href="#cb163-1382" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">toc</span><span class="kw">:</span><span class="at"> </span><span class="ch">true</span></span>
<span id="cb163-1383"><a href="#cb163-1383" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">toc-depth</span><span class="kw">:</span><span class="at"> </span><span class="dv">3</span></span>
<span id="cb163-1384"><a href="#cb163-1384" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">code-fold</span><span class="kw">:</span><span class="at"> </span><span class="ch">false</span></span>
<span id="cb163-1385"><a href="#cb163-1385" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">theme</span><span class="kw">:</span><span class="at"> cosmo</span></span>
<span id="cb163-1386"><a href="#cb163-1386" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">embed-resources</span><span class="kw">:</span><span class="at"> </span><span class="ch">true</span></span>
<span id="cb163-1387"><a href="#cb163-1387" aria-hidden="true" tabindex="-1"></a><span class="fu">execute</span><span class="kw">:</span></span>
<span id="cb163-1388"><a href="#cb163-1388" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">warning</span><span class="kw">:</span><span class="at"> </span><span class="ch">false</span></span>
<span id="cb163-1389"><a href="#cb163-1389" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">message</span><span class="kw">:</span><span class="at"> </span><span class="ch">false</span></span>
<span id="cb163-1390"><a href="#cb163-1390" aria-hidden="true" tabindex="-1"></a><span class="pp">---</span></span>
<span id="cb163-1391"><a href="#cb163-1391" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb163-1392"><a href="#cb163-1392" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb163-1393"><a href="#cb163-1393" aria-hidden="true" tabindex="-1"></a><span class="fu">### Grading Rubric</span></span>
<span id="cb163-1394"><a href="#cb163-1394" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb163-1395"><a href="#cb163-1395" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Part 1: Creating Variables (25%)**:</span>
<span id="cb163-1396"><a href="#cb163-1396" aria-hidden="true" tabindex="-1"></a><span class="ss">  - </span>All variables created correctly (15%)</span>
<span id="cb163-1397"><a href="#cb163-1397" aria-hidden="true" tabindex="-1"></a><span class="ss">  - </span>Proper use of <span class="in">`mutate()`</span> (5%)</span>
<span id="cb163-1398"><a href="#cb163-1398" aria-hidden="true" tabindex="-1"></a><span class="ss">  - </span>Rounding applied correctly (5%)</span>
<span id="cb163-1399"><a href="#cb163-1399" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb163-1400"><a href="#cb163-1400" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Part 2: Conditional Logic (25%)**:</span>
<span id="cb163-1401"><a href="#cb163-1401" aria-hidden="true" tabindex="-1"></a><span class="ss">  - </span>Performance category correct (10%)</span>
<span id="cb163-1402"><a href="#cb163-1402" aria-hidden="true" tabindex="-1"></a><span class="ss">  - </span>Treatment recommendation correct (8%)</span>
<span id="cb163-1403"><a href="#cb163-1403" aria-hidden="true" tabindex="-1"></a><span class="ss">  - </span>Needs attention logic correct (7%)</span>
<span id="cb163-1404"><a href="#cb163-1404" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb163-1405"><a href="#cb163-1405" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Part 3: Grouped Summaries (30%)**:</span>
<span id="cb163-1406"><a href="#cb163-1406" aria-hidden="true" tabindex="-1"></a><span class="ss">  - </span>Overall summaries (8%)</span>
<span id="cb163-1407"><a href="#cb163-1407" aria-hidden="true" tabindex="-1"></a><span class="ss">  - </span>Breed summaries (8%)</span>
<span id="cb163-1408"><a href="#cb163-1408" aria-hidden="true" tabindex="-1"></a><span class="ss">  - </span>Feed/sex summaries (7%)</span>
<span id="cb163-1409"><a href="#cb163-1409" aria-hidden="true" tabindex="-1"></a><span class="ss">  - </span>Performance category summaries (7%)</span>
<span id="cb163-1410"><a href="#cb163-1410" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb163-1411"><a href="#cb163-1411" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Part 4: Complex Pipeline (20%)**:</span>
<span id="cb163-1412"><a href="#cb163-1412" aria-hidden="true" tabindex="-1"></a><span class="ss">  - </span>Pipeline executes correctly (12%)</span>
<span id="cb163-1413"><a href="#cb163-1413" aria-hidden="true" tabindex="-1"></a><span class="ss">  - </span>All steps included (5%)</span>
<span id="cb163-1414"><a href="#cb163-1414" aria-hidden="true" tabindex="-1"></a><span class="ss">  - </span>Clear comments and documentation (3%)</span>
<span id="cb163-1415"><a href="#cb163-1415" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb163-1416"><a href="#cb163-1416" aria-hidden="true" tabindex="-1"></a><span class="fu">### Bonus (10 points)</span></span>
<span id="cb163-1417"><a href="#cb163-1417" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb163-1418"><a href="#cb163-1418" aria-hidden="true" tabindex="-1"></a><span class="ss">1. </span>**Window functions**:</span>
<span id="cb163-1419"><a href="#cb163-1419" aria-hidden="true" tabindex="-1"></a><span class="ss">   - </span>For each pig, calculate the difference between their day 56 weight and the breed average day 56 weight</span>
<span id="cb163-1420"><a href="#cb163-1420" aria-hidden="true" tabindex="-1"></a><span class="ss">   - </span>Rank pigs within their breed by day 56 weight</span>
<span id="cb163-1421"><a href="#cb163-1421" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb163-1422"><a href="#cb163-1422" aria-hidden="true" tabindex="-1"></a><span class="ss">2. </span>**Advanced grouping**:</span>
<span id="cb163-1423"><a href="#cb163-1423" aria-hidden="true" tabindex="-1"></a><span class="ss">   - </span>Identify the top 3 breeds by mean ADG in period 2</span>
<span id="cb163-1424"><a href="#cb163-1424" aria-hidden="true" tabindex="-1"></a><span class="ss">   - </span>For just those breeds, create a detailed summary with all statistics</span>
<span id="cb163-1425"><a href="#cb163-1425" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb163-1426"><a href="#cb163-1426" aria-hidden="true" tabindex="-1"></a>---</span>
<span id="cb163-1427"><a href="#cb163-1427" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb163-1428"><a href="#cb163-1428" aria-hidden="true" tabindex="-1"></a><span class="fu">## Additional Resources</span></span>
<span id="cb163-1429"><a href="#cb163-1429" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb163-1430"><a href="#cb163-1430" aria-hidden="true" tabindex="-1"></a><span class="fu">### Required Reading</span></span>
<span id="cb163-1431"><a href="#cb163-1431" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb163-1432"><a href="#cb163-1432" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span><span class="co">[</span><span class="ot">R for Data Science (2e)</span><span class="co">](https://r4ds.hadley.nz/)</span> - Chapters 3-5: Data transformation</span>
<span id="cb163-1433"><a href="#cb163-1433" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span><span class="co">[</span><span class="ot">dplyr documentation</span><span class="co">](https://dplyr.tidyverse.org/)</span></span>
<span id="cb163-1434"><a href="#cb163-1434" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span><span class="co">[</span><span class="ot">dplyr vignettes</span><span class="co">](https://dplyr.tidyverse.org/articles/dplyr.html)</span> - Introduction to dplyr</span>
<span id="cb163-1435"><a href="#cb163-1435" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb163-1436"><a href="#cb163-1436" aria-hidden="true" tabindex="-1"></a><span class="fu">### Optional Reading</span></span>
<span id="cb163-1437"><a href="#cb163-1437" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb163-1438"><a href="#cb163-1438" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Wickham, H., et al. (2019). "Welcome to the Tidyverse." *Journal of Open Source Software*, 4(43), 1686. <span class="co">[</span><span class="ot">Link</span><span class="co">](https://joss.theoj.org/papers/10.21105/joss.01686)</span></span>
<span id="cb163-1439"><a href="#cb163-1439" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span><span class="co">[</span><span class="ot">Programming with dplyr</span><span class="co">](https://dplyr.tidyverse.org/articles/programming.html)</span> - Advanced techniques</span>
<span id="cb163-1440"><a href="#cb163-1440" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span><span class="co">[</span><span class="ot">Row-wise operations</span><span class="co">](https://dplyr.tidyverse.org/articles/rowwise.html)</span> - Working row-by-row</span>
<span id="cb163-1441"><a href="#cb163-1441" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb163-1442"><a href="#cb163-1442" aria-hidden="true" tabindex="-1"></a><span class="fu">### Videos</span></span>
<span id="cb163-1443"><a href="#cb163-1443" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb163-1444"><a href="#cb163-1444" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>"Data Manipulation in R" by StatQuest with Josh Starmer</span>
<span id="cb163-1445"><a href="#cb163-1445" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>"dplyr Tutorial" by RStudio / Posit</span>
<span id="cb163-1446"><a href="#cb163-1446" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>"Tidy Data and tidyr" by RStudio / Posit</span>
<span id="cb163-1447"><a href="#cb163-1447" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>"grouped operations in dplyr" by Data Science Dojo</span>
<span id="cb163-1448"><a href="#cb163-1448" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb163-1449"><a href="#cb163-1449" aria-hidden="true" tabindex="-1"></a><span class="fu">### Cheat Sheets</span></span>
<span id="cb163-1450"><a href="#cb163-1450" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb163-1451"><a href="#cb163-1451" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span><span class="co">[</span><span class="ot">dplyr Cheat Sheet</span><span class="co">](https://rstudio.github.io/cheatsheets/data-transformation.pdf)</span></span>
<span id="cb163-1452"><a href="#cb163-1452" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span><span class="co">[</span><span class="ot">tidyr Cheat Sheet</span><span class="co">](https://rstudio.github.io/cheatsheets/tidyr.pdf)</span></span>
<span id="cb163-1453"><a href="#cb163-1453" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb163-1454"><a href="#cb163-1454" aria-hidden="true" tabindex="-1"></a><span class="fu">### Interactive Learning</span></span>
<span id="cb163-1455"><a href="#cb163-1455" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb163-1456"><a href="#cb163-1456" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span><span class="co">[</span><span class="ot">dplyr exercises on R for Data Science</span><span class="co">](https://r4ds.hadley.nz/)</span></span>
<span id="cb163-1457"><a href="#cb163-1457" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span><span class="co">[</span><span class="ot">RStudio Primers: Work with Data</span><span class="co">](https://posit.cloud/learn/primers/2)</span></span>
<span id="cb163-1458"><a href="#cb163-1458" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb163-1459"><a href="#cb163-1459" aria-hidden="true" tabindex="-1"></a><span class="fu">### Useful Websites</span></span>
<span id="cb163-1460"><a href="#cb163-1460" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb163-1461"><a href="#cb163-1461" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span><span class="co">[</span><span class="ot">Tidyverse</span><span class="co">](https://www.tidyverse.org/)</span> - Main tidyverse homepage</span>
<span id="cb163-1462"><a href="#cb163-1462" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span><span class="co">[</span><span class="ot">Stack Overflow: dplyr</span><span class="co">](https://stackoverflow.com/questions/tagged/dplyr)</span> - Q&amp;A community</span>
<span id="cb163-1463"><a href="#cb163-1463" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span><span class="co">[</span><span class="ot">RStudio Community</span><span class="co">](https://community.rstudio.com/)</span> - Friendly help forum</span>
<span id="cb163-1464"><a href="#cb163-1464" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span><span class="co">[</span><span class="ot">dplyr GitHub</span><span class="co">](https://github.com/tidyverse/dplyr)</span> - Source code and issues</span>
<span id="cb163-1465"><a href="#cb163-1465" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb163-1466"><a href="#cb163-1466" aria-hidden="true" tabindex="-1"></a>---</span>
<span id="cb163-1467"><a href="#cb163-1467" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb163-1468"><a href="#cb163-1468" aria-hidden="true" tabindex="-1"></a>**Next Chapter**: <span class="co">[</span><span class="ot">Introduction to Data Visualization with ggplot2</span><span class="co">](ch05-ggplot2_intro.qmd)</span></span>
</code></pre></div><button title="Copy to Clipboard" class="code-copy-button" data-in-quarto-modal=""><i class="bi"></i></button></div>
</div></div></div></div></div>
</div> <!-- /content -->




</body></html>